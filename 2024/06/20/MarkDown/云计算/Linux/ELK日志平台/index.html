<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>ELK | AYO</title><meta name="keywords" content="Linux,Database,ELK"><meta name="author" content="AYO,2609320892@qq.com"><meta name="copyright" content="AYO"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="ELK"><meta name="application-name" content="ELK"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="ELK"><meta property="og:url" content="https://www.yuki.love/2024/06/20/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/ELK%E6%97%A5%E5%BF%97%E5%B9%B3%E5%8F%B0/index.html"><meta property="og:site_name" content="AYO"><meta property="og:description" content="本文介绍了ELK的相关知识。"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://pic4.zhimg.com/v2-c2b3eb3319d52218753d0ce20bc7c100_r.jpg?_r_=6c3f9f4e-576c-c6b6-dcee-92acc2517142"><meta property="article:author" content="AYO"><meta property="article:tag" content=""><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://pic4.zhimg.com/v2-c2b3eb3319d52218753d0ce20bc7c100_r.jpg?_r_=6c3f9f4e-576c-c6b6-dcee-92acc2517142"><meta name="description" content="本文介绍了ELK的相关知识。"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://www.yuki.love/2024/06/20/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/ELK%E6%97%A5%E5%BF%97%E5%B9%B3%E5%8F%B0/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: undefined,
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: 'https://twikoo.yuki.love',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: undefined,
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","🤝 专修交互与设计","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},
  algolia: {"appId":"XMRZIUY8NL","apiKey":"187af2610e1cc500c95dc8b8f3a53d0e","indexName":"hexo","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: AYO","link":"链接: ","source":"来源: AYO","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'AYO',
  title: 'ELK',
  postAI: '',
  pageFillDescription: '1.ELK架构介绍, 2.环境安装, 1.安装JDK, 2.安装Elasticsearch, 3.安装Kibana, 4.安装Head插件, 5.YUM安装, 1.集群的健康值检查, 3.核心概念, 1.倒排索引, 1.FOR压缩算法, 2.RBM压缩算法, 3.FST压缩算法, 2.tip和tim文件内部结构, , 3.FSt在Lucene中的构建和读取过程, 4.集群、节点和分片, 4.索引的CRUD, 5.Mapping, 1.概念, 2.查看mapping, 3.ES数据类型, 4.两种映射类型, 5.映射参数, 6.搜索和查询, 1.相关度评分, 2.元数据_source, 3.Query String, 4.全文检索：match, 5.精准匹配：exact match, 6.过滤器, 7.组合查询：bool query, 7.分词器, 1.使用分词器查看分词结果, 2.normalization, 3.字符过滤器, 4.令牌过滤器：token filter, 5.分词器：tokenizer, 6.中文分词器, 7.关于热更新, 1.关于远程词库的热更新, 2.关于基于数据库的热更新, 8.聚合查询：Aggregation, 1.基础聚合, 1.分桶聚合(Bucket agregations), 2.指标聚合(Metrics agregations), 3.管道聚合(Pipeline agregation), 2.嵌套聚合：基于聚合结果的聚合, 3.基于查询结果的聚合和基于聚合结果的查询, 4.聚合排序, 5.常见的聚合函数, 1.histogram, 2.percentile, 9.脚本查询Scripting, 1.概念, 2.基础使用, 3.scripting的CURD, 1.修改新增, 2.删除, 3.查询, 4.参数化脚本, 5.scripts模板, 6.函数式编程, 7.doc[‘field’].value和params[‘_source’][‘field’]区别, 10.索引的批量操作, 1.基于mget的批量查询, 2.文档的操作类型, 3.基于_bulk的增删改, 11.模糊查询, 1.prefix：前缀搜索, 2.wildcard：通配符, 3.regexp：正则表达式, 4.fuzzy模糊查询, 5.match_phrase_prefix：短语前缀, 6.ngram和edge-ngram, 12.搜索推荐, 1.Term Suggester, 2.phrase suggester, 3.completion suggester, 4.Context Suggester, 13.数据建模, 1.嵌套类型查询：Nested, 2.父子级关系查询：Join, 3.数据建模, 14.es客户端, 15.Elasticsearch分布式原理, 1.单机服务有哪些问题？, 2.分布式的好处架构介绍是一个应用套件是和的缩写是一种流行的开源日志管理解决方案是一个分布式搜索和分析引擎是一个用于收集处理和转发日志的工具是一个用于可视化数据的工具是一套开源免费功能强大的日志分析管理系统可以将系统日志网站日志应用系统日志等各种日志进行收集过滤清洗如何进行集中存放并可用于实时检索分析是一个实时的分布式搜索和分析引擎它可以用于全文搜索结构化搜索以及分析采用语言编写是一个搜索引擎类的数据库实时搜索实时分析分布式架构实时文件存储并将每一个字段都编入索引文档导向所有的对象都是文档高可用性易拓展支持集群分片和复制接口友好支持是一款轻量级的开源的日志收集处理框架它可以方便的把分散的多样化的日志搜集起来并进行自定义过滤分析处理然后传输到指定的位置比如某个服务器或者文件采用语言编写数据收集数据加工如过滤改写等数据输出是一个开源的数据分析可视化平台使用可以为和提供的日志数据进行高效的搜索可视化汇总和多维度分析还可以与搜索引擎中的数据进行交互它基于浏览器的界面操作可以快速创建动态仪表板实时监控的数据状态与更改环境安装安装安装可以使用运行修改文件添加如下内容修改文件添加如下内容修改文件将如下内容修改为修改文件添加如下内容集群名称节点名称主节点信息数据存放路径日志存放路径这两个最好设置在的安装目录之外避免更新覆盖数据所有可以访问输出至服务器最多有几个可参与主节点选举安装注意版本需求需要跟配合修改指定端口修改服务地址指定地址指定索引修改为中文配置秘钥启动启动之前必须启动可以使用启动安装插件添加环境变量安装依赖库直接安装也行安装在编辑器中添加以下内容保存并退出编辑器然后运行以下命令集群的健康值检查集群名称集群健康状态指示集群是否有操作超时集群中的节点数量集群中的数据节点数量当前活跃的主分片数量当前活跃的分片数量迁移分片初始化分片未分配分片延迟未分配的分片数量在等待中的任务数量正在进行中的获取任务数量任务等待队列的最大等待时间活跃分片的百分比核心概念什么是搜索引擎全文搜索引擎自然语言处理爬虫网页处理大数据处理如谷歌百度等等垂直搜索引擎有明确搜索目的的搜索行为如各大电商网站站内搜索视频网站等搜索引擎应该具备那些要求查询速度快高效的压缩算法快速的编码和解码速度结果准确检索结果丰富召回率索引帮助快速检索以数据结构为载体以文件的形式落地是一个成熟的全文检索库由语言编写具有高性能可伸缩的特点并且开源免费全文检索索引系统通过扫描文章中的每一个词对其创建索引指明在文章中出现的次数和位置当用户查询时索引系统就会根据实现建立的索引进行查找并将查找的结果反馈给用户的检索方式倒排索引倒排索引是一种数据库索引用于存储从内容到文档的映射使用倒排索引可以很好的支持全文搜索被广泛应用于信息检索搜索引擎数据库中倒排索引是实现单词文档矩阵的一种具体存储形式通过倒排索引可以根据单词快速获取包含这个单词的文档列表倒排索引的原理是将文档中的每个单词映射到包含该单词的所有文档的列表中然后用该列表替换单词倒排索引在文本搜索和信息检索中广泛应用如搜索引擎网站搜索文本分类等场景中具体来说一个倒排索引包含一个词语词典和每个词语对应的倒排列表倒排列表中记录了包含该词语的所有文档的编号词频等信息这让我们能够在的时间内判断某个文档是否包含某个词而且还可以基于词频相关度等统计信息进行搜索结果排序压缩算法压缩算法压缩算法为什么要安装的字典序处理为了生成最小化的的数据结构前缀树前缀树又称字典树是一种树形结构是一种哈希树的变种它的典型应用是用于统计和排序大量的字符串但不仅限于字符串所以经常被搜索引擎系统用于文本词频统计前缀树的每一个节点代表一个字符串前缀每一个节点会有多个子节点通往不同子节点的路径上有着不同的字符子节点代表的字符串是由节点到根节点路径上所有字符连接起来的字符串前缀树的主要优点是可以最大限度地减少无谓的字符串比较查询效率比哈希表高前缀树常用于搜索提示自动补全拼写检查等场景中和文件内部结构在中的构建和读取过程集群节点和分片节点每个节点就是一个实例一个节点一台服务器分片一个索引包含一个或多个分片在之前默认五个主分片每个主分片一个副本在之后默认一个主分片副本可以在索引创建之后修改数量但是主分片的数量一旦确认不可修改只能创建索引每个分片都是一个实例有完整的创建索引和处理请求的能力会自动在上做分片均衡一个不可能同时存在于多个主分片中但是当每个主分片的副本数量不为一时可以同时存在与多个副本中每个主分片和其副本分片不能同时存在与同一个节点上所以最低的可用配置是两个节点互为主备集群原生分布式一个节点一台服务器索引的查看一个索引的全部信息查看索引的具体某条信息修改具体索引中的值删除具体索引中的值概念概念映射是定义文档及其包含的字段的存储和索引方式的过程优点类似于中表结构的概念在中包含一些属性比如字段名称类型字段使用的分词器是否评分是否创建索引等属性并且在中一个字段可以有对应类型两种映射方式动态映射或自动映射静态映射或手工映射或显示映射查看数据类型两种映射类型为数据类型数据自动创建一个类型里面包含一个用于基准匹配且默认长度为手动映射手工创建的只能创建无法修改映射参数搜索和查询相关度评分未指定排序字段时会按照评分进行排序元数据发生冲突时以为准查询所有带参数分页精准匹配搜索相当于在所有有索引字段中检索如果设置字段不设置索引那么就不会搜索该字段全文检索全文检索过滤器精准匹配组合查询全文检索全文搜索也被称为全文检索关键词搜索是一种能对文档进行搜索的技术它的主要特点是用户可以输入一个或多个关键词搜索结果返回所有包含这些关键词的文档匹配任意分词在多个字段里搜索任一词项在字段里包含全部词项精准匹配给当前时区加小时匹配点以天为单位过滤器和的主要区别在是结果导向的而是过程导向倾向于当前文档和查询的语句的相关度而倾向于当前文档和查询的条件是不是相符即在查询过程中是要对查询的每个结果计算相关性得分的而不会另外有相应的缓存机制可以提高查询效率组合查询组合查询如果一个组合查询中字句遇上或子句那么它的判定条件会变为如果不想这样在子句中添加让他至少满足一个条件先使用提升性能分词器规范化字符过滤器分词器令牌过滤器使用分词器查看分词结果结果文档规范化提高召回率停用词时态转换大小写同义词语气词字符过滤器分词之前的预处理过滤无用字符测试数据保留的标签结果滚垃圾你就是个垃圾滚结果你就是个结果令牌过滤器停用词时态转换大小写转换同义词转换语气词处理等的令牌过滤器和字符过滤器是用于分析器的两种过滤器字符过滤器用于在将字符流传递给分词器之前对其进行预处理将原始文本作为字符流接收并可以通过添加删除或更改字符来转换流而令牌过滤器则是在分词器生成单词后对单词进行进一步的处理如删除停用词同义词转换等等分词器切词常见分词器默认分词器中文支持的不理想会逐字拆分以正则匹配分隔符把文本拆分成若干词项以正则匹配词项速度比快以空白符分隔自定义分词器自定义分析器中文分词器地址关于热更新关于远程词库的热更新关于基于数据库的热更新聚合查询基础聚合语法小米手机手机中的战斗机旗舰机手机性价比发烧不卡顿手机手机中的轰炸机高端机手机性价比快充门禁卡挨炮除了一无是处旗舰机手机割韭菜割韭菜割新韭菜分桶聚合分桶聚合统计不同标签的商品数量结果不卡顿割新韭菜割韭菜发烧快充门禁卡性价比指标聚合指标聚合统计最贵最便宜和平均价格结果管道聚合管道聚合统计平均价格最低的商品分类结果性价比不卡顿割新韭菜割韭菜发烧快充门禁卡快充门禁卡嵌套聚合基于聚合结果的聚合嵌套聚合统计每个商品类型中不同档次分类商品中平均价格最低的档次基于查询结果的聚合和基于聚合结果的查询基于查询结果的聚合基于查询结果的聚合手机基于聚合结果的查询用来看聚合的详细信息手机结果小米手机手机中的战斗机旗舰机手机性价比发烧不卡顿手机手机中的轰炸机高端机手机性价比快充门禁卡挨炮除了一无是处旗舰机手机割韭菜割韭菜割新韭菜手机玩具截断查询条件基于查询结果的聚合如果这里用此后查询条件会是这个查询条件和上面那个查询的集合聚合排序手机玩具结果手机玩具常见的聚合函数使用使用改变形式显示的最小值对字段空值赋予默认值扩展显示数据完全显示月的数据进行累加操作根据来自动设置结果结果脚本查询概念是支持的一种专门用于复杂场景下支持自定义编程的强大的脚本功能支持多种脚本语言如其语法类似于也有注释关键字类型变量函数等其相对于其他脚本高出几倍性能并且安全可靠可以用于内联合存储脚本语法基础使用表示上下文的备份数据修改新增无线充电如果有这条数据就修改没有就新增下面那条语句删除查询查询参数化脚本在执行脚本之前需要编译脚本这是一个相对耗时的操作为了提高性能可以使用参数来避免编译脚本参数可以在脚本中使用它允许你在执行脚本时传递参数而不是在脚本中写死参数值这样如果脚本只是参数值不同就可以避免重复编译脚本从而提高性能参数化脚本无线充电快充模板会把模板保存在集群的缓存中创建模板查看模板使用脚本函数式编程小米统计所有价格小于的商品的数量和区别和都只能查询中的数据在中和都是用于访问文档字段的方式但是它们之间有一些区别是一种更快的方式它将字段的术语加载到内存中以便脚本可以更快地访问它们但是它只能访问简单字段值例如数字或字符串是一种更通用的方式它可以访问复杂字段值例如嵌套对象或数组但是它比慢因为它需要从磁盘中加载整个文档并解析格式索引的批量操作基于的批量查询文档的操作类型自动生成懒删除全量或增量更新全量可以是创建也可以是全量替换只输出错误的信息基于的增删改传统的增删改都要在内存中序列化成对象而是用不消耗额外内存模糊查询前缀搜索通配符正则表达式模糊查询也可用使用模糊查询但是是分词的是不分词的短语前缀是分片级别的限制和默认的和分别是和都是可以在前缀中缀后缀都能使用只能在前缀使用结果结果搜索推荐在使用之前需要定义一个特定的使用之前先创建使用之前也必须创建数据建模嵌套类型查询父子级关系查询使用指定分片数据建模客户端分布式原理单机服务有哪些问题性能有限可用性差难以扩展分布式的好处高可用性集群可容忍部分节点宕机而保持服务的可用性和数据的完整性易扩展性当集群的性能不满足业务要求时可以方便快速的扩容集群而无需停止服务高性能集群通过负载均衡器分摊并发请求压力可以大大提高集群的吞吐能力和并发能力',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-02-17 16:22:58',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.0.0"><link rel="alternate" href="/atom.xml" title="AYO" type="application/atom+xml">
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://git.yuki.love/" title="AYO网站"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="AYO网站"/><span class="back-menu-item-text">AYO网站</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://juejin.cn/user/3708003152300183" title="AYO博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="AYO博客"/><span class="back-menu-item-text">AYO博客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/AYO-Al" title="GitHub"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="GitHub"/><span class="back-menu-item-text">GitHub</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">AYO</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Ansible/" style="font-size: 1.05rem;">Ansible<sup>1</sup></a><a href="/tags/CDN/" style="font-size: 1.05rem;">CDN<sup>1</sup></a><a href="/tags/DNS/" style="font-size: 1.05rem;">DNS<sup>1</sup></a><a href="/tags/Database/" style="font-size: 1.05rem;">Database<sup>8</sup></a><a href="/tags/Docker/" style="font-size: 1.05rem;">Docker<sup>1</sup></a><a href="/tags/ELK/" style="font-size: 1.05rem;">ELK<sup>1</sup></a><a href="/tags/Flask/" style="font-size: 1.05rem;">Flask<sup>1</sup></a><a href="/tags/Httpd/" style="font-size: 1.05rem;">Httpd<sup>1</sup></a><a href="/tags/JavaScript/" style="font-size: 1.05rem;">JavaScript<sup>1</sup></a><a href="/tags/Keepalived/" style="font-size: 1.05rem;">Keepalived<sup>1</sup></a><a href="/tags/LVS/" style="font-size: 1.05rem;">LVS<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 1.05rem;">Linux<sup>22</sup></a><a href="/tags/MLinux/" style="font-size: 1.05rem;">MLinux<sup>1</sup></a><a href="/tags/MySQL/" style="font-size: 1.05rem;">MySQL<sup>6</sup></a><a href="/tags/Nginx/" style="font-size: 1.05rem;">Nginx<sup>3</sup></a><a href="/tags/Prometheus/" style="font-size: 1.05rem;">Prometheus<sup>1</sup></a><a href="/tags/Python/" style="font-size: 1.05rem;">Python<sup>8</sup></a><a href="/tags/Rabbit/" style="font-size: 1.05rem;">Rabbit<sup>1</sup></a><a href="/tags/Redis/" style="font-size: 1.05rem;">Redis<sup>2</sup></a><a href="/tags/Shell/" style="font-size: 1.05rem;">Shell<sup>3</sup></a><a href="/tags/Web/" style="font-size: 1.05rem;">Web<sup>2</sup></a><a href="/tags/Zabbix/" style="font-size: 1.05rem;">Zabbix<sup>2</sup></a><a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 1.05rem;">中间件<sup>1</sup></a><a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" style="font-size: 1.05rem;">云计算<sup>7</sup></a><a href="/tags/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" style="font-size: 1.05rem;">反向代理<sup>1</sup></a><a href="/tags/%E5%9B%9B%E5%A4%A7%E4%BB%B6/" style="font-size: 1.05rem;">四大件<sup>3</sup></a><a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 1.05rem;">开发<sup>7</sup></a><a href="/tags/%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB%E6%9C%8D%E5%8A%A1/" style="font-size: 1.05rem;">文件共享服务<sup>1</sup></a><a href="/tags/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" style="font-size: 1.05rem;">文件系统<sup>1</sup></a><a href="/tags/%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/" style="font-size: 1.05rem;">日志管理<sup>1</sup></a><a href="/tags/%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5/" style="font-size: 1.05rem;">时间同步<sup>1</sup></a><a href="/tags/%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/" style="font-size: 1.05rem;">服务管理<sup>1</sup></a><a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 1.05rem;">爬虫<sup>4</sup></a><a href="/tags/%E7%9B%91%E6%8E%A7/" style="font-size: 1.05rem;">监控<sup>3</sup></a><a href="/tags/%E7%A3%81%E7%9B%98/" style="font-size: 1.05rem;">磁盘<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 1.05rem;">网络<sup>4</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E6%9E%B6%E6%9E%84/" style="font-size: 1.05rem;">网络架构<sup>1</sup></a><a href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/" style="font-size: 1.05rem;">自动化运维<sup>1</sup></a><a href="/tags/%E8%BD%AF%E4%BB%B6%E7%AE%A1%E7%90%86/" style="font-size: 1.05rem;">软件管理<sup>1</sup></a><a href="/tags/%E9%98%B2%E7%81%AB%E5%A2%99/" style="font-size: 1.05rem;">防火墙<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">三月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/12/"><span class="card-archive-list-date">十二月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">十一月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/10/"><span class="card-archive-list-date">十月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux/" itemprop="url">Linux</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Linux/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Linux</span></a><a class="article-meta__tags" href="/tags/Database/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Database</span></a><a class="article-meta__tags" href="/tags/ELK/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>ELK</span></a></span></div></div><h1 class="post-title" itemprop="name headline">ELK</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-06-19T16:00:00.000Z" title="发表于 2024-06-20 00:00:00">2024-06-20</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-02-17T08:22:58.982Z" title="更新于 2024-02-17 16:22:58">2024-02-17</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">10.3k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>50分钟</span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为长沙"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>长沙</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://pic4.zhimg.com/v2-c2b3eb3319d52218753d0ce20bc7c100_r.jpg?_r_=6c3f9f4e-576c-c6b6-dcee-92acc2517142"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://www.yuki.love/2024/06/20/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/ELK%E6%97%A5%E5%BF%97%E5%B9%B3%E5%8F%B0/"><header><a class="post-meta-categories" href="/categories/Linux/" itemprop="url">Linux</a><a href="/tags/Linux/" tabindex="-1" itemprop="url">Linux</a><a href="/tags/Database/" tabindex="-1" itemprop="url">Database</a><a href="/tags/ELK/" tabindex="-1" itemprop="url">ELK</a><h1 id="CrawlerTitle" itemprop="name headline">ELK</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">AYO</span><time itemprop="dateCreated datePublished" datetime="2024-06-19T16:00:00.000Z" title="发表于 2024-06-20 00:00:00">2024-06-20</time><time itemprop="dateCreated datePublished" datetime="2024-02-17T08:22:58.982Z" title="更新于 2024-02-17 16:22:58">2024-02-17</time></header><h1 id="1-ELK架构介绍"><a href="#1-ELK架构介绍" class="headerlink" title="1.ELK架构介绍"></a>1.ELK架构介绍</h1><p>ELK是一个应用套件，ELK 是 Elasticsearch、Logstash 和 Kibana 的缩写，是一种流行的开源日志管理解决方案。Elasticsearch 是一个分布式搜索和分析引擎，Logstash 是一个用于收集、处理和转发日志的工具，Kibana 是一个用于可视化 Elasticsearch 数据的工具。</p>
<p>是一套开源免费、功能强大的日志分析管理系统。ELK可以将系统日志、网站日志、应用系统日志等各种日志进行收集、过滤、清洗、如何进行集中存放并可用于实时检索、分析</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/fo2cu2-0.png" alt="image-20230708094728915"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/fp2u6b-0.png" alt="image-20230708094909840"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/fpbvj7-0.png" alt="image-20230708094952089"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/fqbv4c-0.png" alt="image-20230708095119692"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/e5e6xb-0.png" alt="image-20230712085537081"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/o36kfz-0.png" alt="image-20230527145652207"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/fbzr3w-0.png" alt="image-20230708092704346"></p>
<ul>
<li><p>Elasticsearch</p>
<ul>
<li><p>是一个实时的分布式搜索和分析引擎，它可以用于全文搜索，结构化搜索以及分析，采用java语言编写。是一个搜索引擎类的数据库</p>
</li>
<li><p>实时搜索，实时分析</p>
</li>
<li><p>分布式架构、实时文件存储，并将每一个字段都编入索引</p>
</li>
<li><p>文档导向，所有的对象都是文档</p>
</li>
<li><p>高可用性、易拓展、支持集群、分片和复制</p>
</li>
<li><p>接口友好，支持JSON</p>
</li>
</ul>
</li>
<li><p>Logstash</p>
<ul>
<li>是一款轻量级的、开源的日志收集处理框架，它可以方便的把分散的、多样化的日志搜集起来，并进行自定义过滤分析处理，然后传输到指定的位置，比如某个服务器或者文件。Logstash采用JRuby语言编写</li>
<li>input：数据收集</li>
<li>filter：数据加工，如过滤，改写等</li>
<li>output：数据输出</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/o4y21m-0.png" alt="image-20230527145948103"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/oughyk-0.png" alt="image-20230527150233063"></p>
</li>
<li><p>Kibana</p>
<ul>
<li>是一个开源的数据分析可视化平台。使用Kibana可以为Logstash和Elasticsearch提供的日志数据进行高效的搜索、可视化汇总和多维度分析，还可以与Elasticsearch搜索引擎中的数据进行交互。它基于浏览器的界面操作可以快速创建动态仪表板，实时监控Elasticsearch的数据状态与更改</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/oxabx8-0.png" alt="image-20230527150707991"></p>
<h1 id="2-环境安装"><a href="#2-环境安装" class="headerlink" title="2.环境安装"></a>2.环境安装</h1><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/fsas0c-0.png" alt="image-20230708095450667"></p>
<h2 id="1-安装JDK"><a href="#1-安装JDK" class="headerlink" title="1.安装JDK"></a>1.安装JDK</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/fsv2ge-0.png" alt="image-20230708095545188"></p>
<h2 id="2-安装Elasticsearch"><a href="#2-安装Elasticsearch" class="headerlink" title="2.安装Elasticsearch"></a>2.安装Elasticsearch</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/gk4whj-0.png" alt="image-20230708100102553"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -L -O https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.3.2-darwin-x86_64.tar.gz</span><br><span class="line">tar -xvf elasticsearch-7.3.2-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/goszfg-0.png" alt="image-20230708100908493"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./elasticsearch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以使用root运行</span></span><br><span class="line">bin/elasticsearch -Des.insecure.allow.root=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">修改文件/etc/security/limits.conf，添加如下内容：</span><br><span class="line">* soft nofile 65535</span><br><span class="line">* hard nofile 65535</span><br><span class="line"></span><br><span class="line">修改文件/etc/sysctl.conf，添加如下内容：</span><br><span class="line">vm.max_map_count=262144</span><br><span class="line"></span><br><span class="line">修改文件/etc/security/limits.d/20-nproc.conf，将如下内容：</span><br><span class="line">* soft <span class="built_in">nproc</span> 1024</span><br><span class="line"></span><br><span class="line">修改为：</span><br><span class="line">* soft <span class="built_in">nproc</span> 4096</span><br><span class="line"></span><br><span class="line">修改elasticsearch.yml文件，添加如下内容：</span><br><span class="line"></span><br><span class="line">cluster.name: elkcluster <span class="comment">#集群名称</span></span><br><span class="line">node.name: elk    	  <span class="comment">#节点名称</span></span><br><span class="line">cluster.initial_master_nodes: [<span class="string">&quot;elk&quot;</span>] <span class="comment">#主节点信息</span></span><br><span class="line">path.data: /data/es/data       <span class="comment">#数据存放路径</span></span><br><span class="line">path.logs: /data/es/logs       <span class="comment">#日志存放路径，这两个最好设置在Elasticsearch的安装目录之外，避免更新覆盖数据</span></span><br><span class="line">bootstrap.memory_lock: <span class="literal">false</span>   </span><br><span class="line">bootstrap.system_call_filter: <span class="literal">false</span></span><br><span class="line">network.host: 0.0.0.0				<span class="comment">#所有ip可以访问，</span></span><br><span class="line">discovery.seed_hosts: [<span class="string">&quot;elk&quot;</span>] <span class="comment">#输出至elasticsearch服务器</span></span><br><span class="line">discovery.zen.minimum_master_nodes: 2 	<span class="comment">#最多有几个可参与主节点选举</span></span><br><span class="line">http.cors.enabled: <span class="literal">true</span></span><br><span class="line">http.max_initial_line_length: <span class="string">&quot;1024k&quot;</span></span><br><span class="line">http.max_header_size: <span class="string">&quot;1024k&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/gov325-0.png" alt="image-20230709100902148"></p>
<h2 id="3-安装Kibana"><a href="#3-安装Kibana" class="headerlink" title="3.安装Kibana"></a>3.安装Kibana</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/gsnnd7-0.png" alt="image-20230709101558263"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 注意版本需求，需要跟Elasticsearch配合</span></span><br><span class="line">curl -O https://artifacts.elastic.co/downloads/kibana/kibana-7.10.2-linux-x86_64.tar.gz</span><br><span class="line">tar xvf kibana-7.10.2-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 修改config/kibana.yml</span></span><br><span class="line">server.port: 5601 <span class="comment"># 指定端口</span></span><br><span class="line">server.host: <span class="string">&quot;0.0.0.0&quot;</span>  <span class="comment"># 修改服务地址</span></span><br><span class="line">elasticsearch.hosts: [<span class="string">&quot;http://localhost:9200&quot;</span>] <span class="comment"># 指定Elasticsearch地址</span></span><br><span class="line">kibana.index: <span class="string">&quot;.kibana&quot;</span> <span class="comment"># 指定索引</span></span><br><span class="line">i18n.locale: <span class="string">&quot;zh-CN&quot;</span>  <span class="comment"># 修改为中文</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置秘钥</span></span><br><span class="line">xpack.reporting.encryptionKey: <span class="string">&quot;chenqionghe&quot;</span></span><br><span class="line">xpack.security.encryptionKey: <span class="string">&quot;122333444455555666666777777788888888&quot;</span></span><br><span class="line">xpack.encryptedSavedObjects.encryptionKey: <span class="string">&quot;122333444455555666666777777788888888&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动，启动之前必须启动Elasticsearch</span></span><br><span class="line">[root@localhost kibana-7.10.2-linux-x86_64]<span class="comment"># bin/kibana --allow-root # 可以使用root启动</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/icea8n-0.png" alt="image-20230709110909145"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/id4fn3-0.png" alt="image-20230709111041457"></p>
<h2 id="4-安装Head插件"><a href="#4-安装Head插件" class="headerlink" title="4.安装Head插件"></a>4.安装Head插件</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/iez0ou-0.png" alt="image-20230709111340665"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 添加环境变量</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export PATH=<span class="variable">$PATH</span>:/usr/local/node/bin&quot;</span> &gt; /etc/profile.d/node.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装依赖库</span></span><br><span class="line">sudo yum install glibc glibc-devel libstdc++ libstdc++-devel</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接安装也行</span></span><br><span class="line">yum install -y nodejs</span><br><span class="line">npm install -g grunt-cli</span><br><span class="line">npm install grunt --save-dev</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">git <span class="built_in">clone</span> git://github.com/mobz/elasticsearch-head.git</span><br><span class="line"><span class="built_in">cd</span> elasticsearch-head</span><br><span class="line">npm install</span><br><span class="line">npm run start</span><br><span class="line">open http://localhost:9100/</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/jvx53i-0.png" alt="image-20230709120234306"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/pbq562-0.png" alt="image-20230709153120975"></p>
<h2 id="5-YUM安装"><a href="#5-YUM安装" class="headerlink" title="5.YUM安装"></a>5.YUM安装</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch</span><br><span class="line">sudo vi /etc/yum.repos.d/elasticsearch.repo</span><br><span class="line"></span><br><span class="line">在编辑器中添加以下内容：</span><br><span class="line">[elasticsearch-7.x]</span><br><span class="line">name=Elasticsearch repository <span class="keyword">for</span> 7.x packages</span><br><span class="line">baseurl=https://artifacts.elastic.co/packages/7.x/yum  <span class="comment"># https://mirrors.aliyun.com/elasticstack/7.x/yum</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch</span><br><span class="line">enabled=1</span><br><span class="line">autorefresh=1</span><br><span class="line"><span class="built_in">type</span>=rpm-md</span><br><span class="line"></span><br><span class="line">保存并退出编辑器。然后运行以下命令：</span><br><span class="line">sudo yum install elasticsearch kibana -y</span><br></pre></td></tr></table></figure>



<h3 id="1-集群的健康值检查"><a href="#1-集群的健康值检查" class="headerlink" title="1.集群的健康值检查"></a>1.集群的健康值检查</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/pcwp7w-0.png" alt="image-20230709153330559"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span> : <span class="string">&quot;elkcluster&quot;</span>,  <span class="comment"># 集群名称</span></span><br><span class="line">  <span class="string">&quot;status&quot;</span> : <span class="string">&quot;green&quot;</span>,  <span class="comment"># 集群健康状态</span></span><br><span class="line">  <span class="string">&quot;timed_out&quot;</span> : <span class="literal">false</span>,  <span class="comment"># 指示集群是否有操作超时</span></span><br><span class="line">  <span class="string">&quot;number_of_nodes&quot;</span> : 1, <span class="comment"># 集群中的节点数量</span></span><br><span class="line">  <span class="string">&quot;number_of_data_nodes&quot;</span> : 1,  <span class="comment"># 集群中的数据节点数量</span></span><br><span class="line">  <span class="string">&quot;active_primary_shards&quot;</span> : 10,  <span class="comment"># 当前活跃的主分片数量</span></span><br><span class="line">  <span class="string">&quot;active_shards&quot;</span> : 10,         <span class="comment"># 当前活跃的分片数量</span></span><br><span class="line">  <span class="string">&quot;relocating_shards&quot;</span> : 0,      <span class="comment"># 迁移分片</span></span><br><span class="line">  <span class="string">&quot;initializing_shards&quot;</span> : 0,     <span class="comment"># 初始化分片</span></span><br><span class="line">  <span class="string">&quot;unassigned_shards&quot;</span> : 0,       <span class="comment"># 未分配分片</span></span><br><span class="line">  <span class="string">&quot;delayed_unassigned_shards&quot;</span> : 0, <span class="comment"># 延迟未分配的分片数量</span></span><br><span class="line">  <span class="string">&quot;number_of_pending_tasks&quot;</span> : 0,  <span class="comment"># 在等待中的任务数量</span></span><br><span class="line">  <span class="string">&quot;number_of_in_flight_fetch&quot;</span> : 0,  <span class="comment"># 正在进行中的获取任务数量</span></span><br><span class="line">  <span class="string">&quot;task_max_waiting_in_queue_millis&quot;</span> : 0,  <span class="comment"># 任务等待队列的最大等待时间</span></span><br><span class="line">  <span class="string">&quot;active_shards_percent_as_number&quot;</span> : 100.0 <span class="comment"># 活跃分片的百分比</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="3-核心概念"><a href="#3-核心概念" class="headerlink" title="3.核心概念"></a>3.核心概念</h1><blockquote>
<p>什么是搜索引擎</p>
</blockquote>
<ol>
<li>全文搜索引擎<ul>
<li>自然语言处理(NLP)、爬虫、网页处理、大数据处理。</li>
<li>如谷歌、百度等等</li>
</ul>
</li>
<li>垂直搜索引擎<ul>
<li>有明确搜索目的的搜索行为</li>
<li>如各大电商网站、OA、站内搜索、视频网站等</li>
</ul>
</li>
</ol>
<blockquote>
<p>搜索引擎应该具备那些要求？</p>
</blockquote>
<ul>
<li>查询速度快<ul>
<li>高效的压缩算法</li>
<li>快速的编码和解码速度</li>
</ul>
</li>
<li>结果准确<ul>
<li>BM25</li>
<li>TF-IDF</li>
</ul>
</li>
<li>检索结果丰富<ul>
<li>召回率</li>
</ul>
</li>
</ul>
<blockquote>
<p>索引</p>
</blockquote>
<ul>
<li>帮助快速检索</li>
<li>以数据结构为载体</li>
<li>以文件的形式落地</li>
</ul>
<blockquote>
<p>Lucene</p>
</blockquote>
<ul>
<li>Lucene是一个成熟的全文检索库，由Java语言编写，具有高性能、可伸缩的特点，并且开源、免费</li>
</ul>
<blockquote>
<p>全文检索</p>
</blockquote>
<ul>
<li>索引系统通过扫描文章中的每一个词，对其创建索引，指明在文章中出现的次数和位置，当用户查询时，索引系统就会根据实现建立的索引进行查找，并将查找的结果反馈给用户的检索方式</li>
</ul>
<h2 id="1-倒排索引"><a href="#1-倒排索引" class="headerlink" title="1.倒排索引"></a>1.倒排索引</h2><p>倒排索引（Inverted Index）是一种数据库索引，用于存储从内容到文档的映射。使用倒排索引可以很好的支持全文搜索，被广泛应用于信息检索（搜索引擎、数据库）中。 倒排索引是实现“单词-文档矩阵”的一种具体存储形式，通过倒排索引，可以根据单词快速获取包含这个单词的文档列表。</p>
<p>倒排索引的原理是将文档中的每个单词映射到包含该单词的所有文档的列表中，然后用该列表替换单词。倒排索引在文本搜索和信息检索中广泛应用，如搜索引擎、网站搜索、文本分类等场景中。 具体来说，一个倒排索引包含一个词语词典和每个词语对应的倒排列表。2倒排列表中记录了包含该词语的所有文档的编号、词频等信息。2这让我们能够在O(1)的时间内判断某个文档是否包含某个词，而且还可以基于词频、相关度等统计信息进行搜索结果排序。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/e700h4-0.png" alt="image-20230710085827326"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/e56cum-0.png" alt="image-20230710085500631"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/e7my9z-0.png" alt="image-20230710085933908"></p>
<h3 id="1-FOR压缩算法"><a href="#1-FOR压缩算法" class="headerlink" title="1.FOR压缩算法"></a>1.FOR压缩算法</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/evvlb7-0.png" alt="image-20230710090004193"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/f5zpqd-0.png" alt="image-20230710091653036"></p>
<h3 id="2-RBM压缩算法"><a href="#2-RBM压缩算法" class="headerlink" title="2.RBM压缩算法"></a>2.RBM压缩算法</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/fjotnt-0.png" alt="image-20230710094004593"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/fkhae3-0.png" alt="image-20230710094138943"></p>
<h3 id="3-FST压缩算法"><a href="#3-FST压缩算法" class="headerlink" title="3.FST压缩算法"></a>3.FST压缩算法</h3><blockquote>
<p>为什么要安装term的字典序处理？</p>
</blockquote>
<ul>
<li>为了生成最小化的FST的数据结构</li>
</ul>
<blockquote>
<p>Trie前缀树</p>
</blockquote>
<p>前缀树（Prefix Tree），又称字典树（Trie Tree），是一种树形结构，是一种哈希树的变种。 它的典型应用是用于统计和排序大量的字符串（但不仅限于字符串），所以经常被搜索引擎系统用于文本词频统计。 前缀树的每一个节点代表一个字符串（前缀）。每一个节点会有多个子节点，通往不同子节点的路径上有着不同的字符。 子节点代表的字符串是由节点到根节点路径上所有字符连接起来的字符串。</p>
<p>前缀树的主要优点是可以最大限度地减少无谓的字符串比较，查询效率比哈希表高。前缀树常用于搜索提示、自动补全、拼写检查等场景中</p>
<blockquote>
<p>FST</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/guyrqr-0.png" alt="image-20230710101943648"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/gz0mnz-0.png" alt="image-20230710102624989"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/h0bodv-0.png" alt="image-20230710102845688"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/h1jb2x-0.png" alt="image-20230710103048426"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/h91ytd-0.png" alt="image-20230710104311638"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/ii9uim-0.png" alt="image-20230710111903280"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/irtugf-0.png" alt="image-20230710113506320"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/ivznc1-0.png" alt="image-20230710114205557"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/j0z9kj-0.png" alt="image-20230710115048700"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/j1ej5r-0.png" alt="image-20230710115120443"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/j10nl9-0.png" alt="image-20230710115054814"></p>
<h2 id="2-tip和tim文件内部结构"><a href="#2-tip和tim文件内部结构" class="headerlink" title="2.tip和tim文件内部结构"></a>2.tip和tim文件内部结构</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/e56cum-0.png"></p>
<h3 id=""><a href="#" class="headerlink" title=""></a><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/nn46xh-0.png" alt="image-20230710142906928"></h3><h2 id="3-FSt在Lucene中的构建和读取过程"><a href="#3-FSt在Lucene中的构建和读取过程" class="headerlink" title="3.FSt在Lucene中的构建和读取过程"></a>3.FSt在Lucene中的构建和读取过程</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/nzjl8p-0.png" alt="image-20230710145035388"></p>
<h2 id="4-集群、节点和分片"><a href="#4-集群、节点和分片" class="headerlink" title="4.集群、节点和分片"></a>4.集群、节点和分片</h2><blockquote>
<p>节点</p>
</blockquote>
<ul>
<li>每个节点就是一个Elasticsearch实例</li>
<li>一个节点≠一台服务器</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/p5ofde-0.png" alt="image-20230710152107315"></p>
<blockquote>
<p>分片</p>
</blockquote>
<ul>
<li>一个索引包含一个或多个分片，在7.0之前默认五个主分片，每个主分片一个副本；在7.0之后默认一个主分片。副本可以在索引创建之后修改数量，但是主分片的数量一旦确认不可修改，只能创建索引</li>
<li>每个分片都是一个Lucene实例，有完整的创建索引和处理请求的能力</li>
<li>ES会自动在nodes上做分片均衡</li>
<li>一个doc不可能同时存在于多个主分片中，但是当每个主分片的副本数量不为一时，可以同时存在与多个副本中</li>
<li>每个主分片和其副本分片不能同时存在与同一个节点上，所以最低的可用配置是两个节点互为主备</li>
</ul>
<blockquote>
<p>集群</p>
</blockquote>
<ul>
<li>原生分布式</li>
<li>一个节点≠一台服务器</li>
</ul>
<h1 id="4-索引的CRUD"><a href="#4-索引的CRUD" class="headerlink" title="4.索引的CRUD"></a>4.索引的CRUD</h1><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/qsr2si-0.png" alt="image-20230710162039699"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看一个索引的全部信息</span></span><br><span class="line">GET /index/_search</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看索引的具体某条信息</span></span><br><span class="line">GET /inde/_doc/2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改具体索引中的值</span></span><br><span class="line">POST /index/_update/1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;doc&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;1&quot;</span>:2</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除具体索引中的值</span></span><br><span class="line">DELETE /index/_doc/2</span><br></pre></td></tr></table></figure>



<h1 id="5-Mapping"><a href="#5-Mapping" class="headerlink" title="5.Mapping"></a>5.Mapping</h1><h2 id="1-概念"><a href="#1-概念" class="headerlink" title="1.概念"></a>1.概念</h2><ul>
<li>概念：映射是定义文档及其包含的字段的存储和索引方式的过程。优点类似于RDB中”表结构”的概念。在Mapping中包含一些属性，比如字段名称、类型、字段使用的分词器、是否评分、是否创建索引等属性。并且在ES中一个字段可以有对应类型</li>
<li>两种映射方式<ul>
<li>dynamic mapping(动态映射或自动映射)</li>
<li>expllcit mapping(静态映射或手工映射或显示映射)</li>
</ul>
</li>
</ul>
<h2 id="2-查看mapping"><a href="#2-查看mapping" class="headerlink" title="2.查看mapping"></a>2.查看mapping</h2><ul>
<li>GET &#x2F;index&#x2F;_mapping</li>
</ul>
<h2 id="3-ES数据类型"><a href="#3-ES数据类型" class="headerlink" title="3.ES数据类型"></a>3.ES数据类型</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/sj9a7j-0.png" alt="image-20230710172536417"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/skamzm-0.png" alt="image-20230710172702590"></p>
<h2 id="4-两种映射类型"><a href="#4-两种映射类型" class="headerlink" title="4.两种映射类型"></a>4.两种映射类型</h2><ul>
<li><strong>Dynamic field mapping</strong></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/sm9fxc-0.png" alt="image-20230710173032068"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 为text数据类型数据，自动创建一个fields类型，里面包含一个keyword，用于基准匹配，且默认长度为256</span></span><br><span class="line"><span class="string">&quot;3&quot;</span> : &#123;</span><br><span class="line">       <span class="string">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span>,</span><br><span class="line">       <span class="string">&quot;fields&quot;</span> : &#123;</span><br><span class="line">         <span class="string">&quot;keyword&quot;</span> : &#123;</span><br><span class="line">           <span class="string">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">           <span class="string">&quot;ignore_above&quot;</span> : 256</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;,</span><br></pre></td></tr></table></figure>



<ul>
<li><strong>Expllcit field mapping：手动映射</strong></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/upcex0-0.png" alt="image-20230710185653982"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 手工创建mapping(fields的mapping只能创建，无法修改)</span></span><br><span class="line">PUT /product</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;mappings&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>:<span class="string">&quot;text&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="5-映射参数"><a href="#5-映射参数" class="headerlink" title="5.映射参数"></a>5.映射参数</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/vk3xs1-0.png" alt="image-20230710190819394"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/vlxmm4-0.png" alt="image-20230710191127139"></p>
<h1 id="6-搜索和查询"><a href="#6-搜索和查询" class="headerlink" title="6.搜索和查询"></a>6.搜索和查询</h1><h2 id="1-相关度评分"><a href="#1-相关度评分" class="headerlink" title="1.相关度评分"></a>1.相关度评分</h2><p><strong>未指定排序字段时，会按照评分进行排序</strong></p>
<h2 id="2-元数据-source"><a href="#2-元数据-source" class="headerlink" title="2.元数据_source"></a>2.元数据_source</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/xnoonc-0.png" alt="image-20230710203355415"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/xnppda-0.png" alt="image-20230710203455689"></p>
<blockquote>
<p>发生冲突时，以excludes为准</p>
</blockquote>
<h2 id="3-Query-String"><a href="#3-Query-String" class="headerlink" title="3.Query String"></a>3.Query String</h2><ul>
<li><p><strong>查询所有：</strong></p>
<p>GET &#x2F;product&#x2F;_search</p>
</li>
<li><p><strong>带参数</strong></p>
<p>GET &#x2F;product&#x2F;_search?q&#x3D;name:xiaomi</p>
</li>
<li><p><strong>分页</strong></p>
<p>GET &#x2F;product&#x2F;_search?from&#x3D;0&amp;size&#x3D;2$sort&#x3D;price:asc</p>
</li>
<li><p><strong>精准匹配exact value</strong></p>
<p>GET &#x2F;product&#x2F;_search?q&#x3D;name:xiaomi</p>
</li>
<li><p><strong>_all搜索 相当于在所有有索引字段中检索</strong></p>
<p>GET &#x2F;product&#x2F;_search?q&#x3D;xiaomi</p>
<p>如果设置字段不设置索引，那么就不会搜索该字段</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/yrix6d-0.png" alt="image-20230710210155756"></p>
</li>
</ul>
<h2 id="4-全文检索：match"><a href="#4-全文检索：match" class="headerlink" title="4.全文检索：match"></a>4.全文检索：match</h2><blockquote>
<p>DSL(Domain Specific Language)</p>
</blockquote>
<ul>
<li><p>Query string search</p>
</li>
<li><p>全文检索：fulltext search</p>
</li>
<li><p>过滤器：filter</p>
</li>
<li><p>精准匹配：exact match</p>
</li>
<li><p>组合查询：boo query</p>
</li>
</ul>
<blockquote>
<p>全文检索</p>
</blockquote>
<p>全文搜索，也被称为全文检索、关键词搜索，是一种能对文档进行搜索的技术，它的主要特点是用户可以输入一个或多个关键词，搜索结果返回所有包含这些关键词的文档。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/yvtkg1-0.png" alt="image-20230710210926041"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># match：匹配任意分词</span></span><br><span class="line">GET product/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;xiaomi nfs phone&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># match_all</span></span><br><span class="line">GET product/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># multi_match：在多个字段里搜索任一词项</span></span><br><span class="line">GET product/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;multi_match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;query&quot;</span>: <span class="string">&quot;nfc 111&quot;</span>,</span><br><span class="line">      <span class="string">&quot;fields&quot;</span>: [<span class="string">&quot;name&quot;</span>,<span class="string">&quot;desc&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># match_phrase：在字段里包含全部词项</span></span><br><span class="line">GET product/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match_phrase&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;xiaomi nfc&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="5-精准匹配：exact-match"><a href="#5-精准匹配：exact-match" class="headerlink" title="5.精准匹配：exact match"></a>5.精准匹配：exact match</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/z9kt2l-0.png" alt="image-20230710213225073"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># term</span></span><br><span class="line">GET product/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;term&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;xiaomi nfs phone&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># terms</span></span><br><span class="line">GET product/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;terms&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;xiaomi&quot;</span>,</span><br><span class="line">        <span class="string">&quot;phone&quot;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># range</span></span><br><span class="line">GET /product/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;range&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">      <span class="comment"># &quot;time_zone&quot;: &quot;+8:00&quot;;给当前时区加8小时</span></span><br><span class="line">      <span class="comment"># &quot;2021-01-02T08:00:00&quot;;匹配8点</span></span><br><span class="line">        <span class="string">&quot;gte&quot;</span>: now-1d/d, <span class="comment">#&gt;=</span></span><br><span class="line">        <span class="string">&quot;gt&quot;</span> <span class="comment"># &gt;</span></span><br><span class="line">        <span class="comment"># &lt;=now,以天为单位</span></span><br><span class="line">        <span class="string">&quot;lte&quot;</span>: now/d  <span class="comment">#&lt;=</span></span><br><span class="line">        <span class="string">&quot;lt&quot;</span>  <span class="comment">#&lt;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="6-过滤器"><a href="#6-过滤器" class="headerlink" title="6.过滤器"></a>6.过滤器</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/10ny94c-0.png" alt="image-20230710221649595"></p>
<ul>
<li>filter：query和filter的主要区别在：filter是结果导向的而query是过程导向。query倾向于当前文档和查询的语句的相关度，而filter倾向于当前文档和查询的条件是不是相符。即在查询过程中，query是要对查询的每个结果计算相关性得分的，而filter不会。另外filter有相应的缓存机制，可以提高查询效率</li>
</ul>
<h2 id="7-组合查询：bool-query"><a href="#7-组合查询：bool-query" class="headerlink" title="7.组合查询：bool query"></a>7.组合查询：bool query</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/10qjz8q-0.png" alt="image-20230710222132970"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 组合查询</span></span><br><span class="line"><span class="comment"># 如果一个组合查询中should字句遇上must或filter子句，那么它的判定条件会变为0，如果不想这样，在bool子句中添加&quot;minimum_should_match&quot;:1</span></span><br><span class="line"><span class="comment"># 让他至少满足一个条件</span></span><br><span class="line">GET product/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;bool&quot;</span>: &#123;</span><br><span class="line">    <span class="comment"># 先使用filter提升性能</span></span><br><span class="line">      <span class="string">&quot;filter&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;range&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;price&quot;</span>: &#123;</span><br><span class="line">              <span class="string">&quot;lte&quot;</span>: 4000</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;must&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;desc&quot;</span>: <span class="string">&quot;zhichi&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="7-分词器"><a href="#7-分词器" class="headerlink" title="7.分词器"></a>7.分词器</h1><ul>
<li>规范化：normalization</li>
<li>字符过滤器：character filter</li>
<li>分词器：tokenizer</li>
<li>令牌过滤器：token filter</li>
</ul>
<h2 id="1-使用分词器查看分词结果"><a href="#1-使用分词器查看分词结果" class="headerlink" title="1.使用分词器查看分词结果"></a>1.使用分词器查看分词结果</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;standard&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span> : <span class="string">&quot;xiaomi nfc phone&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;tokens&quot;</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span> : <span class="string">&quot;xiaomi&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span> : 0,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span> : 6,</span><br><span class="line">      <span class="string">&quot;type&quot;</span> : <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span> : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span> : <span class="string">&quot;nfc&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span> : 7,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span> : 10,</span><br><span class="line">      <span class="string">&quot;type&quot;</span> : <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span> : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span> : <span class="string">&quot;phone&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span> : 11,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span> : 16,</span><br><span class="line">      <span class="string">&quot;type&quot;</span> : <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span> : 2</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="2-normalization"><a href="#2-normalization" class="headerlink" title="2.normalization"></a>2.normalization</h2><p><strong>文档规范化，提高召回率</strong></p>
<ul>
<li>停用词</li>
<li>时态转换</li>
<li>大小写</li>
<li>同义词</li>
<li>语气词</li>
</ul>
<h2 id="3-字符过滤器"><a href="#3-字符过滤器" class="headerlink" title="3.字符过滤器"></a>3.字符过滤器</h2><p><strong>分词之前的预处理，过滤无用字符</strong></p>
<ul>
<li>HTML Strip</li>
<li>Mapping</li>
<li>Pattern Replace</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># HTML Strip Character Filter</span></span><br><span class="line"><span class="comment"># 测试数据:&lt;p&gt;I&amp;apos;m so &lt;a&gt;happy&lt;/a&gt;!&lt;/p&gt;</span></span><br><span class="line">DELETE my_index</span><br><span class="line">PUT my_index</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;settings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;analysis&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;char_filter&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;my_chart_filter&quot;</span>:&#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>:<span class="string">&quot;html_strip&quot;</span>,</span><br><span class="line">          <span class="string">&quot;escaped_tags&quot;</span>:[<span class="string">&quot;a&quot;</span>] <span class="comment"># 保留的html标签</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, </span><br><span class="line">      <span class="string">&quot;analyzer&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;my_analyzer&quot;</span>:&#123;</span><br><span class="line">          <span class="string">&quot;tokenizer&quot;</span>:<span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">          <span class="string">&quot;char_filter&quot;</span>:<span class="string">&quot;my_chart_filter&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">GET my_index/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;my_analyzer&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;&lt;p&gt;I&amp;apos;m so &lt;a&gt;happy&lt;/a&gt;!&lt;/p&gt;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;tokens&quot;</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span> : <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">I&#x27;m so &lt;a&gt;happy&lt;/a&gt;!</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span> : 0,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span> : 32,</span><br><span class="line">      <span class="string">&quot;type&quot;</span> : <span class="string">&quot;word&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span> : 0</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># mapping</span></span><br><span class="line">PUT my_index</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;settings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;analysis&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;char_filter&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;my_chart_filter&quot;</span>:&#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>:<span class="string">&quot;mapping&quot;</span>,</span><br><span class="line">          <span class="string">&quot;mappings&quot;</span>:[</span><br><span class="line">            <span class="string">&quot;滚 =&gt; *&quot;</span>,</span><br><span class="line">            <span class="string">&quot;垃 =&gt; *&quot;</span>,</span><br><span class="line">            <span class="string">&quot;圾 =&gt; *&quot;</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, </span><br><span class="line">      <span class="string">&quot;analyzer&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;my_analyzer&quot;</span>:&#123;</span><br><span class="line">          <span class="string">&quot;tokenizer&quot;</span>:<span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">          <span class="string">&quot;char_filter&quot;</span>:<span class="string">&quot;my_chart_filter&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">GET my_index/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;my_analyzer&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;你就是个垃圾，滚&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;tokens&quot;</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span> : <span class="string">&quot;你就是个**，*&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span> : 0,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span> : 8,</span><br><span class="line">      <span class="string">&quot;type&quot;</span> : <span class="string">&quot;word&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span> : 0</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Pattern Replace</span></span><br><span class="line">PUT my_index</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;settings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;analysis&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;char_filter&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;my_chart_filter&quot;</span>:&#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>:<span class="string">&quot;pattern_replace&quot;</span>,</span><br><span class="line">          <span class="string">&quot;pattern&quot;</span>:<span class="string">&quot;(\\d&#123;3&#125;)\\d&#123;4&#125;(\\d&#123;4&#125;)&quot;</span>,</span><br><span class="line">          <span class="string">&quot;replacement&quot;</span>:<span class="string">&quot;<span class="variable">$1</span>*****<span class="variable">$2</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, </span><br><span class="line">      <span class="string">&quot;analyzer&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;my_analyzer&quot;</span>:&#123;</span><br><span class="line">          <span class="string">&quot;tokenizer&quot;</span>:<span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">          <span class="string">&quot;char_filter&quot;</span>:<span class="string">&quot;my_chart_filter&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">GET my_index/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;my_analyzer&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;17287371738&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;tokens&quot;</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span> : <span class="string">&quot;172*****1738&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span> : 0,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span> : 11,</span><br><span class="line">      <span class="string">&quot;type&quot;</span> : <span class="string">&quot;word&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span> : 0</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="4-令牌过滤器：token-filter"><a href="#4-令牌过滤器：token-filter" class="headerlink" title="4.令牌过滤器：token filter"></a>4.令牌过滤器：token filter</h2><p><strong>停用词、时态转换、大小写转换、同义词转换、语气词处理等</strong></p>
<p><strong>ES的令牌过滤器和字符过滤器是用于分析器的两种过滤器。字符过滤器用于在将字符流传递给分词器之前对其进行预处理，将原始文本作为字符流接收，并可以通过添加、删除或更改字符来转换流。而令牌过滤器则是在分词器生成单词后，对单词进行进一步的处理，如删除停用词、同义词转换等等。</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/h7irnp-0.png" alt="image-20230711104036234"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/haugan-0.png" alt="image-20230711104601803"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/hck1ho-0.png" alt="image-20230711104900823"></p>
<h2 id="5-分词器：tokenizer"><a href="#5-分词器：tokenizer" class="headerlink" title="5.分词器：tokenizer"></a>5.分词器：tokenizer</h2><p><strong>切词</strong></p>
<blockquote>
<p>常见分词器</p>
</blockquote>
<ul>
<li>standard analyzer:默认分词器，中文支持的不理想，会逐字拆分</li>
<li>pattern tokenizer:以正则匹配分隔符，把文本拆分成若干词项</li>
<li>simple pattern tokenizer:以正则匹配词项，速度比pattern tokenizer快</li>
<li>whitespace analyzer:以空白符分隔 tim_cookie</li>
</ul>
<blockquote>
<p>自定义分词器</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">PUT custom</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;settings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;analysis&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;char_filter&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;my_char&quot;</span>:&#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>:<span class="string">&quot;mapping&quot;</span>,</span><br><span class="line">          <span class="string">&quot;mappings&quot;</span>:[</span><br><span class="line">            <span class="string">&quot;&amp; =&gt; and&quot;</span>,</span><br><span class="line">            <span class="string">&quot;| =&gt; or&quot;</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;filter&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;my_stopword&quot;</span>:&#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>:<span class="string">&quot;stop&quot;</span>,</span><br><span class="line">          <span class="string">&quot;stopwards&quot;</span>:[</span><br><span class="line">            <span class="string">&quot;is&quot;</span>,<span class="string">&quot;in&quot;</span>,<span class="string">&quot;the&quot;</span>,<span class="string">&quot;a&quot;</span>,<span class="string">&quot;at&quot;</span>,<span class="string">&quot;for&quot;</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;tokenizer&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;my_tokenizer&quot;</span>:&#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>:<span class="string">&quot;pattern&quot;</span>,</span><br><span class="line">          <span class="string">&quot;pattern&quot;</span>:<span class="string">&quot;[,!?]&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      , <span class="string">&quot;analyzer&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;my_analyzer&quot;</span>:&#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>:<span class="string">&quot;custom&quot;</span>, <span class="comment"># 自定义分析器</span></span><br><span class="line">          <span class="string">&quot;char_filter&quot;</span>:<span class="string">&quot;my_char&quot;</span>,</span><br><span class="line">          <span class="string">&quot;tokenizer&quot;</span>:<span class="string">&quot;my_tokenizer&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="6-中文分词器"><a href="#6-中文分词器" class="headerlink" title="6.中文分词器"></a>6.中文分词器</h2><p><a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik">Github地址</a></p>
<p>Analyzer: <code>ik_smart</code> , <code>ik_max_word</code> , Tokenizer: <code>ik_smart</code> , <code>ik_max_word</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/in08rs-0.png" alt="image-20230711112650649"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/itsk0g-0.png" alt="image-20230711113838343"></p>
<h2 id="7-关于热更新"><a href="#7-关于热更新" class="headerlink" title="7.关于热更新"></a>7.关于热更新</h2><h3 id="1-关于远程词库的热更新"><a href="#1-关于远程词库的热更新" class="headerlink" title="1.关于远程词库的热更新"></a>1.关于远程词库的热更新</h3><h3 id="2-关于基于数据库的热更新"><a href="#2-关于基于数据库的热更新" class="headerlink" title="2.关于基于数据库的热更新"></a>2.关于基于数据库的热更新</h3><h1 id="8-聚合查询：Aggregation"><a href="#8-聚合查询：Aggregation" class="headerlink" title="8.聚合查询：Aggregation"></a>8.聚合查询：Aggregation</h1><h2 id="1-基础聚合"><a href="#1-基础聚合" class="headerlink" title="1.基础聚合"></a>1.基础聚合</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 语法</span></span><br><span class="line">GET /product/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;NAME&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;AGG_TYPE&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;NAME2 &quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;AGG_TYPE&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">DELETE product</span><br><span class="line">PUT product</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;createtime&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;date&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;desc&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">         <span class="string">&quot;fields&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;keyword&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ignore_above&quot;</span> : 256</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;ik_max_word&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;lv&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="string">&quot;fields&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;keyword&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ignore_above&quot;</span> : 256</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;name&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span></span><br><span class="line">        , <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;ik_max_word&quot;</span>,</span><br><span class="line">        <span class="string">&quot;fields&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;keyword&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ignore_above&quot;</span> : 256</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;price&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;tags&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="string">&quot;fields&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;keyword&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ignore_above&quot;</span> : 256</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;type&quot;</span> :&#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="string">&quot;fields&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;keyword&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ignore_above&quot;</span> : 256</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">PUT /product/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>:<span class="string">&quot;小米手机&quot;</span>,</span><br><span class="line">  <span class="string">&quot;desc&quot;</span>:<span class="string">&quot;手机中的战斗机&quot;</span>,</span><br><span class="line">  <span class="string">&quot;price&quot;</span>: <span class="string">&quot;3999&quot;</span>,</span><br><span class="line">  <span class="string">&quot;lv&quot;</span>:<span class="string">&quot;旗舰机&quot;</span>,</span><br><span class="line">  <span class="string">&quot;type&quot;</span>:<span class="string">&quot;手机&quot;</span>,</span><br><span class="line">  <span class="string">&quot;createtime&quot;</span>:<span class="string">&quot;2020-10-01T08:00:00Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;tags&quot;</span>:[</span><br><span class="line">    <span class="string">&quot;性价比&quot;</span>,</span><br><span class="line">    <span class="string">&quot;发烧&quot;</span>,</span><br><span class="line">    <span class="string">&quot;不卡顿&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">PUT /product/_doc/2</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>:<span class="string">&quot;NFC手机&quot;</span>,</span><br><span class="line">  <span class="string">&quot;desc&quot;</span>:<span class="string">&quot;手机中的轰炸机&quot;</span>,</span><br><span class="line">  <span class="string">&quot;price&quot;</span>: <span class="string">&quot;2999&quot;</span>,</span><br><span class="line">  <span class="string">&quot;lv&quot;</span>:<span class="string">&quot;高端机&quot;</span>,</span><br><span class="line">  <span class="string">&quot;type&quot;</span>:<span class="string">&quot;手机&quot;</span>,</span><br><span class="line">  <span class="string">&quot;createtime&quot;</span>:<span class="string">&quot;2020-06-20&quot;</span>,</span><br><span class="line">  <span class="string">&quot;tags&quot;</span>:[</span><br><span class="line">    <span class="string">&quot;性价比&quot;</span>,</span><br><span class="line">    <span class="string">&quot;快充&quot;</span>,</span><br><span class="line">    <span class="string">&quot;门禁卡&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">PUT /product/_doc/3</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>:<span class="string">&quot;挨炮&quot;</span>,</span><br><span class="line">  <span class="string">&quot;desc&quot;</span>:<span class="string">&quot;除了CPU一无是处&quot;</span>,</span><br><span class="line">  <span class="string">&quot;price&quot;</span>: <span class="string">&quot;3299&quot;</span>,</span><br><span class="line">  <span class="string">&quot;lv&quot;</span>:<span class="string">&quot;旗舰机&quot;</span>,</span><br><span class="line">  <span class="string">&quot;type&quot;</span>:<span class="string">&quot;手机&quot;</span>,</span><br><span class="line">  <span class="string">&quot;createtime&quot;</span>:<span class="string">&quot;2020-07-21&quot;</span>,</span><br><span class="line">  <span class="string">&quot;tags&quot;</span>:[</span><br><span class="line">    <span class="string">&quot;割韭菜&quot;</span>,</span><br><span class="line">    <span class="string">&quot;割韭菜&quot;</span>,</span><br><span class="line">    <span class="string">&quot;割新韭菜&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-分桶聚合-Bucket-agregations"><a href="#1-分桶聚合-Bucket-agregations" class="headerlink" title="1.分桶聚合(Bucket agregations)"></a>1.分桶聚合(Bucket agregations)</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 分桶聚合(Bucket agregations)：统计不同标签的商品数量</span></span><br><span class="line">GET /product/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0, </span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;aggs_tag&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;terms&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;tags.keyword&quot;</span>,</span><br><span class="line">        <span class="string">&quot;size&quot;</span>: 10,</span><br><span class="line">        <span class="string">&quot;order&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;_count&quot;</span>: <span class="string">&quot;asc&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;took&quot;</span> : 8,</span><br><span class="line">  <span class="string">&quot;timed_out&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;_shards&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span> : 1,</span><br><span class="line">    <span class="string">&quot;successful&quot;</span> : 1,</span><br><span class="line">    <span class="string">&quot;skipped&quot;</span> : 0,</span><br><span class="line">    <span class="string">&quot;failed&quot;</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;hits&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span> : 3,</span><br><span class="line">      <span class="string">&quot;relation&quot;</span> : <span class="string">&quot;eq&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;max_score&quot;</span> : null,</span><br><span class="line">    <span class="string">&quot;hits&quot;</span> : [ ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;aggregations&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;aggs_tag&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;doc_count_error_upper_bound&quot;</span> : 0,</span><br><span class="line">      <span class="string">&quot;sum_other_doc_count&quot;</span> : 0,</span><br><span class="line">      <span class="string">&quot;buckets&quot;</span> : [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span> : <span class="string">&quot;不卡顿&quot;</span>,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span> : 1</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span> : <span class="string">&quot;割新韭菜&quot;</span>,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span> : 1</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span> : <span class="string">&quot;割韭菜&quot;</span>,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span> : 1</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span> : <span class="string">&quot;发烧&quot;</span>,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span> : 1</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span> : <span class="string">&quot;快充&quot;</span>,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span> : 1</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span> : <span class="string">&quot;门禁卡&quot;</span>,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span> : 1</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span> : <span class="string">&quot;性价比&quot;</span>,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span> : 2</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-指标聚合-Metrics-agregations"><a href="#2-指标聚合-Metrics-agregations" class="headerlink" title="2.指标聚合(Metrics agregations)"></a>2.指标聚合(Metrics agregations)</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/e7nzpp-0.png" alt="image-20230713085920942"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 指标聚合(Metrics agregations)：统计最贵、最便宜和平均价格</span></span><br><span class="line">GET product/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0, </span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;max_price&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;max&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;min_price&quot;</span>:&#123;</span><br><span class="line">      <span class="string">&quot;min&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;avg_price&quot;</span>:&#123;</span><br><span class="line">      <span class="string">&quot;avg&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span></span><br><span class="line">      &#125;  </span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;price_stats&quot;</span>:&#123;</span><br><span class="line">      <span class="string">&quot;stats&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;name_count&quot;</span>:&#123;</span><br><span class="line">      <span class="string">&quot;cardinality&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;name.keyword&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;took&quot;</span> : 1,</span><br><span class="line">  <span class="string">&quot;timed_out&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;_shards&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span> : 1,</span><br><span class="line">    <span class="string">&quot;successful&quot;</span> : 1,</span><br><span class="line">    <span class="string">&quot;skipped&quot;</span> : 0,</span><br><span class="line">    <span class="string">&quot;failed&quot;</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;hits&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span> : 3,</span><br><span class="line">      <span class="string">&quot;relation&quot;</span> : <span class="string">&quot;eq&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;max_score&quot;</span> : null,</span><br><span class="line">    <span class="string">&quot;hits&quot;</span> : [ ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;aggregations&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;max_price&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span> : 3999.0</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;min_price&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span> : 2999.0</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;avg_price&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span> : 3432.3333333333335</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;price_stats&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;count&quot;</span> : 3,</span><br><span class="line">      <span class="string">&quot;min&quot;</span> : 2999.0,</span><br><span class="line">      <span class="string">&quot;max&quot;</span> : 3999.0,</span><br><span class="line">      <span class="string">&quot;avg&quot;</span> : 3432.3333333333335,</span><br><span class="line">      <span class="string">&quot;sum&quot;</span> : 10297.0</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;name_count&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span> : 3</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-管道聚合-Pipeline-agregation"><a href="#3-管道聚合-Pipeline-agregation" class="headerlink" title="3.管道聚合(Pipeline agregation)"></a>3.管道聚合(Pipeline agregation)</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/ewkslj-0.png" alt="image-20230713090116297"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 管道聚合</span></span><br><span class="line"><span class="comment"># 统计平均价格最低的商品分类</span></span><br><span class="line">GET product/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0, </span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;type_bucket&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;terms&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;tags.keyword&quot;</span>,</span><br><span class="line">        <span class="string">&quot;size&quot;</span>: 10</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;price_bucket&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;avg&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;min_buckets&quot;</span>:&#123;</span><br><span class="line">      <span class="string">&quot;min_bucket&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;buckets_path&quot;</span>: <span class="string">&quot;type_bucket&gt;price_bucket&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;took&quot;</span> : 15,</span><br><span class="line">  <span class="string">&quot;timed_out&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;_shards&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span> : 1,</span><br><span class="line">    <span class="string">&quot;successful&quot;</span> : 1,</span><br><span class="line">    <span class="string">&quot;skipped&quot;</span> : 0,</span><br><span class="line">    <span class="string">&quot;failed&quot;</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;hits&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span> : 3,</span><br><span class="line">      <span class="string">&quot;relation&quot;</span> : <span class="string">&quot;eq&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;max_score&quot;</span> : null,</span><br><span class="line">    <span class="string">&quot;hits&quot;</span> : [ ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;aggregations&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;type_bucket&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;doc_count_error_upper_bound&quot;</span> : 0,</span><br><span class="line">      <span class="string">&quot;sum_other_doc_count&quot;</span> : 0,</span><br><span class="line">      <span class="string">&quot;buckets&quot;</span> : [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span> : <span class="string">&quot;性价比&quot;</span>,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span> : 2,</span><br><span class="line">          <span class="string">&quot;price_bucket&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;value&quot;</span> : 3499.0</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span> : <span class="string">&quot;不卡顿&quot;</span>,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span> : 1,</span><br><span class="line">          <span class="string">&quot;price_bucket&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;value&quot;</span> : 3999.0</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span> : <span class="string">&quot;割新韭菜&quot;</span>,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span> : 1,</span><br><span class="line">          <span class="string">&quot;price_bucket&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;value&quot;</span> : 3299.0</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span> : <span class="string">&quot;割韭菜&quot;</span>,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span> : 1,</span><br><span class="line">          <span class="string">&quot;price_bucket&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;value&quot;</span> : 3299.0</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span> : <span class="string">&quot;发烧&quot;</span>,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span> : 1,</span><br><span class="line">          <span class="string">&quot;price_bucket&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;value&quot;</span> : 3999.0</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span> : <span class="string">&quot;快充&quot;</span>,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span> : 1,</span><br><span class="line">          <span class="string">&quot;price_bucket&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;value&quot;</span> : 2999.0</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span> : <span class="string">&quot;门禁卡&quot;</span>,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span> : 1,</span><br><span class="line">          <span class="string">&quot;price_bucket&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;value&quot;</span> : 2999.0</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;min_buckets&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span> : 2999.0,</span><br><span class="line">      <span class="string">&quot;keys&quot;</span> : [</span><br><span class="line">        <span class="string">&quot;快充&quot;</span>,</span><br><span class="line">        <span class="string">&quot;门禁卡&quot;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="2-嵌套聚合：基于聚合结果的聚合"><a href="#2-嵌套聚合：基于聚合结果的聚合" class="headerlink" title="2.嵌套聚合：基于聚合结果的聚合"></a>2.嵌套聚合：基于聚合结果的聚合</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 嵌套聚合</span></span><br><span class="line"><span class="comment"># 统计每个商品类型中不同档次分类商品中平均价格最低的档次</span></span><br><span class="line">GET product/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0, </span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;type_lv_agg&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;terms&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;type.keyword&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;count_num&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;terms&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;field&quot;</span>: <span class="string">&quot;lv.keyword&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;price_avg&quot;</span>: &#123;</span><br><span class="line">              <span class="string">&quot;avg&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">         <span class="string">&quot;min_bucket&quot;</span>:&#123;</span><br><span class="line">      <span class="string">&quot;min_bucket&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;buckets_path&quot;</span>: <span class="string">&quot;count_num&gt;price_avg&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="3-基于查询结果的聚合和基于聚合结果的查询"><a href="#3-基于查询结果的聚合和基于聚合结果的查询" class="headerlink" title="3.基于查询结果的聚合和基于聚合结果的查询"></a>3.基于查询结果的聚合和基于聚合结果的查询</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 基于查询结果的聚合</span></span><br><span class="line"><span class="comment"># 基于查询结果的聚合</span></span><br><span class="line">GET product/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;手机&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>:&#123;</span><br><span class="line">      <span class="string">&quot;price&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;terms&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 基于聚合结果的查询：用来看聚合的详细信息</span></span><br><span class="line">GET product/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>:&#123;</span><br><span class="line">      <span class="string">&quot;price&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;terms&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;field&quot;</span>: <span class="string">&quot;type.keyword&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  <span class="string">&quot;post_filter&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;手机&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;took&quot;</span> : 5,</span><br><span class="line">  <span class="string">&quot;timed_out&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;_shards&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span> : 1,</span><br><span class="line">    <span class="string">&quot;successful&quot;</span> : 1,</span><br><span class="line">    <span class="string">&quot;skipped&quot;</span> : 0,</span><br><span class="line">    <span class="string">&quot;failed&quot;</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;hits&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span> : 3,</span><br><span class="line">      <span class="string">&quot;relation&quot;</span> : <span class="string">&quot;eq&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;max_score&quot;</span> : 1.0,</span><br><span class="line">    <span class="string">&quot;hits&quot;</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;product&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_type&quot;</span> : <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_score&quot;</span> : 1.0,</span><br><span class="line">        <span class="string">&quot;_source&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span> : <span class="string">&quot;小米手机&quot;</span>,</span><br><span class="line">          <span class="string">&quot;desc&quot;</span> : <span class="string">&quot;手机中的战斗机&quot;</span>,</span><br><span class="line">          <span class="string">&quot;price&quot;</span> : <span class="string">&quot;3999&quot;</span>,</span><br><span class="line">          <span class="string">&quot;lv&quot;</span> : <span class="string">&quot;旗舰机&quot;</span>,</span><br><span class="line">          <span class="string">&quot;type&quot;</span> : <span class="string">&quot;手机&quot;</span>,</span><br><span class="line">          <span class="string">&quot;createtime&quot;</span> : <span class="string">&quot;2020-10-01T08:00:00Z&quot;</span>,</span><br><span class="line">          <span class="string">&quot;tags&quot;</span> : [</span><br><span class="line">            <span class="string">&quot;性价比&quot;</span>,</span><br><span class="line">            <span class="string">&quot;发烧&quot;</span>,</span><br><span class="line">            <span class="string">&quot;不卡顿&quot;</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;product&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_type&quot;</span> : <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_score&quot;</span> : 1.0,</span><br><span class="line">        <span class="string">&quot;_source&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span> : <span class="string">&quot;NFC手机&quot;</span>,</span><br><span class="line">          <span class="string">&quot;desc&quot;</span> : <span class="string">&quot;手机中的轰炸机&quot;</span>,</span><br><span class="line">          <span class="string">&quot;price&quot;</span> : <span class="string">&quot;2999&quot;</span>,</span><br><span class="line">          <span class="string">&quot;lv&quot;</span> : <span class="string">&quot;高端机&quot;</span>,</span><br><span class="line">          <span class="string">&quot;type&quot;</span> : <span class="string">&quot;手机&quot;</span>,</span><br><span class="line">          <span class="string">&quot;createtime&quot;</span> : <span class="string">&quot;2020-06-20&quot;</span>,</span><br><span class="line">          <span class="string">&quot;tags&quot;</span> : [</span><br><span class="line">            <span class="string">&quot;性价比&quot;</span>,</span><br><span class="line">            <span class="string">&quot;快充&quot;</span>,</span><br><span class="line">            <span class="string">&quot;门禁卡&quot;</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;product&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_type&quot;</span> : <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;3&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_score&quot;</span> : 1.0,</span><br><span class="line">        <span class="string">&quot;_source&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;name&quot;</span> : <span class="string">&quot;挨炮&quot;</span>,</span><br><span class="line">          <span class="string">&quot;desc&quot;</span> : <span class="string">&quot;除了CPU一无是处&quot;</span>,</span><br><span class="line">          <span class="string">&quot;price&quot;</span> : <span class="string">&quot;3299&quot;</span>,</span><br><span class="line">          <span class="string">&quot;lv&quot;</span> : <span class="string">&quot;旗舰机&quot;</span>,</span><br><span class="line">          <span class="string">&quot;type&quot;</span> : <span class="string">&quot;手机&quot;</span>,</span><br><span class="line">          <span class="string">&quot;createtime&quot;</span> : <span class="string">&quot;2020-07-21&quot;</span>,</span><br><span class="line">          <span class="string">&quot;tags&quot;</span> : [</span><br><span class="line">            <span class="string">&quot;割韭菜&quot;</span>,</span><br><span class="line">            <span class="string">&quot;割韭菜&quot;</span>,</span><br><span class="line">            <span class="string">&quot;割新韭菜&quot;</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;aggregations&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;price&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;doc_count_error_upper_bound&quot;</span> : 0,</span><br><span class="line">      <span class="string">&quot;sum_other_doc_count&quot;</span> : 0,</span><br><span class="line">      <span class="string">&quot;buckets&quot;</span> : [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span> : <span class="string">&quot;手机&quot;</span>,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span> : 3</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;key&quot;</span> : <span class="string">&quot;玩具&quot;</span>,</span><br><span class="line">          <span class="string">&quot;doc_count&quot;</span> : 1</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 截断查询条件</span></span><br><span class="line"><span class="comment"># 基于查询结果的聚合</span></span><br><span class="line">GET product/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;range&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;price&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;gte&quot;</span>: 3000,</span><br><span class="line">        <span class="string">&quot;lte&quot;</span>: 4000</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>:&#123;</span><br><span class="line">      <span class="string">&quot;max_price&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;max&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;min_price&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;global&quot;</span>: &#123;&#125;, <span class="comment"># 如果这里用filter，此后查询条件会是这个查询条件和上面那个查询的集合</span></span><br><span class="line">        <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;min&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;min&quot;</span>: &#123;</span><br><span class="line">              <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="4-聚合排序"><a href="#4-聚合排序" class="headerlink" title="4.聚合排序"></a>4.聚合排序</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET product/_search?size=0</span><br><span class="line">&#123;</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;type_avg_price&quot;: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;type.keyword&quot;,</span><br><span class="line">        &quot;order&quot;: &#123;</span><br><span class="line">          &quot;agg_stats&gt;stats.min&quot;: &quot;asc&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &quot;aggs&quot;: &#123;</span><br><span class="line">      &quot;agg_stats&quot;: &#123;</span><br><span class="line">        &quot;filter&quot;: &#123;</span><br><span class="line">          &quot;terms&quot;: &#123;</span><br><span class="line">            &quot;type.keyword&quot;: [&quot;手机&quot;,&quot;玩具&quot;]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      &quot;aggs&quot;: &#123;</span><br><span class="line">       &quot;stats&quot;: &#123;</span><br><span class="line">         &quot;stats&quot;: &#123;</span><br><span class="line">          &quot;field&quot;: &quot;price&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 结果</span><br><span class="line">&#123;</span><br><span class="line">  &quot;took&quot; : 12,</span><br><span class="line">  &quot;timed_out&quot; : false,</span><br><span class="line">  &quot;_shards&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 1,</span><br><span class="line">    &quot;successful&quot; : 1,</span><br><span class="line">    &quot;skipped&quot; : 0,</span><br><span class="line">    &quot;failed&quot; : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : &#123;</span><br><span class="line">      &quot;value&quot; : 4,</span><br><span class="line">      &quot;relation&quot; : &quot;eq&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;max_score&quot; : null,</span><br><span class="line">    &quot;hits&quot; : [ ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;aggregations&quot; : &#123;</span><br><span class="line">    &quot;type_avg_price&quot; : &#123;</span><br><span class="line">      &quot;doc_count_error_upper_bound&quot; : 0,</span><br><span class="line">      &quot;sum_other_doc_count&quot; : 0,</span><br><span class="line">      &quot;buckets&quot; : [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;key&quot; : &quot;手机&quot;,</span><br><span class="line">          &quot;doc_count&quot; : 3,</span><br><span class="line">          &quot;agg_stats&quot; : &#123;</span><br><span class="line">            &quot;doc_count&quot; : 3,</span><br><span class="line">            &quot;stats&quot; : &#123;</span><br><span class="line">              &quot;count&quot; : 3,</span><br><span class="line">              &quot;min&quot; : 2999.0,</span><br><span class="line">              &quot;max&quot; : 3999.0,</span><br><span class="line">              &quot;avg&quot; : 3432.3333333333335,</span><br><span class="line">              &quot;sum&quot; : 10297.0</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;key&quot; : &quot;玩具&quot;,</span><br><span class="line">          &quot;doc_count&quot; : 1,</span><br><span class="line">          &quot;agg_stats&quot; : &#123;</span><br><span class="line">            &quot;doc_count&quot; : 1,</span><br><span class="line">            &quot;stats&quot; : &#123;</span><br><span class="line">              &quot;count&quot; : 1,</span><br><span class="line">              &quot;min&quot; : 3299.0,</span><br><span class="line">              &quot;max&quot; : 3299.0,</span><br><span class="line">              &quot;avg&quot; : 3299.0,</span><br><span class="line">              &quot;sum&quot; : 3299.0</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="5-常见的聚合函数"><a href="#5-常见的聚合函数" class="headerlink" title="5.常见的聚合函数"></a>5.常见的聚合函数</h2><h3 id="1-histogram"><a href="#1-histogram" class="headerlink" title="1.histogram"></a>1.histogram</h3><blockquote>
<p>使用range</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">GET product/_search?size=0</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;price_range&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;range&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ranges&quot;</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">&quot;from&quot;</span>: 2000,</span><br><span class="line">            <span class="string">&quot;to&quot;</span>: 3000</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">&quot;from&quot;</span>: 3000,</span><br><span class="line">            <span class="string">&quot;to&quot;</span>: 4000</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>使用histogram</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># histogram</span></span><br><span class="line">GET product/_search?size=0</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;price&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;histogram&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span>,</span><br><span class="line">        <span class="string">&quot;interval&quot;</span>: 1000,</span><br><span class="line">        <span class="string">&quot;keyed&quot;</span>: <span class="literal">true</span>,  <span class="comment"># 改变形式</span></span><br><span class="line">        <span class="string">&quot;min_doc_count&quot;</span>: 0, <span class="comment"># 显示的最小值</span></span><br><span class="line">        <span class="string">&quot;missing&quot;</span>: 1999 <span class="comment"># 对字段空值赋予默认值</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># date-histogram</span></span><br><span class="line">GET product/_search?size=0</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;date&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;date_histogram&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;createtime&quot;</span>,</span><br><span class="line">        <span class="string">&quot;calendar_interval&quot;</span>: <span class="string">&quot;1M&quot;</span>,</span><br><span class="line">        <span class="string">&quot;format&quot;</span>: <span class="string">&quot;yyyy-MM&quot;</span>, </span><br><span class="line">        <span class="string">&quot;extended_bounds&quot;</span>: &#123; <span class="comment"># 扩展显示数据</span></span><br><span class="line">          <span class="string">&quot;min&quot;</span>: <span class="string">&quot;2020-01&quot;</span>,</span><br><span class="line">          <span class="string">&quot;max&quot;</span>: <span class="string">&quot;2020-12&quot;</span></span><br><span class="line">        &#125;<span class="comment"># 完全显示1-12月的数据</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;aggs&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;sum_agg&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;sum&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;field&quot;</span>:<span class="string">&quot;price&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment"># 进行累加操作</span></span><br><span class="line">    <span class="string">&quot;my_cumulative_sum&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;cumulative_sum&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;backets_path&quot;</span>:<span class="string">&quot;sum_agg&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># auto_date_histogram：根据buckets来自动设置interval</span></span><br><span class="line">GET product/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;auto&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;auto_date_histogram&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>:<span class="string">&quot;createtime&quot;</span>,</span><br><span class="line">        <span class="string">&quot;format&quot;</span>:<span class="string">&quot;yyyy-MM-dd&quot;</span>,</span><br><span class="line">        <span class="string">&quot;buckets&quot;</span>:365</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="2-percentile"><a href="#2-percentile" class="headerlink" title="2.percentile"></a>2.percentile</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">GET product/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;price_percenties&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;percentiles&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span>,</span><br><span class="line">        <span class="string">&quot;percents&quot;</span>: [</span><br><span class="line">          1,</span><br><span class="line">          5,</span><br><span class="line">          25,</span><br><span class="line">          50,</span><br><span class="line">          75,</span><br><span class="line">          95,</span><br><span class="line">          99</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;took&quot;</span> : 2,</span><br><span class="line">  <span class="string">&quot;timed_out&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;_shards&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span> : 1,</span><br><span class="line">    <span class="string">&quot;successful&quot;</span> : 1,</span><br><span class="line">    <span class="string">&quot;skipped&quot;</span> : 0,</span><br><span class="line">    <span class="string">&quot;failed&quot;</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;hits&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span> : 4,</span><br><span class="line">      <span class="string">&quot;relation&quot;</span> : <span class="string">&quot;eq&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;max_score&quot;</span> : null,</span><br><span class="line">    <span class="string">&quot;hits&quot;</span> : [ ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;aggregations&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;price_percenties&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;values&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;1.0&quot;</span> : 2999.0,</span><br><span class="line">        <span class="string">&quot;5.0&quot;</span> : 2999.0,</span><br><span class="line">        <span class="string">&quot;25.0&quot;</span> : 3149.0,</span><br><span class="line">        <span class="string">&quot;50.0&quot;</span> : 3299.0,</span><br><span class="line">        <span class="string">&quot;75.0&quot;</span> : 3649.0,</span><br><span class="line">        <span class="string">&quot;95.0&quot;</span> : 3999.0,</span><br><span class="line">        <span class="string">&quot;99.0&quot;</span> : 3999.0</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">GET product/_search?size=0</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;price_percenties&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;percentile_ranks&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span>,</span><br><span class="line">      <span class="string">&quot;values&quot;</span>: [</span><br><span class="line">        1000,</span><br><span class="line">        2000,</span><br><span class="line">        3000,</span><br><span class="line">        4000</span><br><span class="line">        ]</span><br><span class="line">        </span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;took&quot;</span> : 1,</span><br><span class="line">  <span class="string">&quot;timed_out&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;_shards&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span> : 1,</span><br><span class="line">    <span class="string">&quot;successful&quot;</span> : 1,</span><br><span class="line">    <span class="string">&quot;skipped&quot;</span> : 0,</span><br><span class="line">    <span class="string">&quot;failed&quot;</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;hits&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;value&quot;</span> : 4,</span><br><span class="line">      <span class="string">&quot;relation&quot;</span> : <span class="string">&quot;eq&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;max_score&quot;</span> : null,</span><br><span class="line">    <span class="string">&quot;hits&quot;</span> : [ ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;aggregations&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;price_percenties&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;values&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;1000.0&quot;</span> : 0.0,</span><br><span class="line">        <span class="string">&quot;2000.0&quot;</span> : 0.0,</span><br><span class="line">        <span class="string">&quot;3000.0&quot;</span> : 12.583333333333332,</span><br><span class="line">        <span class="string">&quot;4000.0&quot;</span> : 100.0</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="9-脚本查询-Scripting"><a href="#9-脚本查询-Scripting" class="headerlink" title="9.脚本查询:Scripting"></a>9.脚本查询:Scripting</h1><h2 id="1-概念-1"><a href="#1-概念-1" class="headerlink" title="1.概念"></a>1.概念</h2><p>Scripting是Elasticsearch支持的一种专门用于复杂场景下支持自定义编程的强大的脚本功能，ES支持多种脚本语言，如painless，其语法类似于java，也有注释、关键字、类型、变量、函数等，其相对于其他脚本高出几倍性能，并且安全可靠，可以用于内联合存储脚本</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/f35oht-0.png" alt="image-20230713091228197"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 语法</span></span><br><span class="line">POST product/_update/2</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;script&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;source&quot;</span>: <span class="string">&quot;SCRIPT&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="2-基础使用"><a href="#2-基础使用" class="headerlink" title="2.基础使用"></a>2.基础使用</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">POST product2/_update/1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;script&quot;</span>: &#123;</span><br><span class="line">  <span class="comment"># ctx表示上下文</span></span><br><span class="line">    <span class="string">&quot;source&quot;</span>: <span class="string">&quot;ctx._source.num-=1&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="3-scripting的CURD"><a href="#3-scripting的CURD" class="headerlink" title="3.scripting的CURD"></a>3.scripting的CURD</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 备份数据</span></span><br><span class="line">POST _reindex</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;source&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;index&quot;</span>: <span class="string">&quot;product&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;dest&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;index&quot;</span>: <span class="string">&quot;product3&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-修改新增"><a href="#1-修改新增" class="headerlink" title="1.修改新增"></a>1.修改新增</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">POST product/_update/2</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;script&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;lang&quot;</span>: <span class="string">&quot;painless&quot;</span>,</span><br><span class="line">    <span class="string">&quot;source&quot;</span>: <span class="string">&quot;ctx._source.tags.add(&#x27;无线充电&#x27;)&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># upsert update + insert</span></span><br><span class="line"><span class="comment"># 如果有2这条数据就修改price，没有就新增下面那条语句</span></span><br><span class="line">POST product/_update/2</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;script&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;lang&quot;</span>: <span class="string">&quot;painless&quot;</span>,</span><br><span class="line">    <span class="string">&quot;source&quot;</span>: <span class="string">&quot;ctx._source.price +=100&#x27;&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;upsert&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>:<span class="string">&quot;xiaomi&quot;</span>,</span><br><span class="line">    <span class="string">&quot;desc&quot;</span>:123,</span><br><span class="line">    <span class="string">&quot;price&quot;</span>:199</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-删除"><a href="#2-删除" class="headerlink" title="2.删除"></a>2.删除</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">POST product/_update/2</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;script&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;lang&quot;</span>: <span class="string">&quot;painless&quot;</span>,</span><br><span class="line">    <span class="string">&quot;source&quot;</span>: <span class="string">&quot;ctx.op=&#x27;delete&#x27;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-查询"><a href="#3-查询" class="headerlink" title="3.查询"></a>3.查询</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查询</span></span><br><span class="line">GET product/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;script_fields&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;my_price&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;script&quot;</span>:&#123;</span><br><span class="line">      <span class="string">&quot;lang&quot;</span>: <span class="string">&quot;expression&quot;</span>, </span><br><span class="line">      <span class="string">&quot;source&quot;</span>: <span class="string">&quot;doc[&#x27;price&#x27;]&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">GET product/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;script_fields&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;my_price&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;script&quot;</span>:&#123;</span><br><span class="line">      <span class="string">&quot;lang&quot;</span>: <span class="string">&quot;painless&quot;</span>, </span><br><span class="line">      <span class="string">&quot;source&quot;</span>: <span class="string">&quot;doc[&#x27;price&#x27;].value+100&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-参数化脚本"><a href="#4-参数化脚本" class="headerlink" title="4.参数化脚本"></a>4.参数化脚本</h2><p><strong>Elasticsearch在执行脚本之前需要编译脚本，这是一个相对耗时的操作。为了提高性能，可以使用params参数来避免编译脚本。params参数可以在脚本中使用，它允许你在执行脚本时传递参数，而不是在脚本中写死参数值。这样，如果脚本只是参数值不同，就可以避免重复编译脚本，从而提高性能。</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 参数化脚本</span></span><br><span class="line">POST product/_update/1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;script&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;lang&quot;</span>: <span class="string">&quot;painless&quot;</span>,</span><br><span class="line">    <span class="string">&quot;source&quot;</span>: <span class="string">&quot;ctx._source.tags.add(params.tags_name); ctx._source.tags.add(params.tags_name2)&quot;</span>,</span><br><span class="line">    <span class="string">&quot;params&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;tags_name&quot;</span>:<span class="string">&quot;无线充电&quot;</span>,</span><br><span class="line">      <span class="string">&quot;tags_name2&quot;</span>:<span class="string">&quot;快充&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">GET product/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;script_fields&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;price&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;script&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;lang&quot;</span>: <span class="string">&quot;painless&quot;</span>,</span><br><span class="line">        <span class="string">&quot;source&quot;</span>: <span class="string">&quot;[doc[&#x27;price&#x27;].value * params.d8,doc[&#x27;price&#x27;].value * params.d7,doc[&#x27;price&#x27;].value * params.d6]&quot;</span>,</span><br><span class="line">        <span class="string">&quot;params&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;d8&quot;</span>:0.8,</span><br><span class="line">          <span class="string">&quot;d7&quot;</span>:0.7,</span><br><span class="line">          <span class="string">&quot;d6&quot;</span>:0.6</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="5-scripts模板"><a href="#5-scripts模板" class="headerlink" title="5.scripts模板"></a>5.scripts模板</h2><p><strong>Elasticsearch会把模板保存在集群的缓存中</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Stored scripts</span></span><br><span class="line"><span class="comment"># /_scripts/&#123;id&#125;</span></span><br><span class="line"><span class="comment"># 创建模板</span></span><br><span class="line">POST _scripts/calculate</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;script&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;lang&quot;</span>: <span class="string">&quot;painless&quot;</span>,</span><br><span class="line">    <span class="string">&quot;source&quot;</span>: <span class="string">&quot;doc.price.value * params.discount&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 查看模板</span></span><br><span class="line">GET _scripts/calculate</span><br><span class="line"><span class="comment"># 使用脚本</span></span><br><span class="line">GET product/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;script_fields&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;discount_fields&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;script&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="string">&quot;calculate&quot;</span>,</span><br><span class="line">        <span class="string">&quot;params&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;discount&quot;</span>:0.8</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="6-函数式编程"><a href="#6-函数式编程" class="headerlink" title="6.函数式编程"></a>6.函数式编程</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/i9bfvj-0.png" alt="image-20230713110353579"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">GET product/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;script&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;lang&quot;</span>: <span class="string">&quot;painless&quot;</span>,</span><br><span class="line">    <span class="string">&quot;source&quot;</span>: <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">    if(ctx._source.name ==~ /[\s\S]*小米[\s\S]*/) &#123;</span></span><br><span class="line"><span class="string">      ctx._source.name+=&quot;</span>***<span class="string">&quot;</span></span><br><span class="line"><span class="string">    &#125;else&#123;</span></span><br><span class="line"><span class="string">      ctx.op=&quot;</span>noop<span class="string">&quot;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 统计所有价格小于1000的商品的tag数量</span></span><br><span class="line">GET product/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;constant_score&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;filter&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;range&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;price&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;lte&quot;</span>:1000</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;tag_agg&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;sum&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;script&quot;</span>: </span><br><span class="line">          <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">          int total = 0;</span></span><br><span class="line"><span class="string">          for(int i= 0; i&lt;doc[&#x27;tags&#x27;].length; i++)&#123;</span></span><br><span class="line"><span class="string">          total++;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">         &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="7-doc-‘field’-value和params-‘-source’-‘field’-区别"><a href="#7-doc-‘field’-value和params-‘-source’-‘field’-区别" class="headerlink" title="7.doc[‘field’].value和params[‘_source’][‘field’]区别"></a>7.doc[‘field’].value和params[‘_source’][‘field’]区别</h2><p><strong>doc和params都只能查询_source中的数据</strong></p>
<p>在Elasticsearch中，doc[‘field’].value和params[‘_source’][‘field’]都是用于访问文档字段的方式。但是，它们之间有一些区别。</p>
<p>doc[‘field’].value是一种更快的方式，它将字段的术语加载到内存中，以便脚本可以更快地访问它们。但是，它只能访问简单字段值，例如数字或字符串。</p>
<p>params[‘_source’][‘field’]是一种更通用的方式，它可以访问复杂字段值，例如嵌套对象或数组。但是，它比doc[‘field’].value慢，因为它需要从磁盘中加载整个文档并解析JSON格式。</p>
<h1 id="10-索引的批量操作"><a href="#10-索引的批量操作" class="headerlink" title="10.索引的批量操作"></a>10.索引的批量操作</h1><h2 id="1-基于mget的批量查询"><a href="#1-基于mget的批量查询" class="headerlink" title="1.基于mget的批量查询"></a>1.基于mget的批量查询</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">GET /_mget</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;docs&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;product&quot;</span>,</span><br><span class="line">      <span class="string">&quot;_id&quot;</span>:3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;product&quot;</span>,</span><br><span class="line">      <span class="string">&quot;_id&quot;</span>:1</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">GET product/_mget</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;ids&quot;</span>:[3,1]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># </span></span><br><span class="line">GET /_mget</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;docs&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;product&quot;</span>,</span><br><span class="line">      <span class="string">&quot;_id&quot;</span>: 3,</span><br><span class="line">      <span class="string">&quot;_source&quot;</span>:[</span><br><span class="line">        <span class="string">&quot;price&quot;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;product&quot;</span>,</span><br><span class="line">      <span class="string">&quot;_id&quot;</span>: 1,</span><br><span class="line">      <span class="string">&quot;_source&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;include&quot;</span>:[</span><br><span class="line">          <span class="string">&quot;name&quot;</span></span><br><span class="line">          ],</span><br><span class="line">          <span class="string">&quot;exclude&quot;</span>:[</span><br><span class="line">            <span class="string">&quot;price&quot;</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="2-文档的操作类型"><a href="#2-文档的操作类型" class="headerlink" title="2.文档的操作类型"></a>2.文档的操作类型</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/it4h8x-0.png" alt="image-20230723102638235"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># create</span></span><br><span class="line">PUT test_index/_create/3</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;test_field&quot;</span>:<span class="string">&quot;test&quot;</span>,</span><br><span class="line">    <span class="string">&quot;test_title&quot;</span>:<span class="string">&quot;title&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 自动生成id</span></span><br><span class="line">POST test_index/_doc</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;test_field&quot;</span>:<span class="string">&quot;test&quot;</span>,</span><br><span class="line">  <span class="string">&quot;test_title&quot;</span>:<span class="string">&quot;title&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># delete:懒删除</span></span><br><span class="line">DELETE test_index/_doc/3</span><br><span class="line"></span><br><span class="line"><span class="comment"># update</span></span><br><span class="line"><span class="comment"># 全量或增量更新</span></span><br><span class="line">POST /test_index/_update/iXifgIkBcdO9ST1Q54i5/</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;doc&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;test_field&quot;</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">    <span class="string">&quot;test_title&quot;</span>: <span class="string">&quot;title&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 全量</span></span><br><span class="line">POST /test_index/_doc/iXifgIkBcdO9ST1Q54i5/</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;test_field&quot;</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">    <span class="string">&quot;test_title&quot;</span>: <span class="string">&quot;title&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># index：可以是创建，也可以是全量替换</span></span><br><span class="line">PUT test_index/_doc/iXifgIkBcdO9ST1Q54i5?op_type=index</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;test_title&quot;</span>:1</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#?filter_path=items.*.error:只输出错误的信息</span></span><br></pre></td></tr></table></figure>



<h2 id="3-基于-bulk的增删改"><a href="#3-基于-bulk的增删改" class="headerlink" title="3.基于_bulk的增删改"></a>3.基于_bulk的增删改</h2><p><strong>传统的增删改都要在内存中序列化成JSON对象，而是用bulk不消耗额外内存</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#POST /_bulk</span></span><br><span class="line"><span class="comment">#POST /&lt;index&gt;/_bulk</span></span><br><span class="line"><span class="comment">#&#123;&quot;action&quot;: &#123;&quot;metadata&quot;&#125;&#125;</span></span><br><span class="line"><span class="comment">#&#123;&quot;data&quot;&#125;</span></span><br><span class="line">POST _bulk?filter_path=items.*.error</span><br><span class="line">&#123; <span class="string">&quot;create&quot;</span>: &#123;<span class="string">&quot;_index&quot;</span>: <span class="string">&quot;product&quot;</span>,<span class="string">&quot;_id&quot;</span>: 2&#125;&#125;</span><br><span class="line">&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;_bulk create&quot;</span>&#125;</span><br><span class="line">&#123; <span class="string">&quot;delete&quot;</span>: &#123;<span class="string">&quot;_index&quot;</span>: <span class="string">&quot;product&quot;</span>,<span class="string">&quot;_id&quot;</span>: 2&#125;&#125;</span><br><span class="line">&#123; <span class="string">&quot;update&quot;</span>: &#123;<span class="string">&quot;_index&quot;</span>: <span class="string">&quot;product&quot;</span>,<span class="string">&quot;_id&quot;</span>: 2&#125;&#125;</span><br><span class="line">&#123;<span class="string">&quot;doc&quot;</span>:&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;_bulk create11&quot;</span>&#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="11-模糊查询"><a href="#11-模糊查询" class="headerlink" title="11.模糊查询"></a>11.模糊查询</h1><h2 id="1-prefix：前缀搜索"><a href="#1-prefix：前缀搜索" class="headerlink" title="1.prefix：前缀搜索"></a>1.prefix：前缀搜索</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/itjln2-0.png" alt="image-20230723113759738"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/nxp15j-0.png" alt="image-20230723144726293"></p>
<h2 id="2-wildcard：通配符"><a href="#2-wildcard：通配符" class="headerlink" title="2.wildcard：通配符"></a>2.wildcard：通配符</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/nzdocz-0.png" alt="image-20230723145012836"></p>
<h2 id="3-regexp：正则表达式"><a href="#3-regexp：正则表达式" class="headerlink" title="3.regexp：正则表达式"></a>3.regexp：正则表达式</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/o1r1uk-0.png" alt="image-20230723145408720"></p>
<h2 id="4-fuzzy模糊查询"><a href="#4-fuzzy模糊查询" class="headerlink" title="4.fuzzy模糊查询"></a>4.fuzzy模糊查询</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/ou974i-0.png" alt="image-20230723150157764"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># match也可用使用模糊查询，但是match是分词的，fuzzy是不分词的</span></span><br><span class="line">GET product/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;desc&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;query&quot;</span>: <span class="string">&quot;nfe quaha&quot;</span>,</span><br><span class="line">        <span class="string">&quot;fuzziness&quot;</span>: 1</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="5-match-phrase-prefix：短语前缀"><a href="#5-match-phrase-prefix：短语前缀" class="headerlink" title="5.match_phrase_prefix：短语前缀"></a>5.match_phrase_prefix：短语前缀</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20230723151406305.png" alt="image-20230723151406305"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">GET product/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match_phrase_prefix&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;desc&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;query&quot;</span>: <span class="string">&quot;zhong&quot;</span>,</span><br><span class="line">        <span class="string">&quot;max_expansions&quot;</span>: 10, <span class="comment"># 是分片级别的限制</span></span><br><span class="line">        <span class="string">&quot;slop&quot;</span>: 3</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="6-ngram和edge-ngram"><a href="#6-ngram和edge-ngram" class="headerlink" title="6.ngram和edge-ngram"></a>6.ngram和edge-ngram</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/piydc2-0.png" alt="image-20230723154345325"></p>
<p><strong>ngram默认的min_gram和max_gram分别是1和2，edge_ngram都是1</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># ngram可以在前缀，中缀，后缀都能使用</span><br><span class="line"># edge_ngram只能在前缀使用</span><br><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;standard&quot;,</span><br><span class="line">  &quot;filter&quot;: [&quot;edge_ngram&quot;],</span><br><span class="line">  &quot;text&quot;: &quot;reba always loves me&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># ngram结果</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;r&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 4,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;re&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 4,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;e&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 4,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;eb&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 4,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;b&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 4,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;ba&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 4,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;a&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 4,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;a&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 5,</span><br><span class="line">      &quot;end_offset&quot; : 11,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;al&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 5,</span><br><span class="line">      &quot;end_offset&quot; : 11,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;l&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 5,</span><br><span class="line">      &quot;end_offset&quot; : 11,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;lw&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 5,</span><br><span class="line">      &quot;end_offset&quot; : 11,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;w&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 5,</span><br><span class="line">      &quot;end_offset&quot; : 11,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;wa&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 5,</span><br><span class="line">      &quot;end_offset&quot; : 11,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;a&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 5,</span><br><span class="line">      &quot;end_offset&quot; : 11,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;ay&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 5,</span><br><span class="line">      &quot;end_offset&quot; : 11,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;y&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 5,</span><br><span class="line">      &quot;end_offset&quot; : 11,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;ys&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 5,</span><br><span class="line">      &quot;end_offset&quot; : 11,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;s&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 5,</span><br><span class="line">      &quot;end_offset&quot; : 11,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;l&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 12,</span><br><span class="line">      &quot;end_offset&quot; : 17,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;lo&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 12,</span><br><span class="line">      &quot;end_offset&quot; : 17,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;o&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 12,</span><br><span class="line">      &quot;end_offset&quot; : 17,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;ov&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 12,</span><br><span class="line">      &quot;end_offset&quot; : 17,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;v&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 12,</span><br><span class="line">      &quot;end_offset&quot; : 17,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;ve&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 12,</span><br><span class="line">      &quot;end_offset&quot; : 17,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;e&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 12,</span><br><span class="line">      &quot;end_offset&quot; : 17,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;es&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 12,</span><br><span class="line">      &quot;end_offset&quot; : 17,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;s&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 12,</span><br><span class="line">      &quot;end_offset&quot; : 17,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;m&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 18,</span><br><span class="line">      &quot;end_offset&quot; : 20,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;me&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 18,</span><br><span class="line">      &quot;end_offset&quot; : 20,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;e&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 18,</span><br><span class="line">      &quot;end_offset&quot; : 20,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 3</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># edge_ngram结果</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;r&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 4,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;a&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 5,</span><br><span class="line">      &quot;end_offset&quot; : 11,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;l&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 12,</span><br><span class="line">      &quot;end_offset&quot; : 17,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;m&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 18,</span><br><span class="line">      &quot;end_offset&quot; : 20,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 3</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="12-搜索推荐"><a href="#12-搜索推荐" class="headerlink" title="12.搜索推荐"></a>12.搜索推荐</h1><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/pqk3wq-0.png" alt="image-20230723155623358"></p>
<h2 id="1-Term-Suggester"><a href="#1-Term-Suggester" class="headerlink" title="1.Term Suggester"></a>1.Term Suggester</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/pqzz82-0.png" alt="image-20230723155658051"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/pru08a-0.png" alt="image-20230723155838665"></p>
<h2 id="2-phrase-suggester"><a href="#2-phrase-suggester" class="headerlink" title="2.phrase suggester"></a>2.phrase suggester</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/qpji9t-0.png" alt="image-20230723161458910"></p>
<p><strong>在使用Phrase之前，需要定义一个特定的mapping</strong></p>
<h2 id="3-completion-suggester"><a href="#3-completion-suggester" class="headerlink" title="3.completion suggester"></a>3.completion suggester</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/qxynmy-0.png" alt="image-20230723162914547"></p>
<p><strong>使用之前先创建mapping</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/r09zm3-0.png" alt="image-20230723163303066"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/r12iwf-0.png" alt="image-20230723163436872"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/r1h8zx-0.png" alt="image-20230723163505077"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/r2z27w-0.png" alt="image-20230723163756295"></p>
<h2 id="4-Context-Suggester"><a href="#4-Context-Suggester" class="headerlink" title="4.Context Suggester"></a>4.Context Suggester</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/r3kp41-0.png" alt="image-20230723163856871"></p>
<p><strong>使用之前也必须创建mapping</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/r4r4ox-0.png" alt="image-20230723164055119"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/r5vtra-0.png" alt="image-20230723164244325"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/r8p1xt-0.png" alt="image-20230723164717164"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/r8toa7-0.png" alt="image-20230723164738869"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/r9aod0-0.png" alt="image-20230723164818251"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/rahlbt-0.png" alt="image-20230723165018188"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/ralqzy-0.png" alt="image-20230723165037517"></p>
<h1 id="13-数据建模"><a href="#13-数据建模" class="headerlink" title="13.数据建模"></a>13.数据建模</h1><h2 id="1-嵌套类型查询：Nested"><a href="#1-嵌套类型查询：Nested" class="headerlink" title="1.嵌套类型查询：Nested"></a>1.嵌套类型查询：Nested</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/sae18u-0.png" alt="image-20230723171048222"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/sc6xr7-0.png" alt="image-20230723171351490"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/sdz9zp-0.png" alt="image-20230723171651878"></p>
<h2 id="2-父子级关系查询：Join"><a href="#2-父子级关系查询：Join" class="headerlink" title="2.父子级关系查询：Join"></a>2.父子级关系查询：Join</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/sl24ko-0.png" alt="image-20230723172840889"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/sihe8k-0.png" alt="image-20230723172407516"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/sk971b-0.png" alt="image-20230723172705560"></p>
<p><strong>使用routing指定分片</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/sm0yh3-0.png" alt="image-20230723173002496"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/snuz7s-0.png" alt="image-20230723173310633"></p>
<h2 id="3-数据建模"><a href="#3-数据建模" class="headerlink" title="3.数据建模"></a>3.数据建模</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/soh4l2-0.png" alt="image-20230723173412424"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/sqda0v-0.png" alt="image-20230723173730078"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/ssk1ng-0.png" alt="image-20230723174059545"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/stdtok-0.png" alt="image-20230723174238437"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/sucm5g-0.png" alt="image-20230723174400203"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/suid7n-0.png" alt="image-20230723174426836"></p>
<h1 id="14-es客户端"><a href="#14-es客户端" class="headerlink" title="14.es客户端"></a>14.es客户端</h1><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w2ie98-0.png" alt="image-20230724193905189"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w2k3d3-0.png"></p>
<h1 id="15-Elasticsearch分布式原理"><a href="#15-Elasticsearch分布式原理" class="headerlink" title="15.Elasticsearch分布式原理"></a>15.Elasticsearch分布式原理</h1><h2 id="1-单机服务有哪些问题？"><a href="#1-单机服务有哪些问题？" class="headerlink" title="1.单机服务有哪些问题？"></a>1.单机服务有哪些问题？</h2><ul>
<li>性能有限</li>
<li>可用性差</li>
<li>难以扩展</li>
</ul>
<h2 id="2-分布式的好处"><a href="#2-分布式的好处" class="headerlink" title="2.分布式的好处"></a>2.分布式的好处</h2><ul>
<li>高可用性：集群可容忍部分节点宕机而保持服务的可用性和数据的完整性</li>
<li>易扩展性：当集群的性能不满足业务要求时，可以方便快速的扩容集群，而无需停止服务</li>
<li>高性能：集群通过负载均衡器分摊并发请求压力，可以大大提高集群的吞吐能力和并发能力</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/xpngd9-0.png" alt="image-20230724203842799"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/xuemdz-0.png" alt="image-20230724204618678"></p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">AYO</div><div class="post-copyright__author_desc">天行健，君子以自强不息</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://www.yuki.love/2024/06/20/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/ELK%E6%97%A5%E5%BF%97%E5%B9%B3%E5%8F%B0/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://www.yuki.love/2024/06/20/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/ELK%E6%97%A5%E5%BF%97%E5%B9%B3%E5%8F%B0/')">ELK</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://www.yuki.love/2024/06/20/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/ELK%E6%97%A5%E5%BF%97%E5%B9%B3%E5%8F%B0/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=ELK&amp;url=https://www.yuki.love/2024/06/20/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/ELK%E6%97%A5%E5%BF%97%E5%B9%B3%E5%8F%B0/&amp;pic=https://pic4.zhimg.com/v2-c2b3eb3319d52218753d0ce20bc7c100_r.jpg?_r_=6c3f9f4e-576c-c6b6-dcee-92acc2517142" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.yuki.love" target="_blank">AYO</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Linux/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Linux<span class="tagsPageCount">22</span></a><a class="post-meta__box__tags" href="/tags/Database/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Database<span class="tagsPageCount">8</span></a><a class="post-meta__box__tags" href="/tags/ELK/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>ELK<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://pic4.zhimg.com/v2-c2b3eb3319d52218753d0ce20bc7c100_r.jpg?_r_=6c3f9f4e-576c-c6b6-dcee-92acc2517142" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2024/06/01/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Nginx/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic1.zhimg.com/v2-0cc45f5fda6e8ff79350ec1303835629_r.jpg?source=1940ef5c&amp;_r_=c68f1e80-4c0f-608c-c12b-8408d5dfad74" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Nginx反向代理配置</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2023/02/15/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/DNS%E4%B8%8ECDN/" title="DNS"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://th.bing.com/th/id/R.d8dfd08893b58d08d74b38ad8870a48d?rik=9KBqff6Rai035Q&riu=http%3A%2F%2Fstatic.cntonan.com%2Fuploadfile%2F2019%2F0214%2F20190214104244pwm1xxsdikh.jpg&ehk=MOxI2n5nY44gO%2FKsNYWAuEBvcRwSmkRVNb4dTS6Gk%2BY%3D&risl=&pid=ImgRaw&r=0&_r_=72c5c74e-eb50-91dc-2f47-7594a0701bd0" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-02-15</div><div class="title">DNS</div></div></a></div><div><a href="/2024/03/20/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/HTTPD/" title="Httpd"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://th.bing.com/th/id/OIP.IV7LvR2MoBb3y-EKG9uAJAHaEK?rs=1&pid=ImgDetMain&_r_=d1b32877-dc3a-1263-57fe-13e0e7c8297c" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-03-20</div><div class="title">Httpd</div></div></a></div><div><a href="/2023/04/20/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/LVS/" title="LVS"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic2.zhimg.com/v2-264805954c1f033af43e006cb826ab60_r.jpg?source=1940ef5c&_r_=ecbebc4e-3997-3e9e-ce01-3c72e48cf774" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-04-20</div><div class="title">LVS</div></div></a></div><div><a href="/2024/03/20/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/Linux%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/" title="Linux日志管理"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://th.bing.com/th/id/OIP.IV7LvR2MoBb3y-EKG9uAJAHaEK?rs=1&pid=ImgDetMain&_r_=1880e756-a713-9a9b-ca9e-ed4ee628b270" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-03-20</div><div class="title">Linux日志管理</div></div></a></div><div><a href="/2023/04/22/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/Linux%E5%AE%89%E5%85%A8/" title="Linux安全"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic1.zhimg.com/v2-0cc45f5fda6e8ff79350ec1303835629_r.jpg?source=1940ef5c&_r_=4c42e96f-e7b2-2688-9605-788332b74254" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-04-22</div><div class="title">Linux安全</div></div></a></div><div><a href="/2024/01/15/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/Linux/" title="Linux"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://th.bing.com/th/id/R.4cb70989991c1861426358cb196b6d01?rik=83OmAlSQSFM51Q&riu=http%3A%2F%2Fpic.bizhi360.com%2Fbpic%2F88%2F9588_8.jpg&ehk=Vc5LFstc1coz3liGA9YtX3SOl%2BcMJTlRfHNhk%2F4%2FA0w%3D&risl=&pid=ImgRaw&r=0&_r_=494ba667-f738-de76-9b69-b2e30368a39e" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-01-15</div><div class="title">Linux</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-switch"><span class="first-comment">Twikoo</span><span id="switch-btn"></span><span class="second-comment">Waline</span></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div><div><div id="waline-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);"><b style="color:#fff">AYO的知识输出基地，</b><b style="color:#fff">以输出倒逼输入，以输出巩固知识！</b></div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">AYO</h1><div class="author-info__desc">天行健，君子以自强不息</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/AYO-Al" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://juejin.cn/user/3708003152300183" target="_blank" title="JueJin"><i class="anzhiyufont anzhiyu-icon-book"></i></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-ELK%E6%9E%B6%E6%9E%84%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">1.ELK架构介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">2.环境安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%AE%89%E8%A3%85JDK"><span class="toc-number">2.1.</span> <span class="toc-text">1.安装JDK</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%AE%89%E8%A3%85Elasticsearch"><span class="toc-number">2.2.</span> <span class="toc-text">2.安装Elasticsearch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%AE%89%E8%A3%85Kibana"><span class="toc-number">2.3.</span> <span class="toc-text">3.安装Kibana</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%AE%89%E8%A3%85Head%E6%8F%92%E4%BB%B6"><span class="toc-number">2.4.</span> <span class="toc-text">4.安装Head插件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-YUM%E5%AE%89%E8%A3%85"><span class="toc-number">2.5.</span> <span class="toc-text">5.YUM安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%9B%86%E7%BE%A4%E7%9A%84%E5%81%A5%E5%BA%B7%E5%80%BC%E6%A3%80%E6%9F%A5"><span class="toc-number">2.5.1.</span> <span class="toc-text">1.集群的健康值检查</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">3.</span> <span class="toc-text">3.核心概念</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95"><span class="toc-number">3.1.</span> <span class="toc-text">1.倒排索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-FOR%E5%8E%8B%E7%BC%A9%E7%AE%97%E6%B3%95"><span class="toc-number">3.1.1.</span> <span class="toc-text">1.FOR压缩算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-RBM%E5%8E%8B%E7%BC%A9%E7%AE%97%E6%B3%95"><span class="toc-number">3.1.2.</span> <span class="toc-text">2.RBM压缩算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-FST%E5%8E%8B%E7%BC%A9%E7%AE%97%E6%B3%95"><span class="toc-number">3.1.3.</span> <span class="toc-text">3.FST压缩算法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-tip%E5%92%8Ctim%E6%96%87%E4%BB%B6%E5%86%85%E9%83%A8%E7%BB%93%E6%9E%84"><span class="toc-number">3.2.</span> <span class="toc-text">2.tip和tim文件内部结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">3.2.1.</span> <span class="toc-text"></span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-FSt%E5%9C%A8Lucene%E4%B8%AD%E7%9A%84%E6%9E%84%E5%BB%BA%E5%92%8C%E8%AF%BB%E5%8F%96%E8%BF%87%E7%A8%8B"><span class="toc-number">3.3.</span> <span class="toc-text">3.FSt在Lucene中的构建和读取过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E9%9B%86%E7%BE%A4%E3%80%81%E8%8A%82%E7%82%B9%E5%92%8C%E5%88%86%E7%89%87"><span class="toc-number">3.4.</span> <span class="toc-text">4.集群、节点和分片</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E7%B4%A2%E5%BC%95%E7%9A%84CRUD"><span class="toc-number">4.</span> <span class="toc-text">4.索引的CRUD</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-Mapping"><span class="toc-number">5.</span> <span class="toc-text">5.Mapping</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%A6%82%E5%BF%B5"><span class="toc-number">5.1.</span> <span class="toc-text">1.概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%9F%A5%E7%9C%8Bmapping"><span class="toc-number">5.2.</span> <span class="toc-text">2.查看mapping</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-ES%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.3.</span> <span class="toc-text">3.ES数据类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E4%B8%A4%E7%A7%8D%E6%98%A0%E5%B0%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.4.</span> <span class="toc-text">4.两种映射类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%98%A0%E5%B0%84%E5%8F%82%E6%95%B0"><span class="toc-number">5.5.</span> <span class="toc-text">5.映射参数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E6%90%9C%E7%B4%A2%E5%92%8C%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.</span> <span class="toc-text">6.搜索和查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%9B%B8%E5%85%B3%E5%BA%A6%E8%AF%84%E5%88%86"><span class="toc-number">6.1.</span> <span class="toc-text">1.相关度评分</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%85%83%E6%95%B0%E6%8D%AE-source"><span class="toc-number">6.2.</span> <span class="toc-text">2.元数据_source</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Query-String"><span class="toc-number">6.3.</span> <span class="toc-text">3.Query String</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2%EF%BC%9Amatch"><span class="toc-number">6.4.</span> <span class="toc-text">4.全文检索：match</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E7%B2%BE%E5%87%86%E5%8C%B9%E9%85%8D%EF%BC%9Aexact-match"><span class="toc-number">6.5.</span> <span class="toc-text">5.精准匹配：exact match</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">6.6.</span> <span class="toc-text">6.过滤器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E7%BB%84%E5%90%88%E6%9F%A5%E8%AF%A2%EF%BC%9Abool-query"><span class="toc-number">6.7.</span> <span class="toc-text">7.组合查询：bool query</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-number">7.</span> <span class="toc-text">7.分词器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BD%BF%E7%94%A8%E5%88%86%E8%AF%8D%E5%99%A8%E6%9F%A5%E7%9C%8B%E5%88%86%E8%AF%8D%E7%BB%93%E6%9E%9C"><span class="toc-number">7.1.</span> <span class="toc-text">1.使用分词器查看分词结果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-normalization"><span class="toc-number">7.2.</span> <span class="toc-text">2.normalization</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%AD%97%E7%AC%A6%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">7.3.</span> <span class="toc-text">3.字符过滤器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E4%BB%A4%E7%89%8C%E8%BF%87%E6%BB%A4%E5%99%A8%EF%BC%9Atoken-filter"><span class="toc-number">7.4.</span> <span class="toc-text">4.令牌过滤器：token filter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%88%86%E8%AF%8D%E5%99%A8%EF%BC%9Atokenizer"><span class="toc-number">7.5.</span> <span class="toc-text">5.分词器：tokenizer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-number">7.6.</span> <span class="toc-text">6.中文分词器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E5%85%B3%E4%BA%8E%E7%83%AD%E6%9B%B4%E6%96%B0"><span class="toc-number">7.7.</span> <span class="toc-text">7.关于热更新</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%85%B3%E4%BA%8E%E8%BF%9C%E7%A8%8B%E8%AF%8D%E5%BA%93%E7%9A%84%E7%83%AD%E6%9B%B4%E6%96%B0"><span class="toc-number">7.7.1.</span> <span class="toc-text">1.关于远程词库的热更新</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%85%B3%E4%BA%8E%E5%9F%BA%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E7%83%AD%E6%9B%B4%E6%96%B0"><span class="toc-number">7.7.2.</span> <span class="toc-text">2.关于基于数据库的热更新</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2%EF%BC%9AAggregation"><span class="toc-number">8.</span> <span class="toc-text">8.聚合查询：Aggregation</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%9F%BA%E7%A1%80%E8%81%9A%E5%90%88"><span class="toc-number">8.1.</span> <span class="toc-text">1.基础聚合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%86%E6%A1%B6%E8%81%9A%E5%90%88-Bucket-agregations"><span class="toc-number">8.1.1.</span> <span class="toc-text">1.分桶聚合(Bucket agregations)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%8C%87%E6%A0%87%E8%81%9A%E5%90%88-Metrics-agregations"><span class="toc-number">8.1.2.</span> <span class="toc-text">2.指标聚合(Metrics agregations)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%AE%A1%E9%81%93%E8%81%9A%E5%90%88-Pipeline-agregation"><span class="toc-number">8.1.3.</span> <span class="toc-text">3.管道聚合(Pipeline agregation)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%B5%8C%E5%A5%97%E8%81%9A%E5%90%88%EF%BC%9A%E5%9F%BA%E4%BA%8E%E8%81%9A%E5%90%88%E7%BB%93%E6%9E%9C%E7%9A%84%E8%81%9A%E5%90%88"><span class="toc-number">8.2.</span> <span class="toc-text">2.嵌套聚合：基于聚合结果的聚合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%9F%BA%E4%BA%8E%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E7%9A%84%E8%81%9A%E5%90%88%E5%92%8C%E5%9F%BA%E4%BA%8E%E8%81%9A%E5%90%88%E7%BB%93%E6%9E%9C%E7%9A%84%E6%9F%A5%E8%AF%A2"><span class="toc-number">8.3.</span> <span class="toc-text">3.基于查询结果的聚合和基于聚合结果的查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E8%81%9A%E5%90%88%E6%8E%92%E5%BA%8F"><span class="toc-number">8.4.</span> <span class="toc-text">4.聚合排序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%B8%B8%E8%A7%81%E7%9A%84%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-number">8.5.</span> <span class="toc-text">5.常见的聚合函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-histogram"><span class="toc-number">8.5.1.</span> <span class="toc-text">1.histogram</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-percentile"><span class="toc-number">8.5.2.</span> <span class="toc-text">2.percentile</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-%E8%84%9A%E6%9C%AC%E6%9F%A5%E8%AF%A2-Scripting"><span class="toc-number">9.</span> <span class="toc-text">9.脚本查询:Scripting</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%A6%82%E5%BF%B5-1"><span class="toc-number">9.1.</span> <span class="toc-text">1.概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8"><span class="toc-number">9.2.</span> <span class="toc-text">2.基础使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-scripting%E7%9A%84CURD"><span class="toc-number">9.3.</span> <span class="toc-text">3.scripting的CURD</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BF%AE%E6%94%B9%E6%96%B0%E5%A2%9E"><span class="toc-number">9.3.1.</span> <span class="toc-text">1.修改新增</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%A0%E9%99%A4"><span class="toc-number">9.3.2.</span> <span class="toc-text">2.删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%9F%A5%E8%AF%A2"><span class="toc-number">9.3.3.</span> <span class="toc-text">3.查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%8F%82%E6%95%B0%E5%8C%96%E8%84%9A%E6%9C%AC"><span class="toc-number">9.4.</span> <span class="toc-text">4.参数化脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-scripts%E6%A8%A1%E6%9D%BF"><span class="toc-number">9.5.</span> <span class="toc-text">5.scripts模板</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B"><span class="toc-number">9.6.</span> <span class="toc-text">6.函数式编程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-doc-%E2%80%98field%E2%80%99-value%E5%92%8Cparams-%E2%80%98-source%E2%80%99-%E2%80%98field%E2%80%99-%E5%8C%BA%E5%88%AB"><span class="toc-number">9.7.</span> <span class="toc-text">7.doc[‘field’].value和params[‘_source’][‘field’]区别</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-%E7%B4%A2%E5%BC%95%E7%9A%84%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C"><span class="toc-number">10.</span> <span class="toc-text">10.索引的批量操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%9F%BA%E4%BA%8Emget%E7%9A%84%E6%89%B9%E9%87%8F%E6%9F%A5%E8%AF%A2"><span class="toc-number">10.1.</span> <span class="toc-text">1.基于mget的批量查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%96%87%E6%A1%A3%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B1%BB%E5%9E%8B"><span class="toc-number">10.2.</span> <span class="toc-text">2.文档的操作类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%9F%BA%E4%BA%8E-bulk%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9"><span class="toc-number">10.3.</span> <span class="toc-text">3.基于_bulk的增删改</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="toc-number">11.</span> <span class="toc-text">11.模糊查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-prefix%EF%BC%9A%E5%89%8D%E7%BC%80%E6%90%9C%E7%B4%A2"><span class="toc-number">11.1.</span> <span class="toc-text">1.prefix：前缀搜索</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-wildcard%EF%BC%9A%E9%80%9A%E9%85%8D%E7%AC%A6"><span class="toc-number">11.2.</span> <span class="toc-text">2.wildcard：通配符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-regexp%EF%BC%9A%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">11.3.</span> <span class="toc-text">3.regexp：正则表达式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-fuzzy%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="toc-number">11.4.</span> <span class="toc-text">4.fuzzy模糊查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-match-phrase-prefix%EF%BC%9A%E7%9F%AD%E8%AF%AD%E5%89%8D%E7%BC%80"><span class="toc-number">11.5.</span> <span class="toc-text">5.match_phrase_prefix：短语前缀</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-ngram%E5%92%8Cedge-ngram"><span class="toc-number">11.6.</span> <span class="toc-text">6.ngram和edge-ngram</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#12-%E6%90%9C%E7%B4%A2%E6%8E%A8%E8%8D%90"><span class="toc-number">12.</span> <span class="toc-text">12.搜索推荐</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Term-Suggester"><span class="toc-number">12.1.</span> <span class="toc-text">1.Term Suggester</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-phrase-suggester"><span class="toc-number">12.2.</span> <span class="toc-text">2.phrase suggester</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-completion-suggester"><span class="toc-number">12.3.</span> <span class="toc-text">3.completion suggester</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Context-Suggester"><span class="toc-number">12.4.</span> <span class="toc-text">4.Context Suggester</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#13-%E6%95%B0%E6%8D%AE%E5%BB%BA%E6%A8%A1"><span class="toc-number">13.</span> <span class="toc-text">13.数据建模</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%B5%8C%E5%A5%97%E7%B1%BB%E5%9E%8B%E6%9F%A5%E8%AF%A2%EF%BC%9ANested"><span class="toc-number">13.1.</span> <span class="toc-text">1.嵌套类型查询：Nested</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E7%88%B6%E5%AD%90%E7%BA%A7%E5%85%B3%E7%B3%BB%E6%9F%A5%E8%AF%A2%EF%BC%9AJoin"><span class="toc-number">13.2.</span> <span class="toc-text">2.父子级关系查询：Join</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%95%B0%E6%8D%AE%E5%BB%BA%E6%A8%A1"><span class="toc-number">13.3.</span> <span class="toc-text">3.数据建模</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#14-es%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">14.</span> <span class="toc-text">14.es客户端</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#15-Elasticsearch%E5%88%86%E5%B8%83%E5%BC%8F%E5%8E%9F%E7%90%86"><span class="toc-number">15.</span> <span class="toc-text">15.Elasticsearch分布式原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%8D%95%E6%9C%BA%E6%9C%8D%E5%8A%A1%E6%9C%89%E5%93%AA%E4%BA%9B%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="toc-number">15.1.</span> <span class="toc-text">1.单机服务有哪些问题？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%88%86%E5%B8%83%E5%BC%8F%E7%9A%84%E5%A5%BD%E5%A4%84"><span class="toc-number">15.2.</span> <span class="toc-text">2.分布式的好处</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/06/20/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/ELK%E6%97%A5%E5%BF%97%E5%B9%B3%E5%8F%B0/" title="ELK"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic4.zhimg.com/v2-c2b3eb3319d52218753d0ce20bc7c100_r.jpg?_r_=6c3f9f4e-576c-c6b6-dcee-92acc2517142" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ELK"/></a><div class="content"><a class="title" href="/2024/06/20/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/ELK%E6%97%A5%E5%BF%97%E5%B9%B3%E5%8F%B0/" title="ELK">ELK</a><time datetime="2024-06-19T16:00:00.000Z" title="发表于 2024-06-20 00:00:00">2024-06-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/01/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Nginx/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" title="Nginx反向代理配置"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic1.zhimg.com/v2-0cc45f5fda6e8ff79350ec1303835629_r.jpg?source=1940ef5c&amp;_r_=c68f1e80-4c0f-608c-c12b-8408d5dfad74" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nginx反向代理配置"/></a><div class="content"><a class="title" href="/2024/06/01/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Nginx/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" title="Nginx反向代理配置">Nginx反向代理配置</a><time datetime="2024-05-31T16:00:00.000Z" title="发表于 2024-06-01 00:00:00">2024-06-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/27/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Nginx/Nginx-all/" title="Nginx模块"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://th.bing.com/th/id/R.d8dfd08893b58d08d74b38ad8870a48d?rik=9KBqff6Rai035Q&amp;riu=http%3A%2F%2Fstatic.cntonan.com%2Fuploadfile%2F2019%2F0214%2F20190214104244pwm1xxsdikh.jpg&amp;ehk=MOxI2n5nY44gO%2FKsNYWAuEBvcRwSmkRVNb4dTS6Gk%2BY%3D&amp;risl=&amp;pid=ImgRaw&amp;r=0&amp;_r_=94f86d0f-25c2-9dfb-f7a3-57d28c353d04" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nginx模块"/></a><div class="content"><a class="title" href="/2024/05/27/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Nginx/Nginx-all/" title="Nginx模块">Nginx模块</a><time datetime="2024-05-26T16:00:00.000Z" title="发表于 2024-05-27 00:00:00">2024-05-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/22/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%8E%E7%A3%81%E7%9B%98/" title="Linux文件系统与磁盘"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://th.bing.com/th/id/R.4cb70989991c1861426358cb196b6d01?rik=83OmAlSQSFM51Q&amp;riu=http%3A%2F%2Fpic.bizhi360.com%2Fbpic%2F88%2F9588_8.jpg&amp;ehk=Vc5LFstc1coz3liGA9YtX3SOl%2BcMJTlRfHNhk%2F4%2FA0w%3D&amp;risl=&amp;pid=ImgRaw&amp;r=0&amp;_r_=d5bf5c62-a48f-b710-2900-dd8067c6536d" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux文件系统与磁盘"/></a><div class="content"><a class="title" href="/2024/05/22/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%8E%E7%A3%81%E7%9B%98/" title="Linux文件系统与磁盘">Linux文件系统与磁盘</a><time datetime="2024-05-21T16:00:00.000Z" title="发表于 2024-05-22 00:00:00">2024-05-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/11/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/%E9%98%B2%E7%81%AB%E5%A2%99/" title="Linux防火墙"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://th.bing.com/th/id/R.4cb70989991c1861426358cb196b6d01?rik=83OmAlSQSFM51Q&amp;riu=http%3A%2F%2Fpic.bizhi360.com%2Fbpic%2F88%2F9588_8.jpg&amp;ehk=Vc5LFstc1coz3liGA9YtX3SOl%2BcMJTlRfHNhk%2F4%2FA0w%3D&amp;risl=&amp;pid=ImgRaw&amp;r=0&amp;_r_=d354d21d-c9ea-92b8-4903-99284305900f" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux防火墙"/></a><div class="content"><a class="title" href="/2024/05/11/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/%E9%98%B2%E7%81%AB%E5%A2%99/" title="Linux防火墙">Linux防火墙</a><time datetime="2024-05-10T16:00:00.000Z" title="发表于 2024-05-11 00:00:00">2024-05-11</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="/2609320892@qq.com" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://regexlearn.com/zh-cn" title="Regex 101"><i class="anzhiyufont anzhiyu-icon-font"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://regexcrossword.com/" title="Regexcrossword"><i class="anzhiyufont anzhiyu-icon-bolt"></i></a><a class="deal_link" href="/atom.xml" title="RSS"><i class="anzhiyufont anzhiyu-icon-rss"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0, 500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" size="50px"/><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/AYO-Al" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://learngitbranching.js.org/?demo=&amp;locale=zh_CN" title="Learn Git"><i class="anzhiyufont anzhiyu-icon-pencil"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://www.drawio.com/" title="draw.io"><i class="anzhiyufont anzhiyu-icon-instagram"></i></a><a class="deal_link" href="/copyright" title="CC"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i></a></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="algolia" target="_blank" rel="noopener" href="https://www.algolia.com/">algolia</a><a class="footer-item" title="twikoo" target="_blank" rel="noopener" href="https://twikoo.js.org/">twikoo</a><a class="footer-item" title="vercel" target="_blank" rel="noopener" href="https://vercel.com/">vercel</a></div></div><div class="footer-group"><div class="footer-title">主题</div><div class="footer-links"><a class="footer-item" title="文档" target="_blank" rel="noopener" href="https://docs.anheyu.com/">文档</a><a class="footer-item" title="源码" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu">源码</a><a class="footer-item" title="更新日志" target="_blank" rel="noopener" href="https://blog.anheyu.com/update/">更新日志</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="即刻短文" href="/essay/">即刻短文</a><a class="footer-item" title="友链文章" href="/fcircle/">友链文章</a><a class="footer-item" title="留言板" href="/comments/">留言板</a></div></div><div class="footer-group"><div class="footer-title">协议</div><div class="footer-links"><a class="footer-item" title="隐私协议" href="/privacy/">隐私协议</a><a class="footer-item" title="Cookies" href="/cookies/">Cookies</a><a class="footer-item" title="版权协议" href="/copyright/">版权协议</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v7.0.0" title="博客框架为Hexo_v7.0.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v7.0.0"/></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"/></a><a class="github-badge" target="_blank" href="https://www.dogecloud.com/" style="margin-inline:5px" data-title="本站使用多吉云为静态资源提供CDN加速" title="本站使用多吉云为静态资源提供CDN加速"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/CDN-多吉云-3693F3.svg" alt="本站使用多吉云为静态资源提供CDN加速"/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="本站项目由Github托管"/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2021 - 2024 By <a class="footer-bar-link" href="/" title="AYO" target="_blank">AYO</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      if (true) {
        const from = '出自 ' + data.from
        const sub = ["生活明朗&#44; 万物可爱&#44; 人间值得&#44; 未来可期."]
        sub.unshift(data.hitokoto, from)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = data.hitokoto
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.cbd.int/typed.js@2.0.15/dist/typed.umd.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/AYO-Al/AYO-Al.github.io" title="博客">博客</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/AYO-Al" title="本站项目由GitHub托管">本站项目由GitHub托管</a><a class="footer-bar-link cc" href="/copyright" title="cc协议"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-by-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nc-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nd-line"></i></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">53</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">46</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">8</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://git.yuki.love/" title="AYO网站"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="AYO网站"/><span class="back-menu-item-text">AYO网站</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://juejin.cn/user/3708003152300183" title="AYO博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="AYO博客"/><span class="back-menu-item-text">AYO博客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/AYO-Al" title="GitHub"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="GitHub"/><span class="back-menu-item-text">GitHub</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Ansible/" style="font-size: 0.88rem;">Ansible<sup>1</sup></a><a href="/tags/CDN/" style="font-size: 0.88rem;">CDN<sup>1</sup></a><a href="/tags/DNS/" style="font-size: 0.88rem;">DNS<sup>1</sup></a><a href="/tags/Database/" style="font-size: 0.88rem;">Database<sup>8</sup></a><a href="/tags/Docker/" style="font-size: 0.88rem;">Docker<sup>1</sup></a><a href="/tags/ELK/" style="font-size: 0.88rem;">ELK<sup>1</sup></a><a href="/tags/Flask/" style="font-size: 0.88rem;">Flask<sup>1</sup></a><a href="/tags/Httpd/" style="font-size: 0.88rem;">Httpd<sup>1</sup></a><a href="/tags/JavaScript/" style="font-size: 0.88rem;">JavaScript<sup>1</sup></a><a href="/tags/Keepalived/" style="font-size: 0.88rem;">Keepalived<sup>1</sup></a><a href="/tags/LVS/" style="font-size: 0.88rem;">LVS<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>22</sup></a><a href="/tags/MLinux/" style="font-size: 0.88rem;">MLinux<sup>1</sup></a><a href="/tags/MySQL/" style="font-size: 0.88rem;">MySQL<sup>6</sup></a><a href="/tags/Nginx/" style="font-size: 0.88rem;">Nginx<sup>3</sup></a><a href="/tags/Prometheus/" style="font-size: 0.88rem;">Prometheus<sup>1</sup></a><a href="/tags/Python/" style="font-size: 0.88rem;">Python<sup>8</sup></a><a href="/tags/Rabbit/" style="font-size: 0.88rem;">Rabbit<sup>1</sup></a><a href="/tags/Redis/" style="font-size: 0.88rem;">Redis<sup>2</sup></a><a href="/tags/Shell/" style="font-size: 0.88rem;">Shell<sup>3</sup></a><a href="/tags/Web/" style="font-size: 0.88rem;">Web<sup>2</sup></a><a href="/tags/Zabbix/" style="font-size: 0.88rem;">Zabbix<sup>2</sup></a><a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 0.88rem;">中间件<sup>1</sup></a><a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" style="font-size: 0.88rem;">云计算<sup>7</sup></a><a href="/tags/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" style="font-size: 0.88rem;">反向代理<sup>1</sup></a><a href="/tags/%E5%9B%9B%E5%A4%A7%E4%BB%B6/" style="font-size: 0.88rem;">四大件<sup>3</sup></a><a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 0.88rem;">开发<sup>7</sup></a><a href="/tags/%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB%E6%9C%8D%E5%8A%A1/" style="font-size: 0.88rem;">文件共享服务<sup>1</sup></a><a href="/tags/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" style="font-size: 0.88rem;">文件系统<sup>1</sup></a><a href="/tags/%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/" style="font-size: 0.88rem;">日志管理<sup>1</sup></a><a href="/tags/%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5/" style="font-size: 0.88rem;">时间同步<sup>1</sup></a><a href="/tags/%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/" style="font-size: 0.88rem;">服务管理<sup>1</sup></a><a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 0.88rem;">爬虫<sup>4</sup></a><a href="/tags/%E7%9B%91%E6%8E%A7/" style="font-size: 0.88rem;">监控<sup>3</sup></a><a href="/tags/%E7%A3%81%E7%9B%98/" style="font-size: 0.88rem;">磁盘<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 0.88rem;">网络<sup>4</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E6%9E%B6%E6%9E%84/" style="font-size: 0.88rem;">网络架构<sup>1</sup></a><a href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/" style="font-size: 0.88rem;">自动化运维<sup>1</sup></a><a href="/tags/%E8%BD%AF%E4%BB%B6%E7%AE%A1%E7%90%86/" style="font-size: 0.88rem;">软件管理<sup>1</sup></a><a href="/tags/%E9%98%B2%E7%81%AB%E5%A2%99/" style="font-size: 0.88rem;">防火墙<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"><a class="tag-list" href="/tags/Linux" title="Linux">Linux</a><a class="tag-list" href="/tags/Database" title="Database">Database</a><a class="tag-list" href="/tags/Kubernetes" title="Kubernetes">Kubernetes</a></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.4/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2021 By 安知鱼 V1.6.10",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 AYO 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.56.5/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.yuki.love',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.yuki.love',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><script>(() => {
  const initWaline = () => {
    const waline = Waline.init(Object.assign({
      el: '#waline-wrap',
      serverURL: '',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: false,
    }, null))
  }

  const loadWaline = async () => {
    if (typeof Waline === 'object') initWaline()
    else {
      await getCSS('https://cdn.cbd.int/@waline/client@2.15.5/dist/waline.css')
      await getScript('https://cdn.cbd.int/@waline/client@2.15.5/dist/waline.js')
      initWaline()
    }
  }

  if ('Twikoo' === 'Waline' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo.yuki.love',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "visitor@anheyu.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/fireworks.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>