<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>Rabbit | AYO</title><meta name="keywords" content="Rabbit,中间件"><meta name="author" content="AYO,2609320892@qq.com"><meta name="copyright" content="AYO"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="Rabbit"><meta name="application-name" content="Rabbit"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="Rabbit"><meta property="og:url" content="https://www.yuki.love/2023/04/22/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/RabbitMQ/index.html"><meta property="og:site_name" content="AYO"><meta property="og:description" content="本文介绍了Rabbit相关知识。"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://th.bing.com/th/id/R.d8dfd08893b58d08d74b38ad8870a48d?rik=9KBqff6Rai035Q&amp;riu=http%3A%2F%2Fstatic.cntonan.com%2Fuploadfile%2F2019%2F0214%2F20190214104244pwm1xxsdikh.jpg&amp;ehk=MOxI2n5nY44gO%2FKsNYWAuEBvcRwSmkRVNb4dTS6Gk%2BY%3D&amp;risl=&amp;pid=ImgRaw&amp;r=0&amp;_r_=acfa0787-21e7-a269-f390-c11386b71948"><meta property="article:author" content="AYO"><meta property="article:tag" content=""><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://th.bing.com/th/id/R.d8dfd08893b58d08d74b38ad8870a48d?rik=9KBqff6Rai035Q&amp;riu=http%3A%2F%2Fstatic.cntonan.com%2Fuploadfile%2F2019%2F0214%2F20190214104244pwm1xxsdikh.jpg&amp;ehk=MOxI2n5nY44gO%2FKsNYWAuEBvcRwSmkRVNb4dTS6Gk%2BY%3D&amp;risl=&amp;pid=ImgRaw&amp;r=0&amp;_r_=acfa0787-21e7-a269-f390-c11386b71948"><meta name="description" content="本文介绍了Rabbit相关知识。"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://www.yuki.love/2023/04/22/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/RabbitMQ/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: undefined,
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: 'https://twikoo.yuki.love',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: undefined,
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","🤝 专修交互与设计","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},
  algolia: {"appId":"XMRZIUY8NL","apiKey":"187af2610e1cc500c95dc8b8f3a53d0e","indexName":"hexo","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: AYO","link":"链接: ","source":"来源: AYO","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'AYO',
  title: 'Rabbit',
  postAI: '',
  pageFillDescription: '1.介绍中间件, 2.主流消息中间件技术, 3.RabbitMQ高性能原因, 4.AMQP协议, 5.Exchange的作用, 6.RabbitMQ快速安装, 7.网页端管理工具, 8.命令行工具上手, 9.RabbitMQ消息交换的关键, 10.具体实例分析, 10.1.需求分析与架构设计, 10.2.数据库设计与项目搭建, 11.保证消息可靠性, 11.1.发送端确认机制, 11.2.消息返回机制, 11.3.消费端确认, 11.4.消费端限流机制, 11.5.消息过期机制, 11.6.死信队列, 12.RabbitMQ集群, 12.1.RabbitMQ集群搭建, 12.2.RabbitMQ镜像队列, 12.3.RabbitMQ实现高可用, 12.4.HAProxy+Keepalived高可用, 12.5.RabbitMQ集群间通信原理, 12.6.总结, 13.RabbitMQ集群高可用, 13.1.使用DockerCompose部署高可用集群, 13.2.使用Kubernetes部署高可用集群, 13.3.分析集群网络分区的意义与风险, 13.4.网络分区的解决办法, 13.5.RabbitMQ状态监控, 13.6.总结, 14.基于RabbitMQ的分布式框架, 14.1.分布式框架设计, 14.2.消息发送重试, 14.3.消息消费失败重试, 14.4.死信消息告警介绍中间件什么是中间件是提供软件和软件之间连接的软件以便于软件各部之间的沟通比如微信相当于消息中间件使用消息中间件的优势业务调用链短用户等待时间短部分组件故障不会瘫痪整个业务业务高峰期有缓冲业务高峰期时不会常数大量的异步线程使用消息中间件的作用异步处理系统解耦流量削峰和流控消息广播消息收集最终一致性是一个开源的消息代理和队列服务器用来通过普通协议在完全不同的应用之间共享数据是使用语言来编写的并且是基于协议的主流消息中间件技术总结高性能原因特点总结协议介绍协议高级消息队列协议作为的规范规定了对外接口是具有现代特征的二进制协议是一个提供统一消息服务的应用层标准高级消息队列协议是应用层协议的一个开放标准为面向消息的中间件设计在协议或者是实现中最核心的组件是承担的核心功能路由转发有多个种类配置多变需要详细讲解的作用时协议和的核心组件的功能是根据绑定关系和路由键为消息提供路由将消息转发至相应的队列有种类型以前三种为主中如果和一致则将发送到对应的中每个发送到的都会分发到所有绑定的上去根据及通配规则将消息分发到目标全匹配与类似中的匹配任意个数的中的匹配任意个可以在线实验规则总结快速安装安装安装拉取镜像手动安装安装下载下载获取包获取秘钥安装开启网页管理工具网页端管理工具命令行工具上手状态查看查看状态查看绑定查看查看查看消费者查看交换机消息交换的关键协议直接定义了的内部结构和外部行为使用本质上是在使用协议协议被多种消息中间件使用消息流转的流程发送者不能直接将消息发送给最终队列必须发送给交换机消息根据路由规则消息由交换机转发给队列消费者从队列将消息取走合理的交换机和队列设置交换机数量不能过多一般来说同一个业务或者同一类业务使用同一个交换机合理设置队列数量一般来说一个微服务监听一个队列或者一个微服务的一个业务监听一个队列合理配置交换机类型使用模式时仔细设置绑定键尽量使用自动化配置将创建交换机队列的操作固化在应用代码中免去复杂的运维操作高效且不易出错一般来说交换机由双方同时声明队列由接收方声明且配置绑定关系交换机队列的参数一定要由双方开发团队确认否则重复声明时若参数不一致会导致声明失败具体实例分析需求分析与架构设计需求分析架构设计什么是微服务架构是一种软件架构风格它定义了一组原则和约束用于设计和实现基于协议的服务风格的接口是指遵循原则和约束的服务接口它可以让不同的应用或设备之间通过协议进行数据交换风格的接口主要有以下特点基于资源每个资源都有一个唯一的标识符可以通过等方法对资源进行操作无状态每个请求都包含了足够的信息服务器不需要保存客户端的状态或上下文统一接口客户端和服务器之间遵循统一的规范如使用或作为数据格式使用状态码表示操作结果等分层系统客户端只能看到当前层次的服务器而不需要知道整个系统的结构或细节数据库设计与项目搭建保证消息可靠性发送方消费方发送端确认机制什么是发送端确认机制消息发送后若中间件收到消息会给发送端一个应答生产者接收应答用来确认这条消息是否正常发送到中间件三种确认机制单条同步确认多条同步确认异步确认机制消息返回机制消费端确认消费端限流机制消息过期机制死信队列集群扩展规模一般的基础结构中单机扩容很难实现需要扩容时尽量使用扩展数量实现集群可以方便的通过扩展规模数据冗余对于单节点如果节点宕机内存数据丢失对于单节点如果节点损坏磁盘丢失集群可以通过镜像队列将数据冗余至多个节点高可用如果单节点宕机服务不可用集群可以通过负载均衡将请求转移至可用节点集群搭建多个单节点经过配置组成集群集群节点之间共享元数据不共享队列数据默认节点数据互相转发客户端通过单一节点可以访问所有数据集群搭建步骤查看要求全部集群节点的全部一样加入集群主机名镜像队列多个单节点经过配置组成集群集群节点之间共享元数据切共享特定队列数据节点数据互相转发客户端通过单一节点可以访问所有数据集群镜像队列设置实现高可用客户端负载均衡服务端负载均衡什么是是一款提供高可用负载均衡以及基于和应用的代理软件适用于那些负载较大的站点可以支持数以万计的并发连接配置方法安装配置使用四层代理模式配置文件目录全局配置默认日志输出配置设置最大连接数设置守护模式设置默认值应用全局配置配置模式记录不记录健康检查日志失败检查次数配置最大连接数配置连接超时时间配置客户端超时时间配置服务端超时时间配置一个转发设置轮训方式配置后端转发目的地和多少检查一次连接检查几次是好的才认为是好的及检查几次是坏的才是坏的及权重开放端口运行网页健康检查放开权限高可用简介高性能的服务器高可用或热备解决方案主要来防止服务器单点故障的发生问题协议为实现基础用协议来实现高可用安装配置邮箱服务器一般公司内也不设置标识这台机器默认情况下是主机名可以配置成主机名所有报文都检查比较消耗性能此配置为如果收到的报文和上一个报文是同一个路由器则跳过检查报文中的源地址严格遵守协议不允许状况没有地址配置了单播邻居在版本中有地址报文发送延迟消息发送延迟指定组播地址默认值范围到避免生成链规则拒绝执行脚本位置检测时间间隔如果条件成立则权重减虚拟路由器名称在一个可以启多个虚拟路由器每个虚拟路由器的名字都不一样当前节点在此虚拟路由器上的初始状态状态为或者一般都是配置该值无法决定身份最终还是通过比较绑定为当前虚拟路由器使用的物理接口如每个虚拟路由器惟一标识范围同一组虚拟路由器的必须一致当前物理节点在此虚拟路由器的优先级范围每个主机节点此值不同通告的时间间隔默认认证机制不推荐或预共享密钥仅前位有效同一个虚拟路由器的多个节点必须一样虚拟指定不指定网卡默认为注意不指定默认为指定的网卡指定的网卡健康检测脚本脚本名称第一台服务器执行脚本集群间通信原理集群间通信方法联邦铲子通过协议使用一个内部交换机让原本发送到一个集群的消息转发到另一个集群消息可以从交换机转发至交换机也可以由队列转发至队列消息可以单向转发也可以双向转发设置方法可以持续的从一个拉去消息转发至另一个的使用较为灵活可以配置从队列至交换机从队列至队列从交换机至交换机总结体系结构升级的根本原因是需求不要盲目升级更高级的架构更高级的架构意味着对运维有更高的要求多思考架构拓扑形成更好的架构思维集群高可用什么是真正的高可用在传统以物理机虚拟机为基础的架构中服务宕机往往需要人工处理随着容器技术的发展容器编排框架可以很好的解决高可用问题已经成为容器编排的事实标准能够承载集群网络分区故障在实际生产中网络分区是非常常见的故障原因网络分区的排查和处理难度较大需要专门研究状态监控在生产环境中需要实时关注集群状态状态包括流量内存占用占用等使用部署高可用集群什么是是新一代虚拟化技术与虚拟机相比具有轻量化高性能的优势什么是是用于定义和运行多容器应用程序的工具通过可以使用文件来配置应用程序需要的所有服务使用一个目录就可以从文件配置中创建并启动所有服务同一台机器使用搭建集群使用版本启动那几个容器使用镜像实例名端口映射表示数组环境变量自定义使用镜像实例名端口映射表示数组环境变量自定义使用网络连接根据开始生成启动容器的环境停止应用使用部署高可用集群什么是可以自动化调度运维容器已经成为微服务基础架构的事实标准中的最小业务单元内含一个或多个容器定义一组有状态将自动维护定义一组无状态将自动维护一组的抽象访问方式相当于负载均衡器相当于负载均衡层元数据命名空间用于注入配置文件使配置生效分析集群网络分区的意义与风险什么是网络分区网络分区指的是集群分裂为了两个网络孤岛集群网络模型集群采用单向环状网络模型集群网络分区的意义如果出现和网络不可连接此时可以人为造成网络分区保存部分集群正常运行网络分区的影响未配置镜像队列发送消息的目标队列与节点一致未配置镜像队列发送消息的目标队列与节点不一致未配置镜像队列接收消息的目标队列与节点一致未配置镜像队列接收消息的目标队列与节点不一致总结网络分区指的是系统网络被分割为了不互通的两部分相对于网络部分故障彻底的分区有时是有意义的不同的系统运行状态下网络分区的影响不尽相同网络分区的解决办法如何制造网络分区封禁解封地址或者端口号关闭开启网卡挂起恢复操作系统如何发现网络分区使用命令使用管控台查看使用网络分区处理办法手动处理挂起客户端进程可以减少不必要的消息丢失如果进程数过多可跳过删除镜像队列的配置如果没有删除镜像队列配置恢复过程中可能会出现队列漂移现象挑选信任分区挑选的指标有是否有节点分区节点数分区队列数分区客户端连接数关闭非信任区的节点采用命令只关闭应用不会关闭虚拟机启动非信任区的节点检查网络分区是否恢复恢复则直接天界镜像队列配置若没有则重启信任分区节点恢复生产者和消费者的进程若步骤并未挂起客户端进程也应该检查客户端见了必要时重启客户端自动处理中有中网络分区自动处理模式默认是模式不自动处理如要开启配置中的参数发生网络分区时接地那自动检测自己是否处于少数派若是则关闭自己若出现了节点数相同的两个分区可能会导致两个分区全部关闭每个节点预先配置一个节点列表当失去和列表中所有接地那的通信时关闭自己此方法考验配置的合理性配置不合理可能会导致集群节点全部宕机发送网络分区时每个节点使用特定算法自动决定一个获胜分区然后重启不在分区的其他节点当节点中有关闭状态时不起作用状态监控状态监控方式通过客户端判断节点是否健康通过监控集群状态通过监控中间件监控客户端使用客户端创建与若能成功则节点健康若失败则节点挂机或与节点的网络连接异常使用接口获得节点信息使用接口获得状态不加后面两个参数则获取全部状态信息使用接口获得状态信息监控中间件常见的监控中间件有等的底层原理是调用再将数据处理存储展示不足发送消息时无法自动重试若消息发送失败没有重试处理机制若集群短暂宕机消息丢失业务异常无法得知接收方处理情况发送无法得知消息是否被处理若消息丢失业务异常无法自动处理并标记死信死信消息依赖人工处理需要自动处理并标记消息状态的标记依赖数据库或缓存对消息状态进行存储总结运维是一项不断演进的技术需要对技术原理有深入了解容器浪潮是不可阻挡的要掌握容器和容器平台知识集群宕机多数是因为资源不足和网络故障排查故障应首先从这两方面开始基于的分布式框架什么是事务事务指的是一系列业务操作只能同时成功或同时失败传统事务有个特性原子性一致性隔离性持久性微服务化带来的挑战在传统单体应用中事务在本地即可完成随着后端架构的微服务化事务无法在本地完成所以需要将事务分布式化分布式框架设计分布式事务框架设计根据上述分析我们的分布式事务框架应该包含以下部分发送失败重试消费失败重试死信告警消息发送重试发送消息前消息持久化发送成功时删除消息定时巡检未发送成功消息重试发送消息消费失败重试收到消息时先进行持久化消息处理成功消费端确认删除消息消息处理失败延时不确认消息记录次数再次处理消息死信消息告警声明死信队列交换机绑定普通队列加入死信设置监听到死信持久化告警',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-02-17 15:02:05',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.0.0"><link rel="alternate" href="/atom.xml" title="AYO" type="application/atom+xml">
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://git.yuki.love/" title="AYO网站"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="AYO网站"/><span class="back-menu-item-text">AYO网站</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://juejin.cn/user/3708003152300183" title="AYO博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="AYO博客"/><span class="back-menu-item-text">AYO博客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/AYO-Al" title="GitHub"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="GitHub"/><span class="back-menu-item-text">GitHub</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">AYO</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Ansible/" style="font-size: 1.05rem;">Ansible<sup>1</sup></a><a href="/tags/CDN/" style="font-size: 1.05rem;">CDN<sup>1</sup></a><a href="/tags/DNS/" style="font-size: 1.05rem;">DNS<sup>1</sup></a><a href="/tags/Database/" style="font-size: 1.05rem;">Database<sup>8</sup></a><a href="/tags/Docker/" style="font-size: 1.05rem;">Docker<sup>1</sup></a><a href="/tags/ELK/" style="font-size: 1.05rem;">ELK<sup>1</sup></a><a href="/tags/Flask/" style="font-size: 1.05rem;">Flask<sup>1</sup></a><a href="/tags/Httpd/" style="font-size: 1.05rem;">Httpd<sup>1</sup></a><a href="/tags/JavaScript/" style="font-size: 1.05rem;">JavaScript<sup>1</sup></a><a href="/tags/Keepalived/" style="font-size: 1.05rem;">Keepalived<sup>1</sup></a><a href="/tags/LVS/" style="font-size: 1.05rem;">LVS<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 1.05rem;">Linux<sup>22</sup></a><a href="/tags/MLinux/" style="font-size: 1.05rem;">MLinux<sup>1</sup></a><a href="/tags/MySQL/" style="font-size: 1.05rem;">MySQL<sup>6</sup></a><a href="/tags/Nginx/" style="font-size: 1.05rem;">Nginx<sup>3</sup></a><a href="/tags/Prometheus/" style="font-size: 1.05rem;">Prometheus<sup>1</sup></a><a href="/tags/Python/" style="font-size: 1.05rem;">Python<sup>8</sup></a><a href="/tags/Rabbit/" style="font-size: 1.05rem;">Rabbit<sup>1</sup></a><a href="/tags/Redis/" style="font-size: 1.05rem;">Redis<sup>2</sup></a><a href="/tags/Shell/" style="font-size: 1.05rem;">Shell<sup>3</sup></a><a href="/tags/Web/" style="font-size: 1.05rem;">Web<sup>2</sup></a><a href="/tags/Zabbix/" style="font-size: 1.05rem;">Zabbix<sup>2</sup></a><a href="/tags/%E4%B8%89%E9%AB%98MySQL/" style="font-size: 1.05rem;">三高MySQL<sup>1</sup></a><a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 1.05rem;">中间件<sup>1</sup></a><a href="/tags/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" style="font-size: 1.05rem;">主从复制<sup>1</sup></a><a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" style="font-size: 1.05rem;">云计算<sup>7</sup></a><a href="/tags/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" style="font-size: 1.05rem;">反向代理<sup>1</sup></a><a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 1.05rem;">开发<sup>7</sup></a><a href="/tags/%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB%E6%9C%8D%E5%8A%A1/" style="font-size: 1.05rem;">文件共享服务<sup>1</sup></a><a href="/tags/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" style="font-size: 1.05rem;">文件系统<sup>1</sup></a><a href="/tags/%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/" style="font-size: 1.05rem;">日志管理<sup>1</sup></a><a href="/tags/%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5/" style="font-size: 1.05rem;">时间同步<sup>1</sup></a><a href="/tags/%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/" style="font-size: 1.05rem;">服务管理<sup>1</sup></a><a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 1.05rem;">爬虫<sup>4</sup></a><a href="/tags/%E7%9B%91%E6%8E%A7/" style="font-size: 1.05rem;">监控<sup>3</sup></a><a href="/tags/%E7%A3%81%E7%9B%98/" style="font-size: 1.05rem;">磁盘<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 1.05rem;">网络<sup>3</sup></a><a href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/" style="font-size: 1.05rem;">自动化运维<sup>1</sup></a><a href="/tags/%E8%BD%AF%E4%BB%B6%E7%AE%A1%E7%90%86/" style="font-size: 1.05rem;">软件管理<sup>1</sup></a><a href="/tags/%E9%98%B2%E7%81%AB%E5%A2%99/" style="font-size: 1.05rem;">防火墙<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">三月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">十一月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/10/"><span class="card-archive-list-date">十月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/09/"><span class="card-archive-list-date">九月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/" itemprop="url">中间件</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Rabbit/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Rabbit</span></a><a class="article-meta__tags" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>中间件</span></a></span></div></div><h1 class="post-title" itemprop="name headline">Rabbit</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-04-21T16:00:00.000Z" title="发表于 2023-04-22 00:00:00">2023-04-22</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-02-17T07:02:05.168Z" title="更新于 2024-02-17 15:02:05">2024-02-17</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">5.6k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>19分钟</span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为长沙"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>长沙</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://th.bing.com/th/id/R.d8dfd08893b58d08d74b38ad8870a48d?rik=9KBqff6Rai035Q&amp;riu=http%3A%2F%2Fstatic.cntonan.com%2Fuploadfile%2F2019%2F0214%2F20190214104244pwm1xxsdikh.jpg&amp;ehk=MOxI2n5nY44gO%2FKsNYWAuEBvcRwSmkRVNb4dTS6Gk%2BY%3D&amp;risl=&amp;pid=ImgRaw&amp;r=0&amp;_r_=acfa0787-21e7-a269-f390-c11386b71948"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://www.yuki.love/2023/04/22/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/RabbitMQ/"><header><a class="post-meta-categories" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/" itemprop="url">中间件</a><a href="/tags/Rabbit/" tabindex="-1" itemprop="url">Rabbit</a><a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" tabindex="-1" itemprop="url">中间件</a><h1 id="CrawlerTitle" itemprop="name headline">Rabbit</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">AYO</span><time itemprop="dateCreated datePublished" datetime="2023-04-21T16:00:00.000Z" title="发表于 2023-04-22 00:00:00">2023-04-22</time><time itemprop="dateCreated datePublished" datetime="2024-02-17T07:02:05.168Z" title="更新于 2024-02-17 15:02:05">2024-02-17</time></header><h1 id="1-介绍中间件"><a href="#1-介绍中间件" class="headerlink" title="1.介绍中间件"></a>1.介绍中间件</h1><blockquote>
<p>什么是中间件(Middleware)</p>
</blockquote>
<p>是提供软件和软件之间连接的软件，以便于软件各部之间的沟通，比如：微信相当于<code>消息中间件</code></p>
<blockquote>
<p>使用消息中间件的优势</p>
</blockquote>
<ul>
<li>业务调用链短，用户等待时间短</li>
<li>部分组件故障不会瘫痪整个业务</li>
<li>业务高峰期有缓冲</li>
<li>业务高峰期时不会常数大量的异步线程</li>
</ul>
<blockquote>
<p>使用消息中间件的作用</p>
</blockquote>
<ul>
<li><p><strong>异步处理</strong></p>
</li>
<li><p><strong>系统解耦</strong></p>
</li>
<li><p>流量削峰和流控</p>
</li>
<li><p>消息广播</p>
</li>
<li><p>消息收集</p>
</li>
<li><p>最终一致性</p>
</li>
</ul>
<blockquote>
<p>RabbitMQ</p>
</blockquote>
<p><strong>RabbitMQ</strong>是一个开源的消息代理和队列服务器，用来通过普通协议在完全不同的应用之间共享数据，RabbitMQ是使用Erlang语言来编写的，并且RabbitMQ是基于<strong>AMQP</strong>协议的</p>
<h1 id="2-主流消息中间件技术"><a href="#2-主流消息中间件技术" class="headerlink" title="2.主流消息中间件技术"></a>2.主流消息中间件技术</h1><blockquote>
<p>ACTIVEMQ</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8kgkx.png" alt="image-20230222164847181"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8ki6z.png" alt="image-20230222164918967"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8knr2.png" alt="image-20230222164946334"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8kn2k.png" alt="image-20230222164956222"></p>
<blockquote>
<p>RabbitMQ</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8kmil.png" alt="image-20230222165036067"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8kk60.png" alt="image-20230222165124659"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8kn6e.png" alt="image-20230222165133285"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8ko8d.png" alt="image-20230222165150102"></p>
<blockquote>
<p>Apache RocketMQ</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8kjpu.png" alt="image-20230222165218293"></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8ki9q.png" alt="image-20230222165229337" style="zoom:150%;" />

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8kvcc.png" alt="image-20230222165238848"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8kr2z.png" alt="image-20230222165246312"></p>
<blockquote>
<p>kafka</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8kwj1.png" alt="image-20230222165332271"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8krui.png" alt="image-20230222165349571"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8kuxk.png" alt="image-20230222165358855"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8kq4y.png" alt="image-20230222165412783"></p>
<blockquote>
<p>总结</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8kr20.png" alt="image-20230222165702812"></p>
<h1 id="3-RabbitMQ高性能原因"><a href="#3-RabbitMQ高性能原因" class="headerlink" title="3.RabbitMQ高性能原因"></a>3.RabbitMQ高性能原因</h1><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8krgl.png" alt="image-20230222165900312"></p>
<blockquote>
<p>Erlang特点</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8kzlu.png" alt="image-20230222170033009"></p>
<blockquote>
<p>总结</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8kzlr.png" alt="image-20230222170212200"></p>
<h1 id="4-AMQP协议"><a href="#4-AMQP协议" class="headerlink" title="4.AMQP协议"></a>4.AMQP协议</h1><blockquote>
<p>介绍</p>
</blockquote>
<ul>
<li>AMQP协议（高级消息队列协议）作为RabbitMQ的规范，规定了RabbitMQ对外接口</li>
<li>是具有现代特征的二进制协议。是一个提供统一消息服务的应用层标准高级消息队列协议，是应用层协议的一个开放标准，为面向消息的中间件设计</li>
</ul>
<p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8kysz.png" alt="image-20230222171814117"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8kxl2.png" alt="image-20230222171853727"></p>
<p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8ky6c.png" alt="image-20230222171932748"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8l1g3.png" alt="image-20230222172034545"></p>
<blockquote>
<p>Exchange</p>
</blockquote>
<ul>
<li><p>在AMQP协议或者是RabbitMQ实现中，最核心的组件是Exchange</p>
</li>
<li><p>Exchange承担RabbitMQ的核心功能—路由转发</p>
</li>
<li><p>Exchange有多个种类，配置多变，需要详细讲解</p>
</li>
</ul>
<h1 id="5-Exchange的作用"><a href="#5-Exchange的作用" class="headerlink" title="5.Exchange的作用"></a>5.Exchange的作用</h1><ul>
<li><p>Exchange时AMQP协议和RabbitMQ的核心组件</p>
</li>
<li><p>Exchange的功能是根据<strong>绑定关系</strong>和<strong>路由键</strong>为消息提供路由，将消息转发至相应的队列</p>
</li>
<li><p>Exchange有4种类型：<strong>Direct、Topic、Fanout</strong>、Headers，以前三种为主</p>
</li>
</ul>
<blockquote>
<p>Direct Exchange</p>
</blockquote>
<ul>
<li>Message中Routing Key如果和BInding Key一致，direct Exchange则将message发送到对应的queue中</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8l7jh.png" alt="image-20230226144723491"></p>
<blockquote>
<p>Fanout Exchange</p>
</blockquote>
<ul>
<li>每个发送到Fanout Exchange的message都会分发到所有绑定的queue上去</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8l8ry.png" alt="image-20230226144941870"></p>
<blockquote>
<p>Topit Exchange</p>
</blockquote>
<ul>
<li><p>根据Routing key及通配规则，Topic Exchange将消息分发到目标Queue</p>
<ul>
<li>全匹配：与DIrect类似</li>
<li>Binging Key中的#：匹配任意个数的word</li>
<li>Binding Key中的*：匹配任意1个word</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8l6j5.png" alt="image-20230226145631688"></p>
</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://tryrabbitmq.com/">RabbitMQ Simulator (tryrabbitmq.com)</a>可以在线实验Exchange规则</p>
</blockquote>
<blockquote>
<p>总结</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8l6c6.png" alt="image-20230226150954374"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8lb61.png" alt="image-20230226151015867"></p>
<h1 id="6-RabbitMQ快速安装"><a href="#6-RabbitMQ快速安装" class="headerlink" title="6.RabbitMQ快速安装"></a>6.RabbitMQ快速安装</h1><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8lgdw.png" alt="image-20230226151326717"></p>
<blockquote>
<p>Windows安装</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8lyqj.png" alt="image-20230226151440450"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8m026.png" alt="image-20230226151535108"></p>
<blockquote>
<p>Linux安装</p>
</blockquote>
<ul>
<li>docker拉取镜像</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8m0eh.png" alt="image-20230226151708341"></p>
<ul>
<li>手动安装<ul>
<li>安装epel：yum install -y epel-release</li>
<li>下载erlang：yum install -y erlang</li>
<li>下载socat：yum install -y socat</li>
<li>获取rpm包：wget <a target="_blank" rel="noopener" href="https://github.com/rabbitmq/rabbitmq-server/releases/download/rabbitmq_v3_6_15/rabbitmq-server-3.6.15-1.el6.noarch.rpm">https://github.com/rabbitmq/rabbitmq-server/releases/download/rabbitmq_v3_6_15/rabbitmq-server-3.6.15-1.el6.noarch.rpm</a></li>
<li>获取秘钥：rpm -import <a target="_blank" rel="noopener" href="https://www.rabbitmq.com/rabbitmq-release-signing-key.asc">https://www.rabbitmq.com/rabbitmq-release-signing-key.asc</a></li>
<li>安装RabbitMQ：rpm -ivh rabbitmq-server-3.6.15-1.el6.noarch.rpm</li>
<li>开启网页管理工具：rabbitmq-plugins enable rabbitmq_management</li>
</ul>
</li>
</ul>
<h1 id="7-网页端管理工具"><a href="#7-网页端管理工具" class="headerlink" title="7.网页端管理工具"></a>7.网页端管理工具</h1><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8m58j.png" alt="image-20230226151927028"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8m2t9.png" alt="image-20230226152049370"></p>
<h1 id="8-命令行工具上手"><a href="#8-命令行工具上手" class="headerlink" title="8.命令行工具上手"></a>8.命令行工具上手</h1><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8m38y.png" alt="image-20230226155056550"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8mccn.png" alt="image-20230226155142994"></p>
<blockquote>
<p>状态查看</p>
</blockquote>
<ul>
<li>查看状态：rabbitmqctl status</li>
<li>查看绑定：rabbitmqctl list_bindings</li>
<li>查看channel：rabbitmqctl list_channels</li>
<li>查看connection：rabbitmqctl list_connections</li>
<li>查看消费者：rabbitmqctl list_consumers</li>
<li>查看交换机：rabbitmqctl list_exchanges</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8mbev.png" alt="image-20230226155510950"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8mdpn.png" alt="image-20230226155526585"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8mcop.png" alt="image-20230226155539538"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8mak4.png" alt="image-20230226155601753"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8mlhh.png" alt="image-20230226155610752"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8mhlm.png" alt="image-20230226155836968"></p>
<h1 id="9-RabbitMQ消息交换的关键"><a href="#9-RabbitMQ消息交换的关键" class="headerlink" title="9.RabbitMQ消息交换的关键"></a>9.RabbitMQ消息交换的关键</h1><blockquote>
<p>AMQP</p>
</blockquote>
<ul>
<li>AMQP协议直接定义了RabbitMQ的内部结构和外部行为</li>
<li>使用RabbitMQ本质上是在使用AMQP协议</li>
<li>AMQP协议被多种消息中间件使用</li>
</ul>
<blockquote>
<p>消息流转的流程</p>
</blockquote>
<ul>
<li>发送者不能直接将消息发送给最终队列，必须发送给交换机</li>
<li>消息根据路由规则，消息由交换机转发给队列</li>
<li>消费者从队列将消息取走</li>
</ul>
<blockquote>
<p>合理的交换机和队列设置</p>
</blockquote>
<ul>
<li>交换机数量不能过多，一般来说同一个业务，或者同一类业务使用同一个交换机</li>
<li>合理设置队列数量，一般来说一个微服务监听一个队列，或者一个微服务的一个业务监听一个队列</li>
<li>合理配置交换机类型，使用Topic模式时仔细设置绑定键</li>
</ul>
<blockquote>
<p>尽量使用自动化配置</p>
</blockquote>
<ul>
<li>将创建交换机&#x2F;队列的操作固化在应用代码中，免去复杂的运维操作，高效且不易出错</li>
<li>一般来说，交换机由双方同时声明，队列由接收方声明且配置绑定关系</li>
<li>交换机&#x2F;队列的参数一定要由双方开发团队确认，否则重复声明时，若参数不一致，会导致声明失败</li>
</ul>
<h1 id="10-具体实例分析"><a href="#10-具体实例分析" class="headerlink" title="10.具体实例分析"></a>10.具体实例分析</h1><h2 id="10-1-需求分析与架构设计"><a href="#10-1-需求分析与架构设计" class="headerlink" title="10.1.需求分析与架构设计"></a>10.1.需求分析与架构设计</h2><blockquote>
<p>需求分析</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8mjfz.png" alt="image-20230227092153458"></p>
<blockquote>
<p>架构设计</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8mlzt.png" alt="image-20230227092246665"></p>
<blockquote>
<p>什么是微服务架构</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8mhzu.png" alt="image-20230227092712108"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8mj1v.png" alt="image-20230227093021066"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8mirf.png" alt="image-20230227093125366"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8ms72.png" alt="image-20230227093230854"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8mtyi.png" alt="image-20230227093412380"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8mrwm.png" alt="image-20230227101750975"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8mpyl.png" alt="image-20230227101826778"></p>
<blockquote>
<ul>
<li>REST（Representational State Transfer）是一种软件架构风格，它定义了一组原则和约束，用于设计和实现基于HTTP协议的Web服务。</li>
<li>REST风格的接口（RESTful API）是指遵循REST原则和约束的Web服务接口，它可以让不同的应用或设备之间通过HTTP协议进行数据交换。</li>
<li>REST风格的接口主要有以下特点：<ul>
<li>基于资源（Resource），每个资源都有一个唯一的标识符（URI），可以通过GET、POST、PUT、DELETE等HTTP方法对资源进行操作。</li>
<li>无状态（Stateless），每个请求都包含了足够的信息，服务器不需要保存客户端的状态或上下文。</li>
<li>统一接口（Uniform Interface），客户端和服务器之间遵循统一的规范，如使用JSON或XML作为数据格式，使用HTTP状态码表示操作结果等。</li>
<li>分层系统（Layered System），客户端只能看到当前层次的服务器，而不需要知道整个系统的结构或细节。</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="10-2-数据库设计与项目搭建"><a href="#10-2-数据库设计与项目搭建" class="headerlink" title="10.2.数据库设计与项目搭建"></a>10.2.数据库设计与项目搭建</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8mrjx.png" alt="image-20230227100718432"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8mrit.png" alt="image-20230227100824329"></p>
<h1 id="11-保证消息可靠性"><a href="#11-保证消息可靠性" class="headerlink" title="11.保证消息可靠性"></a>11.保证消息可靠性</h1><blockquote>
<p>发送方</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8mrj1.png" alt="image-20230228081256003"></p>
<blockquote>
<p>消费方</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8mtkj.png" alt="image-20230228081352702"></p>
<blockquote>
<p>RabbitMQ</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8n0si.png" alt="image-20230228081439255"></p>
<h2 id="11-1-发送端确认机制"><a href="#11-1-发送端确认机制" class="headerlink" title="11.1.发送端确认机制"></a>11.1.发送端确认机制</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8n0xs.png" alt="image-20230228081551897"></p>
<blockquote>
<p>什么是发送端确认机制</p>
</blockquote>
<ul>
<li>消息发送后，若中间件收到消息，会给发送端一个应答</li>
<li>生产者接收应答，用来确认这条消息是否正常发送到中间件</li>
</ul>
<blockquote>
<p>三种确认机制</p>
</blockquote>
<ul>
<li><p>单条同步确认</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8n1hg.png" alt="image-20230228082128561"></p>
</li>
<li><p>多条同步确认</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8mznr.png" alt="image-20230228082209562"></p>
</li>
<li><p>异步确认机制</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8n1nz.png" alt="image-20230228082353745"></p>
</li>
</ul>
<h2 id="11-2-消息返回机制"><a href="#11-2-消息返回机制" class="headerlink" title="11.2.消息返回机制"></a>11.2.消息返回机制</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8myk1.png" alt="image-20230228194255639"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8n37k.png" alt="image-20230228194449663"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8n673.png" alt="image-20230228194526071"></p>
<h2 id="11-3-消费端确认"><a href="#11-3-消费端确认" class="headerlink" title="11.3.消费端确认"></a>11.3.消费端确认</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8n422.png" alt="image-20230228194946791"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8n673_1.png" alt="image-20230228195020267"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8n8oi.png" alt="image-20230228195100671"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8n8gg.png" alt="image-20230228195142226"></p>
<h2 id="11-4-消费端限流机制"><a href="#11-4-消费端限流机制" class="headerlink" title="11.4.消费端限流机制"></a>11.4.消费端限流机制</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8n7n3.png" alt="image-20230228195246755"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8nb8o.png" alt="image-20230228195331598"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8nct5.png" alt="image-20230228195443831"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8nbsg.png" alt="image-20230228195607563"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8nd5u.png" alt="image-20230228195642836"></p>
<h2 id="11-5-消息过期机制"><a href="#11-5-消息过期机制" class="headerlink" title="11.5.消息过期机制"></a>11.5.消息过期机制</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8nep8.png" alt="image-20230228195758983"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8nayn.png" alt="image-20230228195842619"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8nfxh.png" alt="image-20230228200004491"></p>
<h2 id="11-6-死信队列"><a href="#11-6-死信队列" class="headerlink" title="11.6.死信队列"></a>11.6.死信队列</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8nn9z.png" alt="image-20230228200137967"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8niw6.png" alt="image-20230228200220708"></p>
<p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8nowc.png" alt="image-20230228200401202"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8nn8o.png" alt="image-20230228200441631"></p>
<h1 id="12-RabbitMQ集群"><a href="#12-RabbitMQ集群" class="headerlink" title="12.RabbitMQ集群"></a>12.RabbitMQ集群</h1><blockquote>
<p>扩展规模</p>
</blockquote>
<ul>
<li>一般的基础结构中单机扩容(Scale-Up)很难实现</li>
<li>需要扩容时尽量使用扩展数量实现(Scale-Out)</li>
<li>RabbitMQ集群可以方便的通过Scale-Out扩展规模</li>
</ul>
<blockquote>
<p>数据冗余</p>
</blockquote>
<ul>
<li>对于单节点RabbitMQ，如果节点宕机，内存数据丢失</li>
<li>对于单节点RabbitMQ，如果节点损坏，磁盘丢失</li>
<li>RabbitMQ集群可以通过镜像队列，将数据冗余至多个节点</li>
</ul>
<blockquote>
<p>高可用</p>
</blockquote>
<ul>
<li>如果单节点RabbitMQ宕机，服务不可用</li>
<li>RabbitMQ集群可以通过负载均衡，将请求转移至可用节点</li>
</ul>
<h2 id="12-1-RabbitMQ集群搭建"><a href="#12-1-RabbitMQ集群搭建" class="headerlink" title="12.1.RabbitMQ集群搭建"></a>12.1.RabbitMQ集群搭建</h2><ul>
<li>多个RabbitMQ单节点，经过配置组成RabbitMQ集群</li>
<li>集群节点之间共享元数据，不共享队列数据(默认)</li>
<li>RabbitMQ节点数据互相转发，客户端通过单一节点可以访问所有数据</li>
</ul>
<p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8nl8e.png" alt="image-20230228204615951"></p>
<blockquote>
<p>集群搭建步骤</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w8nm25.png" alt="image-20230228204704028"></p>
<ul>
<li><p>查看：cat &#x2F;var&#x2F;lib&#x2F;rabbitmq&#x2F;.erlang.cookie</p>
<ul>
<li>要求全部集群节点的erlang.cookie全部一样</li>
</ul>
</li>
<li><p>加入集群：rabbitmqctl join_cluster 主机名</p>
</li>
</ul>
<h2 id="12-2-RabbitMQ镜像队列"><a href="#12-2-RabbitMQ镜像队列" class="headerlink" title="12.2.RabbitMQ镜像队列"></a>12.2.RabbitMQ镜像队列</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/qrzg52-0.png"></p>
<ul>
<li>多个RabbitMQ单节点，经过配置组成RabbitMQ集群</li>
<li>集群节点之间共享元数据，切共享特定队列数据</li>
<li>RabbitMQ节点数据互相转发，客户端通过单一节点可以访问所有数据</li>
</ul>
<blockquote>
<p>集群镜像队列设置</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/s5l8np-0.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/shfuus-0.png" alt="image-20230301172229025"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/114quia-0.png" alt="image-20230301224514094"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/115be5m-0.png" alt="image-20230301224617231"></p>
<h2 id="12-3-RabbitMQ实现高可用"><a href="#12-3-RabbitMQ实现高可用" class="headerlink" title="12.3.RabbitMQ实现高可用"></a>12.3.RabbitMQ实现高可用</h2><blockquote>
<p>客户端负载均衡</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/117qy7k-0.png" alt="image-20230301225025974"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/118wfz1-0.png" alt="image-20230301225218690"></p>
<blockquote>
<p>服务端负载均衡</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/1194hw9-0.png" alt="image-20230301225256801"></p>
<blockquote>
<p>什么是HAProxy</p>
</blockquote>
<ul>
<li>HAProxy是一款提供高可用、负载均衡以及基于TCP和HTTP应用的代理软件</li>
<li>HAProxy适用于那些负载较大的web站点</li>
<li>HAProxy可以支持数以万计的并发连接</li>
</ul>
<blockquote>
<p>HAProxy配置方法</p>
</blockquote>
<ul>
<li><p>安装HAProxy：yum install -y haproxy</p>
</li>
<li><p>配置HAProxy，使用四层代理模式</p>
<ul>
<li><p>配置文件目录：&#x2F;etc&#x2F;haproxy&#x2F;haproxy.cfg</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">global  <span class="comment"># 全局配置</span></span><br><span class="line">	<span class="built_in">log</span> 127.0.0.1 local0 info <span class="comment"># 默认日志输出配置</span></span><br><span class="line">	maxconn 4096 <span class="comment"># 设置最大连接数</span></span><br><span class="line">	daemon       <span class="comment"># 设置守护模式</span></span><br><span class="line">defaults <span class="comment"># 设置默认值</span></span><br><span class="line">	logglobal <span class="comment"># 应用全局配置</span></span><br><span class="line">	mode tcp <span class="comment"># 配置模式</span></span><br><span class="line">	option tcplog <span class="comment"># 记录tcplog</span></span><br><span class="line">	option dontlognull <span class="comment"># 不记录健康检查日志</span></span><br><span class="line"> 	retires 3 <span class="comment"># 失败检查次数</span></span><br><span class="line">	maxconn 2000 <span class="comment"># 配置最大连接数</span></span><br><span class="line">	<span class="built_in">timeout</span> connect 5s <span class="comment"># 配置连接超时时间</span></span><br><span class="line">	<span class="built_in">timeout</span> client 120s <span class="comment"># 配置客户端超时时间</span></span><br><span class="line">	<span class="built_in">timeout</span> server 120s <span class="comment"># 配置服务端超时时间</span></span><br><span class="line"></span><br><span class="line">listen rabbitmq_cluster <span class="comment"># 配置一个转发</span></span><br><span class="line">	<span class="built_in">bind</span> :5672</span><br><span class="line">	mode tcp</span><br><span class="line">	balance roundrobin <span class="comment"># 设置轮训方式</span></span><br><span class="line">	server mq01 mq01:5672 chech inter 5000 rise 2 fall 3 weight 1 <span class="comment"># 配置后端转发目的地和多少ms检查一次连接、检查几次是好的才认为是好的及检查几次是坏的才是坏的及权重</span></span><br><span class="line">	server mq02 mq02:5672 chech inter 5000 rise 2 fall 3 weight 1</span><br><span class="line">	server mq03 mq03:5672 chech inter 5000 rise 2 fall 3 weight 1</span><br><span class="line"></span><br><span class="line">listen monitor   <span class="comment"># 开放端口运行网页健康检查</span></span><br><span class="line">	<span class="built_in">bind</span> :8100</span><br><span class="line">	mode http</span><br><span class="line">	option httplog</span><br><span class="line">	stats <span class="built_in">enable</span></span><br><span class="line">	stats uri /rabbitmq</span><br><span class="line">	stats refresh 5s</span><br><span class="line">	</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>放开haproxy权限：setsebool -P haproxy_connect_any&#x3D;1</p>
</li>
</ul>
<h2 id="12-4-HAProxy-Keepalived高可用"><a href="#12-4-HAProxy-Keepalived高可用" class="headerlink" title="12.4.HAProxy+Keepalived高可用"></a>12.4.HAProxy+Keepalived高可用</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/12c3gw4-0.png" alt="image-20230301231803286"></p>
<blockquote>
<p>Keepalived简介</p>
</blockquote>
<ul>
<li><p>高性能的服务器高可用或热备解决方案</p>
</li>
<li><p>主要来防止服务器单点故障的发生问题</p>
</li>
<li><p>VRRP协议为实现基础，用VRRP协议来实现高可用</p>
</li>
<li><p>安装：yum install -y keepalived</p>
</li>
<li><p>配置：&#x2F;etc&#x2F;keepalived&#x2F;keepalived.cfg</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">global_defs &#123;</span><br><span class="line">    notification_email &#123;      <span class="comment">#邮箱服务器，一般公司内也不设置</span></span><br><span class="line">    acassen@firewall.loc</span><br><span class="line">    failover@firewall.loc</span><br><span class="line">    sysadmin@firewall.loc</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    notification_email_from Alexandre.Cassen@firewall.loc</span><br><span class="line">    smtp_server 192.168.200.1</span><br><span class="line">    smtp_connect_timeout 30</span><br><span class="line">    router_id LVS_DEVEL          <span class="comment">#标识这台机器ID，默认情况下是主机名，可以配置成主机名</span></span><br><span class="line">    vrrp_skip_check_adv_addr     <span class="comment">#所有报文都检查比较消耗性能，此配置为如果收到的报文和上一个报文是同一个路由器则跳过检查报文中的源地址</span></span><br><span class="line">    vrrp_strict                  <span class="comment">#严格遵守VRRP协议,不允许状况:1,没有VIP地址,2.配置了单播邻居,3.在VRRP版本2中有IPv6地址</span></span><br><span class="line">    vrrp_garp_interval 0         <span class="comment">#ARP报文发送延迟</span></span><br><span class="line">    vrrp_gna_interval 0          <span class="comment">#消息发送延迟</span></span><br><span class="line">    <span class="comment">#vrrp_mcast_group4 224.0.0.18 #指定组播IP地址，默认值：224.0.0.18 范围：224.0.0.0到239.255.255.255</span></span><br><span class="line">    <span class="comment">#vrrp_iptables                #避免生成iptables input链 规则，sip any 拒绝 dip any</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script chk_haproxy &#123;</span><br><span class="line">	script <span class="string">&quot;/etc/keepalived/haproxy_check.sh&quot;</span> <span class="comment"># 执行脚本位置</span></span><br><span class="line">	interval 2 <span class="comment"># 检测时间间隔</span></span><br><span class="line">	weight -20 <span class="comment"># 如果条件成立则权重减20</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;      <span class="comment">#虚拟路由器名称，在一个keepalived可以启多个虚拟路由器，每个虚拟路由器的名字都不一样</span></span><br><span class="line">    state MASTER          <span class="comment">#当前节点在此虚拟路由器上的初始状态，状态为MASTER或者BACKUP，一般都是配置backup，该值无法决定身份，最终还是通过比较priority</span></span><br><span class="line">    interface eth0        <span class="comment">#绑定为当前虚拟路由器使用的物理接口，如：ens32,eth0,bond0,br0</span></span><br><span class="line">    virtual_router_id 51  <span class="comment">#每个虚拟路由器惟一标识，范围：0-255，同一组虚拟路由器的vrid必须一致</span></span><br><span class="line">    priority 100          <span class="comment">#当前物理节点在此虚拟路由器的优先级，范围：1-254，每个keepalived主机节点此值不同</span></span><br><span class="line">    advert_int 1          <span class="comment">#vrrp通告的时间间隔，默认1s</span></span><br><span class="line"> </span><br><span class="line">    authentication &#123;      <span class="comment">#认证机制 </span></span><br><span class="line">        auth_type PASS    <span class="comment">#AH（不推荐）或PASS</span></span><br><span class="line">        auth_pass 1111    <span class="comment">#预共享密钥，仅前8位有效，同一个虚拟路由器的多个keepalived节点必须一样</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    virtual_ipaddress &#123;                      <span class="comment">#虚拟IP</span></span><br><span class="line">        10.0.0.100                           <span class="comment">#指定VIP，不指定网卡，默认为eth0,注意：不指定/prefix,默认为/32</span></span><br><span class="line">        10.0.0.101/24 dev eth1               <span class="comment">#指定VIP的网卡</span></span><br><span class="line">        10.0.0.102/24 dev eth2 label eth2:1  <span class="comment">#指定VIP的网卡label</span></span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;  <span class="comment"># 健康检测脚本</span></span><br><span class="line">    	chk_haproxy <span class="comment"># 脚本名称</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#第一台keepalived服务器</span></span><br><span class="line">vrrp_instance router1 &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 55</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line"> </span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 12345678</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        10.0.0.100/24 dev eth0 label eth0:0</span><br><span class="line">        10.0.0.101/24 dev eth0 label eth0:1</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">vrrp_instance router2 &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 60</span><br><span class="line">    priority 80</span><br><span class="line">    advert_int 1</span><br><span class="line"> </span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 12345678</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        10.0.0.102/24 dev eth0 label eth0:2</span><br><span class="line">        10.0.0.103/24 dev eth0 label eth0:3</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 执行脚本</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">COUNT=`ps -C haproxy --no-header|<span class="built_in">wc</span> -l`</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$COUNT</span> -eq 0];<span class="keyword">then</span></span><br><span class="line">	systemctl start haproxy</span><br><span class="line">	<span class="built_in">sleep</span> 2</span><br><span class="line">	<span class="keyword">if</span> [ `ps -C haproxy --no-header|<span class="built_in">wc</span> -l` -eq 0 ];<span class="keyword">then</span></span><br><span class="line">	 systemctl stop keepalived</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="12-5-RabbitMQ集群间通信原理"><a href="#12-5-RabbitMQ集群间通信原理" class="headerlink" title="12.5.RabbitMQ集群间通信原理"></a>12.5.RabbitMQ集群间通信原理</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/looy94-0.png" alt="image-20230302131119412"></p>
<blockquote>
<p>RabbitMQ集群间通信方法</p>
</blockquote>
<ul>
<li>Federation(联邦)</li>
<li><strong>Shovel</strong>(铲子)</li>
</ul>
<blockquote>
<p>Federation</p>
</blockquote>
<ul>
<li>通过AMQP协议，使用一个内部交换机，让原本发送到一个集群的消息转发到另一个集群</li>
<li>消息可以从交换机转发至交换机，也可以由队列转发至队列</li>
<li>消息可以单向转发，也可以双向转发</li>
</ul>
<blockquote>
<p>Federation</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/lqz1fu-0.png" alt="image-20230302131509273"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/lr573e-0.png" alt="image-20230302131538759"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/lrj1nb-0.png" alt="image-20230302131602775"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/lrpp5b-0.png" alt="image-20230302131633832"></p>
<blockquote>
<p>Federation设置方法</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/ls7jnq-0.png" alt="image-20230302131717746"></p>
<blockquote>
<p>Shovel</p>
</blockquote>
<ul>
<li>Shovel可以持续的从一个broker拉去消息转发至另一个broker</li>
<li>Shovel的使用较为灵活，可以配置从队列至交换机，从队列至队列，从交换机至交换机</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/ltxegx-0.png" alt="image-20230302132005545"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/lu15fr-0.png" alt="image-20230302132024031"></p>
<h2 id="12-6-总结"><a href="#12-6-总结" class="headerlink" title="12.6.总结"></a>12.6.总结</h2><ul>
<li><p>体系结构升级的根本原因是需求</p>
</li>
<li><p>不要盲目升级更高级的架构，更高级的架构意味着对运维有更高的要求</p>
</li>
<li><p>多思考架构拓扑，形成更好的架构思维</p>
</li>
</ul>
<h1 id="13-RabbitMQ集群高可用"><a href="#13-RabbitMQ集群高可用" class="headerlink" title="13.RabbitMQ集群高可用"></a>13.RabbitMQ集群高可用</h1><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/lxqlbm-0.png" alt="image-20230302132645493"></p>
<blockquote>
<p>什么是真正的高可用</p>
</blockquote>
<ul>
<li>在传统以物理机&#x2F;虚拟机为基础的架构中，服务宕机往往需要人工处理</li>
<li>随着容器技术的发展，容器编排框架可以很好的解决高可用问题</li>
<li>k8s已经成为容器编排的事实标准，能够承载RabbitMQ集群</li>
</ul>
<blockquote>
<p>网络分区故障</p>
</blockquote>
<ul>
<li>在实际生产中，网络分区是非常常见的故障原因</li>
<li>网络分区的排查和处理难度较大，需要专门研究</li>
</ul>
<blockquote>
<p>RabbitMQ状态监控</p>
</blockquote>
<ul>
<li>在生产环境中，需要实时关注RabbitMQ集群状态</li>
<li>RabbitMQ状态包括流量、内存占用、CPU占用等</li>
</ul>
<h2 id="13-1-使用DockerCompose部署高可用集群"><a href="#13-1-使用DockerCompose部署高可用集群" class="headerlink" title="13.1.使用DockerCompose部署高可用集群"></a>13.1.使用DockerCompose部署高可用集群</h2><blockquote>
<p>什么是docker</p>
</blockquote>
<ul>
<li>Docker是新一代虚拟化技术</li>
<li>与虚拟机相比，Docker具有轻量化、高性能的优势</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/nzb7nq-0.png" alt="image-20230302144202403"></p>
<blockquote>
<p>什么是compose </p>
</blockquote>
<ul>
<li>Compose是用于定义和运行多容器Docker应用程序的工具</li>
<li>通过Compose，可以使用YAML文件来配置应用程序需要的所有服务</li>
<li>使用一个目录，就可以从YAML文件配置中创建并启动所有服务</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 同一台机器使用compose搭建集群</span></span><br><span class="line"><span class="string">version:&quot;2.0&quot;</span> <span class="comment"># 使用版本</span></span><br><span class="line"><span class="attr">services:</span>     <span class="comment"># 启动那几个容器</span></span><br><span class="line">	<span class="string">rabbit1：</span></span><br><span class="line">		<span class="string">image：rabbitmq:3-management</span> <span class="comment"># 使用镜像</span></span><br><span class="line">		<span class="string">hostname：rabbit1</span> <span class="comment"># 实例名</span></span><br><span class="line">		<span class="string">ports：#</span> <span class="string">端口映射(-表示数组)</span></span><br><span class="line">			<span class="bullet">-</span> <span class="number">5672</span><span class="string">:5672</span></span><br><span class="line">			<span class="bullet">-</span> <span class="number">15672</span><span class="string">:15672</span></span><br><span class="line">		<span class="string">environment：#</span> <span class="string">环境变量</span></span><br><span class="line">			<span class="bullet">-</span> <span class="string">RABBITMQ_DEFAULT_USER=guest</span></span><br><span class="line">			<span class="bullet">-</span> <span class="string">RABBITMQ_DEFAULT_PASS=guest</span></span><br><span class="line">			<span class="bullet">-</span> <span class="string">RABBITMQ_ERLANG_COOKIE=&#x27;uiouio&#x27;#自定义Erlang_cookie</span></span><br><span class="line">	<span class="string">rabbit2：</span></span><br><span class="line">		<span class="string">image：rabbitmq:3-management</span> <span class="comment"># 使用镜像</span></span><br><span class="line">		<span class="string">hostname：rabbit2</span> <span class="comment"># 实例名</span></span><br><span class="line">		<span class="string">ports：#</span> <span class="string">端口映射(-表示数组)</span></span><br><span class="line">			<span class="bullet">-</span> <span class="number">5673</span><span class="string">:5672</span></span><br><span class="line">		<span class="string">environment：#</span> <span class="string">环境变量</span></span><br><span class="line">			<span class="bullet">-</span> <span class="string">RABBITMQ_ERLANG_COOKIE=&#x27;uiouio&#x27;#自定义Erlang_cookie</span></span><br><span class="line">		<span class="string">links：#</span> <span class="string">使用docker网络连接rabbit1</span></span><br><span class="line">			<span class="bullet">-</span> <span class="string">rabbit1</span></span><br><span class="line">			</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-compose up -d <span class="comment"># 根据docker-compose.yml开始生成</span></span><br><span class="line">docker <span class="built_in">exec</span> -it root_rabbitmq2_1 bash <span class="comment"># 启动root_rabbitmq2_1容器的bash环境</span></span><br><span class="line">rabbitmqctl stop_app <span class="comment"># 停止应用</span></span><br><span class="line">rabbitmqctl join_cluster  rabbit@rabbit1</span><br></pre></td></tr></table></figure>



<h2 id="13-2-使用Kubernetes部署高可用集群"><a href="#13-2-使用Kubernetes部署高可用集群" class="headerlink" title="13.2.使用Kubernetes部署高可用集群"></a>13.2.使用Kubernetes部署高可用集群</h2><blockquote>
<p>什么是Kubernetes</p>
</blockquote>
<ul>
<li>Kubernetes可以自动化调度、运维Docker容器</li>
<li>Kubernetes已经成为微服务基础架构的”事实标准”</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/r7hr9c-0.png" alt="image-20230302164516924"></p>
<ul>
<li>Pod：K8S中的最小业务单元，内含一个或多个容器</li>
<li>StatefulSet:定义一组有状态Pod，K8S将自动维护</li>
<li>Ddeployment：定义一组无状态Pod，K8S将自动维护</li>
<li>Service：一组Pod的抽象访问方式，相当于负载均衡器</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="comment"># 相当于负载均衡层</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="comment"># 元数据</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="comment"># 命名空间</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">test-rabbitmq</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">rabbitmq</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">rabbitmq</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">LoadBalancer</span>  </span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">     <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">     <span class="attr">port:</span> <span class="number">15672</span></span><br><span class="line">     <span class="attr">targetPort:</span> <span class="number">15672</span></span><br><span class="line">     <span class="attr">nodePort:</span> <span class="number">31672</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">amqp</span></span><br><span class="line">     <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">     <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">     <span class="attr">targetPort:</span> <span class="number">5672</span></span><br><span class="line">     <span class="attr">nodePort:</span> <span class="number">30672</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">rabbitmq</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="comment"># 用于注入配置文件</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">rabbitmq-config</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">test-rabbitmq</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">enabled_plugins:</span> <span class="string">|</span></span><br><span class="line"><span class="string">      [rabbitmq_management,rabbitmq_peer_discovery_k8s].</span></span><br><span class="line"><span class="string"></span>  <span class="attr">rabbitmq.conf:</span> <span class="string">|</span></span><br><span class="line"><span class="string">      cluster_formation.peer_discovery_backend  = rabbit_peer_discovery_k8s</span></span><br><span class="line"><span class="string">      cluster_formation.k8s.host = kubernetes.default.svc.cluster.local</span></span><br><span class="line"><span class="string">      cluster_formation.k8s.address_type = ip</span></span><br><span class="line"><span class="string">      cluster_formation.node_cleanup.interval = 30</span></span><br><span class="line"><span class="string">      cluster_formation.node_cleanup.only_log_warning = true</span></span><br><span class="line"><span class="string">      cluster_partition_handling = autoheal</span></span><br><span class="line"><span class="string">      loopback_users.guest = false</span></span><br><span class="line"><span class="string"></span>   </span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">rabbitmq</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">test-rabbitmq</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">rabbitmq</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">rabbitmq</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">rabbitmq</span></span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">containers:</span>        </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">rabbitmq</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">rabbitmq:3-management</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">            <span class="attr">mountPath:</span> <span class="string">/etc/rabbitmq</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">            <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">            <span class="attr">containerPort:</span> <span class="number">15672</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">amqp</span></span><br><span class="line">            <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">            <span class="attr">containerPort:</span> <span class="number">5672</span></span><br><span class="line">        <span class="attr">livenessProbe:</span></span><br><span class="line">          <span class="attr">exec:</span></span><br><span class="line">            <span class="attr">command:</span> [<span class="string">&quot;rabbitmqctl&quot;</span>, <span class="string">&quot;status&quot;</span>]</span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">60</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">60</span></span><br><span class="line">          <span class="attr">timeoutSeconds:</span> <span class="number">10</span></span><br><span class="line">        <span class="attr">readinessProbe:</span></span><br><span class="line">          <span class="attr">exec:</span></span><br><span class="line">            <span class="attr">command:</span> [<span class="string">&quot;rabbitmqctl&quot;</span>, <span class="string">&quot;status&quot;</span>]</span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">20</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">60</span></span><br><span class="line">          <span class="attr">timeoutSeconds:</span> <span class="number">10</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">Always</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MY_POD_IP</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">fieldRef:</span></span><br><span class="line">                <span class="attr">fieldPath:</span> <span class="string">status.podIP</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">RABBITMQ_USE_LONGNAME</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">RABBITMQ_NODENAME</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">&quot;rabbit@$(MY_POD_IP)&quot;</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">K8S_SERVICE_NAME</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">&quot;rabbitmq&quot;</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">RABBITMQ_ERLANG_COOKIE</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">&quot;imoocrabbit&quot;</span> </span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">          <span class="attr">configMap:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">rabbitmq-config</span></span><br><span class="line">            <span class="attr">items:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">rabbitmq.conf</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">rabbitmq.conf</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">enabled_plugins</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">enabled_plugins</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">kubectl</span> <span class="string">create</span> <span class="string">-f</span> <span class="string">rabbitmq.yaml</span> <span class="comment"># 使配置生效</span></span><br></pre></td></tr></table></figure>



<h2 id="13-3-分析集群网络分区的意义与风险"><a href="#13-3-分析集群网络分区的意义与风险" class="headerlink" title="13.3.分析集群网络分区的意义与风险"></a>13.3.分析集群网络分区的意义与风险</h2><blockquote>
<p>什么是网络分区</p>
</blockquote>
<ul>
<li>网络分区指的是集群分裂为了两个网络”孤岛”</li>
</ul>
<blockquote>
<p>RabbitMQ集群网络模型</p>
</blockquote>
<ul>
<li>RabbitMQ集群采用单向环状网络模型</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/fj3zld-0.png" alt="image-20230303093900576"></p>
<blockquote>
<p>RabbitMQ集群网络分区的意义</p>
</blockquote>
<ul>
<li>如果出现Rabbit01和Rabbit03网络不可连接，此时可以人为造成网络分区，保存部分集群正常运行</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/fkzfcz-0.png" alt="image-20230303094222029"></p>
<blockquote>
<p>网络分区的影响</p>
</blockquote>
<ul>
<li>未配置镜像队列，发送消息的目标队列与节点一致</li>
<li>未配置镜像队列，发送消息的目标队列与节点不一致</li>
<li>未配置镜像队列，接收消息的目标队列与节点一致</li>
<li>未配置镜像队列，接收消息的目标队列与节点不一致</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/fqx8vy-0.png" alt="image-20230303095219505"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/fqz5v1-0.png" alt="image-20230303095229116"></p>
<blockquote>
<p>总结</p>
</blockquote>
<ul>
<li>网络分区指的是系统网络被分割为了不互通的两部分</li>
<li>相对于网络部分故障，彻底的分区有时是有意义的</li>
<li>不同的系统运行状态下，网络分区的影响不尽相同</li>
</ul>
<h2 id="13-4-网络分区的解决办法"><a href="#13-4-网络分区的解决办法" class="headerlink" title="13.4.网络分区的解决办法"></a>13.4.网络分区的解决办法</h2><blockquote>
<p>如何制造网络分区</p>
</blockquote>
<ul>
<li>iptables封禁&#x2F;解封IP地址或者端口号</li>
<li>关闭&#x2F;开启网卡</li>
<li>挂起&#x2F;恢复操作系统</li>
</ul>
<blockquote>
<p>如何发现网络分区</p>
</blockquote>
<ul>
<li>使用rabbitmqctl cluster_status命令</li>
<li>使用管控台查看</li>
<li>使用HTTP API：http：&#x2F;&#x2F;localhost:15672&#x2F;api&#x2F;nodes</li>
</ul>
<blockquote>
<p>网络分区处理办法</p>
</blockquote>
<ul>
<li><p>手动处理</p>
<ol>
<li>挂起客户端进程：可以减少不必要的消息丢失，如果进程数过多，可跳过</li>
<li>删除镜像队列的配置：如果没有删除镜像队列配置，恢复过程中可能会出现队列”漂移”现象</li>
<li>挑选信任分区：挑选的指标有：是否有disk节点&#x2F;分区节点数&#x2F;分区队列数&#x2F;分区客户端连接数</li>
<li>关闭非信任区的节点：采用rabbitmqctl stop_app命令，只关闭RabbitMQ应用，不会关闭ErLang虚拟机</li>
<li>启动非信任区的节点：rabbitmqctl start_app</li>
<li>检查网络分区是否恢复，恢复则直接天界镜像队列配置，若没有则重启信任分区节点</li>
<li>恢复生产者和消费者的进程：若步骤1并未挂起客户端进程，也应该检查客户端见了，必要时重启客户端</li>
</ol>
</li>
<li><p>自动处理</p>
<ul>
<li><p>RabbitMQ中有3中网络分区自动处理模式：</p>
<ul>
<li>pause-minority&#x2F;pause-if-all-down&#x2F;autoheal</li>
</ul>
</li>
<li><p>默认是ignore模式，不自动处理</p>
</li>
<li><p>如要开启，配置rabbitmq.config中的cluster_paritition_handing参数</p>
</li>
<li><p>pause-minority</p>
<ul>
<li>发生网络分区时，接地那自动检测自己是否处于少数派，若是则关闭自己</li>
<li>若出现了节点数相同的两个分区，可能会导致两个分区全部关闭</li>
</ul>
</li>
<li><p>pause-if-all-down</p>
<ul>
<li>每个节点预先配置一个节点列表，当失去和列表中所有接地那的通信时，关闭自己</li>
<li>此方法考验配置的合理性，配置不合理可能会导致集群节点全部宕机</li>
</ul>
</li>
<li><p>autoheal</p>
<ul>
<li>发送网络分区时，每个节点使用特定算法自动决定一个”获胜分区”，然后重启不在分区的其他节点</li>
<li>当节点中有关闭状态时，autoheal不起作用</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="13-5-RabbitMQ状态监控"><a href="#13-5-RabbitMQ状态监控" class="headerlink" title="13.5.RabbitMQ状态监控"></a>13.5.RabbitMQ状态监控</h2><blockquote>
<p>RabbitMQ状态监控方式</p>
</blockquote>
<ul>
<li>通过客户端判断节点是否健康</li>
<li>通过HTTP Rest API监控集群状态</li>
<li>通过监控中间件监控RabbitMQ</li>
</ul>
<blockquote>
<p>客户端</p>
</blockquote>
<ul>
<li>使用客户端创建connection与channel</li>
<li>若能成功，则节点健康，若失败则节点挂机或与节点的网络连接异常</li>
</ul>
<blockquote>
<p>HTTP Rest API</p>
</blockquote>
<ul>
<li>使用api&#x2F;nodes&#x2F;接口获得节点信息</li>
<li>使用api&#x2F;exchanges&#x2F;{vhost}&#x2F;{name}&#x2F;接口获得Exchange状态，不加后面两个参数则获取全部状态信息</li>
<li>使用api&#x2F;queues&#x2F;{vhost}&#x2F;{name}接口获得queue状态信息</li>
</ul>
<blockquote>
<p>监控中间件</p>
</blockquote>
<ul>
<li>常见的监控中间件有Zabbix、Prometheus等</li>
<li>Zabbix、Prometheus的底层原理是调用HTTP Rest API，再将数据处理、存储、展示</li>
</ul>
<blockquote>
<p>不足</p>
</blockquote>
<ul>
<li>发送消息时无法自动重试<ul>
<li>若消息发送失败，没有重试处理机制</li>
<li>若RabbitMQ集群短暂宕机，消息丢失，业务异常</li>
</ul>
</li>
<li>无法得知接收方处理情况<ul>
<li>发送无法得知消息是否被处理</li>
<li>若消息丢失，业务异常</li>
</ul>
</li>
<li>无法自动处理并标记死信<ul>
<li>死信消息依赖人工处理，需要自动处理并标记</li>
<li>消息状态的标记依赖数据库或缓存，对消息状态进行存储</li>
</ul>
</li>
</ul>
<h2 id="13-6-总结"><a href="#13-6-总结" class="headerlink" title="13.6.总结"></a>13.6.总结</h2><ul>
<li>运维是一项不断演进的技术，需要对技术原理有深入了解</li>
<li>容器浪潮是不可阻挡的，要掌握容器和容器平台知识</li>
<li>RabbitMQ集群宕机多数是因为资源不足和网络故障。排查故障应首先从这两方面开始</li>
</ul>
<h1 id="14-基于RabbitMQ的分布式框架"><a href="#14-基于RabbitMQ的分布式框架" class="headerlink" title="14.基于RabbitMQ的分布式框架"></a>14.基于RabbitMQ的分布式框架</h1><blockquote>
<p>什么是事务</p>
</blockquote>
<ul>
<li>事务指的是一系列业务操作，只能同时成功或同时失败</li>
<li>传统事务有4个特性：原子性、一致性、隔离性、持久性</li>
</ul>
<blockquote>
<p>微服务化带来的挑战</p>
</blockquote>
<ul>
<li>在传统单体应用中，事务在本地即可完成</li>
<li>随着后端架构的微服务化，事务无法在本地完成</li>
<li>所以需要将事务”分布式化”</li>
</ul>
<h2 id="14-1-分布式框架设计"><a href="#14-1-分布式框架设计" class="headerlink" title="14.1.分布式框架设计"></a>14.1.分布式框架设计</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/ntj5j1-0.png" alt="image-20230303144023246"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/nu0zy8-0.png" alt="image-20230303144113687"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/nvg5jf-0.png" alt="image-20230303144353147"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/nwc9zj-0.png" alt="image-20230303144503169"></p>
<blockquote>
<p>分布式事务框架设计</p>
</blockquote>
<ul>
<li>根据上述分析，我们的分布式事务框架应该包含以下部分：</li>
<li>发送失败重试</li>
<li>消费失败重试</li>
<li>死信告警</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/nzd7sd-0.png" alt="image-20230303145011184"></p>
<h2 id="14-2-消息发送重试"><a href="#14-2-消息发送重试" class="headerlink" title="14.2.消息发送重试"></a>14.2.消息发送重试</h2><ul>
<li>发送消息前消息持久化</li>
<li>发送成功时删除消息</li>
<li>定时巡检未发送成功消息、重试发送</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/oudnq3-0.png" alt="image-20230303150220033"></p>
<h2 id="14-3-消息消费失败重试"><a href="#14-3-消息消费失败重试" class="headerlink" title="14.3.消息消费失败重试"></a>14.3.消息消费失败重试</h2><ul>
<li>收到消息时先进行持久化</li>
<li>消息处理成功，消费端确认(ACK)，删除消息</li>
<li>消息处理失败，延时，不确认消息(NACK),记录次数</li>
<li>再次处理消息</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/oxdkib-0.png" alt="image-20230303150722155"></p>
<h2 id="14-4-死信消息告警"><a href="#14-4-死信消息告警" class="headerlink" title="14.4.死信消息告警"></a>14.4.死信消息告警</h2><ul>
<li>声明死信队列、交换机、绑定</li>
<li>普通队列加入死信设置</li>
<li>监听到死信，持久化、告警</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/oyks1j-0.png" alt="image-20230303150925024"></p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">AYO</div><div class="post-copyright__author_desc">天行健，君子以自强不息</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://www.yuki.love/2023/04/22/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/RabbitMQ/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://www.yuki.love/2023/04/22/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/RabbitMQ/')">Rabbit</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://www.yuki.love/2023/04/22/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/RabbitMQ/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=Rabbit&amp;url=https://www.yuki.love/2023/04/22/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/RabbitMQ/&amp;pic=https://th.bing.com/th/id/R.d8dfd08893b58d08d74b38ad8870a48d?rik=9KBqff6Rai035Q&amp;riu=http%3A%2F%2Fstatic.cntonan.com%2Fuploadfile%2F2019%2F0214%2F20190214104244pwm1xxsdikh.jpg&amp;ehk=MOxI2n5nY44gO%2FKsNYWAuEBvcRwSmkRVNb4dTS6Gk%2BY%3D&amp;risl=&amp;pid=ImgRaw&amp;r=0&amp;_r_=acfa0787-21e7-a269-f390-c11386b71948" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.yuki.love" target="_blank">AYO</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Rabbit/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Rabbit<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>中间件<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://pic1.zhimg.com/v2-37d1dd62d373427b8035891e9fe1653e_r.jpg?source=1940ef5c&amp;_r_=e42e569a-0069-e343-79bf-48be39c14141" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/04/22/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/Linux%E5%AE%89%E5%85%A8/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic1.zhimg.com/v2-37d1dd62d373427b8035891e9fe1653e_r.jpg?source=1940ef5c&amp;_r_=20cd9717-1dc6-24e7-ae56-94957dcf9d67" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Linux安全</div></div></a></div><div class="next-post pull-right"><a href="/2023/04/26/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/shell%E7%BC%96%E7%A8%8B/shell%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic1.zhimg.com/v2-0cc45f5fda6e8ff79350ec1303835629_r.jpg?source=1940ef5c&amp;_r_=5b5be3b2-5ab4-1509-905f-9e94fedb03b3" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Shell实操</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-switch"><span class="first-comment">Twikoo</span><span id="switch-btn"></span><span class="second-comment">Waline</span></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div><div><div id="waline-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);"><b style="color:#fff">AYO的知识输出基地，</b><b style="color:#fff">以输出倒逼输入，以输出巩固知识！</b></div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">AYO</h1><div class="author-info__desc">天行健，君子以自强不息</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/AYO-Al" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://juejin.cn/user/3708003152300183" target="_blank" title="JueJin"><i class="anzhiyufont anzhiyu-icon-book"></i></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E4%BB%8B%E7%BB%8D%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">1.</span> <span class="toc-text">1.介绍中间件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E4%B8%BB%E6%B5%81%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%8A%80%E6%9C%AF"><span class="toc-number">2.</span> <span class="toc-text">2.主流消息中间件技术</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-RabbitMQ%E9%AB%98%E6%80%A7%E8%83%BD%E5%8E%9F%E5%9B%A0"><span class="toc-number">3.</span> <span class="toc-text">3.RabbitMQ高性能原因</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-AMQP%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.</span> <span class="toc-text">4.AMQP协议</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-Exchange%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">5.</span> <span class="toc-text">5.Exchange的作用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-RabbitMQ%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85"><span class="toc-number">6.</span> <span class="toc-text">6.RabbitMQ快速安装</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E7%BD%91%E9%A1%B5%E7%AB%AF%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7"><span class="toc-number">7.</span> <span class="toc-text">7.网页端管理工具</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7%E4%B8%8A%E6%89%8B"><span class="toc-number">8.</span> <span class="toc-text">8.命令行工具上手</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-RabbitMQ%E6%B6%88%E6%81%AF%E4%BA%A4%E6%8D%A2%E7%9A%84%E5%85%B3%E9%94%AE"><span class="toc-number">9.</span> <span class="toc-text">9.RabbitMQ消息交换的关键</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-%E5%85%B7%E4%BD%93%E5%AE%9E%E4%BE%8B%E5%88%86%E6%9E%90"><span class="toc-number">10.</span> <span class="toc-text">10.具体实例分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E4%B8%8E%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1"><span class="toc-number">10.1.</span> <span class="toc-text">10.1.需求分析与架构设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E4%B8%8E%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA"><span class="toc-number">10.2.</span> <span class="toc-text">10.2.数据库设计与项目搭建</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-%E4%BF%9D%E8%AF%81%E6%B6%88%E6%81%AF%E5%8F%AF%E9%9D%A0%E6%80%A7"><span class="toc-number">11.</span> <span class="toc-text">11.保证消息可靠性</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#11-1-%E5%8F%91%E9%80%81%E7%AB%AF%E7%A1%AE%E8%AE%A4%E6%9C%BA%E5%88%B6"><span class="toc-number">11.1.</span> <span class="toc-text">11.1.发送端确认机制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-2-%E6%B6%88%E6%81%AF%E8%BF%94%E5%9B%9E%E6%9C%BA%E5%88%B6"><span class="toc-number">11.2.</span> <span class="toc-text">11.2.消息返回机制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-3-%E6%B6%88%E8%B4%B9%E7%AB%AF%E7%A1%AE%E8%AE%A4"><span class="toc-number">11.3.</span> <span class="toc-text">11.3.消费端确认</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-4-%E6%B6%88%E8%B4%B9%E7%AB%AF%E9%99%90%E6%B5%81%E6%9C%BA%E5%88%B6"><span class="toc-number">11.4.</span> <span class="toc-text">11.4.消费端限流机制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-5-%E6%B6%88%E6%81%AF%E8%BF%87%E6%9C%9F%E6%9C%BA%E5%88%B6"><span class="toc-number">11.5.</span> <span class="toc-text">11.5.消息过期机制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-6-%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97"><span class="toc-number">11.6.</span> <span class="toc-text">11.6.死信队列</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#12-RabbitMQ%E9%9B%86%E7%BE%A4"><span class="toc-number">12.</span> <span class="toc-text">12.RabbitMQ集群</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#12-1-RabbitMQ%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA"><span class="toc-number">12.1.</span> <span class="toc-text">12.1.RabbitMQ集群搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-2-RabbitMQ%E9%95%9C%E5%83%8F%E9%98%9F%E5%88%97"><span class="toc-number">12.2.</span> <span class="toc-text">12.2.RabbitMQ镜像队列</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-3-RabbitMQ%E5%AE%9E%E7%8E%B0%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="toc-number">12.3.</span> <span class="toc-text">12.3.RabbitMQ实现高可用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-4-HAProxy-Keepalived%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="toc-number">12.4.</span> <span class="toc-text">12.4.HAProxy+Keepalived高可用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-5-RabbitMQ%E9%9B%86%E7%BE%A4%E9%97%B4%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86"><span class="toc-number">12.5.</span> <span class="toc-text">12.5.RabbitMQ集群间通信原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-6-%E6%80%BB%E7%BB%93"><span class="toc-number">12.6.</span> <span class="toc-text">12.6.总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#13-RabbitMQ%E9%9B%86%E7%BE%A4%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="toc-number">13.</span> <span class="toc-text">13.RabbitMQ集群高可用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#13-1-%E4%BD%BF%E7%94%A8DockerCompose%E9%83%A8%E7%BD%B2%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4"><span class="toc-number">13.1.</span> <span class="toc-text">13.1.使用DockerCompose部署高可用集群</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-2-%E4%BD%BF%E7%94%A8Kubernetes%E9%83%A8%E7%BD%B2%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4"><span class="toc-number">13.2.</span> <span class="toc-text">13.2.使用Kubernetes部署高可用集群</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-3-%E5%88%86%E6%9E%90%E9%9B%86%E7%BE%A4%E7%BD%91%E7%BB%9C%E5%88%86%E5%8C%BA%E7%9A%84%E6%84%8F%E4%B9%89%E4%B8%8E%E9%A3%8E%E9%99%A9"><span class="toc-number">13.3.</span> <span class="toc-text">13.3.分析集群网络分区的意义与风险</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-4-%E7%BD%91%E7%BB%9C%E5%88%86%E5%8C%BA%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95"><span class="toc-number">13.4.</span> <span class="toc-text">13.4.网络分区的解决办法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-5-RabbitMQ%E7%8A%B6%E6%80%81%E7%9B%91%E6%8E%A7"><span class="toc-number">13.5.</span> <span class="toc-text">13.5.RabbitMQ状态监控</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-6-%E6%80%BB%E7%BB%93"><span class="toc-number">13.6.</span> <span class="toc-text">13.6.总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#14-%E5%9F%BA%E4%BA%8ERabbitMQ%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E6%A1%86%E6%9E%B6"><span class="toc-number">14.</span> <span class="toc-text">14.基于RabbitMQ的分布式框架</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#14-1-%E5%88%86%E5%B8%83%E5%BC%8F%E6%A1%86%E6%9E%B6%E8%AE%BE%E8%AE%A1"><span class="toc-number">14.1.</span> <span class="toc-text">14.1.分布式框架设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-2-%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E9%87%8D%E8%AF%95"><span class="toc-number">14.2.</span> <span class="toc-text">14.2.消息发送重试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-3-%E6%B6%88%E6%81%AF%E6%B6%88%E8%B4%B9%E5%A4%B1%E8%B4%A5%E9%87%8D%E8%AF%95"><span class="toc-number">14.3.</span> <span class="toc-text">14.3.消息消费失败重试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-4-%E6%AD%BB%E4%BF%A1%E6%B6%88%E6%81%AF%E5%91%8A%E8%AD%A6"><span class="toc-number">14.4.</span> <span class="toc-text">14.4.死信消息告警</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/06/20/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/ELK%E6%97%A5%E5%BF%97%E5%B9%B3%E5%8F%B0/" title="ELK"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic1.zhimg.com/v2-37d1dd62d373427b8035891e9fe1653e_r.jpg?source=1940ef5c&amp;_r_=e42e569a-0069-e343-79bf-48be39c14141" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ELK"/></a><div class="content"><a class="title" href="/2024/06/20/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/ELK%E6%97%A5%E5%BF%97%E5%B9%B3%E5%8F%B0/" title="ELK">ELK</a><time datetime="2024-06-19T16:00:00.000Z" title="发表于 2024-06-20 00:00:00">2024-06-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/01/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Nginx/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" title="Nginx反向代理配置"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic2.zhimg.com/v2-264805954c1f033af43e006cb826ab60_r.jpg?source=1940ef5c&amp;_r_=d28f8021-80ec-dd23-d7ce-55dc3a4df08f" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nginx反向代理配置"/></a><div class="content"><a class="title" href="/2024/06/01/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Nginx/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" title="Nginx反向代理配置">Nginx反向代理配置</a><time datetime="2024-05-31T16:00:00.000Z" title="发表于 2024-06-01 00:00:00">2024-06-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/27/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Nginx/Nginx-all/" title="Nginx模块"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic2.zhimg.com/v2-264805954c1f033af43e006cb826ab60_r.jpg?source=1940ef5c&amp;_r_=cf8f7b16-55dc-54da-ea02-d65be627d09c" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nginx模块"/></a><div class="content"><a class="title" href="/2024/05/27/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Nginx/Nginx-all/" title="Nginx模块">Nginx模块</a><time datetime="2024-05-26T16:00:00.000Z" title="发表于 2024-05-27 00:00:00">2024-05-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/22/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%8E%E7%A3%81%E7%9B%98/" title="Linux文件系统与磁盘"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic2.zhimg.com/v2-264805954c1f033af43e006cb826ab60_r.jpg?source=1940ef5c&amp;_r_=70c214d9-ccf1-8389-2dfd-c3cf81d71a86" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux文件系统与磁盘"/></a><div class="content"><a class="title" href="/2024/05/22/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%8E%E7%A3%81%E7%9B%98/" title="Linux文件系统与磁盘">Linux文件系统与磁盘</a><time datetime="2024-05-21T16:00:00.000Z" title="发表于 2024-05-22 00:00:00">2024-05-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/11/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/%E9%98%B2%E7%81%AB%E5%A2%99/" title="Linux防火墙"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic1.zhimg.com/v2-0cc45f5fda6e8ff79350ec1303835629_r.jpg?source=1940ef5c&amp;_r_=da6546e9-b132-ceda-756f-c65d96d41164" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux防火墙"/></a><div class="content"><a class="title" href="/2024/05/11/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/%E9%98%B2%E7%81%AB%E5%A2%99/" title="Linux防火墙">Linux防火墙</a><time datetime="2024-05-10T16:00:00.000Z" title="发表于 2024-05-11 00:00:00">2024-05-11</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="/2609320892@qq.com" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://regexlearn.com/zh-cn" title="Regex 101"><i class="anzhiyufont anzhiyu-icon-font"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://regexcrossword.com/" title="Regexcrossword"><i class="anzhiyufont anzhiyu-icon-bolt"></i></a><a class="deal_link" href="/atom.xml" title="RSS"><i class="anzhiyufont anzhiyu-icon-rss"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0, 500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" size="50px"/><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/AYO-Al" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://learngitbranching.js.org/?demo=&amp;locale=zh_CN" title="Learn Git"><i class="anzhiyufont anzhiyu-icon-pencil"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://www.drawio.com/" title="draw.io"><i class="anzhiyufont anzhiyu-icon-instagram"></i></a><a class="deal_link" href="/copyright" title="CC"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i></a></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="algolia" target="_blank" rel="noopener" href="https://www.algolia.com/">algolia</a><a class="footer-item" title="twikoo" target="_blank" rel="noopener" href="https://twikoo.js.org/">twikoo</a><a class="footer-item" title="vercel" target="_blank" rel="noopener" href="https://vercel.com/">vercel</a></div></div><div class="footer-group"><div class="footer-title">主题</div><div class="footer-links"><a class="footer-item" title="文档" target="_blank" rel="noopener" href="https://docs.anheyu.com/">文档</a><a class="footer-item" title="源码" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu">源码</a><a class="footer-item" title="更新日志" target="_blank" rel="noopener" href="https://blog.anheyu.com/update/">更新日志</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="即刻短文" href="/essay/">即刻短文</a><a class="footer-item" title="友链文章" href="/fcircle/">友链文章</a><a class="footer-item" title="留言板" href="/comments/">留言板</a></div></div><div class="footer-group"><div class="footer-title">协议</div><div class="footer-links"><a class="footer-item" title="隐私协议" href="/privacy/">隐私协议</a><a class="footer-item" title="Cookies" href="/cookies/">Cookies</a><a class="footer-item" title="版权协议" href="/copyright/">版权协议</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v7.0.0" title="博客框架为Hexo_v7.0.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v7.0.0"/></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"/></a><a class="github-badge" target="_blank" href="https://www.dogecloud.com/" style="margin-inline:5px" data-title="本站使用多吉云为静态资源提供CDN加速" title="本站使用多吉云为静态资源提供CDN加速"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/CDN-多吉云-3693F3.svg" alt="本站使用多吉云为静态资源提供CDN加速"/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="本站项目由Github托管"/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2021 - 2024 By <a class="footer-bar-link" href="/" title="AYO" target="_blank">AYO</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      if (true) {
        const from = '出自 ' + data.from
        const sub = ["生活明朗&#44; 万物可爱&#44; 人间值得&#44; 未来可期."]
        sub.unshift(data.hitokoto, from)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = data.hitokoto
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.cbd.int/typed.js@2.0.15/dist/typed.umd.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/AYO-Al/AYO-Al.github.io" title="博客">博客</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/AYO-Al" title="本站项目由GitHub托管">本站项目由GitHub托管</a><a class="footer-bar-link cc" href="/copyright" title="cc协议"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-by-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nc-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nd-line"></i></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">52</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">45</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">8</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://git.yuki.love/" title="AYO网站"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="AYO网站"/><span class="back-menu-item-text">AYO网站</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://juejin.cn/user/3708003152300183" title="AYO博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="AYO博客"/><span class="back-menu-item-text">AYO博客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/AYO-Al" title="GitHub"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="GitHub"/><span class="back-menu-item-text">GitHub</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Ansible/" style="font-size: 0.88rem;">Ansible<sup>1</sup></a><a href="/tags/CDN/" style="font-size: 0.88rem;">CDN<sup>1</sup></a><a href="/tags/DNS/" style="font-size: 0.88rem;">DNS<sup>1</sup></a><a href="/tags/Database/" style="font-size: 0.88rem;">Database<sup>8</sup></a><a href="/tags/Docker/" style="font-size: 0.88rem;">Docker<sup>1</sup></a><a href="/tags/ELK/" style="font-size: 0.88rem;">ELK<sup>1</sup></a><a href="/tags/Flask/" style="font-size: 0.88rem;">Flask<sup>1</sup></a><a href="/tags/Httpd/" style="font-size: 0.88rem;">Httpd<sup>1</sup></a><a href="/tags/JavaScript/" style="font-size: 0.88rem;">JavaScript<sup>1</sup></a><a href="/tags/Keepalived/" style="font-size: 0.88rem;">Keepalived<sup>1</sup></a><a href="/tags/LVS/" style="font-size: 0.88rem;">LVS<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>22</sup></a><a href="/tags/MLinux/" style="font-size: 0.88rem;">MLinux<sup>1</sup></a><a href="/tags/MySQL/" style="font-size: 0.88rem;">MySQL<sup>6</sup></a><a href="/tags/Nginx/" style="font-size: 0.88rem;">Nginx<sup>3</sup></a><a href="/tags/Prometheus/" style="font-size: 0.88rem;">Prometheus<sup>1</sup></a><a href="/tags/Python/" style="font-size: 0.88rem;">Python<sup>8</sup></a><a href="/tags/Rabbit/" style="font-size: 0.88rem;">Rabbit<sup>1</sup></a><a href="/tags/Redis/" style="font-size: 0.88rem;">Redis<sup>2</sup></a><a href="/tags/Shell/" style="font-size: 0.88rem;">Shell<sup>3</sup></a><a href="/tags/Web/" style="font-size: 0.88rem;">Web<sup>2</sup></a><a href="/tags/Zabbix/" style="font-size: 0.88rem;">Zabbix<sup>2</sup></a><a href="/tags/%E4%B8%89%E9%AB%98MySQL/" style="font-size: 0.88rem;">三高MySQL<sup>1</sup></a><a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 0.88rem;">中间件<sup>1</sup></a><a href="/tags/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" style="font-size: 0.88rem;">主从复制<sup>1</sup></a><a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" style="font-size: 0.88rem;">云计算<sup>7</sup></a><a href="/tags/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" style="font-size: 0.88rem;">反向代理<sup>1</sup></a><a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 0.88rem;">开发<sup>7</sup></a><a href="/tags/%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB%E6%9C%8D%E5%8A%A1/" style="font-size: 0.88rem;">文件共享服务<sup>1</sup></a><a href="/tags/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" style="font-size: 0.88rem;">文件系统<sup>1</sup></a><a href="/tags/%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/" style="font-size: 0.88rem;">日志管理<sup>1</sup></a><a href="/tags/%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5/" style="font-size: 0.88rem;">时间同步<sup>1</sup></a><a href="/tags/%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/" style="font-size: 0.88rem;">服务管理<sup>1</sup></a><a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 0.88rem;">爬虫<sup>4</sup></a><a href="/tags/%E7%9B%91%E6%8E%A7/" style="font-size: 0.88rem;">监控<sup>3</sup></a><a href="/tags/%E7%A3%81%E7%9B%98/" style="font-size: 0.88rem;">磁盘<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 0.88rem;">网络<sup>3</sup></a><a href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/" style="font-size: 0.88rem;">自动化运维<sup>1</sup></a><a href="/tags/%E8%BD%AF%E4%BB%B6%E7%AE%A1%E7%90%86/" style="font-size: 0.88rem;">软件管理<sup>1</sup></a><a href="/tags/%E9%98%B2%E7%81%AB%E5%A2%99/" style="font-size: 0.88rem;">防火墙<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"><a class="tag-list" href="/tags/Linux" title="Linux">Linux</a><a class="tag-list" href="/tags/Database" title="Database">Database</a><a class="tag-list" href="/tags/Kubernetes" title="Kubernetes">Kubernetes</a></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.4/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2021 By 安知鱼 V1.6.10",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 AYO 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.56.5/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.yuki.love',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.yuki.love',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><script>(() => {
  const initWaline = () => {
    const waline = Waline.init(Object.assign({
      el: '#waline-wrap',
      serverURL: '',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: false,
    }, null))
  }

  const loadWaline = async () => {
    if (typeof Waline === 'object') initWaline()
    else {
      await getCSS('https://cdn.cbd.int/@waline/client@2.15.5/dist/waline.css')
      await getScript('https://cdn.cbd.int/@waline/client@2.15.5/dist/waline.js')
      initWaline()
    }
  }

  if ('Twikoo' === 'Waline' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo.yuki.love',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "visitor@anheyu.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/fireworks.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>