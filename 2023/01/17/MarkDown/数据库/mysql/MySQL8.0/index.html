<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>MySQL | AYO</title><meta name="keywords" content="MySQL,Database"><meta name="author" content="AYO,2609320892@qq.com"><meta name="copyright" content="AYO"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="MySQL"><meta name="application-name" content="MySQL"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="MySQL"><meta property="og:url" content="https://www.yuki.love/2023/01/17/MarkDown/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL8.0/index.html"><meta property="og:site_name" content="AYO"><meta property="og:description" content="本文介绍了MySQL数据库的进阶知识。"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://pic2.zhimg.com/v2-264805954c1f033af43e006cb826ab60_r.jpg?source=1940ef5c&amp;_r_=33d9c07f-6b23-dcfb-775e-2f0bcbf6c0b0"><meta property="article:author" content="AYO"><meta property="article:tag" content=""><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://pic2.zhimg.com/v2-264805954c1f033af43e006cb826ab60_r.jpg?source=1940ef5c&amp;_r_=33d9c07f-6b23-dcfb-775e-2f0bcbf6c0b0"><meta name="description" content="本文介绍了MySQL数据库的进阶知识。"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://www.yuki.love/2023/01/17/MarkDown/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL8.0/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: undefined,
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: 'https://twikoo.yuki.love',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: undefined,
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","🤝 专修交互与设计","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},
  algolia: {"appId":"XMRZIUY8NL","apiKey":"187af2610e1cc500c95dc8b8f3a53d0e","indexName":"hexo","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: AYO","link":"链接: ","source":"来源: AYO","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'AYO',
  title: 'MySQL',
  postAI: '',
  pageFillDescription: '1.数据库介绍, 1.数据库类型, 2.MySQL数据库介绍, 3.数据库工程师职责, 4.MySQL下载, 5.如何在一台机器上启多个MySQL服务呢？, 6.MySQL相关启动参数, 2.MySQL基础命令, 1.MySQL权限认证, 1.权限详解, 2.设置MySQL用户的密码, 3.设置MySQL用户密码过期策略, 3.SQL, 1.SQL, 2.数据类型, 3.DDL语句, 4.DML语句, 5.DQL语句, 1.基本查询, 2.条件查询, 3.聚合函数, 4.分组查询, 5.排序查询, 6.分页查询, 7.DQL执行顺序, 4.DCL, 1.用户管理, 2.权限, 5.正则, 4.函数, 1.字符串函数, 2.数值函数, 3.日期函数, 4.高级函数, 5.约束, 6.多表查询, 1.多表关系, 2.内连接, 3.外连接, 4.自连接, 5.联合查询, 6.子查询, 7.事务, 1.事务四大特性, 2.并发事务问题, 3.事务隔离级别, 8.存储引擎, 1.存储引擎特点, 9.索引, 1.索引概述, 2.为什么选择b+树作为索引结构, 3.索引语法, 4.性能优化, 5.profile详情, 6.explain执行计划, 7.索引的使用, 8.索引涉及原则, 10.SQL优化, 1.插入数据优化, 2.主键插入, 3.order by优化, 4.group by优化, 5.limit优化, 6.count优化, 7.update优化, 11.视图, 1.检查选项, 2.视图更新, 12.存储过程, 1.变量, 2.IF条件判断, 3.参数, 4.case语句, 5.循环, 6.游标, 13.存储函数, 14.触发器, 15.锁, 1.全局锁, 2.表级锁, 3.行级锁, 16.Innodb存储引擎, 1.架构, 2.内存架构, 3.磁盘结构, 4.后台线程, 2.事务原理, 3.MVCC, 17.MySQL管理, 1.系统数据库, 2.常用工具, 18.日志, 1.错误日志, 2.二进制日志, 3.查询日志, 4.慢查询日志, 19.主从复制, 1.原理, 2.主从搭建, 20.分库分表, 1.Mycat, 2.Mycat配置, 3.分片, 4.分片规则, 5.监控Mycat, 21.表分区, 1.表分区类型, 2.子表分区, 3.分区表操作, 22.读写分离数据库介绍数据库将信息数据按照计算机可识别的方式规则存放在磁盘库中并提供一系列可供读写的方式相比较于磁盘文件数据库最大的特点是提供了非常灵活的接口可以获取完整数据或则特定部分数据的方式并提供了一套完整管理数据的方法存储结构备份恢复等为什么要存储数据数据要被随时随地的反复使用不是一次性消耗品数据要被记录防止遗忘数据库类型关系型数据库目前市场上占主要份额的数据库类型以二维表格行和列来存储数据表格和表格之间的数据关系用字段引用来表示非关系型数据库出现时间较短抛弃关系型死板的数据存储方式提供了更加灵活的方式面向高性能并发读写的数据库数据库的主要特点即使具有极高的并发读写性能就是这类代表面向海量数据访问的文档型数据库可以在海量的数据中快速的查询数据以为代表面向可扩展性的分布式数据库这类数据库想解决的问题就是传统数据库存在可扩展性上的缺陷以为代表数据库介绍是一种开发源代码的关系型数据库管理系统数据库系统使用常用的数据库管理语言结构化查询语言进行数据库管理体积小速度快总体拥有成本低尤其是开发源码这一特点使得许多企业选择了作为数据库数据库工程师职责数据库开发工程师负责公司业务数据库系统的模型设计表结构设计负责数据处理中的语句实现存储过程逻辑实现负责指导开发人员对语句的性能优化和指导数据库管理员负责公司业务数据库系统的部署实现负责数据库系统的高可用性备份恢复性能调优监控等实现数据库架构师统筹公司业务数据库系统各个层面的技术实现指导数据库开发工程师和管理员在各个环节的工作提供更优的方案下载下载地址下载正确的包在成功登录之后需要修改初始密码否则不能执行命令内置函数返回当前用户如何在一台机器上启多个服务呢修改配置文件修改端口修改文件修改端口修改启动时指定配置文件相关启动参数安装路径数据文件路径端口启动和错误日志默认是监听的地址默认是指定字符集指定排序规则指定默认存储引擎指定默认时区指定运行过程中可以打开的文件数指定进程对应的程序文件默认在数据文件目录里指定避开内部的权限表启动服务指定临时表文件的存放路径基础命令权限认证权限系统的作用是授予来自某个主机的某个用户可以查询插入修改删除等数据库操作的权限不能明确的指定拒绝某个用户的连接权限控制的执行语句包括授权后的权限都存放在的内部数据库中库并在数据库启动之后把权限信息复制到内存中用户的认证信息包括用户名和主机以下不是同一个用户使用可以查看能赋予的权限创建用户赋予权限表示所有权限可以指定具体权限可以使用查看第一个表示那个库第二个表示那个表可以指定具体的库表表示该用户可以赋予别人相同的权限可以指定查那个字段的权限删除权限权限详解设置用户的密码请注意在之后不支持用命令修改密码创建用户时设置密码指定用户身份验证方法创建用户后设置密码查看身份验证方法身份验证方法这是的传统身份验证方法密码以散列形式存储在的表中大多数用户在使用此方法这是版本引入的一种新的身份验证方法密码以散列形式存储在表中使用算法支持更强大的安全性适用于新的安全标准与类似是版本引入的使用算法存储密码散列用于平台使用客户端进行身份验证用户的身份验证依赖于用户凭据和这两种方法允许连接到服务器进行身份验证使用简单的身份验证而使用身份验证查看密码规则在中使用插件管理密码策略这个参数定义了在密码更改时新密码与旧密码相比必须有多少百分比的字符变化在这里设置为表示新密码必须与旧密码完全不同如果设置为则禁用了检查密码是否包含与用户名相同的字符或序列的功能这个参数定义了密码验证时要使用的字典文件的路径在这里设置为空字符串表示不使用字典文件这个参数定义了密码长度表示可以为空定义了密码中必须包含的大写和小写字符的最小数量在这里设置为表示密码可以不包含混合大小写字符定义了密码中必须包含的数字的最小数量在这里设置为表示密码可以不包含数字定义了密码强度策略的级别可选值包括和在这里设置为表示使用较低的密码策略定义了密码中必须包含的特殊字符的最小数量在这里设置为表示密码可以不包含特殊字符设置用户密码过期策略通用语法语句可以单行或多行书写以分号结尾语句可以使用空格缩进来增强语句的可读性数据库的语句不区分大小写关键字建议使用大写注释单行注释注释内容或注释内容多行注释注释内容分类分类全称说明数据库定义语言用来定义数据库对象数据库表字段数据库操作语言用来对数据库表中的数据进行增删改的子集数据库查询语言用来查询数据库中表的记录数据库控制语言用来创建数据库用户控制数据库的访问权限数据类型中的数据类型有很多主要分为三个类数值类型字符串类型日期时间类型数值类型类型大小有符号范围无符号范围用途小整数值大整数值大整数值或大整数值极大整数值单精度浮点数值双精度浮点数值对如果为否则为依赖于和的值依赖于和的值小数值如果想使用无符号数值类型可以使用指定字符串类型类型大小用途定长字符串变长字符串不超过个字符的二进制字符串短文本字符串二进制形式的长文本数据长文本数据二进制形式的中等长度文本数据中等长度文本数据二进制形式的极大文本数据极大文本数据日期时间类型类型大小范围格式用途日期值时间值或持续时间年份值到混合日期和时间值精确到毫秒不带时区信息到结束时间是第秒北京时间格林尼治时间年月日凌晨混合日期和时间值时间戳精确到秒带有时区信息枚举与集合类型枚举类型用于存储单一值可以选择一个预定义的集合列的存储效率通常较高因为它只需要存储一个值而且内部表示是整数集合类型用于存储多个值可以选择多个预定义的集合语句全称数据库定义语言用来定义数据库对象数据库表字段查询查询所有数据库表查询当前数据库查询表结构表名查询指定表的建表语句表名创建创建数据库可以指定字符集和排序规则创建表修改添加字段表名字段名类型长度注释约束修改数据类型表名字段名新类型长度修改字段表名旧字段名新字段名类型长度注释约束删除字段表名字段名修改表名表名新表名删除删除数据库数据库名删除表表名表名切换数据库数据库名语句全称数据库操作语言用来对数据库表中的数据进行增删改添加数据值和字段的顺序一一对应表名字段字段值值如果对整个字段进行插入可以省略字段表名值值也可以插入多条记录表名值值值值修改数据表名字段值字段值字段值如果不用做限制会修改所有行删除数据表名字段值和都可以删除数据它们的区别在哪呢用于删除表中的所有数据但保留表的结构不删除表本身是一个语句数据定义语言它比更快因为它不是逐行删除数据而是直接释放表所占用的数据页用于从表中删除特定的行也可以删除所有行是一个语句数据操作语言它逐行删除数据可能比慢尤其是在删除大量数据时释放所占用的空间不可恢复不释放表所占用空间可以使用事务进行回滚语句全称的子集数据库查询语言用来查询数据库中表的记录语法字段列表表名条件列表分组字段列表分组后条件列表排序字段列表分页参数基本查询查询多个字段字段字段字段表名查询所有字段表名也可以给查询字段设置别名字段别名表名也可以去除重复记录字段列表表名条件查询语法字段列表表名条件列表条件运算符运算符说明大于大于等于小于小于等于等于或不等于在某个范围之内含边界值包含在之后的列表占位符模糊匹配匹配一个字符匹配任意字符是不是或与或或或非聚合函数聚合函数是将一列数据作为一个整体进行纵向计算值不参与聚合函数运算语法聚合函数字段列表表名常见的集合函数函数说明统计数量最大值最小值平均值求和分组查询语法字段列表表名条件分组字段分组后的过滤条件与区别执行时机不同是分组之前进行过滤不满足条件不参数分组而是分组之后对结果进行过滤判断条件不同不能对聚合函数进行判断而可以过滤对象过滤的是表中的行它作用在每一行上过滤的是分组后的结果它作用在聚合值上的严格模式引起的它要求在使用子句时列表中的每个列都要么是一个聚合函数例如等要么包含在子句中根据性别分组统计男女员工数量查询年龄小于的员工并根据员工工作地址分组获取员工数量大于等于的工作地址执行顺序聚合函数分组之后查询的字段一般为聚合函数和分组字段查询其他字段无意义排序查询中的排序操作在内存中完成大数据排序可以面临着内存空间不足的问题在排序过程中可以使用来控制排序操作使用的内存排序操作比较消耗内存所以可以考虑使用索引排序也就是语法字段列表表名字段排序方式字段排序方式排序方式升序默认降序如果是多字段排序当第一个字段相同时才回使用第二个字段进行排序分页查询语法字段列表表名起始索引查询记录数起始索引从开始起始索引查询页码每页显示记录数分页查询时数据库的方言不同数据库有不同的实现如果查询的是第一个数据可以省略起始索引执行顺序语句的执行顺序包括以下步骤这些步骤用于从数据库中检索数据并确保结果按照指定的顺序和条件返回子句查询从子句中指定的表中获取数据这是查询的起点子句子句用于对行进行条件过滤只有符合子句中条件的行才会被包括在结果中子句如果有子句数据将按照子句中指定的列进行分组这导致对每个组应用后续的聚合函数子句如果有子句它将在子句后用于筛选分组后的结果只有满足子句中条件的组才会被包括在结果中子句子句用于选择要包括在结果中的列这是确定最终输出的列的阶段在这一步中可以使用聚合函数如等对每个分组的结果进行计算子句如果有子句数据库将对结果进行排序这决定了结果集的顺序子句如果有子句它将用于限制结果的数量只有满足前面所有条件的行中的一部分将被返回全称数据库控制语言用来创建数据库用户控制数据库的访问权限用户管理查询用户创建用户用户名主机名密码修改用户密码用户名主机名新密码指定使用密码验证插件删除用户用户名主机名用户主机部分可以使用或等通配符权限中常用权限查询权限用户名主机名授予权限权限列表数据库名表名用户名主机名删除权限权限列表数据库名表名用户名主机名正则语法模式描述匹配输入字符串的开始位置如果设置了对象的属性也匹配或之后的位置匹配输入字符串的结束位置如果设置了对象的属性也匹配或之前的位置匹配除之外的任何单个字符要匹配包括在内的任何字符请使用像的模式字符集合匹配所包含的任意一个字符例如可以匹配中的负值字符集合匹配未包含的任意字符例如可以匹配中的匹配或或例如能匹配或则匹配或匹配前面的子表达式零次或多次例如能匹配以及等价于匹配前面的子表达式一次或多次例如能匹配以及但不能匹配等价于是一个非负整数匹配确定的次例如不能匹配中的但是能匹配中的两个和均为非负整数其中最少匹配次且最多匹配次匹配一个数字字符匹配一个字母数字字符包括下划线匹配一个空白字符函数函数是指一段可以直接被另一段程序调用的程序或代码字符串函数函数描述实例返回字符串的第一个字符的码返回字段第一个字母的码返回字符串的字符数返回字符串的字符数返回字符串的字符数等同于返回字符串的字符数字符串等多个字符串合并为一个字符串合并多个字符串同函数但是每个字符串之间要加上可以是分隔符合并多个字符串并添加分隔符返回第一个字符串在字符串列表中的位置返回字符串在列表值中的位置返回在字符串中与匹配的字符串的位置返回字符串在指定字符串中的位置函数可以将数字进行格式化将保留到小数点后位最后一位四舍五入格式化数字形式输出字符串替换的位置开始长度为的字符串从字符串第一个位置开始的个字符替换为输出从字符串中获取的开始位置获取在字符串中的位置返回字符串中的位置将字符串的所有字母变成小写字母字符串转换为小写返回字符串的前个字符返回字符串中的前两个字符将字符串的所有字母变成小写字母字符串转换为小写在字符串的开始处填充字符串使字符串长度达到将字符串填充到字符串的开始处去掉字符串开始处的空格去掉字符串开始处的空格从字符串的位置截取长度为的子字符串同从字符串中的第个位置截取个字符从字符串中获取的开始位置返回字符串中的位置将字符串重复次将字符串重复三次将字符串替代字符串中的字符串将字符串中的字符替换为字符将字符串的顺序反过来将字符串的顺序反过来返回字符串的后个字符返回字符串的后两个字符在字符串的结尾处添加字符串使字符串的长度达到将字符串填充到字符串的结尾处去掉字符串结尾处的空格去掉字符串的末尾空格返回个空格返回个空格比较字符串和如果与相等返回如果返回如果返回比较字符串从字符串的位置截取长度为的子字符串从字符串中的第个位置截取个字符从字符串的位置截取长度为的子字符串等同于从字符串中的第个位置截取个字符返回从字符串的第个出现的分隔符之后的子串如果是正数返回第个字符左边的字符串如果是负数返回第的绝对值从右边数个字符右边的字符串去掉字符串开始和结尾处的空格去掉字符串的首尾空格将字符串转换为大写将字符串转换为大写将字符串转换为大写将字符串转换为大写数值函数函数名描述实例返回的绝对值返回的绝对值返回求的反余弦值单位为弧度为一个数值求反正弦值单位为弧度为一个数值求反正切值单位为弧度为一个数值求反正切值单位为弧度返回一个表达式的平均值是一个字段返回表中字段的平均值返回大于或等于的最小整数返回返回大于或等于的最小整数返回求余弦值参数是弧度求余切值参数是弧度返回查询的记录总数参数是一个字段或者号返回表中字段总共有多少条记录将弧度转换为角度整除为被除数为除数计算除于返回的次方计算的三次方返回小于或等于的最大整数小于或等于的整数返回返回列表中的最大值返回以下数字列表中的最大值返回以下字符串列表中的最大值将一个地址转换为整数将一个整数转换为地址返回列表中的最小值返回以下数字列表中的最小值返回以下字符串列表中的最小值返回数字的自然对数以为底返回的自然对数或返回自然对数以为底的对数如果带有参数则为指定带底数返回以为底的对数返回以为底的对数返回以为底的对数返回字段中的最大值返回数据表中字段的最大值返回字段中的最小值返回数据表中字段的最小值返回除以以后的余数除于的余数返回圆周率返回的次方的次方返回的次方的次方将角度转换为弧度度转换为弧度返回到的随机数返回离最近的整数可选参数表示要四舍五入的小数位数如果省略则返回整数返回的符号是负数正数分别返回和求正弦值参数是弧度返回的平方根的平方根返回指定字段的总和计算表中字段的总和求正切值参数是弧度返回数值保留到小数点后位的值与最大的区别是不会进行四舍五入日期函数函数名描述实例计算起始日期加上天的日期是一个时间表达式时间加上时间表达式加秒秒添加小时分钟秒返回当前日期返回当前日期返回当前时间返回当前日期和时间返回当前时间从日期或日期时间表达式中提取日期值计算日期之间相隔的天数计算起始日期加上一个时间段后的日期值可以是按表达式的要求显示日期函数从日期减去指定的时间间隔表中字段减去天返回日期值的日期部分返回日期是星期几如计算日期是本月的第几天日期今天是星期几星期日星期一以此类推计算日期是本年的第几天从日期中获取指定的值指定返回的值可取值为计算从年月日开始天后的日期返回中的小时值返回给给定日期的那一月份的最后一天返回当前日期和时间返回当前日期和时间基于给定参数年份和所在年中的天数序号返回一个日期组合时间参数分别为小时分钟秒返回日期参数所对应的微秒数返回中的分钟值返回日期当中的月份名称如返回日期中的月份值到返回当前日期和时间为年月组合日期添加一个时段返回两个时段之间的月份差值返回日期是第几季节返回到返回中的秒钟值将以秒为单位的时间转换为时分秒的格式将字符串转变为日期日期减去天后的日期默认是天时间减去秒的时间秒返回当前日期和时间提取传入表达式的时间部分按表达式的要求显示时间将时间转换为秒计算时间差值单个参数时函数返回日期或日期时间表达式有个参数时将参数加和计算时间差返回的时间差计算两个时间相隔多少天计算两个时间相隔多少月计算两个时间相隔多少年计算两个时间相隔多少分钟计算日期距离年月日的天数计算日期是本年的第几个星期范围是到日期是星期几表示星期一表示星期二计算日期是本年的第几个星期范围是到返回年份返回年份及第几周到中表示周天表示周一以此类推高级函数函数名描述实例返回的二进制编码为十进制数的进制编码将字符串转换为二进制字符串表示函数开始表示函数结束如果成立则返回如果成立则返回当全部不成立则返回而当有一个成立之后后面的就不执行了转换数据类型字符串日期转换为日期返回参数中的第一个非空表达式从左向右返回唯一的连接返回进制数变成进制数函数将字符串的字符集变成返回当前用户返回当前数据库名如果表达式成立返回结果否则返回结果正确错误正确如果的值不为则返回否则返回判断表达式是否为返回最近生成的值比较两个字符串如果字符串与相等返回否则返回返回当前用户返回当前用户返回当前用户返回数据库的版本号以下是版本新增的一些常用函数函数描述实例将键值对转换为对象将值转换为数组从字符串中提取指定的值检查一个字符串是否包含指定的值为查询结果中的每一行分配一个唯一的数字为查询结果中的每一行分配一个排名约束概念约束是作用于表中字段上的规则用于限制存储在表中的数据目的保证数据库中数据的正确有效性和完整性常用约束约束说明关键字非空约束该字段的数据不能为唯一约束保证该字段的所有数据都是唯一的主键约束主键是一行数据的唯一标识要求非空且唯一默认约束保存数据时如果未指定该字段的值则采用默认值检查约束版本之后保证字段值满足某一条件外键约束用来让两张表的数据之间建立连接保证数据的一致性和完整性自增序列一般一个表中只有一个通常跟主键搭配添加外键表名字段名数据类型外键名称外键字段主表主表列名表名外键名称外键字段主表主表列名删除外键表名外键名多表查询指从多张表中查询数据笛卡尔积笛卡尔乘积是指在数学中两个集合和的所有组合情况在多表查询时需要消除无效的笛卡尔积多表查询分类连接查询内连接相当于查询交集部分数据外连接左外连接查询左表所有数据以及两张表交集部分数据且对于右表没有的数据以填补右外连接查询右表所有数据以及两张表交集部分数据且对于左表没有的数据以填补自连接当前表与自身的连接查询自连接必须使用表别名子查询在连接中表示的是连接条件而定义对查询结果进行过滤的条件外连接必须使用语句一般来说中的优化器会根据查询条件索引情况和统计信息来决定先读那个表但也可以用来强制让数据库顺序读多表关系在项目开发中在进行数据库表结构设计时会根据业务需求及业务模块之间的关系分析并设计表结构由于业务之间相互关联所以各个表结构之间也存在着各种联系基本上分为三种一对多多对多一对一一对多案例部门与员工的关系关系一个部门对应多个员工一个员工对应一个部门实现在多的一方建立外键指向一的一方的主键多对多案例学生与课程的关系关系一个学生可以选修多门课程一门课程也可以拱多个学生选择实现建立第三张中间表中间表至少包含两个外键分别关联两方主键一对一案例用户与用户详情的关系关系一对一关系多用于单表拆分将一张表的基础字段放在一张表中其他详情字段放在另一张表中以提升操作效率实现在任意一方加入外键关联另一方的主键并且设置外键为唯一的内连接语法隐式内连接字段列表表表条件显式内连接字段列表表表条件内连接查询的是两张表交集的部分外连接语法左外连接字段列表表表条件查询左表所有数据以及两张表交集部分数据且对于右表没有的数据以填补右外连接字段列表表表条件查询右表所有数据以及两张表交集部分数据且对于左表没有的数据以填补自连接语法字段列表表别名表别名条件自连接可以是内连接也可以是外连接使用自连接必须起别名联合查询语法字段列表表字段列表表操作符用于连接两个以上的语句的结果组合到一个结果集合并去除重复的行不去除重复行操作符必须由两个或多个语句组成每个语句的列数和对应位置的数据类型必须相同子查询语句中嵌套语句称为嵌套查询也称为子查询子查询外部语句可以是任一个根据子查询结果不同分为标量子查询子查询结果为单个值把标量子查询当成单个值使用列子查询把列子查询当成集合来使用行子查询元组方式表示的逻辑表子查询查询结果为多行多列可以当成一个中间表来查询并且可以使用操作符方式使用元组方式比较根据出现位置之后在对表进行修改操作时不能在中子查询引用正在更新的表可以在子查询中再嵌套一个子查询不能在后面之间用而是必须在后面再嵌套一个子查询这样做的目的是避免后的表与正在更新的表一致之后中间表必须使用别名之后只能是标量子查询事务事务是一组操作的集合它是一个不可分割的工作单位事务会把所有的操作作为一个整体一起向系统提交或撤销操作请求即这些操作要么同时成功要么同时失败默认的事务是自动提交的也就是说执行一条语句会立即隐式的提交事务这个由中的属性控制查看设置提交方式或显式地开启一个事务也可以使用不过二者是等价的会提交事务并使已对数据库进行的所有修改成为永久性的也可以使用不过二者是等价的回滚会结束用户的事务并撤销正在进行的所有未提交的修改允许在事务中创建一个保存点一个事务中可以有多个删除一个事务的保存点当没有指定的保存点时执行该语句会抛出一个异常把事务回滚到标记点事务四大特性并发事务问题问题描述脏读一个事物读到另一个事物未提交的数据不可重复读一个事物先后读取同一条记录但两次读取的数据不同幻读一个事物按照条件查询数据时没有对应的数据行但是在插入数据时又发现这行数据已经存在事务隔离级别存储引擎体系结构连接层最上层是一些客户端和链接服务主要完成一些类似于连接处理授权认证及相关的安全方案服务器也会为安全接入的每个客户端验证它所具有的权限服务层第二层架构主要完成大多数的核心服务功能如接口并完成缓存的查询的分析和优化部分内置函数的执行所有跨存储引擎的功能也在这一层实现如过程函数等引擎层存储引擎真正的负责了中数据的存储和提取服务器通过和存储引擎进行通信不同的存储引擎具有不同的功能这样我们可以根据自己的需要来选取合适的存储引擎存储层主要是将数据存储在文件系统之上并完成与存储引擎的交互存储引擎存储引擎就是存储数据建立索引更新查询数据等技术的实现方式存储引擎是基于表的而不是基于库的所以存储引擎也可被称为表类型之后默认存储引擎是查看数据库支持的存储引擎在创建表时用来指定表的存储引擎存储引擎特点是一种兼顾高可靠性和高性能的通用存储引擎在之后是默认的存储引擎操作遵循模型支持事务行级锁提高并发访问性能支持外键约束保证数据的完整性和正确性代表的是表名引擎每张表都会对应这样一个表空间文件存储该表的表结构数据和索引该行为由参数控制是早期默认存储引擎不支持事物不支持外键支持表锁不支持行锁访问速度快文件表结构文件表数据文件索引引擎的表数据时存储在内存中的由于受到硬件问题或断电问题的影响只能将这些表作为临时表或缓存使用内存存放索引存储表结构信息索引索引概述索引是帮助高效获取数据的数据结构有序在数据之外数据库系统还维护着满足特定查找算法的数据结构这些数据结构以某种方式指向数据这样就可以在这些数据结构上实现高级查找算法这种数据结构就是索引索引相当于数据的目录优势劣势提高数据检索的效率减低数据库的成本索引列也是要占用空间通过索引对数据进行排序减低数据排序的成本降低的消耗索引大大提高了查询效率同时却也减低了更新表的速度如对表进行增删改等操作时效率减低的索引是在存储引擎层实现的不同的存储引擎有不同的结构主要包含索引哈希索引就是采用一定的算法将键值换算成新的值映射到对应的槽位上然后存储到表中如果两个或多个键值映射到一个相同的槽位上他们就产生了冲突可以通过链表解决索引只能用于等值比较不支持范围查询无法利用索引进行排序查询效率高通常只需要一次检索就可以了效率通常高于索引存储引擎支持索引中具有自适应功能索引是存储引擎根据索引在指定条件下自动构建的根据字段特性索引分类分类含义特点关键字主键索引针对表中主键创建的索引默认自动创建只能有一个唯一索引避免同一个表中某数据列中的值重复可以有多个常规索引快速定位特定数据可以有多个全文索引全文索引查找的是文本中的关键字而不是比较索引中的值可以有多个根据字段个数索引分为单列索引联合索引根据存储形式索引分为分类含义特点聚簇索引将数据和索引存储在一起索引的叶子结点保存了行数据必须有且只有一个二级索引将数据与索引分开存储索引结构的叶子结点关联的是对应的主键可以存在多个聚簇索引选取规则如果存在主键主键索引就是聚簇索引如果没有则使用第一个唯一索引作为聚簇索引如果都没有则会自动生成一个作为隐藏的聚簇索引为什么选择树作为索引结构索引语法创建索引索引最大长度为字节但引入了超长索引索引的最大长度是字节创建的时候可以只使用字段的一部分作为索引用于指定索引的排序顺序默认情况下索引以升序排序可以直接在创建表的时候指定查看索引删除索引性能优化执行频率客户端连接成功后通过命令可以提供服务器状态信息通过如下指令可以查看当前数据库执行语句的频次慢查询日志慢查询日志记录了所有执行时间超过指定参数单位默认的所有语句的日志的慢查询日志默认没有开启需要在配置文件中配置开启慢日志查询开关设置慢日志的时间设置慢查询日志位置慢查询日志文件默认位置在详情能够在做优化时帮助我们了解时间都耗费到哪里了通过参数能够查看是否支持操作默认是关闭的可以通过语句在级别开启开启后就可以使用查看各的耗时了查看每一条的耗时基本情况查看指定的语句各个阶段的耗时情况格式显示所有性能信息显示块操作次数显示上下文切换次数被动和主动显示用户时间系统时间显示发送和接受的消息数量截止到版本还未实现显示页错误数量显示源码中的函数名称与位置显示的次数开始执行查询的阶段表示查询的整体开始检查执行查询的用户是否具有足够的权限打开涉及的表准备执行查询之前的阶段初始化查询的一些内部数据结构优化器在这个阶段尝试找到最优的执行计划选择最有效的方式来执行执行查询的主要阶段实际执行查询并返回结果查询执行结束的标志查询处理结束的标志包括了阶段以及一些后续清理工作关闭之前打开的表释放相应的资源释放在执行过程中分配的临时数据结构和资源清理和释放其他与查询执行相关的资源查看指定的语句使用情况执行计划或者命令获取如何执行语句的信息包括在语句执行过程中表如何连接和连接的顺序的使用直接加在任何一条查询语句的前面即可查询类型操作表表分区连接类型可能用到的索引实际用到的索引索引长度查询的序列号表示查询中执行字句或者是操作表的顺序相同执行顺序从上到下不同值越大越先执行表示类型常见的取值有简单表即不使用表连接或子查询主查询即外层的查询中的第二个或后面的查询语句之后包含子查询等表示连接类型性能由好到坏的连接类型为不访问任何表访问系统表这是最好的连接类型表示表中只有一行记录系统表这是常量连接这个类型通常出现在对等系统表的查询中根据主键或唯一索引访问也是常量连接但是与不同的是它用于比较与查询表的所有部分或索引的所有部分匹配的常量值这个类型通常出现在对主键或唯一索引列进行等值查询的情况下表示对于前表的每个行组合都只有一行在后表中匹配这是一个非常有效的连接类型通常出现在使用主键或唯一索引进行连接的情况下该连接类型表示使用非唯一索引进行连接这通常用于使用非唯一索引进行连接表示使用索引范围扫描通常发生在使用这类范围条件的查询中表示对整个索引进行扫描通常在没有找到更好的连接类型时使用这可能发生在查询不会返回大量数据的情况下以避免排序操作全表扫描显示可能应用在这张表上的索引一个或多个实际使用呢的索引如果为则没有使用索引表示索引中使用的字节数该值为索引字段最大可能长度并非实际使用长度在不损失精确性的前提下长度越短越好认为必须要执行查询的行数在引擎表中是一个估计值可能并不总是准确的表示返回结果的行数占需读取行数的百分比的值越大越好额外的信息索引的使用最左前缀法则如果索引联合了多列要遵守最左前缀法则最左前缀法则指的是查询从索引的最左列开始并且不跳过索引中间的列如果跳过某一列索引将部分失效后面的字段索引失效为联合索引范围查询联合索引中出现范围查询范围查询右侧的列索引失效索引失效所以尽量使用或索引列运算不要在索引列上进行运算或函数操作索引将失效字符串不加引号字符串类型字段使用时不加引号索引将失效模糊查询如果仅仅是尾部模糊匹配索引不会失效如果是头部模糊匹配索引失效连接条件用分割开的条件如果前的条件中的列有索引而后面的列中没有索引那么涉及的索引都不会被用到使用时两侧必须都有索引数据分布影响如果评估使用索引比全表慢则不使用索引提示提示是优化数据库的一个重要手段简单来说就是在语句中加入一些认为的提示来达到优化操作的目的在选择使用那个索引的时候一般会选择基数高的索引但有的时候我们可以自己指定要使用的索引覆盖索引尽量使用覆盖索引查询使用了索引并且需要返回的列在该索引中已经全部能够找到减少简单来说就是查找的数据尽量在一个上面而不用回表到聚簇索引上进行二次查找前缀索引当字段类型为字符串时有时候需要索引很长的字符串这会让索引变的很大查询时浪费大量的磁盘影响查询效率此时可以只将字符串的一部分前缀建立索引这样可以大大节约索引空间从而提高索引效率但也有缺点无法对前缀索引做或前缀长度可以根据索引的选择性来决定而选择性是指不重复的索引值基数和数据表的记录总数的比值索引选择性越高则查询效率越高唯一索引的选择性是这是最好的索引选择性性能也是最好的所以选择前缀长度要尽可能短且选择性高的选择性单列索引和联合索引在业务场景中如果存在多个查询条件考虑针对于查询字段建立索引时建议建立联合索引而非单列索引索引下推在使用联合索引查询时如和是一个联合索引如果没有索引下推那么存储引擎通过回表去查找第一条的数据然后让层判断是否符合条件然后根据属性去查找下一条记录如果有索引下推那么在存储引擎层返回数据的时候会一起判断是否符合条件才去回表而不是回表之后让层去判断简单来说没有索引下推的话存储引擎层只会判断联合索引的第一个索引然后回表全部数据让层去判断剩下的索引条件有了索引下推之后会在存储引擎层判断完所有的索引条件再去回表减少回表次数提升查询效率索引涉及原则针对数据量较大且查询毕竟频繁的表建立索引针对于常作为查询条件排序分组操作的字段建立索引简历选择区分度高的列作为索引尽量建立唯一索引区分区越高使用索引的效率越高如果是字符串类型的字段字段的长度较长可以针对于字段的特点建立前缀索引尽量使用联合索引减少单列索引查询时联合索引很多时候可以覆盖索引节省内存空间避免回表提高查询效率要控制索引的数量索引并不是多多益善索引越多维护索引结构的代价也就越大会影响增删改的效率如果索引列不能存储值请在创建表时约束它当优化器知道每列索引是否包含值时它可以更好地确定那个索引最有效的用于查询优化一般来说有两种优化查询技术即基于成本的优化和基于规则的优化而优化器使用的是可以使用语句来查询最近一条查询的成本插入数据优化优化推荐使用批量插入减少连接开销最好一次插入条记录手动提交事务可以将大批量插入分为几条插入语句主键顺序插入大批量插入数据主键插入数据组织方式在存储引擎中表数据都是根据主键顺序组织存放的这种存储方式的表称为索引组织表页分裂页可以为空也可以填充一半也可以填充每个页包含了行数据如果一行数据过大会行溢出根据主键顺序排列当主键乱序插入时因为叶子结点是按顺序排列的所以出现上面这种情况时第一页剩余空间不足以插入这一条数据所以会把第一页的的数据分到新的一页再把按顺序插入插入完成后还需要对页的顺序指针进行重排这就是页分裂现象所以主键顺序插入性能要高于乱序插入页合并当删除一行记录时实际上记录并没有被物理删除只是记录被标记为删除并且它的空间变得允许被其他记录声明使用当页中删除的记录达到默认为页的会开始寻找最靠近的页前或后看看是否可以将两个页合并以优化空间使用可以自行配置主键设计原则满足业务需求的情况下尽量减低主键的长度插入数据时尽量选择顺序插入选择使用自增主键尽量不要使用做主键或者是其他自然主键如身份证尽量减少对主键的修改优化通过表的索引或全表扫描读取满足条件的数据行然后在排序缓冲区中完成排序操作所有不是通过索引直接返回排序结果的排序都叫排序通过有序索引顺序扫描直接返回有序数据这种情况即为不需要额外排序操作效率高在表中有一个联合索引不符合最左前缀原则所以会使用根据排序字段建立合适的索引多字段排序时也遵循最左前缀法则尽量使用覆盖索引多字段排序一个升序一个降序此时需要注意联合索引在创建时的规则如果不可避免的出现大数据排序时可以适当增大排序缓冲区大小默认当排序的数据大小超过后会选择使用即使使用索引优化使用索引使用临时表效率低使用也遵循最左原则导致部分索引失效可以使用过滤来确保不使用临时表所以在分组时尽量使用覆盖索引和满足最左原则优化在大数据进行分页时数据所在位置越靠后分页速度越慢一个常见的问题是此时需要排序前记录仅仅返回的记录其他记录丢弃查询排序的代价非常大官方推荐优化使用覆盖索引加子查询形式进行优化目前不支持在子查询中出现可以使用连接来实现优化引擎把一个表的总行数存在磁盘上因此执行的时候会直接返回这个数效率很高引擎执行的时候需要把数据一行行从引擎里面读出来然后累计计数优化思路自己计数几种用法是一个聚合函数对于返回的结果集一行行判断如果不是累计值加否则不加最后返回累计值用法主键字段和有会先选择二级索引因为二级索引比聚簇索引要小如果使用主键字段的话会读取记录的值但使用前两种方法不用优化的行锁是针对索引加的锁不是针对记录加的锁并且该索引不能失效否则会从行锁升级为表锁视图视图是一种虚拟存在的表视图中的数据并不在数据库中实际存在行和列数据来自定义视图的查询中使用的表并且是在使用视图时动态生成的通俗的说视图只保存了查询了逻辑不保存查询结果所以我们在创建视图的时候主要的工作就落在创建这条查询语句上创建视图名称列名列表语句实例查询查看创建视图语句视图名称查看视图数据视图名称修改方式一视图名称列名列表语句方式二视图名称列名列表语句删除视图名称视图名称检查选项视图更新要使视图可以更新视图中的行与基础表中的行之间必须存在一对一的关系如果视图包含以下任何一项则该视图不可更新聚合函数或窗口函数或作用简单视图不仅可以简化用户对数据的理解也可以简化他们的操作那些被经常使用的查询可以被定义为视图从而使得用户不必为以后得操作每次指定全部的条件安全数据库可以授权但不能授权到数据库特定行和特定列上通过视图用户只能查询和修改他们所能看到的数据数据独立视图可以帮助用户屏蔽真是表结构变化带来的影响就算修改了数据库中的字段名但可以在创建视图的时候指定别名来使用户无感知存储过程存储过程是事先经过编译并存储在数据库中的一段语句的集合调用存储过程可以简化应用开发人员的很多工作减少数据在数据库和应用服务器之间的传输对于提高数据处理的效率是有好处的存储过程思想很简单就是数据库语言层面的代码封装和重用特点封装复用可以接受参数也可以返回数据减少网络交互效率提升创建存储过程名称参数列表语句在命令行创建存储过程可能会出错因为监测到自动结束语句所以要使用指定其他分隔符调用名称参数查看查询指定数据库的存储过程及状态信息存储过程名称查询存储过程定义删除存储过程名称变量系统变量是服务器提供的不是用户定义的属于服务器层面分为全局变量会话变量用户自定义变量用户自定义变量条件判断语法条件条件优秀合格不合格参数类型类型含义备注该类参数作为输入也就是需要调用时传入值默认该类参数作为输出也就是该参数可以作为返回值既可以作为输入参数也可以作为输出参数定义存储过程名称参数名参数类型语句示例优秀合格不合格示例语句语法循环判断为执行满足条件时退出循环条件实现简单的循环如果不在逻辑中增加退出循环的条件可以用来使用简单的死循环相当于相当于游标在之前的用户自定义变量都只能接收单个值不能接收多行多列数据而游标可以游标是用来存储查询结果集的数据类型在存储过程和函数中可以使用游标对结果集进行循环的处理游标的使用包括游标的声明和游标声明游标声明在普通变量之后游标名称查询语句打开游标游标名称获取游标记录游标名称变量变量关闭游标游标名称条件处理程序存储函数触发器触发器是与表有关的数据库对象指正在之前或之后触发并执行触发器中定义的语句集合触发器的这种特性可以协助应用在数据库端确保数据的完整性日志记录数据校验等操作使用别名和来引用触发器中发生变化的记录内容这与其他数据库是相似的现在触发器还只支持行级触发不支持语句级触发触发器类型和类型表示将要或已经新增的数据类型表示修改之前的数据表示将要或已经修改后的数据类型表示将要或者已经删除的数据定义行级触发器查看删除没有指定数据库则默认当前数据库示例锁锁是计算机协调多个进行或线程并发访问某一资源的基址在数据库中除传统的计算资源的争用以外数据也是一种供许多用户共享的资源如何保证数据并发访问的一致性有效性是所有数据库必须解决的一个问题锁冲突也是影响数据库并发访问性能的一个重要因素从这个角度来说锁对数据库而言显得尤其重要也更加复杂中的锁按照粒度分分为以下三类全局锁锁定数据库中的所有表表级锁每次操作锁住整张表行级锁每次操作锁住对应的行数据全局锁全局锁就是对整个数据库实例加锁加锁后整个实例就处于只读状态后续的的写语句语句已经更新操作的事务提交语句都将被阻塞典型的使用场景是做全库的逻辑备份对所有表进行锁定从而获取一致性视图保证数据的完整性加锁解锁备份库在数据库中加全局锁可能存在以下问题如果在主库上备份那么在备份期间都不能执行更新业务基本上就得停摆如果在从库上备份那么备份期间从库不能执行主库同步过来的二进制日志会导致主从延迟在引擎中可以在备份时加上参数来完成不加锁的一致性数据备份表级锁表级锁每次操作锁住整个表锁粒度大发生锁冲突的概率最高并发度最低应用在等存储引擎中表级锁主要分为以下三类表锁元数据锁意向锁表锁表锁分为表共享读锁表独占写锁语法加锁表名释放锁客户端断开连接读锁不会阻塞其他客户端的读但是会阻塞写写锁两者都会元数据锁加锁过程是系统自动控制无需显式使用在访问一张表的时候会自动加上锁主要作用是维护表元数据的数据一致性在表上有活动事务时不可以对元数据进行写入操作为了避免与冲突保证读写的正确性查看元数据锁信息意向锁为了避免在执行时加的行锁和表锁的冲突在中引入了意向锁使得表锁不用检查每行数据是否加锁使用意向锁来减少表锁的检查如果没有意向锁在一个事物想对表加表锁的时候需要一行行数据去检查是否加了行锁及行锁的类型是否兼容性能极低语法意向共享锁由语句添加与表兼容与表互斥意向排他锁由添加与表和互斥意向锁之间不会互斥查看意向锁及行锁的加锁情况行级锁行级锁每次操作锁住对应的行数据锁定粒度最小发生锁冲突的概率最低并发度最高应用在存储引擎中的数据是基于索引组织的行锁是通过对索引上的索引项加锁来实现的而不是对记录加的锁对于行级锁主要分为行锁锁定单个行记录的锁防止其他事物对此进行和在隔离级别支持间隙锁索引索引记录间隙不含该记录确保索引记录间隙不变防止其他事物在这个间隙进行产生幻读在隔离级别支持间隙锁锁定的是两个索引记录之间的间隙而不是实际的记录本身当一个事务在某个范围内的记录上使用了或语句时会对这个范围的间隙进行间隙锁定防止其他事务在这个范围内插入新记录从而保证该范围内的幻读问题不会发生临键锁行锁和间隙锁组合同时锁住数据并锁住数据前面的间隙在隔离级别支持临键锁是存储引擎的一种组合锁它结合了行级锁和间隙锁的特性当一个事务在某个范围内的记录上使用了或语句时会对范围内的记录进行行级锁定并对记录前的间隙和记录后的间隙进行间隙锁定这样可以避免在范围内插入新记录或者在范围前后插入新记录防止幻读行锁实现了以下两种类型的行锁共享锁允许一个事物去读一行阻止其他事物获得相同数据集的排它锁排它锁允许获取排它锁的事务更新数据阻止其他事物获得相同数据集的共享锁和排它锁默认情况下在事务隔离级别运行使用锁进行搜索和索引扫描以防止幻读针对唯一索引进行检索时对已存在的记录进行等值匹配时将会自动优化为行锁的行锁是针对于索引加的锁不通过索引条件检索数据那么将对表中的所有记录加锁此时就会升级为表锁间隙锁临键锁默认情况下在事务隔离级别运行使用锁进行搜索和索引扫描以防止幻读索引上的等值查询唯一索引给不存在的记录加锁时优化为间隙锁索引上的等值查询普通索引向右遍历时最后一个值不满足查询需求时退化为间隙锁索引上的范围查询唯一索引会访问到不满足的条件的第一个值为止间隙锁唯一目的是防止其他事物插入间隙间隙锁可以共存一个事物采用的间隙锁不会阻止另一个事物在同一间隙上采用间隙锁存储引擎架构版本开始默认使用存储引擎它擅长事务处理具有奔溃恢复特性在日常开发中使用非常广泛下面是架构图左侧为内存结构右侧为磁盘结构内存架构缓存池是主内存中的一个区域里面可以缓存磁盘上经常操作的真实数据在执行增删改查操作时先操作缓冲池中的数据若缓冲池没有数据则从磁盘加载并缓存然后再以一定频率刷新到磁盘从而减少磁盘加快处理速度缓冲区大小一般可以设置为物理内存的缓冲池以页为单位底层采用链表数据结构管理根据状态将分为空闲未被使用被使用数据没有被修改过脏页被使用数据被修改过池中数据与磁盘数据不一致更改缓冲区针对于非唯一二级索引页在执行语句时如果这些数据没有在中不会直接操作磁盘而会将数据变更在更改缓冲区中在未来数据没有被读取时再将数据合并恢复到中再将合并后的数据刷新到磁盘中的意义是什么与聚簇索引不同二级索引通常是非唯一的并且以相对随机的顺序插入二级索引同样删除和更新可能会影响索引树中不相邻的二级索引页如果每一次都操作磁盘会造成大量的磁盘有了之后可以在缓冲池中进行合并处理减少磁盘自适应索引用于优化对数据的查询存储引擎会监控表上各索引页的查询如果观察到索引可以提升速度则建立索引称之为自适应索引自适应哈希索引无需人工干预是系统工具情况自动完成参数是否开启自适应哈希自适应哈希的桶数量日志缓冲区用来保存要写到磁盘中的日志数据默认大小为日志缓冲区会定期刷新到磁盘中如果需要更新插入或删除许多行的事务增加日志缓冲区的大小可以节省磁盘参数缓冲区大小日志刷新到磁盘时机日志每次事务提交时写入并刷新到磁盘每秒将日志写入并刷新到磁盘一次日志在每次事务提交后写入并每秒刷新到磁盘一次磁盘结构系统表空间时更改缓冲区的存储区域如果表时在系统表空间而不是每个表空间或通用表空间中创建的它也有可能包含表和索引数据参数每个表的文件表空间包含单个表的数据和索引并存储在文件系统上的单个数据文件中参数通用表空间需要通过语法创建通用表空间在创建表时可以指定该表空间创建指定撤销表空间实例在初始化时会自动创建两个默认的表空间初始大小用于存储使用会话临时表空间和全局临时表空间存储用户创建的临时表等数据双写缓冲区引擎将数据页从刷新到磁盘前先将数据页写入双写缓冲区文件中便于系统异常时恢复数据文件以结尾重做日志是用来实现事务的持久性该日志文件由两部分组成重做日志缓冲区和重做日志文件前者在内存中后者在磁盘中当事务提交之后会把所有修改信息都会存到该日志中用于在刷新脏页到磁盘时发生错误时进行数据恢复使用以循环方式写入重做日志文件默认有两个文件后台线程核心后台线程负责调度其他线程还负责将缓冲池中的数据异步刷新到磁盘中保持数据的一致性还包括脏页的刷新合并插入缓存页的回收在存储引擎中大量使用了来处理请求这样可以极大的提高数据库的性能而主要负责这些请求的回调线程类型默认个数说明负责读操作负责写操作负责将日志缓冲区刷新到磁盘负责将写缓冲区内存刷新到磁盘可以在存储引擎状态中查看线程的状态主要用于回收事务已经提交了的在事务提交之后可能不用了就用它来回收协助刷新脏页到磁盘的线程它可以减轻的工作压力减少阻塞事务原理重做日志记录的是事务提交时数据页的物理修改是用来实现事务的持久性该日志由两部分组成操作日志缓冲及重做日志文件前者在内存中后者在磁盘中当事务提交之后会把所有修改信息都存到该日志文件中用于在刷脏到磁盘出错后进行数据恢复用的回滚日志用于记录数据被修改前的信息作用包含两个提供回滚和多版本并发控制和记录物理日志不一样它是逻辑日志可以认为当一条记录时中会记录一条对应的记录当执行时就可以从中的逻辑记录读取到相应的内容并进行回滚销毁在事务执行时产生事务提交时并不会立即删除因为这些日志还可能应用于存储采用段方式进行管理和记录存放在回滚段中内部包含个当前读读取的是记录的最新版本读取时还要保证其他并发事务不能修改当前记录会对读取的记录进行加锁对于我们的日常操作如共享锁排它锁都是一种当前读快照读简单的不加锁就是一种快照读快照读读取的是记录数据的可见版本有可能是历史数据不加锁是非阻塞读每次都生成一个快照读开启事务后第一个语句才是快照读的地方快照读会退化为当前读全称多版本并发控制指维护一个数据的多个版本使的读写操作没有冲突快照读为实现提供了一个非阻塞读功能的具体实现还需要依赖于数据库中的三个隐藏字段日志依赖三个隐藏字段隐藏字段说明最近修改事务记录插入这条记录或最后一次修改该记录的事务回滚指针指向这条记录的上一个版本用于配合指向上一个版本隐藏主键当表结构没有指定主键时将会生成该隐藏字段回滚日志在的时候产生的便于数据回滚的日志当的时候产生的日志只在回滚时需要在事务提交后可被立即删除而在的时候产生的日志不仅在回滚时需要在快照读时也需要不会立即删除读视图是快照读执行时提取数据的重要依据记录并维护系统当前活跃的事务未提交的中包含了四个核心字段字段含义当前活跃的事务集合最小活跃事务预分配事务当前最大事务因为事务是自增的创建者的事务不同的隔离级别生成的时机不同在事务中每一次执行快照读时生成仅在事务中第一次执行快照读时生成后续复用该管理系统数据库数据库安装完成后自带了一下四个数据库数据库含义存储服务器正常运行所需要的各种信息时区主从用户权限等提供了访问数据库元数据的各种表和视图包含数据库表字段类型及访问权限为服务器运行时状态提供了一个底层监控功能主要用于收集数据库服务器性能参数包含了一系列方便和开发人员利用性能数据库进行性能调优和诊断的视图常用工具语法选项指定用户名指定密码指定服务器指定端口执行语句并退出是一个执行管理操作的客户端程序可以用来检查服务器的配置和当前状态创建并删除数据库等由于服务器生成的二进制日志文件以二进制格式保存所以如果想检查这些文本的文本格式就会使用日志管理工具语法选项指定数据库名称只列出指定数据库相关操作忽略日志中的前行将输出的文本格式日志输出到指定文件显示简单格式指定日期间隔内的所有日志指定位置间隔内的所有日志客户端对象查找工具用来很快的查找存在哪些数据库数据库中的表表中的列或索引语法选项显示数据库及表的统计信息库表都可以不指定显示指定数据库或者表的状态信息查询库中表的详细信息客户端工具用来本分数据库或在不同数据库之间进行数据迁移备份内容包括创建表插入表的语句语法不加选项只会导出数据库下面的所有表输出选项在每个数据库创建语句前加上语句在每个表创建语句前加上语句不包含数据库的创建语句不包含数据库的建表语句不包含数据自动生成两个文件一个文件创建表结构语句一个文件数据文件根据条件备份导出数据之后生成一个新的导出数据之前提交一个语句不会阻塞任何应用程序且能保证导出时数据库的一致性状态开始导出前锁定所有表将库中表备份到目录下使用日志错误日志错误日志是中最重要的日志之一它记录了当启动和停止时以及服务器在运行过程中发生任何严重错误时的相关信息当数据库出现任何故障导致无法正常使用时建议首先查看此日志该日志默认开启默认位置为查看位置二进制日志二进制日志记录了所有的数据定义语言语句和数据操纵语言语句但不包括语句作用灾难时的数据恢复的主从复制在中默认开启日志格式服务器中提供了多种格式来记录二进制日志格式含义基于语句的日志记录记录的是语句对数据进行修改的都会记录在日志文件中基于行的日志记录记录的是每一行的变更默认混合前两种格式默认采用在某些特殊情况下会自动切换为进行记录在格式下的日志文件中记录的是数据变更需要加参数将数据变更重构为语句日志删除对于业务比较繁忙的系统来说每天会产生大量的数据将会占用大量的磁盘空间所以需要删除不用的指令含义删除全部日志日志重新从开始编号删除编号之前的所有日志删除日志为之前产生的所有日志在中可以为设置过期时间过期之后会自动删除默认为天查询日志查询日志记录了客户端的所有操作语句而二进制日志不包含查询数据的语句默认情况下查询日志是没有开启的慢查询日志慢查询日志记录了所有执行时间超过设置值并且扫描数不小于的所有语句的日志默认未开启默认为秒最小为精度可以到微秒开启执行时间参数默认情况下不会记录管理语句也不会记录未使用索引进行查找的查询记录较慢的管理语句记录未使用索引的语句主从复制概述主从复制是指将主数据库的和操作通过二进制日志传到从库服务器中然后在从库上对这些日志重新执行重做从而使得从库和主库的数据保持同步支持一台主库同时向多台从库进行复制从库同时也可以作为其他从服务器的主库实现链状复制主从复制优点主库出现问题可以快速切换到从库提供服务实现读写分离减低主库的访问压力可以在从库执行备份以避免备份期间影响主库服务原理主库在提交事务时会把数据变更记录在二进制日志文件中从库读取主库的二进制日志文件写入到从库的中继日志需要权限重做中继日志中的时间将改变反映到它自己的数据主从搭建进入配置文件日志所在目录在同一个集群中不一样即可范围配置半同步插件配置只读指定不需要同步的数据库指定同步的数据库在主库给从库创建备份账户它允许从库连接到主库并获取二进制日志事件在配置时要先给上全局锁备份数据给使用查看执行情况配置之后将换成配置完成开启查看状态若不想设置就要给每个事务配一个唯一开启功能增强的一致性配置分库分表随着互联网及移动互联网的发展应用系统的数据量也是指数级增长若采用单数据库进行数据存储存在一下瓶颈瓶颈热点数据太多数据库缓存不足产生大量磁盘效率较低请求数据太多带宽不够网络瓶颈瓶颈排序分组连接查询聚合统计等会消耗大量的资源请求数太多出现瓶颈分库分表的中心思想都是将数据分散存储使得单一数据库表的数据量变小来缓解单一数据库的性能问题从而达到提升数据库性能的目的拆分策略垂直分库以表为依据根据业务将不同表拆分到不同库中每个库的表结构不一样每个库的数据也不一样所有库的并集是全量数据垂直分表以字段为依据根据字段属性将不同字段拆分到不同表中每个表结构不一样每个表数据不一样一般通过一列主键外键关联所有表的并集是全量数据水平分库以字段为依据按照一定策略将一个库的数据拆分到多个库中每个库的表结构一样每个库的数据不一样所有所有库的并集是全量数据水平分表以字段为依据按照一定策略将一个表的数据拆分到多个表中每个表的表结构一样每个表的数据不一样所有表的并集是全量数据是开源的活跃的基于语言编写的数据库中间件可以像使用一样来使用用户无感知默认端口下载地址目录结构存放可执行文件用于启动停止存放的配置文件存放的项目依赖包存放的日志文件分片配置用户配置配置作为中最重要的配置文件之一涵盖了的逻辑库逻辑表分片规则分片节点及数据源的配置标签标签用于定义实例中的逻辑库一个实例可以有多个逻辑库可以通过标签来划分不同的逻辑库中的逻辑库的概念等同与中的概念需要操作某个概念库下的表时也需要切换逻辑库指定自定义的逻辑库库名在语句操作时指定了数据库名称执行时是否自动去除自动去除不自动去除如果未指定进行查询列表查询模式查询多少条记录标签定义了逻辑库中的逻辑表所有需要拆分的表都需要再标签中定义定义逻辑表名在该逻辑库唯一定义逻辑表所属的该属性需要与标签中的对应对个逗号分隔分片规则的名字分片规则名字在中定义逻辑表对应真实表的主键逻辑表类型目前只有全局表和普通表如果未配置则为普通表全局表配置为标签标签中定义了中的数据节点也就是数据分片一个就是一个独立的数据分片定义数据节点名字数据库实例主机名称引用自标签中的属性定义分片所属数据库标签该标签在逻辑库中作为底层标签存在直接定义了具体的数据库实例读写分离心跳语句唯一标识供上层标签使用最大最小连接数负载均衡策略取值写操作分发方式写操作转发到第一个第一个挂了切换到第二个写操作随机分发到配置的数据库驱动支持中定义所有拆分表的规则在使用过程中可以灵活的使用分片算法或者对同一个分片算法使用不用参数它让分片过程可配置换主要包含两类标签配置文件包含了的系统配置信息主要有两个重要标签分片垂直分库在中进行多表联查的时候需要保证所有的表都在一个节点上所以最好将常用表设置为水平分表分片规则范围分片根据指定字段的范围进行分片和节点对应情况来分片取模分片根据指定的字段值与节点数量进行求模运算根据运算结果来决定该数据属于哪一个分片一致性分片所谓一致性哈希相同的哈希因子计算值总是被划分到相同的分区表中不会因为分区节点的增加而改变原来数据的分区位置枚举分片通过在配置文件中配置可能的枚举值指定数据分布到不同数据节点上本规则适用于按照省份性别状态拆分数据等业务应用指定分片运行阶段由应用自主决定路由到那个分片直接根据字符子串必须是数据计算分片号固定分片算法该算法类似于十进制的求模运算但是为二进制的操作例如去的二进制低位与进行为运算字符串解析截取字符串中的指定位置的子字符串进行计算算出分片进行为运算按天分片按月分片监控原理默认开放两个端口可以在中进行修改数据访问端口即进行和操作数据库管理端口即服务管理控制功能用于管理的整个集群状态监控可以通过或者进行监控表分区表分区是将一个表的数据按照一定的规则水平划分为不同的逻辑快并分别进行物理存储这个存在就叫做分区函数可以有不同的分区规则表分区修剪是优化的一种其核心就是只扫描需要的分区可以通过这个语句查看是否支持表分区移除了里对的显示但默认开启创建表分区可以认为指定使用的分区当表中含有主键或唯一键时则每个被用作分区函数的字段必须是表中唯一键和主键的全部或一部分否则就无法创建分区表表分区优势可以允许在一个表里存储更多的数据突破磁盘限制或文件系统限制一个表分区会具体化为一个文件对于从表里将过期或历史的数据移除是很容易的只需要将对应的分区移除即可对某些查询和修改语句来说可以自动将数据范围缩小到一个或几个表分区上优化语句执行效率而且可以通过指定表分区来执行语句表分区类型表分区类型分为表分区范围表分区按照一定的范围值来确定每个分区包含的数据表分区列表表分区按照一个个确定的值来确定每个分区包含的数据表分区哈希表分区按照一个自定义的函数返回值来确定每个分区包含的数据表分区表分区与哈希表分区类似只是用自己的函数来确定每个分区包含的数据查看表分区信息查看表分区有多少行数据可以用这条语句刷新上面的结果这条语句是用来分析表的索引分布情况使用这语句表被上读锁表分区分区函数使用的字段必须是整数类型分区的定义范围必须是连续的且不能有重叠部分通过使用来定义分区范围范围由小到大定义会把值放在最小的表分区表示未确定的上限表分区通过分区函数表达式必须返回整数取值范围通过定义必须要定义否则不能插入值多字段分区对和表分区来说分区函数可以包含多个字段分区多字段函数所涉及的字段类型可以包括范围多字段分区函数和普通的范围分区函数的区别在于字段类型多样化范围多字段分区函数不支持表达式只能用字段名范围多字段分区函数支持一个或多个字段每个里的字段和里的数值必须一一对应数据类型也要一致对范围多字段分区来说有时一行数据的分区列表的第一个元素等于的值列表的第一个元素会被插入到相应的分区对比的时候会这样对比对比逻辑是第一个相等就比较第二个表分区哈希表分区按照一个自定义的函数返回值来确定每一个分区包含的数据这个自定义函数也可以仅仅是一个字段名通过字句来定义哈希表分区其中的表达式必须返回一个整数基于分区的数量的取模运算根据余数插入到指定分区值会被放在分区对哈希表分区来说只需要定义分区的个数其余的事情内部完成分区表名为表分区与哈希表分区类似表分区依赖自身不写入值则使用主键可以使用非整数类型子表分区子表分区是在表分区的基础上再创建表分区的概念每个表分区下的子表分区个数必须一致子表分区必须是子表组合分区键必须一样子分区名也可以显示指定子分区名分区表操作删除表分区删除表分区也会把里面的数据删除删除表分区数据交换数据交换数据两表必须结构完全相同包括字段类型索引存储引擎交换时的数据必须在分区范围之内可以添加来跳过行验证当有子分区时只能交换子分区而不能交换整个分区增加表分区对于范围表分区来说增加必须在尾部否则会失败对于列表表分区来说要保证新增值没有出现过为了解决这个问题可以使用范围表分区表示把表分区拆分成和两个分区分区必须和一致也可以合并回来列表表分区要保持分区值一致且必须是相邻的分区如果分区值不一致有可能导致数据丢失哈希表分区和表分区这两类型不能删除表分区能合并表分区表示缩减的个数而不是缩减到的个数增加表分区读写分离读写分离简单的说就是把对数据库的读和写操作分开以对应不同的数据库服务器主数据库提供写操作从数据库提供读操作这样能有效的减轻单台数据库的压力控制后台数据的读写分离和负载均衡由文件标签的属性控制不开启读写分离机制所有读操作都发送到当前可用的上全部的与备用的都参数语句的负载均衡双主所有的读写操作都随机到上分发所有的读操作随机分发到对应的上执行不负担读压力写操作都转发到第一台挂了会切换到上所有的写操作都随机的发送到配置的上不自动切换自动切换',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-02-21 16:52:52',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.0.0"><link rel="alternate" href="/atom.xml" title="AYO" type="application/atom+xml">
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://git.yuki.love/" title="AYO网站"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="AYO网站"/><span class="back-menu-item-text">AYO网站</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://juejin.cn/user/3708003152300183" title="AYO博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="AYO博客"/><span class="back-menu-item-text">AYO博客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/AYO-Al" title="GitHub"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="GitHub"/><span class="back-menu-item-text">GitHub</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">AYO</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CDN/" style="font-size: 1.05rem;">CDN<sup>1</sup></a><a href="/tags/DNS/" style="font-size: 1.05rem;">DNS<sup>1</sup></a><a href="/tags/Database/" style="font-size: 1.05rem;">Database<sup>8</sup></a><a href="/tags/Docker/" style="font-size: 1.05rem;">Docker<sup>1</sup></a><a href="/tags/ELK/" style="font-size: 1.05rem;">ELK<sup>1</sup></a><a href="/tags/Flask/" style="font-size: 1.05rem;">Flask<sup>1</sup></a><a href="/tags/Httpd/" style="font-size: 1.05rem;">Httpd<sup>1</sup></a><a href="/tags/JavaScript/" style="font-size: 1.05rem;">JavaScript<sup>1</sup></a><a href="/tags/Keepalived/" style="font-size: 1.05rem;">Keepalived<sup>1</sup></a><a href="/tags/LVS/" style="font-size: 1.05rem;">LVS<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 1.05rem;">Linux<sup>22</sup></a><a href="/tags/MLinux/" style="font-size: 1.05rem;">MLinux<sup>1</sup></a><a href="/tags/MySQL/" style="font-size: 1.05rem;">MySQL<sup>6</sup></a><a href="/tags/Nginx/" style="font-size: 1.05rem;">Nginx<sup>3</sup></a><a href="/tags/Prometheus/" style="font-size: 1.05rem;">Prometheus<sup>1</sup></a><a href="/tags/Python/" style="font-size: 1.05rem;">Python<sup>8</sup></a><a href="/tags/Rabbit/" style="font-size: 1.05rem;">Rabbit<sup>1</sup></a><a href="/tags/Redis/" style="font-size: 1.05rem;">Redis<sup>2</sup></a><a href="/tags/Shell/" style="font-size: 1.05rem;">Shell<sup>3</sup></a><a href="/tags/Web/" style="font-size: 1.05rem;">Web<sup>2</sup></a><a href="/tags/Zabbix/" style="font-size: 1.05rem;">Zabbix<sup>2</sup></a><a href="/tags/%E4%B8%89%E9%AB%98MySQL/" style="font-size: 1.05rem;">三高MySQL<sup>1</sup></a><a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 1.05rem;">中间件<sup>1</sup></a><a href="/tags/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" style="font-size: 1.05rem;">主从复制<sup>1</sup></a><a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" style="font-size: 1.05rem;">云计算<sup>7</sup></a><a href="/tags/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" style="font-size: 1.05rem;">反向代理<sup>1</sup></a><a href="/tags/%E5%9B%9B%E5%A4%A7%E4%BB%B6/" style="font-size: 1.05rem;">四大件<sup>2</sup></a><a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 1.05rem;">开发<sup>7</sup></a><a href="/tags/%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB%E6%9C%8D%E5%8A%A1/" style="font-size: 1.05rem;">文件共享服务<sup>1</sup></a><a href="/tags/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" style="font-size: 1.05rem;">文件系统<sup>1</sup></a><a href="/tags/%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/" style="font-size: 1.05rem;">日志管理<sup>1</sup></a><a href="/tags/%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5/" style="font-size: 1.05rem;">时间同步<sup>1</sup></a><a href="/tags/%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/" style="font-size: 1.05rem;">服务管理<sup>1</sup></a><a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 1.05rem;">爬虫<sup>4</sup></a><a href="/tags/%E7%9B%91%E6%8E%A7/" style="font-size: 1.05rem;">监控<sup>3</sup></a><a href="/tags/%E7%A3%81%E7%9B%98/" style="font-size: 1.05rem;">磁盘<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 1.05rem;">网络<sup>3</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E6%9E%B6%E6%9E%84/" style="font-size: 1.05rem;">网络架构<sup>1</sup></a><a href="/tags/%E8%BD%AF%E4%BB%B6%E7%AE%A1%E7%90%86/" style="font-size: 1.05rem;">软件管理<sup>1</sup></a><a href="/tags/%E9%98%B2%E7%81%AB%E5%A2%99/" style="font-size: 1.05rem;">防火墙<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">三月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">十一月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/10/"><span class="card-archive-list-date">十月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/09/"><span class="card-archive-list-date">九月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/Database/" itemprop="url">Database</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/MySQL/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>MySQL</span></a><a class="article-meta__tags" href="/tags/Database/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Database</span></a></span></div></div><h1 class="post-title" itemprop="name headline">MySQL</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-01-16T16:00:00.000Z" title="发表于 2023-01-17 00:00:00">2023-01-17</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-02-21T08:52:52.441Z" title="更新于 2024-02-21 16:52:52">2024-02-21</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">29.7k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>106分钟</span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为长沙"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>长沙</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://pic2.zhimg.com/v2-264805954c1f033af43e006cb826ab60_r.jpg?source=1940ef5c&amp;_r_=33d9c07f-6b23-dcfb-775e-2f0bcbf6c0b0"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://www.yuki.love/2023/01/17/MarkDown/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL8.0/"><header><a class="post-meta-categories" href="/categories/Database/" itemprop="url">Database</a><a href="/tags/MySQL/" tabindex="-1" itemprop="url">MySQL</a><a href="/tags/Database/" tabindex="-1" itemprop="url">Database</a><h1 id="CrawlerTitle" itemprop="name headline">MySQL</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">AYO</span><time itemprop="dateCreated datePublished" datetime="2023-01-16T16:00:00.000Z" title="发表于 2023-01-17 00:00:00">2023-01-17</time><time itemprop="dateCreated datePublished" datetime="2024-02-21T08:52:52.441Z" title="更新于 2024-02-21 16:52:52">2024-02-21</time></header><h1 id="1-数据库介绍"><a href="#1-数据库介绍" class="headerlink" title="1.数据库介绍"></a>1.数据库介绍</h1><ul>
<li>数据+库：将信息(数据)按照计算机可识别的方式规则存放在磁盘库中，并提供一系列可供读写的方式</li>
<li>相比较于磁盘文件，数据库最大的特点是提供了非常灵活的接口、可以获取完整数据或则特定部分数据的方式；并提供了一套完整管理数据的方法(存储结构，备份恢复等)</li>
<li>为什么要存储数据？<ul>
<li>数据要被随时随地的反复使用，不是一次性消耗品</li>
<li>数据要被记录，防止遗忘</li>
</ul>
</li>
</ul>
<h2 id="1-数据库类型"><a href="#1-数据库类型" class="headerlink" title="1.数据库类型"></a>1.数据库类型</h2><ul>
<li>关系型数据库<ul>
<li>目前市场上占主要份额的数据库类型，以二维表格(行和列)来存储数据，表格和表格之间的数据关系用字段引用来表示</li>
</ul>
</li>
<li>非关系型数据库<ul>
<li>出现时间较短，抛弃关系型死板的数据存储方式，提供了更加灵活的方式</li>
<li>面向高性能并发读写的key-value数据库<ul>
<li>key-value数据库的主要特点即使具有极高的并发读写性能，Redis就是这类代表</li>
</ul>
</li>
<li>面向海量数据访问的文档型数据库<ul>
<li>可以在海量的数据中快速的查询数据，以MongoDB为代表</li>
</ul>
</li>
<li>面向可扩展性的分布式数据库<ul>
<li>这类数据库想解决的问题就是传统数据库存在可扩展性上的缺陷，以Cassandra为代表</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="2-MySQL数据库介绍"><a href="#2-MySQL数据库介绍" class="headerlink" title="2.MySQL数据库介绍"></a>2.MySQL数据库介绍</h2><ul>
<li>MySQL是一种开发源代码的关系型数据库管理系统(RDBMS)</li>
<li>MySQL数据库系统使用常用的数据库管理语言—<strong>结构化查询语言</strong>(SQL)进行数据库管理</li>
<li>体积小、速度快、总体拥有成本低，尤其是开发源码这一特点，使得许多企业选择了MySQL作为数据库</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/quh1qn-0.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/r4fo8l-0.png" alt="image-20230909164002223"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/r8sdo9-0.png" alt="image-20230909164733870"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/r9ebjs-0.png" alt="image-20230909164836859"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/r9ik72-0.png" alt="image-20230909164855302"></p>
<h2 id="3-数据库工程师职责"><a href="#3-数据库工程师职责" class="headerlink" title="3.数据库工程师职责"></a>3.数据库工程师职责</h2><ul>
<li>数据库开发工程师<ul>
<li>负责公司业务数据库系统的模型设计，表结构设计</li>
<li>负责数据处理中的语句实现，存储过程逻辑实现</li>
<li>负责指导开发人员对语句的性能优化和指导</li>
</ul>
</li>
<li>数据库管理员(DBA)<ul>
<li>负责公司业务数据库系统的部署实现</li>
<li>负责数据库系统的高可用性，备份恢复，性能调优，监控等实现</li>
</ul>
</li>
<li>数据库架构师<ul>
<li>统筹公司业务数据库系统各个层面的技术实现</li>
<li>指导数据库开发工程师和管理员在各个环节的工作，提供更优的方案</li>
</ul>
</li>
</ul>
<h2 id="4-MySQL下载"><a href="#4-MySQL下载" class="headerlink" title="4.MySQL下载"></a>4.MySQL下载</h2><ul>
<li><p>下载地址：<a target="_blank" rel="noopener" href="https://dev.mysql.com/downloads/">MySQL</a></p>
</li>
<li><p>下载正确的tar包</p>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/p6b5er-0.png" alt="image-20230916152216598"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/p7ect1-0.png" alt="image-20230916152406623"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/rdzr7e-0.png" alt="image-20230916165607372"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/pjyykp-0.png" alt="image-20230916154518607"></p>
<ul>
<li><p>在成功登录mysql之后，需要修改初始密码，否则不能执行命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">alter user user() identified <span class="string">&#x27;passwd&#x27;</span> <span class="comment"># user()：内置函数，返回当前用户</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="5-如何在一台机器上启多个MySQL服务呢？"><a href="#5-如何在一台机器上启多个MySQL服务呢？" class="headerlink" title="5.如何在一台机器上启多个MySQL服务呢？"></a>5.如何在一台机器上启多个MySQL服务呢？</h2><ul>
<li><p>修改配置文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">basedir=/data/mysql</span><br><span class="line">datadir=/data/mysql/data</span><br><span class="line">port=3307    <span class="comment"># 修改端口</span></span><br><span class="line">socket=/tmp/mtsql.sock <span class="comment"># 修改socket文件</span></span><br><span class="line">mysqlx_port=33060   <span class="comment"># 修改mysqlx端口</span></span><br><span class="line">mysqlx_socket=/tmp/mysqlx.sock <span class="comment"># 修改mysqlx socket</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>启动时指定配置文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bin/mysqld --defaults-file=/etc/my3307.cnf --user=mysql</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="6-MySQL相关启动参数"><a href="#6-MySQL相关启动参数" class="headerlink" title="6.MySQL相关启动参数"></a>6.MySQL相关启动参数</h2><ul>
<li>basedir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql：MySQL安装路径</li>
<li>datadir&#x3D;&#x2F;data：数据文件路径</li>
<li>port&#x3D;3306：端口</li>
<li>log-error&#x3D;&#x2F;tmp&#x2F;mysql.error：启动和错误日志</li>
<li>bind-address(默认是*)：监听的IP地址</li>
<li>character-set-server(默认是latin1)：指定字符集</li>
<li>collation-server(latin1_swedish_ci)：指定排序规则</li>
<li>default-storage-engine(InnoDB)：指定默认存储引擎</li>
<li>default-time-zone：指定默认时区</li>
<li>open-files-limit(5000)：指定Mysqld运行过程中可以打开的文件数</li>
<li>pid-file：指定mysqld进程对应的程序ID文件，默认在数据文件目录里</li>
<li>skip-grant-tables：指定避开MySQL内部的权限表启动服务</li>
<li>tmpdir：指定临时表文件的存放路径</li>
</ul>
<h1 id="2-MySQL基础命令"><a href="#2-MySQL基础命令" class="headerlink" title="2.MySQL基础命令"></a>2.MySQL基础命令</h1><h2 id="1-MySQL权限认证"><a href="#1-MySQL权限认证" class="headerlink" title="1.MySQL权限认证"></a>1.MySQL权限认证</h2><ul>
<li>权限系统的作用是授予来自<strong>某个主机</strong>的<strong>某个用户</strong>可以查询、插入、修改、删除等数据库操作的权限</li>
<li>不能明确的指定拒绝某个用户的连接</li>
<li>权限控制的执行语句包括create user，grant，revoke</li>
<li>授权后的权限都存放在MySQL的内部数据库中(mysql库)，并在数据库启动之后把权限信息<strong>复制到内存</strong>中</li>
<li>MySQL用户的认证信息包括用户名和主机（以下不是同一个用户）<ul>
<li>SHOW GRANTS FOR ‘JOKE‘@’<a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a>‘</li>
<li>SHOW GRANTS FOR ‘JOKE‘@’<a target="_blank" rel="noopener" href="http://www.baidu.cn/">www.baidu.cn</a>‘</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/peidmw-0.png" alt="image-20230926153553973"></p>
<ul>
<li><p>使用<code>show privileges;</code>可以查看能赋予的权限</p>
</li>
<li><p>创建用户</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create user user@host identified by &#x27;pass&#x27;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>赋予权限</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">grant all on *.* to user@host with grant option;</span><br><span class="line"># all表示所有权限，可以指定具体权限，可以使用&#x27;show privileges;&#x27;查看</span><br><span class="line"># *.*第一个*表示那个库，第二个*表示那个表，可以指定具体的库表</span><br><span class="line"># with grant option表示该用户可以赋予别人相同的权限</span><br><span class="line"># grant select(id) on mysql.user to user@host;可以指定查那个字段的权限</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除权限</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">revoke all on *.* from user@host;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="1-权限详解"><a href="#1-权限详解" class="headerlink" title="1.权限详解"></a>1.权限详解</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/r7euzj-0.png" alt="image-20230926164501008"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/r7ouia-0.png" alt="image-20230926164548981"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/r83onp-0.png" alt="image-20230926164617774"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/r8n6tj-0.png" alt="image-20230926164708856"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/r8un3i-0.png" alt="image-20230926164743959"></p>
<h2 id="2-设置MySQL用户的密码"><a href="#2-设置MySQL用户的密码" class="headerlink" title="2.设置MySQL用户的密码"></a>2.设置MySQL用户的密码</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231209153601213.png" alt="image-20231209153601213"></p>
<p><strong>请注意：在MySQL8.0之后不支持用<code>grant</code>命令修改密码</strong></p>
<ul>
<li>创建用户时设置密码</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># with指定用户身份验证方法</span></span><br><span class="line">create user <span class="string">&#x27;user&#x27;</span>@<span class="string">&#x27;host&#x27;</span> identified WITH <span class="string">&#x27;mysql_native_password&#x27;</span> by <span class="string">&#x27;passwd&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>创建用户后设置密码</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">alter user <span class="string">&#x27;user&#x27;</span>@<span class="string">&#x27;host&#x27;</span> identified  WITH <span class="string">&#x27;mysql_native_password&#x27;</span> by <span class="string">&#x27;passwd&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>mysql查看身份验证方法</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; select user,host,plugin from mysql.user where user=&#x27;root&#x27;;</span><br></pre></td></tr></table></figure>

<ul>
<li>身份验证方法</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql_native_password：</span><br><span class="line">这是MySQL的传统身份验证方法。</span><br><span class="line">密码以散列形式存储在MySQL的mysql.user表中。</span><br><span class="line">大多数MySQL用户在使用此方法。</span><br><span class="line"></span><br><span class="line">caching_sha2_password：</span><br><span class="line">这是MySQL 8.0版本引入的一种新的身份验证方法。</span><br><span class="line">密码以散列形式存储在mysql.user表中，使用SHA-256算法。</span><br><span class="line">支持更强大的安全性，适用于新的安全标准。</span><br><span class="line"></span><br><span class="line">sha256_password：</span><br><span class="line">与caching_sha2_password 类似，是MySQL 5.6.6版本引入的。</span><br><span class="line">使用SHA-256算法存储密码散列。</span><br><span class="line"></span><br><span class="line">authentication_windows_client：</span><br><span class="line">用于Windows平台，使用Windows客户端进行身份验证。</span><br><span class="line">用户的身份验证依赖于Windows用户凭据。</span><br><span class="line"></span><br><span class="line">authentication_ldap_simple 和 authentication_ldap_sasl：</span><br><span class="line">这两种方法允许MySQL连接到LDAP服务器进行身份验证。</span><br><span class="line">authentication_ldap_simple 使用简单的LDAP身份验证，而 authentication_ldap_sasl 使用SASL身份验证。</span><br></pre></td></tr></table></figure>

<ul>
<li>查看密码规则</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 在mysql中使用validate插件管理密码策略 </span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> &quot;validate%&quot;;</span><br><span class="line"></span><br><span class="line"># 这个参数定义了在密码更改时，新密码与旧密码相比必须有多少百分比的字符变化。在这里，设置为 <span class="number">0</span> 表示新密码必须与旧密码完全不同</span><br><span class="line">validate_password.changed_characters_percentage,<span class="number">0</span></span><br><span class="line"># 如果设置为 OFF，则禁用了检查密码是否包含与用户名相同的字符或序列的功能。</span><br><span class="line">validate_password.check_user_name,OFF</span><br><span class="line"># 这个参数定义了密码验证时要使用的字典文件的路径。在这里，设置为空字符串表示不使用字典文件。</span><br><span class="line">validate_password.dictionary_file,&quot;&quot;</span><br><span class="line"># 这个参数定义了密码长度，<span class="number">0</span>表示可以为空</span><br><span class="line">validate_password.length,<span class="number">0</span></span><br><span class="line"># 定义了密码中必须包含的大写和小写字符的最小数量。在这里，设置为 <span class="number">0</span> 表示密码可以不包含混合大小写字符</span><br><span class="line">validate_password.mixed_case_count,<span class="number">0</span></span><br><span class="line"># 定义了密码中必须包含的数字的最小数量。在这里，设置为 <span class="number">0</span> 表示密码可以不包含数字</span><br><span class="line">validate_password.number_count,<span class="number">0</span></span><br><span class="line"># 定义了密码强度策略的级别，可选值包括 LOW、MEDIUM 和 STRONG。在这里，设置为 LOW 表示使用较低的密码策略</span><br><span class="line">validate_password.policy,LOW</span><br><span class="line"># 定义了密码中必须包含的特殊字符的最小数量。在这里，设置为 <span class="number">0</span> 表示密码可以不包含特殊字符。</span><br><span class="line">validate_password.special_char_count,<span class="number">0</span></span><br></pre></td></tr></table></figure>

<h2 id="3-设置MySQL用户密码过期策略"><a href="#3-设置MySQL用户密码过期策略" class="headerlink" title="3.设置MySQL用户密码过期策略"></a>3.设置MySQL用户密码过期策略</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231209154520773.png" alt="image-20231209154520773"></p>
<h1 id="3-SQL"><a href="#3-SQL" class="headerlink" title="3.SQL"></a>3.SQL</h1><h2 id="1-SQL"><a href="#1-SQL" class="headerlink" title="1.SQL"></a>1.SQL</h2><ul>
<li><p>SQL通用语法</p>
<ul>
<li><p>SQL语句可以单行或多行书写，以分号结尾</p>
</li>
<li><p>SQL语句可以使用空格&#x2F;缩进来增强语句的可读性</p>
</li>
<li><p>MySQL数据库的SQL语句不区分大小写，关键字建议使用大写</p>
</li>
<li><p>注释：</p>
<ul>
<li>单行注释：– 注释内容或#注释内容</li>
<li>多行注释：&#x2F;* 注释内容 *&#x2F;</li>
</ul>
</li>
<li><p>SQL分类</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>分类</th>
<th>全称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>DDL</td>
<td>Data Definition Language</td>
<td>数据库定义语言，用来定义数据库对象(数据库，表，字段)</td>
</tr>
<tr>
<td>DML</td>
<td>Data Manipulation Language</td>
<td>数据库操作语言，用来对数据库表中的数据进行增删改</td>
</tr>
<tr>
<td>DQL</td>
<td>Data Query Language</td>
<td>DML的子集，数据库查询语言，用来查询数据库中表的记录</td>
</tr>
<tr>
<td>DCL</td>
<td>Data Control Language</td>
<td>数据库控制语言，用来创建数据库用户，控制数据库的访问权限</td>
</tr>
</tbody></table>
</li>
</ul>
<h2 id="2-数据类型"><a href="#2-数据类型" class="headerlink" title="2.数据类型"></a>2.数据类型</h2><p>MySQL中的数据类型有很多，主要分为三个类：数值类型、字符串类型、日期时间类型</p>
<ul>
<li>数值类型</li>
</ul>
<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">大小</th>
<th align="left">有符号范围（SIGNED）</th>
<th align="left">无符号范围（UNSIGNED）</th>
<th align="left">用途</th>
</tr>
</thead>
<tbody><tr>
<td align="left">TINYINT</td>
<td align="left">1 Bytes</td>
<td align="left">(-128，127)</td>
<td align="left">(0，255)</td>
<td align="left">小整数值</td>
</tr>
<tr>
<td align="left">SMALLINT</td>
<td align="left">2 Bytes</td>
<td align="left">(-32 768，32 767)</td>
<td align="left">(0，65 535)</td>
<td align="left">大整数值</td>
</tr>
<tr>
<td align="left">MEDIUMINT</td>
<td align="left">3 Bytes</td>
<td align="left">(-8 388 608，8 388 607)</td>
<td align="left">(0，16 777 215)</td>
<td align="left">大整数值</td>
</tr>
<tr>
<td align="left">INT或INTEGER</td>
<td align="left">4 Bytes</td>
<td align="left">(-2 147 483 648，2 147 483 647)</td>
<td align="left">(0，4 294 967 295)</td>
<td align="left">大整数值</td>
</tr>
<tr>
<td align="left">BIGINT</td>
<td align="left">8 Bytes</td>
<td align="left">(-9,223,372,036,854,775,808，9 223 372 036 854 775 807)</td>
<td align="left">(0，18 446 744 073 709 551 615)</td>
<td align="left">极大整数值</td>
</tr>
<tr>
<td align="left">FLOAT</td>
<td align="left">4 Bytes</td>
<td align="left">(-3.402 823 466 E+38，-1.175 494 351 E-38)，0，(1.175 494 351 E-38，3.402 823 466 351 E+38)</td>
<td align="left">0，(1.175 494 351 E-38，3.402 823 466 E+38)</td>
<td align="left">单精度 浮点数值</td>
</tr>
<tr>
<td align="left">DOUBLE</td>
<td align="left">8 Bytes</td>
<td align="left">(-1.797 693 134 862 315 7 E+308，-2.225 073 858 507 201 4 E-308)，0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308)</td>
<td align="left">0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308)</td>
<td align="left">双精度 浮点数值</td>
</tr>
<tr>
<td align="left">DECIMAL</td>
<td align="left">对DECIMAL(M,D) ，如果M&gt;D，为M+2否则为D+2</td>
<td align="left">依赖于M和D的值</td>
<td align="left">依赖于M和D的值</td>
<td align="left">小数值</td>
</tr>
</tbody></table>
<p>**如果想使用无符号数值类型，可以使用<code>int UNSIGNED </code>**指定</p>
<ul>
<li>字符串类型</li>
</ul>
<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">大小</th>
<th align="left">用途</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CHAR</td>
<td align="left">0-255 bytes</td>
<td align="left">定长字符串</td>
</tr>
<tr>
<td align="left">VARCHAR</td>
<td align="left">0-65535 bytes</td>
<td align="left">变长字符串</td>
</tr>
<tr>
<td align="left">TINYBLOB</td>
<td align="left">0-255 bytes</td>
<td align="left">不超过 255 个字符的二进制字符串</td>
</tr>
<tr>
<td align="left">TINYTEXT</td>
<td align="left">0-255 bytes</td>
<td align="left">短文本字符串</td>
</tr>
<tr>
<td align="left">BLOB</td>
<td align="left">0-65 535 bytes</td>
<td align="left">二进制形式的长文本数据</td>
</tr>
<tr>
<td align="left">TEXT</td>
<td align="left">0-65 535 bytes</td>
<td align="left">长文本数据</td>
</tr>
<tr>
<td align="left">MEDIUMBLOB</td>
<td align="left">0-16 777 215 bytes</td>
<td align="left">二进制形式的中等长度文本数据</td>
</tr>
<tr>
<td align="left">MEDIUMTEXT</td>
<td align="left">0-16 777 215 bytes</td>
<td align="left">中等长度文本数据</td>
</tr>
<tr>
<td align="left">LONGBLOB</td>
<td align="left">0-4 294 967 295 bytes</td>
<td align="left">二进制形式的极大文本数据</td>
</tr>
<tr>
<td align="left">LONGTEXT</td>
<td align="left">0-4 294 967 295 bytes</td>
<td align="left">极大文本数据</td>
</tr>
</tbody></table>
<ul>
<li>日期时间类型</li>
</ul>
<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">大小 ( bytes)</th>
<th align="left">范围</th>
<th align="left">格式</th>
<th align="left">用途</th>
</tr>
</thead>
<tbody><tr>
<td align="left">DATE</td>
<td align="left">3</td>
<td align="left">1000-01-01&#x2F;9999-12-31</td>
<td align="left">YYYY-MM-DD</td>
<td align="left">日期值</td>
</tr>
<tr>
<td align="left">TIME</td>
<td align="left">3</td>
<td align="left">‘-838:59:59’&#x2F;‘838:59:59’</td>
<td align="left">HH:MM:SS</td>
<td align="left">时间值或持续时间</td>
</tr>
<tr>
<td align="left">YEAR</td>
<td align="left">1</td>
<td align="left">1901&#x2F;2155</td>
<td align="left">YYYY</td>
<td align="left">年份值</td>
</tr>
<tr>
<td align="left">DATETIME</td>
<td align="left">8</td>
<td align="left">‘1000-01-01 00:00:00’ 到 ‘9999-12-31 23:59:59’</td>
<td align="left">YYYY-MM-DD hh:mm:ss</td>
<td align="left">混合日期和时间值。精确到毫秒。<strong>不带时区信息</strong></td>
</tr>
<tr>
<td align="left">TIMESTAMP</td>
<td align="left">4</td>
<td align="left">‘1970-01-01 00:00:01’ UTC 到 ‘2038-01-19 03:14:07’ UTC结束时间是第 <strong>2147483647</strong> 秒，北京时间 <strong>2038-1-19 11:14:07</strong>，格林尼治时间 2038年1月19日 凌晨 03:14:07</td>
<td align="left">YYYY-MM-DD hh:mm:ss</td>
<td align="left">混合日期和时间值，时间戳。精确到秒。<strong>带有时区信息</strong></td>
</tr>
</tbody></table>
<ul>
<li><p>枚举与集合类型（Enumeration and Set Types）</p>
<ul>
<li><strong>ENUM</strong>: 枚举类型，用于存储单一值，可以选择一个预定义的集合。<code>ENUM</code> 列的存储效率通常较高，因为它只需要存储一个值，而且内部表示是整数</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> example (</span><br><span class="line">    blood_type ENUM(<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;AB&#x27;</span>, <span class="string">&#x27;O&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>SET</strong>: 集合类型，用于存储多个值，可以选择多个预定义的集合。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> example (</span><br><span class="line">    interests <span class="keyword">SET</span>(<span class="string">&#x27;Reading&#x27;</span>, <span class="string">&#x27;Traveling&#x27;</span>, <span class="string">&#x27;Sports&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="3-DDL语句"><a href="#3-DDL语句" class="headerlink" title="3.DDL语句"></a>3.DDL语句</h2><p><strong>DDL全称Data Definition Language，数据库定义语言，用来定义数据库对象(数据库，表，字段)</strong></p>
<ul>
<li>查询</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 查询所有数据库<span class="operator">/</span>表</span><br><span class="line"><span class="keyword">SHOW</span> DATABASES<span class="operator">/</span>TABLES;</span><br><span class="line"></span><br><span class="line"># 查询当前数据库</span><br><span class="line"><span class="keyword">SELECT</span> DATABASE();</span><br><span class="line"></span><br><span class="line"># 查询表结构</span><br><span class="line"><span class="keyword">DESC</span> 表名;</span><br><span class="line"></span><br><span class="line"># 查询指定表的建表语句</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名</span><br></pre></td></tr></table></figure>

<ul>
<li>创建</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 创建数据库，可以指定字符集和排序规则</span></span><br><span class="line">CREATE DATABASE [IF NOT EXISTS] database_name [CHARACTER SET charset_name] [COLLATE collation_name];</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建表</span></span><br><span class="line">CREATE TABLE IF NOT EXISTS `runoob_tbl`(</span><br><span class="line">   `runoob_id` INT UNSIGNED AUTO_INCREMENT,</span><br><span class="line">   `runoob_title` VARCHAR(100) NOT NULL,</span><br><span class="line">   `runoob_author` VARCHAR(40) NOT NULL,</span><br><span class="line">   `submission_date` DATE,</span><br><span class="line">   PRIMARY KEY ( `runoob_id` )</span><br><span class="line">)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE utf8mb4_general_ci;</span><br></pre></td></tr></table></figure>

<ul>
<li>修改</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 添加字段</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">ADD</span> 字段名 类型(长度) [COMMANT 注释][约束];</span><br><span class="line"></span><br><span class="line"># 修改数据类型</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 MODIFY 字段名 新类型(长度);</span><br><span class="line"></span><br><span class="line"># 修改字段</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 CHANGE 旧字段名 新字段名 类型(长度) [COMMANT 注释][约束];</span><br><span class="line"></span><br><span class="line"># 删除字段</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">DROP</span> 字段名;</span><br><span class="line"></span><br><span class="line"># 修改表名</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 RENAME <span class="keyword">TO</span> 新表名;</span><br></pre></td></tr></table></figure>

<ul>
<li>删除</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 删除数据库</span><br><span class="line"><span class="keyword">DROP</span> DATABASE [IF <span class="keyword">EXISTS</span>] 数据库名;</span><br><span class="line"></span><br><span class="line"># 删除表</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> [IF <span class="keyword">EXISTS</span>] 表名;</span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> 表名</span><br></pre></td></tr></table></figure>

<ul>
<li>切换数据库</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">USE 数据库名</span><br></pre></td></tr></table></figure>

<h2 id="4-DML语句"><a href="#4-DML语句" class="headerlink" title="4.DML语句"></a>4.DML语句</h2><p><strong>DML全称Data Manipulation Language ， 数据库操作语言，用来对数据库表中的数据进行增删改</strong></p>
<ul>
<li>添加数据</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 值和字段的顺序一一对应</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表名(字段<span class="number">1</span>,字段<span class="number">2.</span>..) <span class="keyword">VALUES</span>(值<span class="number">1.</span>值<span class="number">2.</span>..);</span><br><span class="line"></span><br><span class="line"># 如果对整个字段进行插入，可以省略字段</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表名 <span class="keyword">VALUES</span>(值<span class="number">1.</span>值<span class="number">2.</span>..);</span><br><span class="line"></span><br><span class="line"># 也可以插入多条记录</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表名 <span class="keyword">VALUES</span>(值<span class="number">1.</span>值<span class="number">2.</span>..),(值<span class="number">1.</span>值<span class="number">2.</span>..)...;</span><br></pre></td></tr></table></figure>

<ul>
<li>修改数据</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> 表名 <span class="keyword">set</span> 字段<span class="operator">=</span>值<span class="number">1</span>,字段<span class="operator">=</span>值<span class="number">2.</span>.. [<span class="keyword">where</span> 字段<span class="operator">=</span>值]</span><br><span class="line"># 如果不用<span class="keyword">where</span>做限制，会修改所有行</span><br></pre></td></tr></table></figure>

<ul>
<li>删除数据</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">delete from 表名 [where 字段=值]</span><br></pre></td></tr></table></figure>

<p><code>truncate</code>和<code>delete</code>都可以删除数据，它们的区别在哪呢？</p>
<ul>
<li><code>TRUNCATE</code> 用于删除表中的所有数据，但保留表的结构，不删除表本身</li>
<li><code>TRUNCATE</code> 是一个DDL语句（数据定义语言），它比 <code>DELETE</code> 更快，因为它不是逐行删除数据，而是直接释放表所占用的数据页</li>
<li><code>DELETE</code> 用于从表中删除特定的行，也可以删除所有行</li>
<li><code>DELETE</code> 是一个DML语句（数据操作语言），它逐行删除数据，可能比 <code>TRUNCATE</code> 慢，尤其是在删除大量数据时</li>
<li><code>truncate</code>释放所占用的空间，不可恢复；<code>delete</code>不释放表所占用空间，可以使用事务进行回滚</li>
</ul>
<h2 id="5-DQL语句"><a href="#5-DQL语句" class="headerlink" title="5.DQL语句"></a>5.DQL语句</h2><p><strong>DQL全称Data Query Language，DML的子集，数据库查询语言，用来查询数据库中表的记录</strong></p>
<ul>
<li>DQL语法</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	字段列表</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	表名</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	条件列表</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">	分组字段列表</span><br><span class="line"><span class="keyword">HAVING</span></span><br><span class="line">	分组后条件列表</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">	排序字段列表</span><br><span class="line">LIMIT</span><br><span class="line">	分页参数</span><br></pre></td></tr></table></figure>

<h3 id="1-基本查询"><a href="#1-基本查询" class="headerlink" title="1.基本查询"></a>1.基本查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 查询多个字段</span><br><span class="line"><span class="keyword">SELECT</span> 字段<span class="number">1</span>,字段<span class="number">2</span>,字段<span class="number">3.</span>.. <span class="keyword">FROM</span> 表名;</span><br><span class="line"></span><br><span class="line"># 查询所有字段</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> 表名;</span><br><span class="line"></span><br><span class="line"># 也可以给查询字段设置别名</span><br><span class="line"><span class="keyword">SELECT</span> 字段<span class="number">1</span> [<span class="keyword">AS</span> 别名<span class="number">1</span>]... <span class="keyword">FROM</span> 表名;</span><br><span class="line"></span><br><span class="line"># 也可以去除重复记录</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> 字段列表 <span class="keyword">FROM</span> 表名;</span><br></pre></td></tr></table></figure>

<h3 id="2-条件查询"><a href="#2-条件查询" class="headerlink" title="2.条件查询"></a>2.条件查询</h3><ul>
<li>语法</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 字段列表 <span class="keyword">FROM</span> 表名 <span class="keyword">WHERE</span> 条件列表;</span><br></pre></td></tr></table></figure>

<ul>
<li>条件运算符</li>
</ul>
<table>
<thead>
<tr>
<th>运算符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>&gt;</td>
<td>大于</td>
</tr>
<tr>
<td>&gt;&#x3D;</td>
<td>大于等于</td>
</tr>
<tr>
<td>&lt;</td>
<td>小于</td>
</tr>
<tr>
<td>&lt;&#x3D;</td>
<td>小于等于</td>
</tr>
<tr>
<td>&#x3D;</td>
<td>等于</td>
</tr>
<tr>
<td>&lt;&gt;或!&#x3D;</td>
<td>不等于</td>
</tr>
<tr>
<td>BETWEEN…AND…</td>
<td>在某个范围之内(含边界值)</td>
</tr>
<tr>
<td>IN(…)</td>
<td>包含在in之后的列表</td>
</tr>
<tr>
<td>LIKE 占位符</td>
<td>模糊匹配(_匹配一个字符,%匹配任意字符)</td>
</tr>
<tr>
<td>IS NULL</td>
<td>是NULL</td>
</tr>
<tr>
<td>IS NOT NULL</td>
<td>不是NULL</td>
</tr>
<tr>
<td>AND或&amp;&amp;</td>
<td>与</td>
</tr>
<tr>
<td>OR或||</td>
<td>或</td>
</tr>
<tr>
<td>NOT或!</td>
<td>非</td>
</tr>
</tbody></table>
<h3 id="3-聚合函数"><a href="#3-聚合函数" class="headerlink" title="3.聚合函数"></a>3.聚合函数</h3><p>聚合函数是将一列数据作为一个整体，进行纵向计算，NULL值不参与聚合函数运算</p>
<ul>
<li>语法</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 聚合函数(字段列表) <span class="keyword">FROM</span> 表名;</span><br></pre></td></tr></table></figure>

<ul>
<li>常见的集合函数</li>
</ul>
<table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>count</td>
<td>统计数量</td>
</tr>
<tr>
<td>max</td>
<td>最大值</td>
</tr>
<tr>
<td>min</td>
<td>最小值</td>
</tr>
<tr>
<td>avg</td>
<td>平均值</td>
</tr>
<tr>
<td>sum</td>
<td>求和</td>
</tr>
</tbody></table>
<h3 id="4-分组查询"><a href="#4-分组查询" class="headerlink" title="4.分组查询"></a>4.分组查询</h3><ul>
<li>语法</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 字段列表 <span class="keyword">FROM</span> 表名 [<span class="keyword">WHERE</span> 条件] <span class="keyword">GROUP</span> <span class="keyword">BY</span> 分组字段 [<span class="keyword">HAVING</span> 分组后的过滤条件]</span><br></pre></td></tr></table></figure>

<ul>
<li>where与having区别<ul>
<li><p>执行时机不同：where是分组之前进行过滤，不满足where条件不参数分组；而having是分组之后对结果进行过滤</p>
</li>
<li><p>判断条件不同：where不能对聚合函数进行判断，而having可以</p>
</li>
<li><p>过滤对象：WHERE 过滤的是表中的行，它作用在每一行上。HAVING 过滤的是分组后的结果，它作用在聚合值上。</p>
</li>
</ul>
</li>
</ul>
<p><strong>SQL 的严格模式 <code>ONLY_FULL_GROUP_BY</code> 引起的，它要求在使用 <code>GROUP BY</code> 子句时，<code>SELECT</code> 列表中的每个列都要么是一个聚合函数（例如 <code>COUNT</code>、<code>SUM</code>、<code>AVG</code> 等），要么包含在 <code>GROUP BY</code> 子句中</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 根据性别分组，统计男女员工数量</span></span><br><span class="line">SELECT sex,count(*) FROM emp group by sex;</span><br><span class="line"><span class="comment"># 查询年龄小于45的员工，并根据员工工作地址分组，获取员工数量大于等于3的工作地址</span></span><br><span class="line"><span class="keyword">select</span> address,count(*) FROM emp <span class="built_in">where</span> age&gt;45 group by address having count(*)&gt;=3</span><br></pre></td></tr></table></figure>

<ul>
<li>执行顺序<ul>
<li>where &gt; 聚合函数 &gt; having</li>
<li>分组之后，查询的字段一般为聚合函数和分组字段，查询其他字段无意义</li>
</ul>
</li>
</ul>
<h3 id="5-排序查询"><a href="#5-排序查询" class="headerlink" title="5.排序查询"></a>5.排序查询</h3><p>MySQL中的排序操作在内存中完成，大数据排序可以面临着内存空间不足的问题。在排序过程中，可以使用<code>sort_buffer_size</code>来控制排序操作使用的内存。排序操作比较消耗内存，所以可以考虑使用索引排序，也就是<code>order by index</code>。</p>
<ul>
<li>语法</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 字段列表 <span class="keyword">FROM</span> 表名 <span class="keyword">ORDER</span> <span class="keyword">BY</span> 字段<span class="number">1</span> 排序方式<span class="number">1</span>,字段<span class="number">2</span> 排序方式<span class="number">2.</span>..</span><br></pre></td></tr></table></figure>

<ul>
<li>排序方式<ul>
<li>ASC：升序(默认)</li>
<li>DESC：降序</li>
</ul>
</li>
</ul>
<p><strong>如果是多字段排序，当第一个字段相同时，才回使用第二个字段进行排序。</strong></p>
<h3 id="6-分页查询"><a href="#6-分页查询" class="headerlink" title="6.分页查询"></a>6.分页查询</h3><ul>
<li>语法</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">SELECT 字段列表 FROM 表名 LIMIT 起始索引,查询记录数;</span><br></pre></td></tr></table></figure>

<ul>
<li>起始索引从0开始，起始索引&#x3D;(查询页码-1)*每页显示记录数</li>
<li>分页查询时数据库的方言，不同数据库有不同的实现</li>
<li>如果查询的是第一个数据，可以省略起始索引</li>
</ul>
<h3 id="7-DQL执行顺序"><a href="#7-DQL执行顺序" class="headerlink" title="7.DQL执行顺序"></a>7.DQL执行顺序</h3><p>DQL（Data Query Language）语句的执行顺序包括以下步骤。这些步骤用于从数据库中检索数据，并确保结果按照指定的顺序和条件返回：</p>
<ol>
<li><strong>FROM 子句：</strong><ul>
<li>查询从 FROM 子句中指定的表中获取数据。这是查询的起点。</li>
</ul>
</li>
<li><strong>WHERE 子句：</strong><ul>
<li>WHERE 子句用于对行进行条件过滤。只有符合 WHERE 子句中条件的行才会被包括在结果中。</li>
</ul>
</li>
<li><strong>GROUP BY 子句：</strong><ul>
<li>如果有 GROUP BY 子句，数据将按照 GROUP BY 子句中指定的列进行分组。这导致对每个组应用后续的聚合函数。</li>
</ul>
</li>
<li><strong>HAVING 子句：</strong><ul>
<li>如果有 HAVING 子句，它将在 GROUP BY 子句后用于筛选分组后的结果。只有满足 HAVING 子句中条件的组才会被包括在结果中。</li>
</ul>
</li>
<li><strong>SELECT 子句：</strong><ul>
<li>SELECT 子句用于选择要包括在结果中的列。这是确定最终输出的列的阶段。在这一步中，可以使用聚合函数（如 SUM、COUNT、AVG 等）对每个分组的结果进行计算。</li>
</ul>
</li>
<li><strong>ORDER BY 子句：</strong><ul>
<li>如果有 ORDER BY 子句，数据库将对结果进行排序。这决定了结果集的顺序。</li>
</ul>
</li>
<li><strong>LIMIT 子句：</strong><ul>
<li>如果有 LIMIT 子句，它将用于限制结果的数量。只有满足前面所有条件的行中的一部分将被返回。</li>
</ul>
</li>
</ol>
<h2 id="4-DCL"><a href="#4-DCL" class="headerlink" title="4.DCL"></a>4.DCL</h2><p>DCL全称Data Control Language，数据库控制语言，用来创建数据库用户，控制数据库的访问权限。</p>
<h3 id="1-用户管理"><a href="#1-用户管理" class="headerlink" title="1.用户管理"></a>1.用户管理</h3><ul>
<li>查询用户</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">use mysql;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>创建用户</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span> identified <span class="keyword">by</span> ‘密码’;</span><br></pre></td></tr></table></figure>

<ul>
<li>修改用户密码</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span> identified <span class="keyword">with</span> mysql_native_password <span class="keyword">by</span> <span class="string">&#x27;新密码&#x27;</span>;</span><br><span class="line"># identified <span class="keyword">with</span> mysql_native_password:指定使用mysql_native_password密码验证插件</span><br></pre></td></tr></table></figure>

<ul>
<li>删除用户</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>MySQL用户主机部分可以使用%或_等通配符</strong></p>
<h3 id="2-权限"><a href="#2-权限" class="headerlink" title="2.权限"></a>2.权限</h3><ul>
<li>MySQL中常用权限</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231210160006040.png" alt="image-20231210160006040"></p>
<ul>
<li>查询权限</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> grants <span class="keyword">for</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>授予权限</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">gtant 权限列表 <span class="keyword">on</span> 数据库名.表名 <span class="keyword">TO</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>删除权限</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">revoke</span> 权限列表 <span class="keyword">on</span> 数据库名.表名 <span class="keyword">TO</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="5-正则"><a href="#5-正则" class="headerlink" title="5.正则"></a>5.正则</h2><ul>
<li>语法</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">SELECT column1, column2, ...</span><br><span class="line">FROM table_name</span><br><span class="line">WHERE column_name REGEXP <span class="string">&#x27;pattern&#x27;</span>;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">模式</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">^</td>
<td align="left">匹配输入字符串的开始位置。如果设置了 RegExp 对象的 Multiline 属性，^ 也匹配 ‘\n’ 或 ‘\r’ 之后的位置。</td>
</tr>
<tr>
<td align="left">$</td>
<td align="left">匹配输入字符串的结束位置。如果设置了RegExp 对象的 Multiline 属性，$ 也匹配 ‘\n’ 或 ‘\r’ 之前的位置。</td>
</tr>
<tr>
<td align="left">.</td>
<td align="left">匹配除 “\n” 之外的任何单个字符。要匹配包括 ‘\n’ 在内的任何字符，请使用像 ‘[.\n]’ 的模式。</td>
</tr>
<tr>
<td align="left">[…]</td>
<td align="left">字符集合。匹配所包含的任意一个字符。例如， ‘[abc]’ 可以匹配 “plain” 中的 ‘a’。</td>
</tr>
<tr>
<td align="left">[^…]</td>
<td align="left">负值字符集合。匹配未包含的任意字符。例如， ‘[^abc]’ 可以匹配 “plain” 中的’p’。</td>
</tr>
<tr>
<td align="left">p1|p2|p3</td>
<td align="left">匹配 p1 或 p2 或 p3。例如，’z|food’ 能匹配 “z” 或 “food”。’(z|f)ood’ 则匹配 “zood” 或 “food”。</td>
</tr>
<tr>
<td align="left">*</td>
<td align="left">匹配前面的子表达式零次或多次。例如，zo* 能匹配 “z” 以及 “zoo”。* 等价于{0,}。</td>
</tr>
<tr>
<td align="left">+</td>
<td align="left">匹配前面的子表达式一次或多次。例如，’zo+’ 能匹配 “zo” 以及 “zoo”，但不能匹配 “z”。+ 等价于 {1,}。</td>
</tr>
<tr>
<td align="left">{n}</td>
<td align="left">n 是一个非负整数。匹配确定的 n 次。例如，’o{2}’ 不能匹配 “Bob” 中的 ‘o’，但是能匹配 “food” 中的两个 o。</td>
</tr>
<tr>
<td align="left">{n,m}</td>
<td align="left">m 和 n 均为非负整数，其中n &lt;&#x3D; m。最少匹配 n 次且最多匹配 m 次。</td>
</tr>
<tr>
<td align="left">\d</td>
<td align="left">匹配一个数字字符。</td>
</tr>
<tr>
<td align="left">\w</td>
<td align="left">匹配一个字母数字字符（包括下划线）。</td>
</tr>
<tr>
<td align="left">\s</td>
<td align="left">匹配一个空白字符。</td>
</tr>
</tbody></table>
<h1 id="4-函数"><a href="#4-函数" class="headerlink" title="4.函数"></a>4.函数</h1><p><strong>函数</strong>是指一段可以直接被另一段程序调用的程序或代码</p>
<h2 id="1-字符串函数"><a href="#1-字符串函数" class="headerlink" title="1.字符串函数"></a>1.字符串函数</h2><table>
<thead>
<tr>
<th align="left">函数</th>
<th align="left">描述</th>
<th align="left">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ASCII(s)</td>
<td align="left">返回字符串 s 的第一个字符的 ASCII 码。</td>
<td align="left">返回 CustomerName 字段第一个字母的 ASCII 码：<code>SELECT ASCII(CustomerName) AS NumCodeOfFirstChar FROM Customers;</code></td>
</tr>
<tr>
<td align="left">CHAR_LENGTH(s)</td>
<td align="left">返回字符串 s 的字符数</td>
<td align="left">返回字符串 RUNOOB 的字符数<code>SELECT CHAR_LENGTH(&quot;RUNOOB&quot;) AS LengthOfString;</code></td>
</tr>
<tr>
<td align="left">CHARACTER_LENGTH(s)</td>
<td align="left">返回字符串 s 的字符数，等同于 CHAR_LENGTH(s)</td>
<td align="left">返回字符串 RUNOOB 的字符数<code>SELECT CHARACTER_LENGTH(&quot;RUNOOB&quot;) AS LengthOfString;</code></td>
</tr>
<tr>
<td align="left"><strong>CONCAT(s1,s2…sn)</strong></td>
<td align="left">字符串 s1,s2 等多个字符串合并为一个字符串</td>
<td align="left">合并多个字符串<code>SELECT CONCAT(&quot;SQL &quot;, &quot;Runoob &quot;, &quot;Gooogle &quot;, &quot;Facebook&quot;) AS ConcatenatedString;</code></td>
</tr>
<tr>
<td align="left">CONCAT_WS(x, s1,s2…sn)</td>
<td align="left">同 CONCAT(s1,s2,…) 函数，但是每个字符串之间要加上 x，x 可以是分隔符</td>
<td align="left">合并多个字符串，并添加分隔符：<code>SELECT CONCAT_WS(&quot;-&quot;, &quot;SQL&quot;, &quot;Tutorial&quot;, &quot;is&quot;, &quot;fun!&quot;)AS ConcatenatedString;</code></td>
</tr>
<tr>
<td align="left">FIELD(s,s1,s2…)</td>
<td align="left">返回第一个字符串 s 在字符串列表(s1,s2…)中的位置</td>
<td align="left">返回字符串 c 在列表值中的位置：<code>SELECT FIELD(&quot;c&quot;, &quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;);</code></td>
</tr>
<tr>
<td align="left">FIND_IN_SET(s1,s2)</td>
<td align="left">返回在字符串s2中与s1匹配的字符串的位置</td>
<td align="left">返回字符串 c 在指定字符串中的位置：<code>SELECT FIND_IN_SET(&quot;c&quot;, &quot;a,b,c,d,e&quot;);</code></td>
</tr>
<tr>
<td align="left">FORMAT(x,n)</td>
<td align="left">函数可以将数字 x 进行格式化 “#,###.##”, 将 x 保留到小数点后 n 位，最后一位四舍五入。</td>
<td align="left">格式化数字 “#,###.##” 形式：<code>SELECT FORMAT(250500.5634, 2);     -- 输出 250,500.56</code></td>
</tr>
<tr>
<td align="left">INSERT(s1,x,len,s2)</td>
<td align="left">字符串 s2 替换 s1 的 x 位置开始长度为 len 的字符串</td>
<td align="left">从字符串第一个位置开始的 6 个字符替换为 runoob：<code>SELECT INSERT(&quot;google.com&quot;, 1, 6, &quot;runoob&quot;);  -- 输出：runoob.com</code></td>
</tr>
<tr>
<td align="left">LOCATE(s1,s)</td>
<td align="left">从字符串 s 中获取 s1 的开始位置</td>
<td align="left">获取 b 在字符串 abc 中的位置：<code>SELECT LOCATE(&#39;st&#39;,&#39;myteststring&#39;);  -- 5</code>返回字符串 abc 中 b 的位置：<code>SELECT LOCATE(&#39;b&#39;, &#39;abc&#39;) -- 2</code></td>
</tr>
<tr>
<td align="left">LCASE(s)</td>
<td align="left">将字符串 s 的所有字母变成小写字母</td>
<td align="left">字符串 RUNOOB 转换为小写：<code>SELECT LCASE(&#39;RUNOOB&#39;) -- runoob</code></td>
</tr>
<tr>
<td align="left">LEFT(s,n)</td>
<td align="left">返回字符串 s 的前 n 个字符</td>
<td align="left">返回字符串 runoob 中的前两个字符：<code>SELECT LEFT(&#39;runoob&#39;,2) -- ru</code></td>
</tr>
<tr>
<td align="left"><strong>LOWER(s)</strong></td>
<td align="left">将字符串 s 的所有字母变成小写字母</td>
<td align="left">字符串 RUNOOB 转换为小写：<code>SELECT LOWER(&#39;RUNOOB&#39;) -- runoob</code></td>
</tr>
<tr>
<td align="left"><strong>LPAD(s1,len,s2)</strong></td>
<td align="left">在字符串 s1 的开始处填充字符串 s2，使字符串长度达到 len</td>
<td align="left">将字符串 xx 填充到 abc 字符串的开始处：<code>SELECT LPAD(&#39;abc&#39;,5,&#39;xx&#39;) -- xxabc</code></td>
</tr>
<tr>
<td align="left">LTRIM(s)</td>
<td align="left">去掉字符串 s 开始处的空格</td>
<td align="left">去掉字符串 RUNOOB开始处的空格：<code>SELECT LTRIM(&quot;    RUNOOB&quot;) AS LeftTrimmedString;-- RUNOOB</code></td>
</tr>
<tr>
<td align="left">MID(s,n,len)</td>
<td align="left">从字符串 s 的 n 位置截取长度为 len 的子字符串，同 SUBSTRING(s,n,len)</td>
<td align="left">从字符串 RUNOOB 中的第 2 个位置截取 3个 字符：<code>SELECT MID(&quot;RUNOOB&quot;, 2, 3) AS ExtractString; -- UNO</code></td>
</tr>
<tr>
<td align="left">POSITION(s1 IN s)</td>
<td align="left">从字符串 s 中获取 s1 的开始位置</td>
<td align="left">返回字符串 abc 中 b 的位置：<code>SELECT POSITION(&#39;b&#39; in &#39;abc&#39;) -- 2</code></td>
</tr>
<tr>
<td align="left">REPEAT(s,n)</td>
<td align="left">将字符串 s 重复 n 次</td>
<td align="left">将字符串 runoob 重复三次：<code>SELECT REPEAT(&#39;runoob&#39;,3) -- runoobrunoobrunoob</code></td>
</tr>
<tr>
<td align="left">REPLACE(s,s1,s2)</td>
<td align="left">将字符串 s2 替代字符串 s 中的字符串 s1</td>
<td align="left">将字符串 abc 中的字符 a 替换为字符 x：<code>SELECT REPLACE(&#39;abc&#39;,&#39;a&#39;,&#39;x&#39;) --xbc</code></td>
</tr>
<tr>
<td align="left">REVERSE(s)</td>
<td align="left">将字符串s的顺序反过来</td>
<td align="left">将字符串 abc 的顺序反过来：<code>SELECT REVERSE(&#39;abc&#39;) -- cba</code></td>
</tr>
<tr>
<td align="left">RIGHT(s,n)</td>
<td align="left">返回字符串 s 的后 n 个字符</td>
<td align="left">返回字符串 runoob 的后两个字符：<code>SELECT RIGHT(&#39;runoob&#39;,2) -- ob</code></td>
</tr>
<tr>
<td align="left"><strong>RPAD(s1,len,s2)</strong></td>
<td align="left">在字符串 s1 的结尾处添加字符串 s2，使字符串的长度达到 len</td>
<td align="left">将字符串 xx 填充到 abc 字符串的结尾处：<code>SELECT RPAD(&#39;abc&#39;,5,&#39;xx&#39;) -- abcxx</code></td>
</tr>
<tr>
<td align="left">RTRIM(s)</td>
<td align="left">去掉字符串 s 结尾处的空格</td>
<td align="left">去掉字符串 RUNOOB 的末尾空格：<code>SELECT RTRIM(&quot;RUNOOB     &quot;) AS RightTrimmedString;   -- RUNOOB</code></td>
</tr>
<tr>
<td align="left">SPACE(n)</td>
<td align="left">返回 n 个空格</td>
<td align="left">返回 10 个空格：<code>SELECT SPACE(10);</code></td>
</tr>
<tr>
<td align="left">STRCMP(s1,s2)</td>
<td align="left">比较字符串 s1 和 s2，如果 s1 与 s2 相等返回 0 ，如果 s1&gt;s2 返回 1，如果 s1&lt;s2 返回 -1</td>
<td align="left">比较字符串：<code>SELECT STRCMP(&quot;runoob&quot;, &quot;runoob&quot;);  -- 0</code></td>
</tr>
<tr>
<td align="left">SUBSTR(s, start, length)</td>
<td align="left">从字符串 s 的 start 位置截取长度为 length 的子字符串</td>
<td align="left">从字符串 RUNOOB 中的第 2 个位置截取 3个 字符：<code>SELECT SUBSTR(&quot;RUNOOB&quot;, 2, 3) AS ExtractString; -- UNO</code></td>
</tr>
<tr>
<td align="left"><strong>SUBSTRING(s, start, length)</strong></td>
<td align="left">从字符串 s 的 start 位置截取长度为 length 的子字符串，等同于 SUBSTR(s, start, length)</td>
<td align="left">从字符串 RUNOOB 中的第 2 个位置截取 3个 字符：<code>SELECT SUBSTRING(&quot;RUNOOB&quot;, 2, 3) AS ExtractString; -- UNO</code></td>
</tr>
<tr>
<td align="left">SUBSTRING_INDEX(s, delimiter, number)</td>
<td align="left">返回从字符串 s 的第 number 个出现的分隔符 delimiter 之后的子串。 如果 number 是正数，返回第 number 个字符左边的字符串。 如果 number 是负数，返回第(number 的绝对值(从右边数))个字符右边的字符串。</td>
<td align="left"><code>SELECT SUBSTRING_INDEX(&#39;a*b&#39;,&#39;*&#39;,1) -- a SELECT SUBSTRING_INDEX(&#39;a*b&#39;,&#39;*&#39;,-1)  -- b SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(&#39;a*b*c*d*e&#39;,&#39;*&#39;,3),&#39;*&#39;,-1)  -- c</code></td>
</tr>
<tr>
<td align="left"><strong>TRIM(s)</strong></td>
<td align="left">去掉字符串 s 开始和结尾处的空格</td>
<td align="left">去掉字符串 RUNOOB 的首尾空格：<code>SELECT TRIM(&#39;    RUNOOB    &#39;) AS TrimmedString;</code></td>
</tr>
<tr>
<td align="left">UCASE(s)</td>
<td align="left">将字符串转换为大写</td>
<td align="left">将字符串 runoob 转换为大写：<code>SELECT UCASE(&quot;runoob&quot;); -- RUNOOB</code></td>
</tr>
<tr>
<td align="left"><strong>UPPER(s)</strong></td>
<td align="left">将字符串转换为大写</td>
<td align="left">将字符串 runoob 转换为大写：<code>SELECT UPPER(&quot;runoob&quot;); -- RUNOOB</code></td>
</tr>
</tbody></table>
<h2 id="2-数值函数"><a href="#2-数值函数" class="headerlink" title="2.数值函数"></a>2.数值函数</h2><table>
<thead>
<tr>
<th align="left">函数名</th>
<th align="left">描述</th>
<th align="left">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ABS(x)</td>
<td align="left">返回 x 的绝对值</td>
<td align="left">返回 -1 的绝对值：<code>SELECT ABS(-1) -- 返回1</code></td>
</tr>
<tr>
<td align="left">ACOS(x)</td>
<td align="left">求 x 的反余弦值（单位为弧度），x 为一个数值</td>
<td align="left"><code>SELECT ACOS(0.25);</code></td>
</tr>
<tr>
<td align="left">ASIN(x)</td>
<td align="left">求反正弦值（单位为弧度），x 为一个数值</td>
<td align="left"><code>SELECT ASIN(0.25);</code></td>
</tr>
<tr>
<td align="left">ATAN(x)</td>
<td align="left">求反正切值（单位为弧度），x 为一个数值</td>
<td align="left"><code>SELECT ATAN(2.5);</code></td>
</tr>
<tr>
<td align="left">ATAN2(n, m)</td>
<td align="left">求反正切值（单位为弧度）</td>
<td align="left"><code>SELECT ATAN2(-0.8, 2);</code></td>
</tr>
<tr>
<td align="left">AVG(expression)</td>
<td align="left">返回一个表达式的平均值，expression 是一个字段</td>
<td align="left">返回 Products 表中Price 字段的平均值：<code>SELECT AVG(Price) AS AveragePrice FROM Products;</code></td>
</tr>
<tr>
<td align="left"><strong>CEIL(x)</strong></td>
<td align="left">返回大于或等于 x 的最小整数</td>
<td align="left"><code>SELECT CEIL(1.5) -- 返回2</code></td>
</tr>
<tr>
<td align="left">CEILING(x)</td>
<td align="left">返回大于或等于 x 的最小整数</td>
<td align="left"><code>SELECT CEILING(1.5); -- 返回2</code></td>
</tr>
<tr>
<td align="left">COS(x)</td>
<td align="left">求余弦值(参数是弧度)</td>
<td align="left"><code>SELECT COS(2);</code></td>
</tr>
<tr>
<td align="left">COT(x)</td>
<td align="left">求余切值(参数是弧度)</td>
<td align="left"><code>SELECT COT(6);</code></td>
</tr>
<tr>
<td align="left">COUNT(expression)</td>
<td align="left">返回查询的记录总数，expression 参数是一个字段或者 * 号</td>
<td align="left">返回 Products 表中 products 字段总共有多少条记录：<code>SELECT COUNT(ProductID) AS NumberOfProducts FROM Products;</code></td>
</tr>
<tr>
<td align="left">DEGREES(x)</td>
<td align="left">将弧度转换为角度</td>
<td align="left"><code>SELECT DEGREES(3.1415926535898) -- 180</code></td>
</tr>
<tr>
<td align="left">n DIV m</td>
<td align="left">整除，n 为被除数，m 为除数</td>
<td align="left">计算 10 除于 5：<code>SELECT 10 DIV 5;  -- 2</code></td>
</tr>
<tr>
<td align="left">EXP(x)</td>
<td align="left">返回 e 的 x 次方</td>
<td align="left">计算 e 的三次方：<code>SELECT EXP(3) -- 20.085536923188</code></td>
</tr>
<tr>
<td align="left"><strong>FLOOR(x)</strong></td>
<td align="left">返回小于或等于 x 的最大整数</td>
<td align="left">小于或等于 1.5 的整数：<code>SELECT FLOOR(1.5) -- 返回1</code></td>
</tr>
<tr>
<td align="left">GREATEST(expr1, expr2, expr3, …)</td>
<td align="left">返回列表中的最大值</td>
<td align="left">返回以下数字列表中的最大值：<code>SELECT GREATEST(3, 12, 34, 8, 25); -- 34</code>返回以下字符串列表中的最大值：<code>SELECT GREATEST(&quot;Google&quot;, &quot;Runoob&quot;, &quot;Apple&quot;);   -- Runoob</code></td>
</tr>
<tr>
<td align="left">INET_ATON(expr:varchar)</td>
<td align="left">将一个IPV4地址转换为整数</td>
<td align="left">select inet_aton(‘192.168.2.204’);</td>
</tr>
<tr>
<td align="left">INET_NTOA(expr:int)</td>
<td align="left">将一个整数转换为IPV4地址</td>
<td align="left">select inet_ntoa(3232236236);</td>
</tr>
<tr>
<td align="left">LEAST(expr1, expr2, expr3, …)</td>
<td align="left">返回列表中的最小值</td>
<td align="left">返回以下数字列表中的最小值：<code>SELECT LEAST(3, 12, 34, 8, 25); -- 3</code>返回以下字符串列表中的最小值：<code>SELECT LEAST(&quot;Google&quot;, &quot;Runoob&quot;, &quot;Apple&quot;);   -- Apple</code></td>
</tr>
<tr>
<td align="left">LN</td>
<td align="left">返回数字的自然对数，以 e 为底。</td>
<td align="left">返回 2 的自然对数：<code>SELECT LN(2);  -- 0.6931471805599453</code></td>
</tr>
<tr>
<td align="left">LOG(x) 或 LOG(base, x)</td>
<td align="left">返回自然对数(以 e 为底的对数)，如果带有 base 参数，则 base 为指定带底数。</td>
<td align="left"><code>SELECT LOG(20.085536923188) -- 3 SELECT LOG(2, 4); -- 2</code></td>
</tr>
<tr>
<td align="left">LOG10(x)</td>
<td align="left">返回以 10 为底的对数</td>
<td align="left"><code>SELECT LOG10(100) -- 2</code></td>
</tr>
<tr>
<td align="left">LOG2(x)</td>
<td align="left">返回以 2 为底的对数</td>
<td align="left">返回以 2 为底 6 的对数：<code>SELECT LOG2(6);  -- 2.584962500721156</code></td>
</tr>
<tr>
<td align="left">MAX(expression)</td>
<td align="left">返回字段 expression 中的最大值</td>
<td align="left">返回数据表 Products 中字段 Price 的最大值：<code>SELECT MAX(Price) AS LargestPrice FROM Products;</code></td>
</tr>
<tr>
<td align="left">MIN(expression)</td>
<td align="left">返回字段 expression 中的最小值</td>
<td align="left">返回数据表 Products 中字段 Price 的最小值：<code>SELECT MIN(Price) AS MinPrice FROM Products;</code></td>
</tr>
<tr>
<td align="left"><strong>MOD(x,y)</strong></td>
<td align="left">返回 x 除以 y 以后的余数</td>
<td align="left">5 除于 2 的余数：<code>SELECT MOD(5,2) -- 1</code></td>
</tr>
<tr>
<td align="left">PI()</td>
<td align="left">返回圆周率(3.141593）</td>
<td align="left"><code>SELECT PI() --3.141593</code></td>
</tr>
<tr>
<td align="left">POW(x,y)</td>
<td align="left">返回 x 的 y 次方</td>
<td align="left">2 的 3 次方：<code>SELECT POW(2,3) -- 8</code></td>
</tr>
<tr>
<td align="left">POWER(x,y)</td>
<td align="left">返回 x 的 y 次方</td>
<td align="left">2 的 3 次方：<code>SELECT POWER(2,3) -- 8</code></td>
</tr>
<tr>
<td align="left">RADIANS(x)</td>
<td align="left">将角度转换为弧度</td>
<td align="left">180 度转换为弧度：<code>SELECT RADIANS(180) -- 3.1415926535898</code></td>
</tr>
<tr>
<td align="left"><strong>RAND()</strong></td>
<td align="left">返回 0 到 1 的随机数</td>
<td align="left"><code>SELECT RAND() --0.93099315644334</code></td>
</tr>
<tr>
<td align="left"><strong>ROUND(x [,y])</strong></td>
<td align="left">返回离 x 最近的整数，可选参数 y 表示要四舍五入的小数位数，如果省略，则返回整数。</td>
<td align="left"><code>SELECT ROUND(1.23456) --1 SELECT ROUND(345.156, 2) -- 345.16</code></td>
</tr>
<tr>
<td align="left">SIGN(x)</td>
<td align="left">返回 x 的符号，x 是负数、0、正数分别返回 -1、0 和 1</td>
<td align="left"><code>SELECT SIGN(-10) -- (-1)</code></td>
</tr>
<tr>
<td align="left">SIN(x)</td>
<td align="left">求正弦值(参数是弧度)</td>
<td align="left"><code>SELECT SIN(RADIANS(30)) -- 0.5</code></td>
</tr>
<tr>
<td align="left">SQRT(x)</td>
<td align="left">返回x的平方根</td>
<td align="left">25 的平方根：<code>SELECT SQRT(25) -- 5</code></td>
</tr>
<tr>
<td align="left">SUM(expression)</td>
<td align="left">返回指定字段的总和</td>
<td align="left">计算 OrderDetails 表中字段 Quantity 的总和：<code>SELECT SUM(Quantity) AS TotalItemsOrdered FROM OrderDetails;</code></td>
</tr>
<tr>
<td align="left">TAN(x)</td>
<td align="left">求正切值(参数是弧度)</td>
<td align="left"><code>SELECT TAN(1.75);  -- -5.52037992250933</code></td>
</tr>
<tr>
<td align="left">TRUNCATE(x,y)</td>
<td align="left">返回数值 x 保留到小数点后 y 位的值（与 ROUND 最大的区别是不会进行四舍五入）</td>
<td align="left"><code>SELECT TRUNCATE(1.23456,3) -- 1.234</code></td>
</tr>
</tbody></table>
<h2 id="3-日期函数"><a href="#3-日期函数" class="headerlink" title="3.日期函数"></a>3.日期函数</h2><table>
<thead>
<tr>
<th align="left">函数名</th>
<th align="left">描述</th>
<th align="left">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ADDDATE(d,n)</td>
<td align="left">计算起始日期 d 加上 n 天的日期</td>
<td align="left"><code>SELECT ADDDATE(&quot;2017-06-15&quot;, INTERVAL 10 DAY); -&gt;2017-06-25</code></td>
</tr>
<tr>
<td align="left">ADDTIME(t,n)</td>
<td align="left">n 是一个时间表达式，时间 t 加上时间表达式 n</td>
<td align="left">加 5 秒：<code>SELECT ADDTIME(&#39;2011-11-11 11:11:11&#39;, 5); -&gt;2011-11-11 11:11:16 (秒)</code>添加 2 小时, 10 分钟, 5 秒:<code>SELECT ADDTIME(&quot;2020-06-15 09:34:21&quot;, &quot;2:10:5&quot;);  -&gt; 2020-06-15 11:44:26</code></td>
</tr>
<tr>
<td align="left"><strong>CURDATE()</strong></td>
<td align="left">返回当前日期</td>
<td align="left"><code>SELECT CURDATE(); -&gt; 2018-09-19</code></td>
</tr>
<tr>
<td align="left">CURRENT_DATE()</td>
<td align="left">返回当前日期</td>
<td align="left"><code>SELECT CURRENT_DATE(); -&gt; 2018-09-19</code></td>
</tr>
<tr>
<td align="left">CURRENT_TIME</td>
<td align="left">返回当前时间</td>
<td align="left"><code>SELECT CURRENT_TIME(); -&gt; 19:59:02</code></td>
</tr>
<tr>
<td align="left">CURRENT_TIMESTAMP()</td>
<td align="left">返回当前日期和时间</td>
<td align="left"><code>SELECT CURRENT_TIMESTAMP() -&gt; 2018-09-19 20:57:43</code></td>
</tr>
<tr>
<td align="left"><strong>CURTIME()</strong></td>
<td align="left">返回当前时间</td>
<td align="left"><code>SELECT CURTIME(); -&gt; 19:59:02</code></td>
</tr>
<tr>
<td align="left">DATE()</td>
<td align="left">从日期或日期时间表达式中提取日期值</td>
<td align="left"><code>SELECT DATE(&quot;2017-06-15&quot;);     -&gt; 2017-06-15</code></td>
</tr>
<tr>
<td align="left"><strong>DATEDIFF(d1,d2)</strong></td>
<td align="left">计算日期 d1-&gt;d2 之间相隔的天数</td>
<td align="left"><code>SELECT DATEDIFF(&#39;2001-01-01&#39;,&#39;2001-02-02&#39;) -&gt; -32</code></td>
</tr>
<tr>
<td align="left"><strong>DATE_ADD(d，INTERVAL expr type)</strong></td>
<td align="left">计算起始日期 d 加上一个时间段后的日期，type 值可以是：MICROSECONDSECONDMINUTEHOURDAYWEEKMONTHQUARTERYEARSECOND_MICROSECONDMINUTE_MICROSECONDMINUTE_SECONDHOUR_MICROSECONDHOUR_SECONDHOUR_MINUTEDAY_MICROSECONDDAY_SECONDDAY_MINUTEDAY_HOURYEAR_MONTH</td>
<td align="left"><code>SELECT DATE_ADD(&quot;2017-06-15&quot;, INTERVAL 10 DAY);     -&gt; 2017-06-25 SELECT DATE_ADD(&quot;2017-06-15 09:34:21&quot;, INTERVAL 15 MINUTE); -&gt; 2017-06-15 09:49:21 SELECT DATE_ADD(&quot;2017-06-15 09:34:21&quot;, INTERVAL -3 HOUR); -&gt;2017-06-15 06:34:21 SELECT DATE_ADD(&quot;2017-06-15 09:34:21&quot;, INTERVAL -3 MONTH); -&gt;2017-04-15</code></td>
</tr>
<tr>
<td align="left">DATE_FORMAT(d,f)</td>
<td align="left">按表达式 f的要求显示日期 d</td>
<td align="left"><code>SELECT DATE_FORMAT(&#39;2011-11-11 11:11:11&#39;,&#39;%Y-%m-%d %r&#39;) -&gt; 2011-11-11 11:11:11 AM</code></td>
</tr>
<tr>
<td align="left">DATE_SUB(date,INTERVAL expr type)</td>
<td align="left">函数从日期减去指定的时间间隔。</td>
<td align="left">Orders 表中 OrderDate 字段减去 2 天：<code>SELECT OrderId,DATE_SUB(OrderDate,INTERVAL 2 DAY) AS OrderPayDate FROM Orders</code></td>
</tr>
<tr>
<td align="left"><strong>DAY(d)</strong></td>
<td align="left">返回日期值 d 的日期部分</td>
<td align="left"><code>SELECT DAY(&quot;2017-06-15&quot;);   -&gt; 15</code></td>
</tr>
<tr>
<td align="left">DAYNAME(d)</td>
<td align="left">返回日期 d 是星期几，如 Monday,Tuesday</td>
<td align="left"><code>SELECT DAYNAME(&#39;2011-11-11 11:11:11&#39;) -&gt;Friday</code></td>
</tr>
<tr>
<td align="left">DAYOFMONTH(d)</td>
<td align="left">计算日期 d 是本月的第几天</td>
<td align="left"><code>SELECT DAYOFMONTH(&#39;2011-11-11 11:11:11&#39;) -&gt;11</code></td>
</tr>
<tr>
<td align="left">DAYOFWEEK(d)</td>
<td align="left">日期 d 今天是星期几，1 星期日，2 星期一，以此类推</td>
<td align="left"><code>SELECT DAYOFWEEK(&#39;2011-11-11 11:11:11&#39;) -&gt;6</code></td>
</tr>
<tr>
<td align="left">DAYOFYEAR(d)</td>
<td align="left">计算日期 d 是本年的第几天</td>
<td align="left"><code>SELECT DAYOFYEAR(&#39;2011-11-11 11:11:11&#39;) -&gt;315</code></td>
</tr>
<tr>
<td align="left">EXTRACT(type FROM d)</td>
<td align="left">从日期 d 中获取指定的值，type 指定返回的值。 type可取值为： MICROSECONDSECONDMINUTEHOURDAYWEEKMONTHQUARTERYEARSECOND_MICROSECONDMINUTE_MICROSECONDMINUTE_SECONDHOUR_MICROSECONDHOUR_SECONDHOUR_MINUTEDAY_MICROSECONDDAY_SECONDDAY_MINUTEDAY_HOURYEAR_MONTH</td>
<td align="left"><code>SELECT EXTRACT(MINUTE FROM &#39;2011-11-11 11:11:11&#39;)  -&gt; 11</code></td>
</tr>
<tr>
<td align="left">FROM_DAYS(n)</td>
<td align="left">计算从 0000 年 1 月 1 日开始 n 天后的日期</td>
<td align="left"><code>SELECT FROM_DAYS(1111) -&gt; 0003-01-16</code></td>
</tr>
<tr>
<td align="left">HOUR(t)</td>
<td align="left">返回 t 中的小时值</td>
<td align="left"><code>SELECT HOUR(&#39;1:2:3&#39;) -&gt; 1</code></td>
</tr>
<tr>
<td align="left">LAST_DAY(d)</td>
<td align="left">返回给给定日期的那一月份的最后一天</td>
<td align="left"><code>SELECT LAST_DAY(&quot;2017-06-20&quot;); -&gt; 2017-06-30</code></td>
</tr>
<tr>
<td align="left">LOCALTIME()</td>
<td align="left">返回当前日期和时间</td>
<td align="left"><code>SELECT LOCALTIME() -&gt; 2018-09-19 20:57:43</code></td>
</tr>
<tr>
<td align="left">LOCALTIMESTAMP()</td>
<td align="left">返回当前日期和时间</td>
<td align="left"><code>SELECT LOCALTIMESTAMP() -&gt; 2018-09-19 20:57:43</code></td>
</tr>
<tr>
<td align="left">MAKEDATE(year, day-of-year)</td>
<td align="left">基于给定参数年份 year 和所在年中的天数序号 day-of-year 返回一个日期</td>
<td align="left"><code>SELECT MAKEDATE(2017, 3); -&gt; 2017-01-03</code></td>
</tr>
<tr>
<td align="left">MAKETIME(hour, minute, second)</td>
<td align="left">组合时间，参数分别为小时、分钟、秒</td>
<td align="left"><code>SELECT MAKETIME(11, 35, 4); -&gt; 11:35:04</code></td>
</tr>
<tr>
<td align="left">MICROSECOND(date)</td>
<td align="left">返回日期参数所对应的微秒数</td>
<td align="left"><code>SELECT MICROSECOND(&quot;2017-06-20 09:34:00.000023&quot;); -&gt; 23</code></td>
</tr>
<tr>
<td align="left">MINUTE(t)</td>
<td align="left">返回 t 中的分钟值</td>
<td align="left"><code>SELECT MINUTE(&#39;1:2:3&#39;) -&gt; 2</code></td>
</tr>
<tr>
<td align="left">MONTHNAME(d)</td>
<td align="left">返回日期当中的月份名称，如 November</td>
<td align="left"><code>SELECT MONTHNAME(&#39;2011-11-11 11:11:11&#39;) -&gt; November</code></td>
</tr>
<tr>
<td align="left"><strong>MONTH(d)</strong></td>
<td align="left">返回日期d中的月份值，1 到 12</td>
<td align="left"><code>SELECT MONTH(&#39;2011-11-11 11:11:11&#39;) -&gt;11</code></td>
</tr>
<tr>
<td align="left"><strong>NOW()</strong></td>
<td align="left">返回当前日期和时间</td>
<td align="left"><code>SELECT NOW() -&gt; 2018-09-19 20:57:43</code></td>
</tr>
<tr>
<td align="left">PERIOD_ADD(period, number)</td>
<td align="left">为 年-月 组合日期添加一个时段</td>
<td align="left"><code>SELECT PERIOD_ADD(201703, 5);    -&gt; 201708</code></td>
</tr>
<tr>
<td align="left">PERIOD_DIFF(period1, period2)</td>
<td align="left">返回两个时段之间的月份差值</td>
<td align="left"><code>SELECT PERIOD_DIFF(201710, 201703); -&gt; 7</code></td>
</tr>
<tr>
<td align="left">QUARTER(d)</td>
<td align="left">返回日期d是第几季节，返回 1 到 4</td>
<td align="left"><code>SELECT QUARTER(&#39;2011-11-11 11:11:11&#39;) -&gt; 4</code></td>
</tr>
<tr>
<td align="left">SECOND(t)</td>
<td align="left">返回 t 中的秒钟值</td>
<td align="left"><code>SELECT SECOND(&#39;1:2:3&#39;) -&gt; 3</code></td>
</tr>
<tr>
<td align="left">SEC_TO_TIME(s)</td>
<td align="left">将以秒为单位的时间 s 转换为时分秒的格式</td>
<td align="left"><code>SELECT SEC_TO_TIME(4320) -&gt; 01:12:00</code></td>
</tr>
<tr>
<td align="left">STR_TO_DATE(string, format_mask)</td>
<td align="left">将字符串转变为日期</td>
<td align="left"><code>SELECT STR_TO_DATE(&quot;August 10 2017&quot;, &quot;%M %d %Y&quot;); -&gt; 2017-08-10</code></td>
</tr>
<tr>
<td align="left">SUBDATE(d,n)</td>
<td align="left">日期 d 减去 n 天后的日期</td>
<td align="left"><code>SELECT SUBDATE(&#39;2011-11-11 11:11:11&#39;, 1) -&gt;2011-11-10 11:11:11 (默认是天)</code></td>
</tr>
<tr>
<td align="left">SUBTIME(t,n)</td>
<td align="left">时间 t 减去 n 秒的时间</td>
<td align="left"><code>SELECT SUBTIME(&#39;2011-11-11 11:11:11&#39;, 5) -&gt;2011-11-11 11:11:06 (秒)</code></td>
</tr>
<tr>
<td align="left">SYSDATE()</td>
<td align="left">返回当前日期和时间</td>
<td align="left"><code>SELECT SYSDATE() -&gt; 2018-09-19 20:57:43</code></td>
</tr>
<tr>
<td align="left">TIME(expression)</td>
<td align="left">提取传入表达式的时间部分</td>
<td align="left"><code>SELECT TIME(&quot;19:30:10&quot;); -&gt; 19:30:10</code></td>
</tr>
<tr>
<td align="left">TIME_FORMAT(t,f)</td>
<td align="left">按表达式 f 的要求显示时间 t</td>
<td align="left"><code>SELECT TIME_FORMAT(&#39;11:11:11&#39;,&#39;%r&#39;) 11:11:11 AM</code></td>
</tr>
<tr>
<td align="left">TIME_TO_SEC(t)</td>
<td align="left">将时间 t 转换为秒</td>
<td align="left"><code>SELECT TIME_TO_SEC(&#39;1:12:00&#39;) -&gt; 4320</code></td>
</tr>
<tr>
<td align="left">TIMEDIFF(time1, time2)</td>
<td align="left">计算时间差值</td>
<td align="left"><code>mysql&gt; SELECT TIMEDIFF(&quot;13:10:11&quot;, &quot;13:10:10&quot;); -&gt; 00:00:01 mysql&gt; SELECT TIMEDIFF(&#39;2000:01:01 00:00:00&#39;,    -&gt;                 &#39;2000:01:01 00:00:00.000001&#39;);        -&gt; &#39;-00:00:00.000001&#39; mysql&gt; SELECT TIMEDIFF(&#39;2008-12-31 23:59:59.000001&#39;,    -&gt;                 &#39;2008-12-30 01:01:01.000002&#39;);        -&gt; &#39;46:58:57.999999&#39;</code></td>
</tr>
<tr>
<td align="left">TIMESTAMP(expression, interval)</td>
<td align="left">单个参数时，函数返回日期或日期时间表达式；有2个参数时，将参数加和</td>
<td align="left"><code>mysql&gt; SELECT TIMESTAMP(&quot;2017-07-23&quot;,  &quot;13:10:11&quot;); -&gt; 2017-07-23 13:10:11 mysql&gt; SELECT TIMESTAMP(&#39;2003-12-31&#39;);        -&gt; &#39;2003-12-31 00:00:00&#39; mysql&gt; SELECT TIMESTAMP(&#39;2003-12-31 12:00:00&#39;,&#39;12:00:00&#39;);        -&gt; &#39;2004-01-01 00:00:00&#39;</code></td>
</tr>
<tr>
<td align="left">TIMESTAMPDIFF(unit,datetime_expr1,datetime_expr2)</td>
<td align="left">计算时间差，返回 datetime_expr2 − datetime_expr1 的时间差</td>
<td align="left"><code>mysql&gt; SELECT TIMESTAMPDIFF(DAY,&#39;2003-02-01&#39;,&#39;2003-05-01&#39;);   // 计算两个时间相隔多少天        -&gt; 89 mysql&gt; SELECT TIMESTAMPDIFF(MONTH,&#39;2003-02-01&#39;,&#39;2003-05-01&#39;);   // 计算两个时间相隔多少月        -&gt; 3 mysql&gt; SELECT TIMESTAMPDIFF(YEAR,&#39;2002-05-01&#39;,&#39;2001-01-01&#39;);    // 计算两个时间相隔多少年        -&gt; -1 mysql&gt; SELECT TIMESTAMPDIFF(MINUTE,&#39;2003-02-01&#39;,&#39;2003-05-01 12:05:55&#39;);  // 计算两个时间相隔多少分钟        -&gt; 128885</code></td>
</tr>
<tr>
<td align="left">TO_DAYS(d)</td>
<td align="left">计算日期 d 距离 0000 年 1 月 1 日的天数</td>
<td align="left"><code>SELECT TO_DAYS(&#39;0001-01-01 01:01:01&#39;) -&gt; 366</code></td>
</tr>
<tr>
<td align="left">WEEK(d)</td>
<td align="left">计算日期 d 是本年的第几个星期，范围是 0 到 53</td>
<td align="left"><code>SELECT WEEK(&#39;2011-11-11 11:11:11&#39;) -&gt; 45</code></td>
</tr>
<tr>
<td align="left">WEEKDAY(d)</td>
<td align="left">日期 d 是星期几，0 表示星期一，1 表示星期二</td>
<td align="left"><code>SELECT WEEKDAY(&quot;2017-06-15&quot;); -&gt; 3</code></td>
</tr>
<tr>
<td align="left">WEEKOFYEAR(d)</td>
<td align="left">计算日期 d 是本年的第几个星期，范围是 0 到 53</td>
<td align="left"><code>SELECT WEEKOFYEAR(&#39;2011-11-11 11:11:11&#39;) -&gt; 45</code></td>
</tr>
<tr>
<td align="left"><strong>YEAR(d)</strong></td>
<td align="left">返回年份</td>
<td align="left"><code>SELECT YEAR(&quot;2017-06-15&quot;); -&gt; 2017</code></td>
</tr>
<tr>
<td align="left">YEARWEEK(date, mode)</td>
<td align="left">返回年份及第几周（0到53），mode 中 0 表示周天，1表示周一，以此类推</td>
<td align="left"><code>SELECT YEARWEEK(&quot;2017-06-15&quot;); -&gt; 201724</code></td>
</tr>
</tbody></table>
<h2 id="4-高级函数"><a href="#4-高级函数" class="headerlink" title="4.高级函数"></a>4.高级函数</h2><table>
<thead>
<tr>
<th align="left">函数名</th>
<th align="left">描述</th>
<th align="left">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">BIN(x)</td>
<td align="left">返回 x 的二进制编码，x 为十进制数</td>
<td align="left">15 的 2 进制编码:<code>SELECT BIN(15); -- 1111</code></td>
</tr>
<tr>
<td align="left">BINARY(s)</td>
<td align="left">将字符串 s 转换为二进制字符串</td>
<td align="left"><code>SELECT BINARY &quot;RUNOOB&quot;; -&gt; RUNOOB</code></td>
</tr>
<tr>
<td align="left"><strong>CASE expression    WHEN condition1 THEN result1    WHEN condition2 THEN result2   …    WHEN conditionN THEN resultN    ELSE result END</strong></td>
<td align="left">CASE 表示函数开始，END 表示函数结束。如果 condition1 成立，则返回 result1, 如果 condition2 成立，则返回 result2，当全部不成立则返回 result，而当有一个成立之后，后面的就不执行了。</td>
<td align="left"><code>SELECT CASE  　WHEN 1 &gt; 0 　THEN &#39;1 &gt; 0&#39; 　WHEN 2 &gt; 0 　THEN &#39;2 &gt; 0&#39; 　ELSE &#39;3 &gt; 0&#39; 　END -&gt;1 &gt; 0</code></td>
</tr>
<tr>
<td align="left">CAST(x AS type)</td>
<td align="left">转换数据类型</td>
<td align="left">字符串日期转换为日期：<code>SELECT CAST(&quot;2017-08-29&quot; AS DATE); -&gt; 2017-08-29</code></td>
</tr>
<tr>
<td align="left">COALESCE(expr1, expr2, …., expr_n)</td>
<td align="left">返回参数中的第一个非空表达式（从左向右）</td>
<td align="left"><code>SELECT COALESCE(NULL, NULL, NULL, &#39;runoob.com&#39;, NULL, &#39;google.com&#39;); -&gt; runoob.com</code></td>
</tr>
<tr>
<td align="left">CONNECTION_ID()</td>
<td align="left">返回唯一的连接 ID</td>
<td align="left"><code>SELECT CONNECTION_ID(); -&gt; 4292835</code></td>
</tr>
<tr>
<td align="left">CONV(x,f1,f2)</td>
<td align="left">返回 f1 进制数变成 f2 进制数</td>
<td align="left"><code>SELECT CONV(15, 10, 2); -&gt; 1111</code></td>
</tr>
<tr>
<td align="left">CONVERT(s USING cs)</td>
<td align="left">函数将字符串 s 的字符集变成 cs</td>
<td align="left"><code>SELECT CHARSET(&#39;ABC&#39;) -&gt;utf-8     SELECT CHARSET(CONVERT(&#39;ABC&#39; USING gbk)) -&gt;gbk</code></td>
</tr>
<tr>
<td align="left">CURRENT_USER()</td>
<td align="left">返回当前用户</td>
<td align="left"><code>SELECT CURRENT_USER(); -&gt; guest@%</code></td>
</tr>
<tr>
<td align="left">DATABASE()</td>
<td align="left">返回当前数据库名</td>
<td align="left"><code>SELECT DATABASE();    -&gt; runoob</code></td>
</tr>
<tr>
<td align="left"><strong>IF(expr,v1,v2)</strong></td>
<td align="left">如果表达式 expr 成立，返回结果 v1；否则，返回结果 v2。</td>
<td align="left"><code>SELECT IF(1 &gt; 0,&#39;正确&#39;,&#39;错误&#39;)     -&gt;正确</code></td>
</tr>
<tr>
<td align="left"><strong>IFNULL(v1,v2)</strong></td>
<td align="left">如果 v1 的值不为 NULL，则返回 v1，否则返回 v2。</td>
<td align="left"><code>SELECT IFNULL(null,&#39;Hello Word&#39;) -&gt;Hello Word</code></td>
</tr>
<tr>
<td align="left">ISNULL(expression)</td>
<td align="left">判断表达式是否为 NULL</td>
<td align="left"><code>SELECT ISNULL(NULL); -&gt;1</code></td>
</tr>
<tr>
<td align="left">LAST_INSERT_ID()</td>
<td align="left">返回最近生成的 AUTO_INCREMENT 值</td>
<td align="left"><code>SELECT LAST_INSERT_ID(); -&gt;6</code></td>
</tr>
<tr>
<td align="left">NULLIF(expr1, expr2)</td>
<td align="left">比较两个字符串，如果字符串 expr1 与 expr2 相等 返回 NULL，否则返回 expr1</td>
<td align="left"><code>SELECT NULLIF(25, 25); -&gt;</code></td>
</tr>
<tr>
<td align="left">SESSION_USER()</td>
<td align="left">返回当前用户</td>
<td align="left"><code>SELECT SESSION_USER(); -&gt; guest@%</code></td>
</tr>
<tr>
<td align="left">SYSTEM_USER()</td>
<td align="left">返回当前用户</td>
<td align="left"><code>SELECT SYSTEM_USER(); -&gt; guest@%</code></td>
</tr>
<tr>
<td align="left">USER()</td>
<td align="left">返回当前用户</td>
<td align="left"><code>SELECT USER(); -&gt; guest@%</code></td>
</tr>
<tr>
<td align="left">VERSION()</td>
<td align="left">返回数据库的版本号</td>
<td align="left"><code>SELECT VERSION() -&gt; 5.6.34</code></td>
</tr>
</tbody></table>
<p>以下是 MySQL 8.0 版本新增的一些常用函数：</p>
<table>
<thead>
<tr>
<th align="left">函数</th>
<th align="left">描述</th>
<th align="left">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">JSON_OBJECT()</td>
<td align="left">将键值对转换为 JSON 对象</td>
<td align="left"><code>SELECT JSON_OBJECT(&#39;key1&#39;, &#39;value1&#39;, &#39;key2&#39;, &#39;value2&#39;)</code></td>
</tr>
<tr>
<td align="left">JSON_ARRAY()</td>
<td align="left">将值转换为 JSON 数组</td>
<td align="left"><code>SELECT JSON_ARRAY(1, 2, &#39;three&#39;)</code></td>
</tr>
<tr>
<td align="left">JSON_EXTRACT()</td>
<td align="left">从 JSON 字符串中提取指定的值</td>
<td align="left"><code>SELECT JSON_EXTRACT(&#39;&#123;&quot;name&quot;: &quot;John&quot;, &quot;age&quot;: 30&#125;&#39;, &#39;$.name&#39;)</code></td>
</tr>
<tr>
<td align="left">JSON_CONTAINS()</td>
<td align="left">检查一个 JSON 字符串是否包含指定的值</td>
<td align="left"><code>SELECT JSON_CONTAINS(&#39;&#123;&quot;name&quot;: &quot;John&quot;, &quot;age&quot;: 30&#125;&#39;, &#39;John&#39;, &#39;$.name&#39;)</code></td>
</tr>
<tr>
<td align="left">ROW_NUMBER()</td>
<td align="left">为查询结果中的每一行分配一个唯一的数字</td>
<td align="left"><code>SELECT ROW_NUMBER() OVER(ORDER BY id) AS row_number, name FROM users</code></td>
</tr>
<tr>
<td align="left">RANK()</td>
<td align="left">为查询结果中的每一行分配一个排名</td>
<td align="left"><code>SELECT RANK() OVER(ORDER BY score DESC) AS rank, name, score FROM students</code></td>
</tr>
</tbody></table>
<h1 id="5-约束"><a href="#5-约束" class="headerlink" title="5.约束"></a>5.约束</h1><ul>
<li>概念：约束是作用于表中字段上的规则，用于限制存储在表中的数据</li>
<li>目的：保证数据库中数据的正确、有效性和完整性</li>
<li>常用约束</li>
</ul>
<table>
<thead>
<tr>
<th>约束</th>
<th>说明</th>
<th>关键字</th>
</tr>
</thead>
<tbody><tr>
<td>非空约束</td>
<td>该字段的数据不能为null</td>
<td>NOT NULL</td>
</tr>
<tr>
<td>唯一约束</td>
<td>保证该字段的所有数据都是唯一的</td>
<td>UNIQUE</td>
</tr>
<tr>
<td>主键约束</td>
<td>主键是一行数据的唯一标识，要求非空且唯一</td>
<td>PRIMARY KEY</td>
</tr>
<tr>
<td>默认约束</td>
<td>保存数据时，如果未指定该字段的值，则采用默认值</td>
<td>DEFAULT</td>
</tr>
<tr>
<td>检查约束(8.0.16版本之后)</td>
<td>保证字段值满足某一条件</td>
<td>CHECK</td>
</tr>
<tr>
<td>外键约束</td>
<td>用来让两张表的数据之间建立连接，保证数据的一致性和完整性</td>
<td>FOREIGN KEY</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> work(</span><br><span class="line">    id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment, # 自增序列一般一个表中只有一个，通常跟主键搭配</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">unique</span> ,</span><br><span class="line">    age <span class="type">int</span> <span class="keyword">check</span> ( age <span class="operator">&gt;</span> <span class="number">0</span> <span class="keyword">and</span> age <span class="operator">&lt;=</span> <span class="number">120</span> ),</span><br><span class="line">    status <span class="type">char</span>(<span class="number">1</span>) <span class="keyword">default</span> <span class="number">1</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 添加外键</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名(</span><br><span class="line">	字段名 数据类型,</span><br><span class="line">    [<span class="keyword">CONSTRAINT</span>] [外键名称] <span class="keyword">FOREIGN</span> KEY (外键字段) <span class="keyword">REFERENCES</span> 主表 (主表列名)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> 外键名称 <span class="keyword">FOREIGN</span> KEY (外键字段) <span class="keyword">REFERENCES</span> 主表 (主表列名)</span><br><span class="line"></span><br><span class="line"># 删除外键</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> KEY 外键名 <span class="keyword">ON</span> <span class="keyword">UPDATE</span> CASCADE <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231210201247039.png" alt="image-20231210201247039"></p>
<h1 id="6-多表查询"><a href="#6-多表查询" class="headerlink" title="6.多表查询"></a>6.多表查询</h1><ul>
<li>指从多张表中查询数据</li>
<li>笛卡尔积：笛卡尔乘积是指在数学中，两个集合A和B的所有组合情况(在多表查询时，需要消除无效的笛卡尔积)</li>
<li>多表查询分类：<ul>
<li>连接查询<ul>
<li>内连接：相当于查询A、B交集部分数据</li>
<li>外连接<ul>
<li>左外连接：查询左表所有数据，以及两张表交集部分数据，且对于右表没有的数据以NULL填补</li>
<li>右外连接：查询右表所有数据，以及两张表交集部分数据，且对于左表没有的数据以NULL填补</li>
</ul>
</li>
<li>自连接：当前表与自身的连接查询，自连接必须使用表别名</li>
</ul>
</li>
<li>子查询</li>
</ul>
</li>
<li>在连接中<code>on</code>表示的是连接条件，而<code>where</code>定义对查询结果进行过滤的条件。外连接必须使用<code>on</code>语句。</li>
<li>一般来说，MySQL中的优化器会根据查询条件、索引情况和统计信息来决定先读那个表，但也可以用<code>STRAIGHT_JOIN</code>来强制让数据库顺序读</li>
</ul>
<h2 id="1-多表关系"><a href="#1-多表关系" class="headerlink" title="1.多表关系"></a>1.多表关系</h2><p>在项目开发中，在进行数据库表结构设计时，会根据业务需求及业务模块之间的关系，分析并设计表结构，由于业务之间相互关联，所以各个表结构之间也存在着各种联系，基本上分为三种：</p>
<ul>
<li>一对多</li>
<li>多对多</li>
<li>一对一</li>
</ul>
<blockquote>
<p>一对多</p>
</blockquote>
<ul>
<li>案例：部门与员工的关系</li>
<li>关系：一个部门对应多个员工，一个员工对应一个部门</li>
<li>实现：在多的一方建立外键，指向一的一方的主键</li>
</ul>
<blockquote>
<p>多对多</p>
</blockquote>
<ul>
<li>案例：学生与课程的关系</li>
<li>关系：一个学生可以选修多门课程，一门课程也可以拱多个学生选择</li>
<li>实现：建立第三张中间表，中间表至少包含两个外键，分别关联两方主键</li>
</ul>
<blockquote>
<p>一对一</p>
</blockquote>
<ul>
<li><p>案例：用户与用户详情的关系</p>
</li>
<li><p>关系：一对一关系，多用于单表拆分，将一张表的基础字段放在一张表中，其他详情字段放在另一张表中，以提升操作效率</p>
</li>
<li><p>实现：在任意一方加入外键，关联另一方的主键，并且设置外键为唯一的</p>
</li>
</ul>
<h2 id="2-内连接"><a href="#2-内连接" class="headerlink" title="2.内连接"></a>2.内连接</h2><ul>
<li>语法</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 隐式内连接</span><br><span class="line"><span class="keyword">SELECT</span> 字段列表 <span class="keyword">FROM</span> 表<span class="number">1</span>,表<span class="number">2</span> [<span class="keyword">WHERE</span> 条件..];</span><br><span class="line"></span><br><span class="line"># 显式内连接</span><br><span class="line"><span class="keyword">SELECT</span> 字段列表 <span class="keyword">FROM</span> 表<span class="number">1</span> [<span class="keyword">INNER</span>] <span class="keyword">JOIN</span> 表<span class="number">2</span> [<span class="keyword">ON</span> 条件..];</span><br></pre></td></tr></table></figure>

<p><strong>内连接查询的是两张表交集的部分</strong></p>
<h2 id="3-外连接"><a href="#3-外连接" class="headerlink" title="3.外连接"></a>3.外连接</h2><ul>
<li>语法</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 左外连接</span><br><span class="line"><span class="keyword">SELECT</span> 字段列表 <span class="keyword">FROM</span> 表<span class="number">1</span> <span class="keyword">LEFT</span> [<span class="keyword">OUTER</span>] <span class="keyword">JOIN</span> 表<span class="number">2</span> <span class="keyword">ON</span> 条件;</span><br><span class="line"># 查询左表所有数据，以及两张表交集部分数据，且对于右表没有的数据以<span class="keyword">NULL</span>填补</span><br><span class="line"></span><br><span class="line"># 右外连接</span><br><span class="line"><span class="keyword">SELECT</span> 字段列表 <span class="keyword">FROM</span> 表<span class="number">1</span> <span class="keyword">RIGHT</span> [<span class="keyword">OUTER</span>] <span class="keyword">JOIN</span> 表<span class="number">2</span> <span class="keyword">ON</span> 条件;</span><br><span class="line"># 查询右表所有数据，以及两张表交集部分数据，且对于左表没有的数据以<span class="keyword">NULL</span>填补</span><br></pre></td></tr></table></figure>

<h2 id="4-自连接"><a href="#4-自连接" class="headerlink" title="4.自连接"></a>4.自连接</h2><ul>
<li>语法</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 字段列表 <span class="keyword">FROM</span> 表A [<span class="keyword">left</span><span class="operator">/</span><span class="keyword">right</span>] <span class="keyword">JOIN</span> 别名A 表A 别名B <span class="keyword">ON</span> 条件..;</span><br></pre></td></tr></table></figure>

<p><strong>自连接可以是内连接也可以是外连接,使用自连接必须起别名</strong></p>
<h2 id="5-联合查询"><a href="#5-联合查询" class="headerlink" title="5.联合查询"></a>5.联合查询</h2><ul>
<li>语法</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 字段列表 <span class="keyword">FROM</span> 表A..</span><br><span class="line"><span class="keyword">UNION</span> [<span class="keyword">ALL</span>]</span><br><span class="line"><span class="keyword">SELECT</span> 字段列表 <span class="keyword">FROM</span> 表B..</span><br></pre></td></tr></table></figure>

<p><strong>MySQL UNION 操作符用于连接两个以上的 SELECT 语句的结果组合到一个结果集合，并去除重复的行（UNION ALL不去除重复行）。</strong></p>
<p><strong>UNION 操作符必须由两个或多个 SELECT 语句组成，每个 SELECT 语句的列数和对应位置的数据类型必须相同。</strong></p>
<h2 id="6-子查询"><a href="#6-子查询" class="headerlink" title="6.子查询"></a>6.子查询</h2><ul>
<li>SQL语句中嵌套SELECT语句，称为嵌套查询，也称为子查询</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t1 <span class="keyword">WHERE</span> COLUMN1<span class="operator">=</span>(<span class="keyword">SELECT</span> <span class="keyword">column</span> <span class="keyword">from</span> t2);</span><br></pre></td></tr></table></figure>

<p>子查询外部语句可以是INSERT&#x2F;UPDATE&#x2F;DELETE&#x2F;SELECT任一个。</p>
<ul>
<li><p>根据子查询结果不同，分为</p>
<ul>
<li><p>标量子查询(子查询结果为单个值)</p>
<ul>
<li>把标量子查询当成单个值使用</li>
</ul>
</li>
<li><p>列子查询</p>
<ul>
<li>把列子查询当成集合来使用</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231210213302544.png" alt="image-20231210213302544"></p>
<ul>
<li><p>行子查询</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 元组方式表示<span class="keyword">and</span>的逻辑</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp <span class="keyword">where</span> (salary,managerid)<span class="operator">=</span>(<span class="keyword">select</span> salary,managerid <span class="keyword">from</span> emp <span class="keyword">where</span> name <span class="operator">=</span> &quot;p&quot;)</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231210213807908.png" alt="image-20231210213807908"></p>
<ul>
<li>表子查询(查询结果为多行多列)<ul>
<li>可以当成一个中间表来查询，并且可以使用in操作符方式使用元组方式比较</li>
</ul>
</li>
</ul>
</li>
<li><p>根据出现位置：</p>
<ul>
<li>WHERE之后：在对表进行修改操作时，不能在WHERE中子查询引用正在更新的表，可以在WHERE子查询中再嵌套一个子查询</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 不能在WHERE后面之间用select  min(id) id from Person group by email</span></span><br><span class="line"><span class="comment">   而是必须在WHERE后面再嵌套一个子查询，这样做的目的是避免WHERE后的表与正在更新的表一致*/</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> Person <span class="keyword">where</span> id <span class="keyword">not</span> <span class="keyword">in</span></span><br><span class="line">                         (<span class="keyword">select</span> t.id <span class="keyword">from</span></span><br><span class="line">                            (<span class="keyword">select</span>  <span class="built_in">min</span>(id) id <span class="keyword">from</span> Person <span class="keyword">group</span> <span class="keyword">by</span> email) t);</span><br></pre></td></tr></table></figure>

<ul>
<li>FROM之后：中间表必须使用别名</li>
<li>SELECT之后：只能是标量子查询</li>
</ul>
</li>
</ul>
<h1 id="7-事务"><a href="#7-事务" class="headerlink" title="7.事务"></a>7.事务</h1><p>事务是一组操作的集合，它是一个不可分割的工作单位，事务会把所有的操作作为一个整体一起向系统提交或撤销操作请求，即这些操作要么同时成功，要么同时失败。</p>
<p>默认MySQL的事务是自动提交的，也就是说，执行一条DML语句，MYSQL会立即隐式的提交事务。这个由MySQL中的<code>autocommit</code>属性控制</p>
<ul>
<li>查看&#x2F;设置提交方式</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> @<span class="variable">@autocommit</span>;</span><br><span class="line"><span class="keyword">set</span> @<span class="variable">@autocommit</span><span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>BEGIN 或 START TRANSACTION 显式地开启一个事务；</li>
<li>COMMIT 也可以使用 COMMIT WORK，不过二者是等价的。COMMIT 会提交事务，并使已对数据库进行的所有修改成为永久性的；</li>
<li>ROLLBACK 也可以使用 ROLLBACK WORK，不过二者是等价的。回滚会结束用户的事务，并撤销正在进行的所有未提交的修改；</li>
<li>SAVEPOINT identifier，SAVEPOINT 允许在事务中创建一个保存点，一个事务中可以有多个 SAVEPOINT；</li>
<li>RELEASE SAVEPOINT identifier 删除一个事务的保存点，当没有指定的保存点时，执行该语句会抛出一个异常；</li>
<li>ROLLBACK TO identifier 把事务回滚到标记点；</li>
</ul>
<h2 id="1-事务四大特性"><a href="#1-事务四大特性" class="headerlink" title="1.事务四大特性"></a>1.事务四大特性</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231210222018597.png" alt="image-20231210222018597"></p>
<h2 id="2-并发事务问题"><a href="#2-并发事务问题" class="headerlink" title="2.并发事务问题"></a>2.并发事务问题</h2><table>
<thead>
<tr>
<th>问题</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>脏读</td>
<td>一个事物读到另一个事物未提交的数据</td>
</tr>
<tr>
<td>不可重复读</td>
<td>一个事物先后读取同一条记录，但两次读取的数据不同</td>
</tr>
<tr>
<td>幻读</td>
<td>一个事物按照条件查询数据时，没有对应的数据行，但是在插入数据时，又发现这行数据已经存在</td>
</tr>
</tbody></table>
<h2 id="3-事务隔离级别"><a href="#3-事务隔离级别" class="headerlink" title="3.事务隔离级别"></a>3.事务隔离级别</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231210222814567.png" alt="image-20231210222814567"></p>
<h1 id="8-存储引擎"><a href="#8-存储引擎" class="headerlink" title="8.存储引擎"></a>8.存储引擎</h1><blockquote>
<p>MySQL体系结构</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231211203725165.png" alt="image-20231211203725165"></p>
<ul>
<li>连接层：最上层是一些客户端和链接服务，主要完成一些类似于连接处理、授权认证及相关的安全方案。服务器也会为安全接入的每个客户端验证它所具有的权限</li>
<li>服务层：第二层架构主要完成大多数的核心服务功能，如SQL接口，并完成缓存的查询，SQL的分析和优化，部分内置函数的执行。所有跨存储引擎的功能也在这一层实现，如过程、函数等</li>
<li>引擎层：存储引擎真正的负责了MySQL中数据的存储和提取，服务器通过API和存储引擎进行通信。不同的存储引擎具有不同的功能，这样我们可以根据自己的需要，来选取合适的存储引擎</li>
<li>存储层：主要是将数据存储在文件系统之上，并完成与存储引擎的交互</li>
</ul>
<blockquote>
<p>存储引擎</p>
</blockquote>
<p>存储引擎就是存储数据、建立索引、更新&#x2F;查询数据等技术的实现方式。存储引擎是基于表的，而不是基于库的，所以存储引擎也可被称为表类型。<strong>MySQL5.5之后默认存储引擎是INNODB</strong></p>
<ul>
<li>查看数据库支持的存储引擎：<code>show engines ;</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 在创建表时用ENGINE<span class="operator">=</span>来指定表的存储引擎</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `Employee` (</span><br><span class="line">  `id` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `salary` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `managerId` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3</span><br></pre></td></tr></table></figure>

<h2 id="1-存储引擎特点"><a href="#1-存储引擎特点" class="headerlink" title="1.存储引擎特点"></a>1.存储引擎特点</h2><ul>
<li>INNODB<ul>
<li>INNODB是一种兼顾高可靠性和高性能的通用存储引擎，在MySQL5.5之后，INNODB是默认的MySQL存储引擎</li>
<li>DML操作遵循ACID模型，支持事务</li>
<li>行级锁，提高并发访问性能</li>
<li>支持外键约束，保证数据的完整性和正确性</li>
<li>xxx.ibd：xxx代表的是表名，innodb引擎每张表都会对应这样一个表空间文件，存储该表的表结构(frm、sdi)、数据和索引。该行为由<code>innodb_file_per_table</code>参数控制</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231211212343512.png" alt="image-20231211212343512"></p>
<ul>
<li><p>MyISAM</p>
<ul>
<li>MyISAM是MySQL早期默认存储引擎</li>
<li>不支持事物，不支持外键</li>
<li>支持表锁，不支持行锁</li>
<li>访问速度快</li>
<li>sdi文件：表结构</li>
<li>MYD文件：表数据</li>
<li>MYI文件：索引</li>
</ul>
</li>
<li><p>MEMORY</p>
<ul>
<li>Memory引擎的表数据时存储在内存中的，由于受到硬件问题、或断电问题的影响，只能将这些表作为临时表或缓存使用</li>
<li>内存存放</li>
<li>hash索引</li>
<li>sdi：存储表结构信息</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231211213236506.png" alt="image-20231211213236506"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231211213345129.png" alt="image-20231211213345129"></p>
<h1 id="9-索引"><a href="#9-索引" class="headerlink" title="9.索引"></a>9.索引</h1><h2 id="1-索引概述"><a href="#1-索引概述" class="headerlink" title="1.索引概述"></a>1.索引概述</h2><p>索引(index)是帮助MySQL高效获取数据的数据结构(有序)。在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式指向数据，这样就可以在这些数据结构上实现高级查找算法，这种数据结构就是索引。索引相当于数据的目录。</p>
<table>
<thead>
<tr>
<th>优势</th>
<th>劣势</th>
</tr>
</thead>
<tbody><tr>
<td>提高数据检索的效率，减低数据库的IO成本</td>
<td>索引列也是要占用空间</td>
</tr>
<tr>
<td>通过索引对数据进行排序，减低数据排序的成本，降低CPU的消耗</td>
<td>索引大大提高了查询效率，同时却也减低了更新表的速度，如对表进行增删改等操作时，效率减低</td>
</tr>
</tbody></table>
<p>MySQL的索引是在存储引擎层实现的，不同的存储引擎有不同的结构，主要包含：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231212203216374.png" alt="image-20231212203216374"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231212203238691.png" alt="image-20231212203238691"></p>
<blockquote>
<p>hash索引</p>
</blockquote>
<p>哈希索引就是采用一定的hash算法，将键值换算成新的hash值，映射到对应的槽位上，然后存储到hash表中。</p>
<p>如果两个(或多个)键值，映射到一个相同的槽位上，他们就产生了hash冲突，可以通过链表解决</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231212205233639.png" alt="image-20231212205233639"></p>
<ul>
<li><p>Hash索引只能用于等值(&#x3D;,in)比较，不支持范围查询</p>
</li>
<li><p>无法利用索引进行排序</p>
</li>
<li><p>查询效率高，通常只需要一次检索就可以了，效率通常高于B+tree索引</p>
</li>
<li><p>Memory存储引擎支持Hash索引；InnoDB中具有自适应Hash功能，Hash索引是存储引擎根据B+tree索引在指定条件下自动构建的</p>
</li>
<li><p>根据字段特性，索引分类</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>分类</th>
<th>含义</th>
<th>特点</th>
<th>关键字</th>
</tr>
</thead>
<tbody><tr>
<td>主键索引</td>
<td>针对表中主键创建的索引</td>
<td>默认自动创建，只能有一个</td>
<td>PRIMARY</td>
</tr>
<tr>
<td>唯一索引</td>
<td>避免同一个表中某数据列中的值重复</td>
<td>可以有多个</td>
<td>UNIQUE</td>
</tr>
<tr>
<td>常规索引</td>
<td>快速定位特定数据</td>
<td>可以有多个</td>
<td></td>
</tr>
<tr>
<td>全文索引</td>
<td>全文索引查找的是文本中的关键字，而不是比较索引中的值</td>
<td>可以有多个</td>
<td>FULLTEXT</td>
</tr>
</tbody></table>
<ul>
<li><p>根据字段个数，索引分为</p>
<ul>
<li>单列索引</li>
<li>联合索引</li>
</ul>
</li>
<li><p>根据存储形式，索引分为</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>分类</th>
<th>含义</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>聚簇索引(Clustered Index)</td>
<td>将数据和索引存储在一起，索引的叶子结点保存了行数据</td>
<td>必须有，且只有一个</td>
</tr>
<tr>
<td>二级索引(Secondary Index)</td>
<td>将数据与索引分开存储，索引结构的叶子结点关联的是对应的主键</td>
<td>可以存在多个</td>
</tr>
</tbody></table>
<p>聚簇索引选取规则：</p>
<ul>
<li>如果存在主键，主键索引就是聚簇索引</li>
<li>如果没有，则使用第一个唯一索引作为聚簇索引</li>
<li>如果都没有，则InnoDB会自动生成一个rowid作为隐藏的聚簇索引</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231212212141792.png" alt="image-20231212212141792"></p>
<h2 id="2-为什么选择b-树作为索引结构"><a href="#2-为什么选择b-树作为索引结构" class="headerlink" title="2.为什么选择b+树作为索引结构"></a>2.为什么选择b+树作为索引结构</h2><p>1. </p>
<h2 id="3-索引语法"><a href="#3-索引语法" class="headerlink" title="3.索引语法"></a>3.索引语法</h2><ul>
<li>创建索引：Innodb索引最大长度为767字节，但引入了超长索引；MyISAM索引的最大长度是 1000 字节</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 创建的时候可以只使用字段的一部分作为索引</span><br><span class="line"># <span class="keyword">CREATE</span> INDEX idx_prefix <span class="keyword">ON</span> your_table(your_column(<span class="number">10</span>));</span><br><span class="line"><span class="keyword">CREATE</span> [<span class="keyword">UNIQUE</span><span class="operator">|</span>FULLTEXT] index index_name <span class="keyword">ON</span> table_name (column1 [<span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>], column2 [<span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>], ...);</span><br><span class="line"># 用于指定索引的排序顺序。默认情况下，索引以升序（<span class="keyword">ASC</span>）排序</span><br><span class="line"></span><br><span class="line"># 可以直接在创建表的时候指定</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name (</span><br><span class="line">  column1 data_type,</span><br><span class="line">  column2 data_type,</span><br><span class="line">  ...,</span><br><span class="line">  INDEX index_name (column1 [<span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>], column2 [<span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>], ...)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li>查看索引</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> index <span class="keyword">from</span> table_name;</span><br></pre></td></tr></table></figure>

<ul>
<li>删除索引</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> index index_name <span class="keyword">ON</span> table_name;</span><br></pre></td></tr></table></figure>

<h2 id="4-性能优化"><a href="#4-性能优化" class="headerlink" title="4.性能优化"></a>4.性能优化</h2><ul>
<li>SQL执行频率</li>
</ul>
<p>Mysql客户端连接成功后，通过show [session|global] status命令可以提供服务器状态信息。通过如下指令，可以查看当前数据库执行SQL语句的频次</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Com_______&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>慢查询日志</li>
</ul>
<p>慢查询日志记录了所有执行时间超过指定参数(long_query_time,单位：s，默认10s)的所有SQL语句的日志。</p>
<p>MySQL的慢查询日志默认没有开启，需要在配置文件中配置：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 开启MySQL慢日志查询开关</span><br><span class="line">slow_query_log<span class="operator">=</span><span class="number">1</span></span><br><span class="line"># 设置慢日志的时间</span><br><span class="line">long_query_time<span class="operator">=</span><span class="number">2</span></span><br><span class="line"># 设置慢查询日志位置</span><br><span class="line">slow_query_log_file <span class="operator">=</span> <span class="operator">/</span>path<span class="operator">/</span><span class="keyword">to</span><span class="operator">/</span>your<span class="operator">/</span>slow_query.log</span><br></pre></td></tr></table></figure>

<p>慢查询日志文件默认位置在：&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;localhost-slow.log</p>
<h2 id="5-profile详情"><a href="#5-profile详情" class="headerlink" title="5.profile详情"></a>5.profile详情</h2><p>show profiles能够在做SQL优化时帮助我们了解时间都耗费到哪里了。通过have_profiling参数，能够查看MySQL是否支持profile操作</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@have_profiling</span>;</span><br></pre></td></tr></table></figure>

<p>默认profiling是关闭的，可以通过set语句在session&#x2F;global级别开启profiling：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> @<span class="variable">@profiling</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@profiling</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="operator">|</span>           <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="keyword">SET</span> profiling<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>开启后，就可以使用profile查看各sql的耗时了</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 查看每一条<span class="keyword">SQL</span>的耗时基本情况</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> profiles;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+------------+--------------------+</span></span><br><span class="line"><span class="operator">|</span> Query_ID <span class="operator">|</span> Duration   <span class="operator">|</span> Query              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+------------+--------------------+</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">1</span> <span class="operator">|</span> <span class="number">0.00064175</span> <span class="operator">|</span> <span class="keyword">select</span> @<span class="variable">@profiling</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+------------+--------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"># 查看指定query_id的<span class="keyword">SQL</span>语句各个阶段的耗时情况</span><br><span class="line"><span class="comment">/*SHOW PROFILE格式</span></span><br><span class="line"><span class="comment">SHOW PROFILE [type [, type] ... ]</span></span><br><span class="line"><span class="comment">    [FOR QUERY n]</span></span><br><span class="line"><span class="comment">    [LIMIT row_count [OFFSET offset]]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">type: &#123;</span></span><br><span class="line"><span class="comment">    ALL ：显示所有性能信息</span></span><br><span class="line"><span class="comment">  | BLOCK IO ：显示块IO操作次数</span></span><br><span class="line"><span class="comment">  | CONTEXT SWITCHES ：显示上下文切换次数，被动和主动</span></span><br><span class="line"><span class="comment">  | CPU ：显示用户CPU时间、系统CPU时间</span></span><br><span class="line"><span class="comment">  | IPC ：显示发送和接受的消息数量</span></span><br><span class="line"><span class="comment">  | MEMORY：截止到8.3版本还未实现</span></span><br><span class="line"><span class="comment">  | PAGE FAULTS ：显示页错误数量</span></span><br><span class="line"><span class="comment">  | SOURCE ：显示源码中的函数名称与位置</span></span><br><span class="line"><span class="comment">  | SWAPS ： 显示swap的次数</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"><span class="keyword">show</span> profile <span class="keyword">for</span> query query_id;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+----------+</span></span><br><span class="line"><span class="operator">|</span> Status               <span class="operator">|</span> Duration <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+----------+</span></span><br><span class="line"><span class="operator">|</span> starting             <span class="operator">|</span> <span class="number">0.000264</span> <span class="operator">|</span> # MySQL开始执行查询的阶段，表示查询的整体开始</span><br><span class="line"><span class="operator">|</span> checking permissions <span class="operator">|</span> <span class="number">0.000073</span> <span class="operator">|</span> # 检查执行查询的用户是否具有足够的权限</span><br><span class="line"><span class="operator">|</span> Opening tables       <span class="operator">|</span> <span class="number">0.000019</span> <span class="operator">|</span> # 打开涉及的表，准备执行查询之前的阶段</span><br><span class="line"><span class="operator">|</span> init                 <span class="operator">|</span> <span class="number">0.000033</span> <span class="operator">|</span> # 初始化查询的一些内部数据结构</span><br><span class="line"><span class="operator">|</span> optimizing           <span class="operator">|</span> <span class="number">0.000058</span> <span class="operator">|</span> # 优化器在这个阶段尝试找到最优的执行计划，选择最有效的方式来执行</span><br><span class="line"><span class="operator">|</span> executing            <span class="operator">|</span> <span class="number">0.000039</span> <span class="operator">|</span> # 执行查询的主要阶段，实际执行查询并返回结果</span><br><span class="line"><span class="operator">|</span> <span class="keyword">end</span>                  <span class="operator">|</span> <span class="number">0.000014</span> <span class="operator">|</span> # 查询执行结束的标志</span><br><span class="line"><span class="operator">|</span> query <span class="keyword">end</span>            <span class="operator">|</span> <span class="number">0.000012</span> <span class="operator">|</span> # 查询处理结束的标志，包括了<span class="keyword">end</span>阶段以及一些后续清理工作</span><br><span class="line"><span class="operator">|</span> closing tables       <span class="operator">|</span> <span class="number">0.000024</span> <span class="operator">|</span> # 关闭之前打开的表，释放相应的资源</span><br><span class="line"><span class="operator">|</span> freeing items        <span class="operator">|</span> <span class="number">0.000038</span> <span class="operator">|</span> # 释放在执行过程中分配的临时数据结构和资源</span><br><span class="line"><span class="operator">|</span> cleaning up          <span class="operator">|</span> <span class="number">0.000069</span> <span class="operator">|</span> # 清理和释放其他与查询执行相关的资源</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+----------+</span></span><br><span class="line"><span class="number">11</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查看指定query_id的<span class="keyword">SQL</span>语句CPU使用情况</span><br><span class="line"><span class="keyword">show</span> profile cpu <span class="keyword">for</span> query query_id;</span><br></pre></td></tr></table></figure>

<h2 id="6-explain执行计划"><a href="#6-explain执行计划" class="headerlink" title="6.explain执行计划"></a>6.explain执行计划</h2><p>EXPLAIN或者DESC命令获取MySQL如何执行SELECT语句的信息，包括在SELECT语句执行过程中表如何连接和连接的顺序，EXPLAIN的使用直接加在任何一条查询语句的前面即可。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql&gt; explain <span class="keyword">select</span>  * from  Weather\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           <span class="built_in">id</span>: 1</span><br><span class="line">  select_type: SIMPLE <span class="comment"># 查询类型</span></span><br><span class="line">        table: Weather <span class="comment"># 操作表</span></span><br><span class="line">   partitions: NULL    <span class="comment"># 表分区</span></span><br><span class="line">         <span class="built_in">type</span>: ALL     <span class="comment"># 连接类型</span></span><br><span class="line">possible_keys: NULL    <span class="comment"># 可能用到的索引</span></span><br><span class="line">          key: NULL    <span class="comment"># 实际用到的索引</span></span><br><span class="line">      key_len: NULL    <span class="comment"># 索引长度</span></span><br><span class="line">          ref: NULL    <span class="comment"># </span></span><br><span class="line">         rows: 4</span><br><span class="line">     filtered: 100.00</span><br><span class="line">        Extra: NULL</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span>, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>id：SELECT查询的序列号，表示查询中执行SELECT字句或者是操作表的顺序(id相同，执行顺序从上到下；id不同，值越大越先执行)</p>
</li>
<li><p>select_type：表示SELECT类型，常见的取值有SIMPLE(简单表，即不使用表连接或子查询)、PRIMARY(主查询，即外层的查询)、UNION(UNION中的第二个或后面的查询语句)、SUBQUERY(SELECT&#x2F;WHERE之后包含子查询)等</p>
</li>
<li><p>type：表示连接类型，性能由好到坏的连接类型为NULL、system、const、eq_ref、ref、range、index、all</p>
<ul>
<li>NULL：不访问任何表</li>
<li>system：访问系统表，这是最好的连接类型，表示表中只有一行记录（系统表），这是常量连接。这个类型通常出现在对 <code>sys</code> 等系统表的查询中。</li>
<li>const：根据主键或唯一索引访问。也是常量连接，但是与 <code>system</code> 不同的是，它用于比较与查询表的所有部分（或索引的所有部分）匹配的常量值。这个类型通常出现在对主键或唯一索引列进行等值查询的情况下。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>eq_ref：表示对于前表的每个行组合，都只有一行在后表中匹配。这是一个非常有效的连接类型，通常出现在使用主键或唯一索引进行连接的情况下。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders o <span class="keyword">JOIN</span> users u <span class="keyword">ON</span> o.user_id <span class="operator">=</span> u.id <span class="keyword">WHERE</span> u.id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>ref：该连接类型表示使用非唯一索引进行连接。这通常用于使用非唯一索引进行连接</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> user_id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>range：表示使用索引范围扫描，通常发生在使用 <code>BETWEEN</code>、<code>&lt;</code>、<code>&gt;</code>、<code>IN()</code> 这类范围条件的查询中。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="keyword">BETWEEN</span> <span class="number">20</span> <span class="keyword">AND</span> <span class="number">30</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>index：表示对整个索引进行扫描，通常在没有找到更好的连接类型时使用。这可能发生在查询不会返回大量数据的情况下，以避免排序操作。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username <span class="keyword">LIKE</span> <span class="string">&#x27;A%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>all：全表扫描</li>
</ul>
</li>
<li><p>possible_key：显示可能应用在这张表上的索引，一个或多个</p>
</li>
<li><p>key：实际使用呢的索引，如果为NULL，则没有使用索引</p>
</li>
<li><p>key_len：表示索引中使用的字节数，该值为索引字段最大可能长度，并非实际使用长度，在不损失精确性的前提下，长度越短越好。</p>
</li>
<li><p>rows：MySQL认为必须要执行查询的行数，在Innodb引擎表中，是一个估计值，可能并不总是准确的。</p>
</li>
<li><p>filtered：表示返回结果的行数占需读取行数的百分比，filtered的值越大越好</p>
</li>
<li><p>Extra：额外的信息</p>
</li>
</ul>
<h2 id="7-索引的使用"><a href="#7-索引的使用" class="headerlink" title="7.索引的使用"></a>7.索引的使用</h2><ul>
<li>最左前缀法则</li>
</ul>
<p>如果索引联合了多列，要遵守最左前缀法则。最左前缀法则指的是查询从索引的最左列开始，并且不跳过索引中间的列。如果跳过某一列，索引将部分失效(后面的字段索引失效)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># abc为联合索引</span><br><span class="line">explain select * from idx_a where a=1  or c=1;</span><br><span class="line">explain select * from idx_a where a=1  and c=1;</span><br></pre></td></tr></table></figure>

<ul>
<li>范围查询</li>
</ul>
<p>联合索引中，出现范围查询(&lt;,&gt;)，范围查询右侧的列索引失效</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> idx_a <span class="keyword">where</span> a<span class="operator">=</span><span class="number">1</span>  <span class="keyword">and</span> b <span class="operator">&gt;</span><span class="number">0</span> <span class="keyword">and</span> c<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"># c索引失效</span><br><span class="line"># 所以尽量使用<span class="operator">&lt;=</span>或<span class="operator">&gt;=</span></span><br></pre></td></tr></table></figure>

<ul>
<li>索引列运算</li>
</ul>
<p>不要在索引列上进行运算或函数操作，索引将失效</p>
<ul>
<li>字符串不加引号</li>
</ul>
<p>字符串类型字段使用时，不加引号，索引将失效</p>
<ul>
<li>模糊查询</li>
</ul>
<p>如果仅仅是尾部模糊匹配，索引不会失效。如果是头部模糊匹配，索引失效。</p>
<ul>
<li>or连接条件</li>
</ul>
<p>用or分割开的条件，如果or前的条件中的列有索引，而后面的列中没有索引，那么涉及的索引都不会被用到。<strong>使用or时，两侧必须都有索引。</strong></p>
<ul>
<li>数据分布影响</li>
</ul>
<p>如果Mysql评估使用索引比全表慢，则不使用索引。</p>
<ul>
<li>SQL提示</li>
</ul>
<p>SQL提示，是优化数据库的一个重要手段，简单来说，就是在SQL语句中加入一些认为的提示来达到优化操作的目的。MySQL在选择使用那个索引的时候，一般会选择基数高的索引，但有的时候我们可以自己指定要使用的索引。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># use index</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_use use index(idx_user_pro) <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"># ignore index</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_use ignore index(idx_user_pro) <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"># force index</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_use force index(idx_user_pro) <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>覆盖索引</li>
</ul>
<p>尽量使用覆盖索引(查询使用了索引，并且需要返回的列，在该索引中已经全部能够找到)，减少select <em>。*<em>简单来说，就是查找的数据尽量在一个b+tree上面，而不用回表到聚簇索引上进行二次查找。</em></em></p>
<ul>
<li>前缀索引</li>
</ul>
<p>当字段类型为字符串(varchar,text)时，有时候需要索引很长的字符串，这会让索引变的很大，查询时，浪费大量的磁盘IO，影响查询效率。此时可以只将字符串的一部分前缀，建立索引，这样可以大大节约索引空间，从而提高索引效率。但也有缺点，mysqsl无法对前缀索引做<code>order by</code>或<code>group by</code></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_xxx <span class="keyword">on</span> table_name(<span class="keyword">column</span>(n));</span><br></pre></td></tr></table></figure>

<p>前缀长度：可以根据索引的选择性来决定，而选择性是指不重复的索引值(基数)和数据表的记录总数的比值，索引选择性越高则查询效率越高，唯一索引的选择性是1，这是最好的索引选择性，性能也是最好的。<strong>所以选择前缀长度要尽可能短，且选择性高的</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 选择性</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> <span class="built_in">substring</span>(a,<span class="number">1</span>,<span class="number">6</span>))<span class="operator">/</span><span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> idx_a</span><br></pre></td></tr></table></figure>

<ul>
<li>单列索引和联合索引</li>
</ul>
<p>在业务场景中，如果存在多个查询条件，考虑针对于查询字段建立索引时，建议建立联合索引，而非单列索引</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231216164831236.png" alt="image-20231216164831236"></p>
<ul>
<li>索引下推</li>
</ul>
<p>在使用联合索引查询时，如<code>SELECT * FROM user WHERE name = &#39;Alice&#39; AND age = 20;</code>name和age是一个联合索引，如果没有索引下推，那么存储引擎通过回表去查找第一条name&#x3D;’Alice’的数据，然后让server层判断age是否符合条件，然后根据<code>next_record</code>属性去查找下一条记录。如果有索引下推，那么在存储引擎层返回数据的时候会一起判断age是否符合条件才去回表，而不是回表之后让server层去判断。</p>
<p>简单来说没有索引下推的话，存储引擎层只会判断联合索引的第一个索引然后回表全部数据让server层去判断剩下的索引条件；有了索引下推之后，会在存储引擎层判断完所有的索引条件再去回表，减少回表次数，提升查询效率。</p>
<h2 id="8-索引涉及原则"><a href="#8-索引涉及原则" class="headerlink" title="8.索引涉及原则"></a>8.索引涉及原则</h2><ol>
<li>针对数据量较大，且查询毕竟频繁的表建立索引</li>
<li>针对于常作为查询条件、排序、分组操作的字段建立索引</li>
<li>简历选择区分度高的列作为索引，尽量建立唯一索引，区分区越高，使用索引的效率越高</li>
<li>如果是字符串类型的字段，字段的长度较长，可以针对于字段的特点，建立前缀索引</li>
<li>尽量使用联合索引，减少单列索引，查询时，联合索引很多时候可以覆盖索引，节省内存空间，避免回表，提高查询效率</li>
<li>要控制索引的数量，索引并不是多多益善，索引越多，维护索引结构的代价也就越大，会影响增删改的效率</li>
<li>如果索引列不能存储NULL值，请在创建表时NOT NULL约束它。当优化器知道每列索引是否包含NULL值时，它可以更好地确定那个索引最有效的用于查询</li>
</ol>
<h1 id="10-SQL优化"><a href="#10-SQL优化" class="headerlink" title="10.SQL优化"></a>10.SQL优化</h1><p>一般来说，有两种优化查询技术，即CBO(Cost-Based Optimization)基于成本的优化和RBO(Rule-Based Optimization)基于规则的优化。而MySQL优化器使用的是CBO，可以使用<code>show status like &#39;last_query_cost&#39;;</code>语句来查询最近一条查询的成本。</p>
<h2 id="1-插入数据优化"><a href="#1-插入数据优化" class="headerlink" title="1.插入数据优化"></a>1.插入数据优化</h2><ul>
<li><p>insert优化</p>
<ul>
<li>推荐使用批量插入，减少连接开销，最好一次插入500-5000条记录</li>
<li>手动提交事务，可以将大批量插入分为几条插入语句</li>
<li>主键顺序插入</li>
<li>大批量插入数据</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231216175249955.png" alt="image-20231216175249955"></p>
</li>
</ul>
<h2 id="2-主键插入"><a href="#2-主键插入" class="headerlink" title="2.主键插入"></a>2.主键插入</h2><ul>
<li>数据组织方式</li>
</ul>
<p>在Innodb存储引擎中，表数据都是根据主键顺序组织存放的，这种存储方式的表称为<strong>索引组织表</strong>(index organized table <strong>IOT</strong>)</p>
<ul>
<li>页分裂</li>
</ul>
<p>页可以为空，也可以填充一半，也可以填充100%。每个页包含了2-N行数据(如果一行数据过大会行溢出)，根据主键顺序排列。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231216181006834.png" alt="image-20231216181006834"></p>
<p>当主键乱序插入时，因为叶子结点是按顺序排列的，所以出现上面这种情况时，第一页剩余空间不足以插入50这一条数据，所以MySQL会把第一页的50%的数据分到新的一页，再把50按顺序插入。插入完成后还需要对页的顺序指针进行重排。<strong>这就是页分裂现象</strong>，所以主键顺序插入性能要高于乱序插入。</p>
<ul>
<li>页合并</li>
</ul>
<p>当删除一行记录时，实际上记录并没有被物理删除，只是记录被标记为删除并且它的空间变得允许被其他记录声明使用。</p>
<p>当页中删除的记录达到MEGRE_THRESHOLD(默认为页的50%)，Innodb会开始寻找最靠近的页(前或后)看看是否可以将两个页合并以优化空间使用。<code>MEGRE_THRESHOLD</code>可以自行配置</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t1 (</span><br><span class="line">   id <span class="type">INT</span>,</span><br><span class="line">  KEY id_index (id) COMMENT <span class="string">&#x27;MERGE_THRESHOLD=40&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> INFORMATION_SCHEMA.INNODB_INDEXES <span class="keyword">WHERE</span> NAME<span class="operator">=</span><span class="string">&#x27;id_index&#x27;</span> ;</span><br></pre></td></tr></table></figure>

<ul>
<li>主键设计原则<ul>
<li>满足业务需求的情况下，尽量减低主键的长度</li>
<li>插入数据时，尽量选择顺序插入，选择使用AUTO_INCREMENT自增主键</li>
<li>尽量不要使用UUID做主键或者是其他自然主键，如身份证</li>
<li>尽量减少对主键的修改</li>
</ul>
</li>
</ul>
<h2 id="3-order-by优化"><a href="#3-order-by优化" class="headerlink" title="3.order by优化"></a>3.order by优化</h2><ol>
<li>Using filesort：通过表的索引或全表扫描，读取满足条件的数据行，然后在排序缓冲区<code>sort buffer</code>中完成排序操作，所有不是通过索引直接返回排序结果的排序都叫FileSort排序</li>
<li>Using index：通过有序索引顺序扫描直接返回有序数据，这种情况即为<code>using index</code>，不需要额外排序，操作效率高</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 在表中有一个abc联合索引</span><br><span class="line"># 不符合最左前缀原则，所以会使用<span class="keyword">using</span> FileSort</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> idx_a <span class="keyword">order</span> <span class="keyword">by</span> b,a;</span><br></pre></td></tr></table></figure>

<ul>
<li>根据排序字段建立合适的索引，多字段排序时，也遵循最左前缀法则</li>
<li>尽量使用覆盖索引</li>
<li>多字段排序，一个升序一个降序，此时需要注意联合索引在创建时的规则(ASC&#x2F;DESC)</li>
<li>如果不可避免的出现FileSort，大数据排序时，可以适当增大排序缓冲区大小<code>sort_buffer_size</code>(默认256K)</li>
<li>当排序的数据大小超过<code>sort_buffer_size</code>后，mysql会选择使用FileSort，即使使用索引。</li>
</ul>
<h2 id="4-group-by优化"><a href="#4-group-by优化" class="headerlink" title="4.group by优化"></a>4.group by优化</h2><ul>
<li>Using index：使用索引</li>
<li>Using temporary：使用临时表，效率低</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 使用<span class="keyword">group</span> <span class="keyword">by</span>也遵循最左原则</span><br><span class="line"># 导致部分索引失效</span><br><span class="line">explain <span class="keyword">select</span> a,c,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> idx_a <span class="keyword">group</span> <span class="keyword">by</span> a,c;</span><br><span class="line"></span><br><span class="line"># 可以使用过滤来确保不使用临时表</span><br><span class="line">explain <span class="keyword">select</span> a,c,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> idx_a <span class="keyword">where</span> b<span class="operator">=</span><span class="number">1</span> <span class="keyword">group</span> <span class="keyword">by</span> a,c;</span><br></pre></td></tr></table></figure>

<p><strong>所以在分组时尽量使用覆盖索引和满足最左原则</strong></p>
<h2 id="5-limit优化"><a href="#5-limit优化" class="headerlink" title="5.limit优化"></a>5.limit优化</h2><p>在大数据进行分页时，数据所在位置越靠后，分页速度越慢</p>
<p>一个常见的问题是<code>limit 20000000,10</code>，此时Mysql需要排序前20000010记录，仅仅返回20000000-20000010的记录，其他记录丢弃，查询排序的代价非常大</p>
<p>官方推荐优化：使用覆盖索引加子查询形式进行优化</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 目前MySQL不支持在子查询中出现limit</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> idx_a <span class="keyword">where</span> a <span class="keyword">in</span> (<span class="keyword">select</span> a <span class="keyword">from</span> idx_a limit <span class="number">2000000</span>,<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"># 可以使用连接来实现</span><br><span class="line"><span class="keyword">select</span> s.<span class="operator">*</span> <span class="keyword">from</span> idx_a s ,(<span class="keyword">select</span> a <span class="keyword">from</span> idx_a limit <span class="number">2000000</span>,<span class="number">10</span>) f <span class="keyword">where</span> s.a<span class="operator">=</span>f.a;</span><br></pre></td></tr></table></figure>

<h2 id="6-count优化"><a href="#6-count优化" class="headerlink" title="6.count优化"></a>6.count优化</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> tb_user;</span><br></pre></td></tr></table></figure>

<ul>
<li>MyISAM引擎把一个表的总行数存在磁盘上，因此执行count(*)的时候会直接返回这个数，效率很高；</li>
<li>Innodb引擎执行count(*)的时候，需要把数据一行行从引擎里面读出来，然后累计计数</li>
<li>优化思路：自己计数</li>
</ul>
<blockquote>
<p>count几种用法</p>
</blockquote>
<ul>
<li>count是一个聚合函数，对于返回的结果集，一行行判断，如果不是null，累计值加1，否则不加，最后返回累计值</li>
<li>用法:count(*)&#x2F;count(1)&#x2F;count(主键)&#x2F;count(字段)</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/af711033aa3423330d3a4bc6baeb9532.png" alt="图片"></p>
<p><strong>count(*)和count(1)有会先选择二级索引，因为二级索引比聚簇索引要小； 如果使用主键字段的话，会读取记录的值，但使用前两种方法不用</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231216202102664.png" alt="image-20231216202102664"></p>
<h2 id="7-update优化"><a href="#7-update优化" class="headerlink" title="7.update优化"></a>7.update优化</h2><p><strong>Innodb的行锁是针对索引加的锁，不是针对记录加的锁，并且该索引不能失效，否则会从行锁升级为表锁</strong></p>
<h1 id="11-视图"><a href="#11-视图" class="headerlink" title="11.视图"></a>11.视图</h1><p>视图(view)是一种虚拟存在的表。视图中的数据并不在数据库中实际存在，行和列数据来自定义视图的查询中使用的表，并且是在使用视图时动态生成的。</p>
<p>通俗的说，视图只保存了查询了SQL逻辑，不保存查询结果。所以我们在创建视图的时候，主要的工作就落在创建这条SQL查询语句上。</p>
<ul>
<li>创建</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> [<span class="keyword">OR</span> REPLACE] <span class="keyword">VIEW</span> 视图名称[(列名列表)] <span class="keyword">AS</span> <span class="keyword">SELECT</span>语句 [<span class="keyword">WITH</span>[<span class="keyword">CASCADED</span><span class="operator">|</span><span class="keyword">LOCAL</span>] <span class="keyword">CHECK</span> OPTION]</span><br><span class="line"># 实例</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> tt <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> idx_a <span class="keyword">where</span> a<span class="operator">&lt;</span><span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>查询</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 查看创建视图语句</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">CREATE</span> <span class="keyword">view</span> 视图名称;</span><br><span class="line"># 查看视图数据</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">FROM</span> 视图名称...;</span><br></pre></td></tr></table></figure>

<ul>
<li>修改</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 方式一</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">VIEW</span> 视图名称[(列名列表)] <span class="keyword">AS</span> <span class="keyword">SELECT</span>语句 [<span class="keyword">WITH</span>[<span class="keyword">CASCADED</span><span class="operator">|</span><span class="keyword">LOCAL</span>] <span class="keyword">CHECK</span>;</span><br><span class="line"># 方式二</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">VIEW</span> 视图名称[(列名列表)] <span class="keyword">AS</span> <span class="keyword">SELECT</span>语句 [<span class="keyword">WITH</span>[<span class="keyword">CASCADED</span><span class="operator">|</span><span class="keyword">LOCAL</span>] <span class="keyword">CHECK</span>;               </span><br></pre></td></tr></table></figure>

<ul>
<li>删除</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">view</span> [if <span class="keyword">exists</span>] 视图名称[视图名称....]</span><br></pre></td></tr></table></figure>

<h2 id="1-检查选项"><a href="#1-检查选项" class="headerlink" title="1.检查选项"></a>1.检查选项</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231216212738879.png" alt="image-20231216212738879"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231216213244112.png" alt="image-20231216213244112"></p>
<h2 id="2-视图更新"><a href="#2-视图更新" class="headerlink" title="2.视图更新"></a>2.视图更新</h2><p>要使视图可以更新，视图中的行与基础表中的行之间必须存在一对一的关系。如果视图包含以下任何一项，则该视图不可更新：</p>
<ol>
<li>聚合函数或窗口函数</li>
<li>DISTINCT</li>
<li>GROUP BY</li>
<li>HAVING</li>
<li>UNION或UNION ALL</li>
</ol>
<blockquote>
<p>作用</p>
</blockquote>
<ul>
<li>简单：视图不仅可以简化用户对数据的理解，也可以简化他们的操作。那些被经常使用的查询可以被定义为视图，从而使得用户不必为以后得操作每次指定全部的条件。</li>
<li>安全：数据库可以授权，但不能授权到数据库特定行和特定列上。通过视图用户只能查询和修改他们所能看到的数据</li>
<li>数据独立：视图可以帮助用户屏蔽真是表结构变化带来的影响。就算修改了数据库中的字段名，但可以在创建视图的时候指定别名来使用户无感知</li>
</ul>
<h1 id="12-存储过程"><a href="#12-存储过程" class="headerlink" title="12.存储过程"></a>12.存储过程</h1><p>存储过程是事先经过编译并存储在数据库中的一段SQL语句的集合，调用存储过程可以简化应用开发人员的很多工作，减少数据在数据库和应用服务器之间的传输，对于提高数据处理的效率是有好处的</p>
<p>存储过程思想很简单，就是数据库SQL语言层面的代码封装和重用</p>
<ul>
<li><p>特点</p>
<ul>
<li>封装，复用</li>
<li>可以接受参数，也可以返回数据</li>
<li>减少网络交互，效率提升</li>
</ul>
</li>
<li><p>创建</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> PROCEDUER 存储过程名称([参数列表])</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="comment">---SQL语句</span></span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="comment">/* 在命令行创建存储过程可能会出错，因为监测到;自动结束sql语句</span></span><br><span class="line"><span class="comment">   所以要使用delimiter $$ 指定其他分隔符   */</span></span><br></pre></td></tr></table></figure>

<ul>
<li>调用</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CALL</span> 名称([参数]);</span><br></pre></td></tr></table></figure>

<ul>
<li>查看</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.ROUTINES <span class="keyword">where</span> ROUTINE_SCHEMA<span class="operator">=</span><span class="string">&#x27;xxxx&#x27;</span>; # 查询指定数据库的存储过程及状态信息</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> 存储过程名称;  # 查询存储过程定义</span><br></pre></td></tr></table></figure>

<ul>
<li>删除</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">procedure</span> [if <span class="keyword">exists</span>] 存储过程名称;</span><br></pre></td></tr></table></figure>

<h2 id="1-变量"><a href="#1-变量" class="headerlink" title="1.变量"></a>1.变量</h2><ul>
<li>系统变量是MySQL服务器提供的，不是用户定义的，属于服务器层面。分为全局变量(GLOBAL)、会话变量(SESSION)</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231216220838470.png" alt="image-20231216220838470"></p>
<ul>
<li>用户自定义变量</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231216220940268.png" alt="image-20231216220940268"></p>
<ul>
<li>用户自定义变量</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231216221645176.png" alt="image-20231216221645176"></p>
<h2 id="2-IF条件判断"><a href="#2-IF条件判断" class="headerlink" title="2.IF条件判断"></a>2.IF条件判断</h2><ul>
<li>语法</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">IF 条件<span class="number">1</span> <span class="keyword">THEN</span></span><br><span class="line">...</span><br><span class="line">ELSEIF 条件<span class="number">2</span> <span class="keyword">THEN</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">ELSE</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">END</span> IF;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p1()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">declare</span> score <span class="type">int</span> <span class="keyword">default</span> <span class="number">58</span>;</span><br><span class="line">    <span class="keyword">declare</span> <span class="keyword">result</span> <span class="type">varchar</span>(<span class="number">10</span>);</span><br><span class="line">    if score <span class="operator">&gt;=</span> <span class="number">85</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">set</span> <span class="keyword">result</span>:<span class="operator">=</span>&quot;优秀&quot;;</span><br><span class="line">    elseif score <span class="operator">&gt;=</span> <span class="number">60</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">set</span> <span class="keyword">result</span>:<span class="operator">=</span>&quot;合格&quot;;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">set</span> <span class="keyword">result</span>:<span class="operator">=</span>&quot;不合格&quot;;</span><br><span class="line">    <span class="keyword">end</span> if;</span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">result</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">call</span> p1();</span><br></pre></td></tr></table></figure>

<h2 id="3-参数"><a href="#3-参数" class="headerlink" title="3.参数"></a>3.参数</h2><ul>
<li>类型</li>
</ul>
<table>
<thead>
<tr>
<th>类型</th>
<th>含义</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>IN</td>
<td>该类参数作为输入，也就是需要调用时传入值</td>
<td>默认</td>
</tr>
<tr>
<td>OUT</td>
<td>该类参数作为输出，也就是该参数可以作为返回值</td>
<td></td>
</tr>
<tr>
<td>INOUT</td>
<td>既可以作为输入参数，也可以作为输出参数</td>
<td></td>
</tr>
</tbody></table>
<ul>
<li>定义</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> PROCEDUER 存储过程名称([<span class="keyword">IN</span><span class="operator">/</span><span class="keyword">OUT</span><span class="operator">/</span><span class="keyword">INOUT</span> 参数名 参数类型])</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="comment">---SQL语句</span></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># <span class="keyword">in</span><span class="operator">/</span><span class="keyword">out</span>示例</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p1(<span class="keyword">in</span> score <span class="type">int</span> ,<span class="keyword">out</span> <span class="keyword">result</span> <span class="type">varchar</span>(<span class="number">10</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    if score <span class="operator">&gt;=</span> <span class="number">85</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">set</span> <span class="keyword">result</span>:<span class="operator">=</span>&quot;优秀&quot;;</span><br><span class="line">    elseif score <span class="operator">&gt;=</span> <span class="number">60</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">set</span> <span class="keyword">result</span>:<span class="operator">=</span>&quot;合格&quot;;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">set</span> <span class="keyword">result</span>:<span class="operator">=</span>&quot;不合格&quot;;</span><br><span class="line">    <span class="keyword">end</span> if;</span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">result</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">call</span> p1(<span class="number">58</span>,<span class="variable">@result</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@result</span>;</span><br><span class="line"></span><br><span class="line"># <span class="keyword">inout</span>示例</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p2(<span class="keyword">inout</span> score <span class="keyword">double</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">set</span> score:<span class="operator">=</span>score<span class="operator">*</span><span class="number">0.5</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@score</span><span class="operator">=</span><span class="number">50</span>;</span><br><span class="line"><span class="keyword">call</span> p2(<span class="variable">@score</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@score</span>;</span><br></pre></td></tr></table></figure>

<h2 id="4-case语句"><a href="#4-case语句" class="headerlink" title="4.case语句"></a>4.case语句</h2><ul>
<li>语法</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># <span class="number">1</span></span><br><span class="line"><span class="keyword">CASE</span> case_value</span><br><span class="line">	<span class="keyword">WHEN</span> when_value1 <span class="keyword">THEN</span> statement_list</span><br><span class="line">	<span class="keyword">WHEN</span> when_value2 <span class="keyword">THEN</span> statement_list2..</span><br><span class="line">	[<span class="keyword">ELSE</span> statement_list]</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">CASE</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">2</span></span><br><span class="line"><span class="keyword">CASE</span></span><br><span class="line">	<span class="keyword">WHEN</span> search_condition1 <span class="keyword">THEN</span> statement_list</span><br><span class="line">	<span class="keyword">WHEN</span> search_condition2 <span class="keyword">THEN</span> statement_list2..</span><br><span class="line">	[<span class="keyword">ELSE</span> statement_list]</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">CASE</span>;</span><br></pre></td></tr></table></figure>

<h2 id="5-循环"><a href="#5-循环" class="headerlink" title="5.循环"></a>5.循环</h2><ul>
<li>while</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 判断<span class="keyword">condition</span>为<span class="literal">TRUE</span>执行</span><br><span class="line">WHILE <span class="keyword">condition</span> DO</span><br><span class="line"><span class="keyword">SQL</span></span><br><span class="line"><span class="keyword">end</span> WHILE</span><br></pre></td></tr></table></figure>

<ul>
<li>repeat</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 满足条件时退出循环</span><br><span class="line">REPEAT</span><br><span class="line"><span class="keyword">SQL</span></span><br><span class="line">UNTIL 条件</span><br><span class="line"><span class="keyword">END</span> REOEAT;</span><br></pre></td></tr></table></figure>

<ul>
<li>loop</li>
</ul>
<p>LOOP实现简单的循环，如果不在SQL逻辑中增加退出循环的条件，可以用来使用简单的死循环。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">[begin_label:] LOOP</span><br><span class="line"><span class="keyword">sql</span></span><br><span class="line"><span class="keyword">END</span> LOOP [end_label]</span><br><span class="line"># LEAVE label:相当于break</span><br><span class="line"># ITERATE label:相当于continue</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p3(<span class="keyword">in</span> n <span class="type">int</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">declare</span> sum <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">    l:loop</span><br><span class="line">    <span class="keyword">set</span> sum:<span class="operator">=</span>sum<span class="operator">+</span>n;</span><br><span class="line">    <span class="keyword">set</span> n:<span class="operator">=</span>n<span class="number">-1</span>;</span><br><span class="line">    if n<span class="operator">&lt;=</span><span class="number">0</span> <span class="keyword">THEN</span></span><br><span class="line">        leave l;</span><br><span class="line">    <span class="keyword">end</span> if;</span><br><span class="line">    <span class="keyword">end</span> loop l;</span><br><span class="line">    <span class="keyword">select</span> sum;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> p3;</span><br><span class="line"><span class="keyword">call</span> p3(<span class="number">100</span>);</span><br></pre></td></tr></table></figure>



<h2 id="6-游标"><a href="#6-游标" class="headerlink" title="6.游标"></a>6.游标</h2><p>在之前的用户自定义变量都只能接收单个值，不能接收多行多列数据，而游标可以；</p>
<p>游标(cursor)是用来存储查询结果集的数据类型，在存储过程和函数中可以使用游标对结果集进行循环的处理。游标的使用包括游标的声明、OPEN、FETCH和CLOSE</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 游标声明</span><br><span class="line"># 游标声明在普通变量之后</span><br><span class="line"><span class="keyword">DECLARE</span> 游标名称 <span class="keyword">CURSOR</span> <span class="keyword">FOR</span> 查询语句;</span><br><span class="line"># 打开游标</span><br><span class="line"><span class="keyword">OPEN</span> 游标名称;</span><br><span class="line"># 获取游标记录</span><br><span class="line"><span class="keyword">FETCH</span> 游标名称 <span class="keyword">INTO</span> 变量,[变量..];</span><br><span class="line"># 关闭游标</span><br><span class="line"><span class="keyword">CLOSE</span> 游标名称;</span><br></pre></td></tr></table></figure>

<ul>
<li>条件处理程序</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231216231657584.png" alt="image-20231216231657584"></p>
<h1 id="13-存储函数"><a href="#13-存储函数" class="headerlink" title="13.存储函数"></a>13.存储函数</h1><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231216233506682.png" alt="image-20231216233506682"></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> delimiter <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">function</span> fun() <span class="keyword">returns</span> <span class="type">int</span> <span class="keyword">DETERMINISTIC</span> <span class="keyword">BEGIN</span> <span class="keyword">RETURN</span> <span class="number">2</span>; <span class="keyword">END</span><span class="operator">/</span><span class="operator">/</span></span><br><span class="line">mysql<span class="operator">&gt;</span> delimiter ;</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> fun();</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+</span></span><br><span class="line"><span class="operator">|</span> fun() <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+</span></span><br><span class="line"><span class="operator">|</span>     <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> <span class="variable">@a</span><span class="operator">=</span>fun();</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="variable">@a</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span> <span class="variable">@a</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br></pre></td></tr></table></figure>



<h1 id="14-触发器"><a href="#14-触发器" class="headerlink" title="14.触发器"></a>14.触发器</h1><p>触发器是与表有关的数据库对象，指正在insert&#x2F;update&#x2F;delete之前或之后，触发并执行触发器中定义的SQL语句集合。触发器的这种特性可以协助应用在数据库端确保数据的完整性，日志记录，数据校验等操作。</p>
<p>使用别名OLD和NEW来引用触发器中发生变化的记录内容，这与其他数据库是相似的。现在触发器还只支持行级触发，不支持语句级触发。</p>
<table>
<thead>
<tr>
<th>触发器类型</th>
<th>NEW和OLD</th>
</tr>
</thead>
<tbody><tr>
<td>INSERT类型</td>
<td>NEW表示将要或已经新增的数据</td>
</tr>
<tr>
<td>UPDATE类型</td>
<td>OLD表示修改之前的数据，NEW表示将要或已经修改后的数据</td>
</tr>
<tr>
<td>DELETE类型</td>
<td>OLD表示将要或者已经删除的数据</td>
</tr>
</tbody></table>
<ul>
<li>定义</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> trigger_name</span><br><span class="line">BEFORE<span class="operator">/</span>AFTER <span class="keyword">INSERT</span><span class="operator">/</span><span class="keyword">UPDATE</span><span class="operator">/</span><span class="keyword">DELETE</span></span><br><span class="line"><span class="keyword">on</span> table_name FRO <span class="keyword">EACH</span> <span class="type">ROW</span> <span class="comment">--行级触发器</span></span><br><span class="line"><span class="keyword">BEGIN</span> </span><br><span class="line">trigger_stmt;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>查看</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> TRIGGERS;</span><br></pre></td></tr></table></figure>

<ul>
<li>删除</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> [schema_name..] trigger_name; # 没有指定数据库，则默认当前数据库</span><br></pre></td></tr></table></figure>

<ul>
<li>示例</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> tri</span><br><span class="line">    after <span class="keyword">insert</span></span><br><span class="line">    <span class="keyword">on</span> Employee <span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span></span><br><span class="line">    <span class="keyword">BEGIN</span></span><br><span class="line">        <span class="keyword">insert</span> <span class="keyword">into</span> t2 <span class="keyword">values</span> (new.name);</span><br><span class="line">    <span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>



<h1 id="15-锁"><a href="#15-锁" class="headerlink" title="15.锁"></a>15.锁</h1><p>锁是计算机协调多个进行或线程并发访问某一资源的基址。在数据库中，除传统的计算资源(CPU、RAM、I&#x2F;O)的争用以外，数据也是一种供许多用户共享的资源。如何保证数据并发访问的一致性、有效性是所有数据库必须解决的一个问题，锁冲突也是影响数据库并发访问性能的一个重要因素。从这个角度来说，锁对数据库而言显得尤其重要，也更加复杂。</p>
<p>MySQL中的锁，按照粒度分，分为以下三类：</p>
<ol>
<li>全局锁：锁定数据库中的所有表</li>
<li>表级锁：每次操作锁住整张表</li>
<li>行级锁：每次操作锁住对应的行数据</li>
</ol>
<h2 id="1-全局锁"><a href="#1-全局锁" class="headerlink" title="1.全局锁"></a>1.全局锁</h2><p>全局锁就是对整个数据库实例加锁，加锁后整个实例就处于只读状态，后续的DML的写语句，DDL语句，已经更新操作的事务提交语句都将被阻塞。</p>
<p>典型的使用场景是做全库的逻辑备份，对所有表进行锁定，从而获取一致性视图，保证数据的完整性。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 加锁</span><br><span class="line">flush tables <span class="keyword">with</span> read lock；</span><br><span class="line"># 解锁</span><br><span class="line">unlock tables；</span><br><span class="line"># 备份test库</span><br><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>proot test <span class="operator">&gt;</span> test.sql</span><br></pre></td></tr></table></figure>

<ul>
<li>在数据库中加全局锁，可能存在以下问题<ul>
<li>如果在主库上备份，那么在备份期间都不能执行更新，业务基本上就得停摆</li>
<li>如果在从库上备份，那么备份期间从库不能执行主库同步过来的二进制日志，会导致主从延迟</li>
</ul>
</li>
<li>在Innodb引擎中，可以在备份时加上<code>--single-transaction</code>参数来完成不加锁的一致性数据备份。</li>
</ul>
<h2 id="2-表级锁"><a href="#2-表级锁" class="headerlink" title="2.表级锁"></a>2.表级锁</h2><p>表级锁，每次操作锁住整个表。锁粒度大，发生锁冲突的概率最高，并发度最低。应用在MyISAM、Innodb、BDB等存储引擎中。</p>
<p>表级锁主要分为以下三类：</p>
<ul>
<li>表锁</li>
<li>元数据锁(meta data lock,DML)</li>
<li>意向锁</li>
</ul>
<blockquote>
<p>表锁</p>
</blockquote>
<ul>
<li><p>表锁分为</p>
<ul>
<li>表共享读锁（read lock）</li>
<li>表独占写锁（write lock）</li>
</ul>
</li>
<li><p>语法</p>
<ul>
<li>加锁：lock tables 表名… read&#x2F;write</li>
<li>释放锁：unlock tables &#x2F; 客户端断开连接</li>
</ul>
</li>
</ul>
<p><strong>读锁不会阻塞其他客户端的读，但是会阻塞写。写锁两者都会</strong></p>
<hr>
<blockquote>
<p>元数据锁</p>
</blockquote>
<p>MDL加锁过程是系统自动控制，无需显式使用，在访问一张表的时候会自动加上。MDL锁主要作用是维护表元数据的数据一致性，在表上有活动事务时，不可以对元数据进行写入操作。<strong>为了避免DML与DDL冲突，保证读写的正确性</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231217203455641.png" alt="image-20231217203455641"></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 查看元数据锁信息</span><br><span class="line"><span class="keyword">select</span> OBJECT_TYPE,OBJECT_SCHEMA,OBJECT_NAME,LOCK_TYPE,LOCK_DURATION <span class="keyword">from</span> performance_schema.metadata_locks;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>意向锁</p>
</blockquote>
<p>为了避免DML在执行时，加的行锁和表锁的冲突，在Innodb中引入了意向锁，使得表锁不用检查每行数据是否加锁，使用意向锁来减少表锁的检查。</p>
<p>如果没有意向锁，在一个事物想对表加表锁的时候，需要一行行数据去检查是否加了行锁及行锁的类型是否兼容，性能极低。</p>
<ul>
<li>语法<ul>
<li>意向共享锁(IS)：由语句SELECT…lock in share mode添加<ul>
<li>与表read兼容，与表write互斥</li>
</ul>
</li>
<li>意向排他锁(IX)：由insert、update、delete、select…for update添加<ul>
<li>与表read和writr互斥。意向锁之间不会互斥</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 查看意向锁及行锁的加锁情况</span><br><span class="line"><span class="keyword">select</span> OBJECT_SCHEMA,OBJECT_NAME,INDEX_NAME,LOCK_TYPE,LOCK_MODE,LOCK_DATA <span class="keyword">from</span> performance_schema.data_locks;</span><br></pre></td></tr></table></figure>



<h2 id="3-行级锁"><a href="#3-行级锁" class="headerlink" title="3.行级锁"></a>3.行级锁</h2><p>行级锁，每次操作锁住对应的行数据。锁定粒度最小，发生锁冲突的概率最低，并发度最高。应用在Innodb存储引擎中。</p>
<p>Innodb的数据是基于索引组织的，行锁是通过对索引上的索引项加锁来实现的，而不是对记录加的锁。对于行级锁，主要分为</p>
<ol>
<li>行锁(Record Lock)：锁定单个行记录的锁，防止其他事物对此进行update和delete。在RC、RR隔离级别支持</li>
<li>间隙锁(Gap Lock)：索引索引记录间隙(不含该记录)，确保索引记录间隙不变，防止其他事物在这个间隙进行insert，产生幻读。在RR隔离级别支持<ul>
<li>间隙锁锁定的是两个索引记录之间的间隙，而不是实际的记录本身。</li>
<li>当一个事务在某个范围内的记录上使用了 SELECT … FOR UPDATE 或 SELECT … FOR SHARE 语句时，InnoDB 会对这个范围的间隙进行间隙锁定，防止其他事务在这个范围内插入新记录，从而保证该范围内的幻读问题不会发生。</li>
</ul>
</li>
<li>临键锁(Nect-Key Lock)：行锁和间隙锁组合，同时锁住数据，并锁住数据前面的间隙Gap。在RR隔离级别支持。<ul>
<li>临键锁是 InnoDB 存储引擎的一种组合锁，它结合了行级锁和间隙锁的特性。</li>
<li>当一个事务在某个范围内的记录上使用了 SELECT … FOR UPDATE 或 SELECT … FOR SHARE 语句时，InnoDB 会对范围内的记录进行行级锁定，并对记录前的间隙和记录后的间隙进行间隙锁定。这样可以避免在范围内插入新记录或者在范围前后插入新记录，防止幻读。</li>
</ul>
</li>
</ol>
<blockquote>
<p>行锁</p>
</blockquote>
<p>Innodb实现了以下两种类型的行锁：</p>
<ol>
<li>共享锁(s)：允许一个事物去读一行，阻止其他事物获得相同数据集的排它锁</li>
<li>排它锁(x)：允许获取排它锁的事务更新数据，阻止其他事物获得相同数据集的共享锁和排它锁</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231217211207451.png" alt="image-20231217211207451"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231217211806562.png" alt="image-20231217211806562"></p>
<p>默认情况下，Innodb在RR事务隔离级别运行，Innodb使用next-key锁进行搜索和索引扫描，以防止幻读。</p>
<ol>
<li>针对唯一索引进行检索时，对已存在的记录进行等值匹配时，将会自动优化为行锁</li>
<li>Innodb的行锁是针对于索引加的锁，不通过索引条件检索数据，那么Innodb将对表中的所有记录加锁，此时就会升级为表锁。</li>
</ol>
<blockquote>
<p>间隙锁&#x2F;临键锁</p>
</blockquote>
<p>默认情况下，Innodb在RR事务隔离级别运行，Innodb使用next-key锁进行搜索和索引扫描，以防止幻读。</p>
<ol>
<li><p>索引上的等值查询(唯一索引)，给不存在的记录加锁时，优化为间隙锁</p>
</li>
<li><p>索引上的等值查询(普通索引)，向右遍历时最后一个值不满足查询需求时，next-key Lock退化为间隙锁。</p>
</li>
<li><p>索引上的范围查询(唯一索引)，会访问到不满足的条件的第一个值为止</p>
</li>
</ol>
<p><strong>间隙锁唯一目的是防止其他事物插入间隙。间隙锁可以共存，一个事物采用的间隙锁不会阻止另一个事物在同一间隙上采用间隙锁</strong></p>
<h1 id="16-Innodb存储引擎"><a href="#16-Innodb存储引擎" class="headerlink" title="16.Innodb存储引擎"></a>16.Innodb存储引擎</h1><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231218202425428.png" alt="image-20231218202425428"></p>
<h2 id="1-架构"><a href="#1-架构" class="headerlink" title="1.架构"></a>1.架构</h2><p>MySQL5.5版本开始，默认使用Innodb存储引擎，它擅长事务处理，具有奔溃恢复特性，在日常开发中使用非常广泛。下面是Innodb架构图，左侧为内存结构，右侧为磁盘结构。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231218202653866.png" alt="image-20231218202653866"></p>
<h3 id="2-内存架构"><a href="#2-内存架构" class="headerlink" title="2.内存架构"></a>2.内存架构</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231218205216321.png" alt="image-20231218205216321"></p>
<ul>
<li><p><strong>Buffer Pool</strong>：缓存池是主内存中的一个区域，里面可以缓存磁盘上经常操作的真实数据，在执行增删改查操作时，先操作缓冲池中的数据(若缓冲池没有数据，则从磁盘加载并缓存)，然后再以一定频率刷新到磁盘，从而减少磁盘IO，加快处理速度。</p>
<ul>
<li>innodb_buffer_pool_size：缓冲区大小，一般可以设置为物理内存的60%-80%</li>
</ul>
</li>
<li><p>缓冲池以Page页为单位，底层采用链表数据结构管理Page。根据状态，将Page分为：</p>
<ul>
<li>free page：空闲page，未被使用</li>
<li>clean page：被使用page，数据没有被修改过</li>
<li>dirty page：脏页，被使用page，数据被修改过，池中数据与磁盘数据不一致</li>
</ul>
</li>
<li><p><strong>Change Buffer</strong>：更改缓冲区(针对于非唯一二级索引页)，在执行DML语句时，如果这些数据Page没有在Buffer Pool中，不会直接操作磁盘，而会将数据变更在更改缓冲区Change Buffer中，在未来数据没有被读取时，再将数据合并恢复到Buffer Pool中，再将合并后的数据刷新到磁盘中。</p>
</li>
<li><p>change Buffer的意义是什么？</p>
<ul>
<li>与聚簇索引不同，二级索引通常是非唯一的，并且以相对随机的顺序插入二级索引。同样，删除和更新可能会影响索引树中不相邻的二级索引页，如果每一次都操作磁盘，会造成大量的磁盘IO。有了Change Buffer之后，可以在缓冲池中进行合并处理，减少磁盘IO。</li>
</ul>
</li>
<li><p><strong>Adaptive Hash Index</strong>：自适应Hash索引，用于优化对Buffer Pool数据的查询。Innodb存储引擎会监控表上各索引页的查询，如果观察到Hash索引可以提升速度，则建立Hash索引，称之为自适应Hash索引。<strong>自适应哈希索引，无需人工干预，是系统工具情况自动完成。</strong></p>
</li>
<li><p>参数</p>
<ul>
<li>innodb_adaptive_hash_index：是否开启自适应哈希</li>
<li>innodb_adaptive_hash_index_parts：自适应哈希的桶数量</li>
</ul>
</li>
<li><p><strong>Log Buffer</strong>：日志缓冲区，用来保存要写到磁盘中的log日志数据(redo log&#x2F;undo log)，默认大小为16M，日志缓冲区会定期刷新到磁盘中，如果需要更新、插入或删除许多行的事务，增加日志缓冲区的大小可以节省磁盘IO。</p>
</li>
<li><p>参数</p>
<ul>
<li>Innodb_log_buffer_size：缓冲区大小</li>
<li>Innodb_flush_log_at_trx_commit：日志刷新到磁盘时机<ul>
<li>1：日志每次事务提交时写入并刷新到磁盘</li>
<li>0：每秒将日志写入并刷新到磁盘一次</li>
<li>2日志在每次事务提交后写入，并每秒刷新到磁盘一次</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="3-磁盘结构"><a href="#3-磁盘结构" class="headerlink" title="3.磁盘结构"></a>3.磁盘结构</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231218205256895.png" alt="image-20231218205256895"></p>
<ul>
<li><p><strong>System Tablespace</strong>：系统表空间时更改缓冲区的存储区域。如果表时在系统表空间而不是每个表空间或通用表空间中创建的，它也有可能包含表和索引数据</p>
<ul>
<li>参数：innodb_data_file_path</li>
</ul>
</li>
<li><p><strong>File-per_Table Tablespaces</strong>：每个表的文件表空间包含单个Innodb表的数据和索引，并存储在文件系统上的单个数据文件中。</p>
<ul>
<li>参数：Innodb_file_per_table</li>
</ul>
</li>
<li><p><strong>General Tablespaces</strong>：通用表空间，需要通过CREATE TABLESPACE语法创建通用表空间，在创建表时，可以指定该表空间</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 创建</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span>SPACE spacename <span class="keyword">ADD</span> DATAFILE <span class="string">&#x27;file_name&#x27;</span> ENGINE<span class="operator">=</span>engine_name;</span><br><span class="line"># 指定</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> xxx  TABLESPACE ts_name;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Undo Tablespaces</strong>：撤销表空间，MySQL实例在初始化时会自动创建两个默认的undo表空间(初始大小16M)，用于存储undo log</p>
</li>
<li><p><strong>Temporary Tablespaces</strong>：Innodb使用会话临时表空间和全局临时表空间。存储用户创建的临时表等数据。</p>
</li>
<li><p><strong>Doublewrite Buffer Files</strong>：双写缓冲区，Innodb引擎将数据页从Buffer Pool刷新到磁盘前，先将数据页写入双写缓冲区文件中，便于系统异常时恢复数据。</p>
<ul>
<li>文件以dblwr结尾</li>
</ul>
</li>
<li><p><strong>Redo Log</strong>：重做日志，是用来实现事务的持久性。该日志文件由两部分组成：重做日志缓冲区(redo log buffer)和重做日志文件(redo log),前者在内存中，后者在磁盘中。当事务提交之后会把所有修改信息都会存到该日志中，用于在刷新脏页到磁盘时，发生错误时，进行数据恢复使用。</p>
<ul>
<li>以循环方式写入重做日志文件，默认有两个文件：ib_logfile0、ib_logfile1</li>
</ul>
</li>
</ul>
<h3 id="4-后台线程"><a href="#4-后台线程" class="headerlink" title="4.后台线程"></a>4.后台线程</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231218211501720.png" alt="image-20231218211501720"></p>
<ol>
<li><strong>Master Thread</strong>：核心后台线程，负责调度其他线程，还负责将缓冲池中的数据异步刷新到磁盘中，保持数据的一致性，还包括脏页的刷新、合并插入缓存、undo页的回收。</li>
<li><strong>IO Thread</strong>：在Innodb存储引擎中大量使用了AIO来处理IO请求，这样可以极大的提高数据库的性能，而IO Thread主要负责这些IO请求的回调</li>
</ol>
<table>
<thead>
<tr>
<th>线程类型</th>
<th>默认个数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Read thread</td>
<td>4</td>
<td>负责读操作</td>
</tr>
<tr>
<td>Write thread</td>
<td>4</td>
<td>负责写操作</td>
</tr>
<tr>
<td>Log thead</td>
<td>1</td>
<td>负责将日志缓冲区刷新到磁盘</td>
</tr>
<tr>
<td>Insert Buffer thread</td>
<td>1</td>
<td>负责将写缓冲区内存刷新到磁盘</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 可以在存储引擎状态中查看IO线程的状态</span><br><span class="line"><span class="keyword">show</span> engine innodb status;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>Purge Thread</strong>：主要用于回收事务已经提交了的undo log，在事务提交之后，undo log可能不用了，就用它来回收。</li>
<li><strong>Page Cleaner Thread</strong>：协助Master Thread刷新脏页到磁盘的线程，它可以减轻Master Thread的工作压力，减少阻塞。</li>
</ol>
<h2 id="2-事务原理"><a href="#2-事务原理" class="headerlink" title="2.事务原理"></a>2.事务原理</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231219202120589.png" alt="image-20231219202120589"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231219202226107.png" alt="image-20231219202226107"></p>
<blockquote>
<p>redo log</p>
</blockquote>
<p>重做日志，记录的是事务提交时数据页的物理修改，是用来实现事务的持久性。</p>
<p>该日志由两部分组成：操作日志缓冲(redo log buffer)及重做日志文件(redo log file)，前者在内存中，后者在磁盘中。当事务提交之后会把所有修改信息都存到该日志文件中，用于在刷脏到磁盘出错后，进行数据恢复用的。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231219202835218.png" alt="image-20231219202835218"></p>
<blockquote>
<p>undo log</p>
</blockquote>
<p>回滚日志，用于记录数据被修改前的信息，作用包含两个：提供回滚和MVCC(多版本并发控制)</p>
<p>undo log和redo log记录物理日志不一样，它是逻辑日志。可以认为当delete一条记录时，undo log中会记录一条对应的Insert记录。当执行rollback时，就可以从undo log中的逻辑记录读取到相应的内容并进行回滚。</p>
<p><strong>undo log销毁</strong>：undo log在事务执行时产生，事务提交时，并不会立即删除undo log，因为这些日志还可能应用于MVCC。</p>
<p><strong>undo log存储</strong>：undo log采用段方式进行管理和记录，存放在<strong>rollback segment</strong>回滚段中，内部包含1024个<strong>undo log segment</strong>。</p>
<h2 id="3-MVCC"><a href="#3-MVCC" class="headerlink" title="3.MVCC"></a>3.MVCC</h2><ul>
<li>当前读</li>
</ul>
<p>读取的是记录的最新版本，读取时还要保证其他并发事务不能修改当前记录，会对读取的记录进行加锁。对于我们的日常操作，如：select..lock in share mode(共享锁)，select…update&#x2F;update&#x2F;insert&#x2F;delete(排它锁)都是一种当前读</p>
<ul>
<li>快照读</li>
</ul>
<p>简单的select(不加锁)就是一种快照读，快照读，读取的是记录数据的可见版本，有可能是历史数据，不加锁，是非阻塞读。</p>
<ul>
<li>Read Committed：每次select都生成一个快照读</li>
<li>repeatable read：开启事务后第一个select语句才是快照读的地方</li>
<li>serializable：快照读会退化为当前读</li>
</ul>
<blockquote>
<p>MVCC</p>
</blockquote>
<p>全称<strong>multi-Version Concurrency control</strong>，多版本并发控制。指维护一个数据的多个版本，使的读写操作没有冲突，快照读为MySQL实现MVCC提供了一个非阻塞读功能。MVCC的具体实现，还需要依赖于数据库中的三个隐藏字段、undo log日志、readView。</p>
<blockquote>
<p>MVCC依赖</p>
</blockquote>
<ul>
<li>三个隐藏字段</li>
</ul>
<table>
<thead>
<tr>
<th>隐藏字段</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>DB_TRX_ID</td>
<td>最近修改事务ID，记录插入这条记录或最后一次修改该记录的事务ID</td>
</tr>
<tr>
<td>DB_ROLL_PTR</td>
<td>回滚指针，指向这条记录的上一个版本，用于配合undo log，指向上一个版本</td>
</tr>
<tr>
<td>DB_ROW_ID</td>
<td>隐藏主键，当表结构没有指定主键时，将会生成该隐藏字段</td>
</tr>
</tbody></table>
<ul>
<li>undo log</li>
</ul>
<p>回滚日志，在Insert、update、delete的时候产生的便于数据回滚的日志。</p>
<p>当Insert的时候，产生的undo log日志只在回滚时需要，在事务提交后，可被立即删除。</p>
<p>而在update、delete的时候，产生的undo log日志不仅在回滚时需要，在快照读时也需要，不会立即删除。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231219210739752.png" alt="image-20231219210739752"></p>
<ul>
<li>readView</li>
</ul>
<p>ReadView(读视图)是<strong>快照读</strong>SQL执行时MVCC提取数据的重要依据，记录并维护系统当前活跃的事务(未提交的)ID。</p>
<p>ReadView中包含了四个核心字段：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>m_ids</td>
<td>当前活跃的事务ID集合</td>
</tr>
<tr>
<td>min_trx_id</td>
<td>最小活跃事务ID</td>
</tr>
<tr>
<td>max_trx_id</td>
<td>预分配事务ID，当前最大事务ID+1(因为事务ID是自增的)</td>
</tr>
<tr>
<td>creator_trx_id</td>
<td>ReadView创建者的事务ID</td>
</tr>
</tbody></table>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231219211837543.png" alt="image-20231219211837543"></p>
<ul>
<li><p>不同的隔离级别，生成的ReadView时机不同</p>
<ul>
<li>Read Committed：在事务中每一次执行快照读时生成ReadView</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231219212726679.png" alt="image-20231219212726679"></p>
<ul>
<li>REPEATABLE READ：仅在事务中第一次执行快照读时生成ReadView，后续复用该ReadView</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231219212726679.png"></p>
<h1 id="17-MySQL管理"><a href="#17-MySQL管理" class="headerlink" title="17.MySQL管理"></a>17.MySQL管理</h1><h2 id="1-系统数据库"><a href="#1-系统数据库" class="headerlink" title="1.系统数据库"></a>1.系统数据库</h2><p>MySQL数据库安装完成后，自带了一下四个数据库</p>
<table>
<thead>
<tr>
<th>数据库</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>mysql</td>
<td>存储MySQL服务器正常运行所需要的各种信息(时区、主从、用户、权限等)</td>
</tr>
<tr>
<td>infomation_schema</td>
<td>提供了访问数据库元数据的各种表和视图，包含数据库、表、字段类型及访问权限</td>
</tr>
<tr>
<td>performance_schema</td>
<td>为MySQL服务器运行时状态提供了一个底层监控功能，主要用于收集数据库服务器性能参数</td>
</tr>
<tr>
<td>sys</td>
<td>包含了一系列方便DBA和开发人员利用performance_schema性能数据库进行性能调优和诊断的视图</td>
</tr>
</tbody></table>
<h2 id="2-常用工具"><a href="#2-常用工具" class="headerlink" title="2.常用工具"></a>2.常用工具</h2><ul>
<li>mysql</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 语法</span></span><br><span class="line">mysql [options] [database]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选项</span></span><br><span class="line">-u 指定用户名</span><br><span class="line">-p 指定密码</span><br><span class="line">-h 指定服务器IP</span><br><span class="line">-P 指定端口</span><br><span class="line">-e 执行SQL语句并退出</span><br></pre></td></tr></table></figure>

<ul>
<li>mysqladmin</li>
</ul>
<p>mysqladmin是一个执行管理操作的客户端程序，可以用来检查服务器的配置和当前状态、创建并删除数据库等</p>
<ul>
<li>mysqlbinlog</li>
</ul>
<p>由于服务器生成的二进制日志文件以二进制格式保存，所以如果想检查这些文本的文本格式，就会使用mysqlbinlog日志管理工具。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 语法</span></span><br><span class="line">mysqlbinlog [options] log-file1...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选项</span></span><br><span class="line">-d 指定数据库名称，只列出指定数据库相关操作</span><br><span class="line">-o 忽略日志中的前n行</span><br><span class="line">-r 将输出的文本格式日志输出到指定文件</span><br><span class="line">-s 显示简单格式</span><br><span class="line">--start-datatime=date1 --stop-datatime=date2 指定日期间隔内的所有日志</span><br><span class="line">--start-position=pos1 --stop-position=pos2 指定位置间隔内的所有日志</span><br></pre></td></tr></table></figure>

<ul>
<li>mysqlshow</li>
</ul>
<p>mysqlshow客户端对象查找工具，用来很快的查找存在哪些数据库、数据库中的表、表中的列或索引</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 语法</span></span><br><span class="line">mysqlshow [options] [db_name[table_name[col_name]]]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选项</span></span><br><span class="line">--count 显示数据库及表的统计信息(库、表都可以不指定)</span><br><span class="line">-i 显示指定数据库或者表的状态信息</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询test库中t1表的详细信息</span></span><br><span class="line">mysqlshow -uroot -proot  <span class="built_in">test</span> t1 --count</span><br></pre></td></tr></table></figure>

<ul>
<li>mysqldump</li>
</ul>
<p>mysqldump客户端工具用来本分数据库或在不同数据库之间进行数据迁移。备份内容包括创建表、插入表的SQL语句。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 语法</span></span><br><span class="line">mysqldump [options] db_name [tables] &gt; name.sql</span><br><span class="line">mysqldump [options] -B/--databases db1...</span><br><span class="line">mysqldump [options] -A/--all-databases</span><br><span class="line">mysqldump  --databases db1 --tables a1 a2</span><br><span class="line"><span class="comment"># 不加选项只会导出数据库下面的所有表</span></span><br><span class="line"><span class="comment"># 输出选项</span></span><br><span class="line">--add-drop-database 在每个数据库创建语句前加上drop database语句</span><br><span class="line">--add-drop-table 在每个表创建语句前加上drop table语句</span><br><span class="line">-n 不包含数据库的创建语句</span><br><span class="line">-t 不包含数据库的建表语句</span><br><span class="line">-d 不包含数据</span><br><span class="line">-T 自动生成两个文件：一个.sql文件，创建表结构语句；一个.txt文件，数据文件</span><br><span class="line">--<span class="built_in">where</span>：根据条件备份，--<span class="built_in">where</span>=<span class="string">&quot;id=&#x27;1&#x27;&quot;</span></span><br><span class="line">-F：导出数据之后，生成一个新的binlog</span><br><span class="line">--single-transaction：导出数据之前提交一个BEGIN SQL语句，BEGIN 不会阻塞任何应用程序且能保证导出时数据库的一致性状态。</span><br><span class="line">--lock-tables/-l：开始导出前，锁定所有表。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将db01库中score表备份到/var/lib/mysql-files/目录下</span></span><br><span class="line">mysqldump -uroot -proot -T /var/lib/mysql-files/ db01 score</span><br><span class="line"><span class="comment"># 使用mysql&gt; show variables like &#x27;%secure_file_priv%&#x27;;</span></span><br><span class="line">+------------------+-----------------------+</span><br><span class="line">| Variable_name    | Value                 |</span><br><span class="line">+------------------+-----------------------+</span><br><span class="line">| secure_file_priv | /var/lib/mysql-files/ |</span><br><span class="line">+------------------+-----------------------+</span><br></pre></td></tr></table></figure>

<ul>
<li>mysqlimport&#x2F;source</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231220214529185.png" alt="image-20231220214529185"></p>
<h1 id="18-日志"><a href="#18-日志" class="headerlink" title="18.日志"></a>18.日志</h1><h2 id="1-错误日志"><a href="#1-错误日志" class="headerlink" title="1.错误日志"></a>1.错误日志</h2><p>错误日志是MySQL中最重要的日志之一，它记录了当mysqld启动和停止时，以及服务器在运行过程中发生任何严重错误时的相关信息。当数据库出现任何故障导致无法正常使用时，建议首先查看此日志。</p>
<p>该日志默认开启，默认位置为<code>/var/log/mysqld.log</code>。查看位置：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%log_error%&#x27;</span>;</span><br><span class="line"><span class="operator">&gt;</span> log_error,<span class="operator">/</span>var<span class="operator">/</span>log<span class="operator">/</span>mysqld.log</span><br></pre></td></tr></table></figure>



<h2 id="2-二进制日志"><a href="#2-二进制日志" class="headerlink" title="2.二进制日志"></a>2.二进制日志</h2><p>二进制日志(BINLOG)记录了所有的DDL(数据定义语言)语句和DML(数据操纵语言)语句，但不包括SELECT、SHOW语句。</p>
<p>作用：1. 灾难时的数据恢复；2.MySQL的主从复制。在MySQL8.0中，默认开启</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;log_bin%&#x27;</span>;</span><br><span class="line"><span class="operator">&gt;</span> log_bin,<span class="keyword">ON</span></span><br><span class="line">log_bin_basename,<span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>binlog</span><br><span class="line">log_bin_index,<span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>binlog.index</span><br></pre></td></tr></table></figure>

<blockquote>
<p>日志格式</p>
</blockquote>
<p>MySQL服务器中提供了多种格式来记录二进制日志</p>
<table>
<thead>
<tr>
<th>格式</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>STATEMENT</td>
<td>基于SQL语句的日志记录，记录的是SQL语句，对数据进行修改的SQL都会记录在日志文件中。</td>
</tr>
<tr>
<td>ROW</td>
<td>基于行的日志记录，记录的是每一行的变更(默认)</td>
</tr>
<tr>
<td>MIXED</td>
<td>混合前两种格式，默认采用STATEMENT，在某些特殊情况下会自动切换为ROW进行记录</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;binlog_format&#x27;</span>;</span><br><span class="line"><span class="operator">&gt;</span> binlog_format,<span class="type">ROW</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 在row格式下的binlog日志文件中记录的是数据变更，需要加-v参数将数据变更重构为sql语句</span></span><br><span class="line">mysqlbinlog -v binlog.000019</span><br></pre></td></tr></table></figure>

<blockquote>
<p>日志删除</p>
</blockquote>
<p>对于业务比较繁忙的系统来说，每天会产生大量的binlog数据，将会占用大量的磁盘空间，所以需要删除不用的binlog。</p>
<table>
<thead>
<tr>
<th>指令</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>reset masert</td>
<td>删除全部日志，binlog日志重新从1开始编号</td>
</tr>
<tr>
<td>purge master logs to binlog.xxxx</td>
<td>删除xxxxx编号之前的所有日志</td>
</tr>
<tr>
<td>purge master logs before ‘yyyy-mm-dd hh:mi:ss’</td>
<td>删除日志为yyyy-mm-dd hh:mi:ss之前产生的所有日志</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">purge master logs <span class="keyword">to</span> &quot;binlog.000002&quot;;</span><br><span class="line">purge master logs before &quot;2023-12-09&quot;;</span><br></pre></td></tr></table></figure>

<p>在MySQL中可以为binlog设置过期时间，过期之后会自动删除，默认为30天</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> @<span class="variable">@binlog_expire_logs_seconds</span>;</span><br><span class="line"><span class="operator">&gt;</span> <span class="number">2592000</span></span><br></pre></td></tr></table></figure>



<h2 id="3-查询日志"><a href="#3-查询日志" class="headerlink" title="3.查询日志"></a>3.查询日志</h2><p>查询日志记录了客户端的所有操作语句，而二进制日志不包含查询数据的SQL语句。默认情况下，查询日志是没有开启的。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%general%&#x27;</span>;</span><br><span class="line"><span class="operator">&gt;</span> general_log,OFF</span><br><span class="line">general_log_file,<span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>localhost.log</span><br></pre></td></tr></table></figure>



<h2 id="4-慢查询日志"><a href="#4-慢查询日志" class="headerlink" title="4.慢查询日志"></a>4.慢查询日志</h2><p> 慢查询日志记录了所有执行时间超过<code>long_query_time</code>设置值并且扫描数不小于<code>min_examined_row_limit</code>的所有SQL语句的日志，默认未开启。<code>long_query_time</code>默认为10秒，最小为0，精度可以到微秒。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 开启</span></span><br><span class="line">slow_query_log=1</span><br><span class="line"><span class="comment"># 执行时间参数</span></span><br><span class="line">long_query_time=2</span><br></pre></td></tr></table></figure>

<p>默认情况下，不会记录管理语句，也不会记录未使用索引进行查找的查询。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 记录较慢的管理语句</span></span><br><span class="line">log_slow_admin_statements=1</span><br><span class="line"><span class="comment"># 记录未使用索引的语句</span></span><br><span class="line">log_queries_not_using_indexes=1</span><br></pre></td></tr></table></figure>



<h1 id="19-主从复制"><a href="#19-主从复制" class="headerlink" title="19.主从复制"></a>19.主从复制</h1><blockquote>
<p>概述</p>
</blockquote>
<p>主从复制是指将主数据库的DDL和DML操作通过二进制日志传到从库服务器中，然后在从库上对这些日志重新执行(重做)，从而使得从库和主库的数据保持同步。</p>
<p>MySQL支持一台主库同时向多台从库进行复制，从库同时也可以作为其他从服务器的主库，实现链状复制。</p>
<p>MySQL主从复制优点：</p>
<ol>
<li>主库出现问题，可以快速切换到从库提供服务</li>
<li>实现读写分离，减低主库的访问压力</li>
<li>可以在从库执行备份，以避免备份期间影响主库服务。</li>
</ol>
<h2 id="1-原理"><a href="#1-原理" class="headerlink" title="1.原理"></a>1.原理</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/w7gq76.png" alt="image-20231223142913264"></p>
<ol>
<li>Master主库在提交事务时，会把数据变更记录在二进制日志文件中</li>
<li>从库读取主库的二进制日志文件Binlog，写入到从库的中继日志Relay Log。(需要<strong>REPLICATION SLAVE</strong>权限)</li>
<li>slave重做中继日志中的时间，将改变反映到它自己的数据。</li>
</ol>
<h2 id="2-主从搭建"><a href="#2-主从搭建" class="headerlink" title="2.主从搭建"></a>2.主从搭建</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 进入mysql配置文件 /etc/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">log-bin=/var/lib/mysql/mysql-bin  <span class="comment"># binlog日志所在目录</span></span><br><span class="line">server-id=123456  				  <span class="comment"># 在同一个集群中不一样即可，范围1-2^32-1</span></span><br><span class="line">plugin-load=<span class="string">&quot;rel_semi_sync_master=semisync_master.so;rel_semi_sync_slave=semisync_slave.so&quot;</span>                              <span class="comment"># 配置半同步插件</span></span><br><span class="line">read_only=1;                      <span class="comment"># slave配置只读</span></span><br><span class="line"><span class="comment"># 指定不需要同步的数据库</span></span><br><span class="line"><span class="comment">#binlog-ignore-db=db1</span></span><br><span class="line"><span class="comment"># 指定同步的数据库</span></span><br><span class="line"><span class="comment">#binlog-do-db=db1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在主库给从库创建备份账户</span></span><br><span class="line"><span class="comment"># replication slave它允许从库连接到主库并获取二进制日志事件</span></span><br><span class="line">create user root@<span class="string">&#x27;192.168.19.1&#x27;</span> identified by <span class="string">&#x27;password&#x27;</span>;</span><br><span class="line">grant replication slave on *.* to root@<span class="string">&#x27;192.168.19.1&#x27;</span> with grant option ;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在配置slave时，要先给master上全局锁备份数据给slave</span></span><br><span class="line"><span class="comment"># 使用show master status;查看master binlog执行情况</span></span><br><span class="line"><span class="comment"># 配置slave</span></span><br><span class="line">mysql&gt; change master to</span><br><span class="line">    -&gt; MASTER_HOST=<span class="string">&#x27;192.168.19.199&#x27;</span>, <span class="comment"># 8.0.23之后将master换成source</span></span><br><span class="line">    -&gt; MASTER_USER=<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    -&gt; MASTER_PASSWORD=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">    -&gt; MATER_LOG_FILE=<span class="string">&#x27;mysql-bin.000001&#x27;</span>,</span><br><span class="line">    -&gt; MASTER_LOG_POS=154;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置完成</span></span><br><span class="line">start slave;       <span class="comment"># 开启slave，8.0.23：start replica</span></span><br><span class="line">show slave status; <span class="comment"># 查看slave状态</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 若不想设置MATER_LOG_FILE，MASTER_LOG_POS，就要给每个事务配一个唯一ID</span></span><br><span class="line">[mysqld]</span><br><span class="line">gtid_mode=on  <span class="comment"># 开启gtid功能   </span></span><br><span class="line">enforce_gtid_consistency=on  <span class="comment"># 增强gtid的一致性</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置slave</span></span><br><span class="line">mysql&gt; change master to</span><br><span class="line">    -&gt; MASTER_HOST=<span class="string">&#x27;192.168.19.199&#x27;</span>,</span><br><span class="line">    -&gt; MASTER_USER=<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    -&gt; MASTER_PASSWORD=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">	-&gt; MASTER_AUTO_POSITION=1;</span><br></pre></td></tr></table></figure>





<h1 id="20-分库分表"><a href="#20-分库分表" class="headerlink" title="20.分库分表"></a>20.分库分表</h1><p>随着互联网及移动互联网的发展，应用系统的数据量也是指数级增长，若采用单数据库进行数据存储，存在一下瓶颈：</p>
<ol>
<li>IO瓶颈：热点数据太多，数据库缓存不足，产生大量磁盘IO，效率较低。请求数据太多，带宽不够，网络IO瓶颈。</li>
<li>CPU瓶颈：排序、分组、连接查询、聚合统计等SQL会消耗大量的CPU资源，请求数太多，CPU出现瓶颈。</li>
</ol>
<p><strong>分库分表的中心思想都是将数据分散存储，使得单一数据库&#x2F;表的数据量变小来缓解单一数据库的性能问题，从而达到提升数据库性能的目的</strong></p>
<blockquote>
<p>拆分策略</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231223153045300.png" alt="image-20231223153045300"></p>
<ul>
<li><p>垂直分库：以表为依据，根据业务将不同表拆分到不同库中</p>
<ul>
<li>每个库的表结构不一样</li>
<li>每个库的数据也不一样</li>
<li>所有库的并集是全量数据</li>
</ul>
</li>
<li><p>垂直分表：以字段为依据，根据字段属性将不同字段拆分到不同表中</p>
<ul>
<li>每个表结构不一样</li>
<li>每个表数据不一样，一般通过一列(主键&#x2F;外键)关联</li>
<li>所有表的并集是全量数据</li>
</ul>
</li>
<li><p>水平分库：以字段为依据，按照一定策略，将一个库的数据拆分到多个库中</p>
<ul>
<li>每个库的表结构一样</li>
<li>每个库的数据不一样</li>
<li>所有所有库的并集是全量数据</li>
</ul>
</li>
<li><p>水平分表：以字段为依据，按照一定策略，将一个表的数据拆分到多个表中</p>
<ul>
<li>每个表的表结构一样</li>
<li>每个表的数据不一样</li>
<li>所有表的并集是全量数据</li>
</ul>
</li>
</ul>
<h2 id="1-Mycat"><a href="#1-Mycat" class="headerlink" title="1.Mycat"></a>1.Mycat</h2><p>Mycat是开源的、活跃的、基于java语言编写的MySQL数据库中间件。可以像使用mysql一样来使用mycat，用户无感知。<strong>Mycat默认端口8066</strong></p>
<p>下载mycat地址：[mycat](<a target="_blank" rel="noopener" href="https://github.com/MyCATApache/Mycat-Server/releases">Releases · MyCATApache&#x2F;Mycat-Server (github.com)</a>)</p>
<ul>
<li>目录结构<ul>
<li>bin：存放可执行文件，用于启动停止mycat</li>
<li>conf：存放mycat的配置文件</li>
<li>lib：存放mycat的项目依赖包</li>
<li>logs：存放mycat的日志文件</li>
</ul>
</li>
</ul>
<blockquote>
<p>分片(schema.xml)配置</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231223194907426.png" alt="image-20231223194907426"></p>
<blockquote>
<p>用户(server.xml)配置</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231223195849192.png" alt="image-20231223195849192"></p>
<h2 id="2-Mycat配置"><a href="#2-Mycat配置" class="headerlink" title="2.Mycat配置"></a>2.Mycat配置</h2><blockquote>
<p>schema.xml</p>
</blockquote>
<p>schema.xml作为Mycat中最重要的配置文件之一，涵盖了Mycat的逻辑库、逻辑表、分片规则、分片节点及数据源的配置</p>
<ul>
<li>schema标签：<ul>
<li>schema标签用于定义Mycat实例中的逻辑库，一个Mycat实例，可以有多个逻辑库，可以通过schema标签来划分不同的逻辑库。Mycat中的逻辑库的概念，等同与MySQL中的database概念，需要操作某个概念库下的表时，也需要切换逻辑库(use xxx).<ul>
<li>name:指定自定义的逻辑库库名</li>
<li>checkSQLschema:在SQL语句操作时指定了数据库名称，执行时是否自动去除；true：自动去除，false：不自动去除</li>
<li>sqlMaxLimit:如果未指定limit进行查询，列表查询模式查询多少条记录</li>
</ul>
</li>
<li>table标签定义了逻辑库中的逻辑表，所有需要拆分的表都需要再table标签中定义<ul>
<li>name：定义逻辑表名，在该逻辑库唯一</li>
<li>dataNode：定义逻辑表所属的dataNode，该属性需要与dataNode标签中的name对应，对个dataNode逗号分隔</li>
<li>rule：分片规则的名字，分片规则名字在rule.xml中定义</li>
<li>primaryKey：逻辑表对应真实表的主键</li>
<li>type：逻辑表 类型，目前只有全局表和普通表，如果未配置则为普通表；全局表配置为global</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231223202648831.png" alt="image-20231223202648831"></p>
<ul>
<li>datanode标签：<ul>
<li>dataNode标签中定义了Mycat中的数据节点，也就是数据分片。一个dataNode就是一个独立的数据分片<ul>
<li>name：定义数据节点名字</li>
<li>dataHost：数据库实例主机名称，引用自dataHost标签中的name属性</li>
<li>database：定义分片所属数据库</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231223203714338.png" alt="image-20231223203714338"></p>
<ul>
<li>datahost标签：<ul>
<li>该标签在mycat逻辑库中作为底层标签存在，直接定义了具体的数据库实例、读写分离、心跳语句。<ul>
<li>name：唯一标识，供上层标签使用</li>
<li>maxCon&#x2F;minCon：最大&#x2F;最小连接数</li>
<li>balance：负载均衡策略，取值0,1,2,3</li>
<li>writeType：写操作分发方式(0：写操作转发到第一个writeHost，第一个挂了，切换到第二个；1：写操作随机分发到配置的writeHost)</li>
<li>dbDriver：数据库驱动，支持native、jdbc</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231223203941870.png" alt="image-20231223203941870"></p>
<blockquote>
<p>rele.xml</p>
</blockquote>
<p>rule.xml中定义所有拆分表的规则，在使用过程中可以灵活的使用分片算法，或者对同一个分片算法使用不用参数，它让分片过程可配置换。主要包含两类标签：tableRule、Function</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231223204744148.png" alt="image-20231223204744148"></p>
<blockquote>
<p>server.xml</p>
</blockquote>
<p>server.xml配置文件包含了mycat的系统配置信息，主要有两个重要标签：system、user</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231223205023587.png" alt="image-20231223205023587"></p>
<h2 id="3-分片"><a href="#3-分片" class="headerlink" title="3.分片"></a>3.分片</h2><blockquote>
<p>垂直分库</p>
</blockquote>
<p>在mycat中进行多表联查的时候，需要保证所有的表都在一个节点上，所以最好将常用表设置为global。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231223205846546.png" alt="image-20231223205846546"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231223210019432.png" alt="image-20231223210019432"></p>
<blockquote>
<p>水平分表</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231223211447054.png" alt="image-20231223211447054"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231223211558764.png" alt="image-20231223211558764"></p>
<h2 id="4-分片规则"><a href="#4-分片规则" class="headerlink" title="4.分片规则"></a>4.分片规则</h2><ul>
<li>范围分片<ul>
<li>根据指定字段的范围进行分片和节点对应情况来分片</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231223212412061.png" alt="image-20231223212412061"></p>
<ul>
<li><p>取模分片</p>
<ul>
<li>根据指定的字段值与节点数量进行求模运算，根据运算结果，来决定该数据属于哪一个分片</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231223212725454.png" alt="image-20231223212725454"></p>
</li>
<li><p>一致性hash分片</p>
<ul>
<li>所谓一致性哈希，相同的哈希因子计算值总是被划分到相同的分区表中，不会因为分区节点的增加而改变原来数据的分区位置</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231223213114571.png" alt="image-20231223213114571"></p>
</li>
<li><p>枚举分片</p>
<ul>
<li>通过在配置文件中配置可能的枚举值，指定数据分布到不同数据节点上，本规则适用于按照省份、性别、状态拆分数据等业务</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231223213801469.png" alt="image-20231223213801469"></p>
</li>
<li><p>应用指定分片</p>
<ul>
<li>运行阶段由应用自主决定路由到那个分片，直接根据字符子串(必须是数据)计算分片号</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231224180942276.png" alt="image-20231224180942276"></p>
<ul>
<li>固定分片hash算法<ul>
<li>该算法类似于十进制的求模运算，但是为二进制的操作，例如，去id的二进制低10位与1111111111进行为&amp;运算</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231224181411551.png" alt="image-20231224181411551"></p>
<ul>
<li>字符串hash解析<ul>
<li>截取字符串中的指定位置的子字符串，进行hash计算，算出分片，1111111111进行为&amp;运算</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231224181726543.png" alt="image-20231224181726543"></p>
<ul>
<li>按天分片</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231224181919774.png" alt="image-20231224181919774"></p>
<ul>
<li>按月分片</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231224182126454.png" alt="image-20231224182126454"></p>
<h2 id="5-监控Mycat"><a href="#5-监控Mycat" class="headerlink" title="5.监控Mycat"></a>5.监控Mycat</h2><blockquote>
<p>Mycat原理</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231224182618709.png" alt="image-20231224182618709"></p>
<p>Mycat默认开放两个端口，可以在server.xml中进行修改</p>
<ul>
<li>8066数据访问端口，即进行DML和DDL操作</li>
<li>9066数据库管理端口，即Mycat服务管理控制功能，用于管理Mycat的整个集群状态</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231224182904010.png" alt="image-20231224182904010"></p>
<p>Mycat监控可以通过Mycat-eye，或者Zabbix进行监控</p>
<h1 id="21-表分区"><a href="#21-表分区" class="headerlink" title="21.表分区"></a>21.表分区</h1><p>表分区是将一个表的数据按照一定的规则水平划分为不同的逻辑快，并分别进行物理存储，这个存在就叫做分区函数，可以有不同的分区规则</p>
<p>表分区修剪是MySQL优化的一种，其核心就是只扫描需要的分区。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># <span class="number">5.7</span>可以通过这个语句查看是否支持表分区</span><br><span class="line"><span class="keyword">show</span> plugins ;</span><br><span class="line"># <span class="keyword">partition</span> </span><br></pre></td></tr></table></figure>

<p><strong>8.0移除了show plugins里对partition的显示，但默认开启</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 创建表分区</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span>  tt(</span><br><span class="line">    id <span class="type">int</span> <span class="keyword">primary</span> key</span><br><span class="line">)<span class="keyword">partition</span> <span class="keyword">by</span> <span class="keyword">range</span> (id)</span><br><span class="line">(<span class="keyword">partition</span> p0 <span class="keyword">values</span> less than (<span class="number">6</span>),<span class="keyword">partition</span> p1 <span class="keyword">values</span> less than (<span class="number">11</span>));</span><br><span class="line"># 可以认为指定使用的分区</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tt <span class="keyword">partition</span> (p1);</span><br></pre></td></tr></table></figure>

<p>当表中含有主键或唯一键时，则每个被用作分区函数的字段必须是表中唯一键和主键的全部或一部分，否则就无法创建分区表</p>
<ul>
<li>表分区优势<ul>
<li>可以允许在一个表里存储更多的数据，突破磁盘限制或文件系统限制。一个表分区会具体化为一个ibd文件</li>
<li>对于从表里将过期或历史的数据移除是很容易的，只需要将对应的分区移除即可</li>
<li>对某些查询和修改语句来说，可以自动将数据范围缩小到一个或几个表分区上，优化语句执行效率。而且可以通过指定表分区来执行语句</li>
</ul>
</li>
</ul>
<h2 id="1-表分区类型"><a href="#1-表分区类型" class="headerlink" title="1.表分区类型"></a>1.表分区类型</h2><p>表分区类型分为：</p>
<ul>
<li>RANGE表分区：范围表分区，按照一定的范围值来确定每个分区包含的数据</li>
<li>LIST表分区：列表表分区，按照一个个确定的值来确定每个分区包含的数据</li>
<li>HASH表分区：哈希表分区，按照一个自定义的函数返回值来确定每个分区包含的数据</li>
<li>KEY表分区：key表分区，与哈希表分区类似，只是用MySQL自己的HASH函数来确定每个分区包含的数据</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 查看表分区信息</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">table</span> status;</span><br><span class="line"># 查看表分区有多少行数据</span><br><span class="line"> <span class="keyword">select</span> PARTITION_name,SUBPARTITION_NAME <span class="keyword">from</span> information_schema.PARTITIONS <span class="keyword">where</span> TABLE_NAME<span class="operator">=</span><span class="string">&#x27;ts&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 可以用这条语句刷新上面的结果，这条语句是用来分析表的索引分布情况</span><br><span class="line"># 使用这语句表被上读锁</span><br><span class="line">analyze <span class="keyword">table</span> tt1;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>RANGE表分区</p>
</blockquote>
<p>分区函数使用的字段必须是整数类型，分区的定义范围必须是连续的，且不能有重叠部分，通过使用<code>VALUES LESS THEN</code>来定义分区范围，范围由小到大定义，会把null值放在最小的表分区</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE TABLE your_table (</span><br><span class="line">    id INT,</span><br><span class="line">    name VARCHAR(50),</span><br><span class="line">    created_at DATE</span><br><span class="line">)</span><br><span class="line">PARTITION BY RANGE (YEAR(created_at)) (</span><br><span class="line">    PARTITION p0 VALUES LESS THAN (1990),</span><br><span class="line">    PARTITION p1 VALUES LESS THAN (2000),</span><br><span class="line">    PARTITION p2 VALUES LESS THAN (2010),</span><br><span class="line">    PARTITION p3 VALUES LESS THAN MAXVALUE # MAXVALUE表示未确定的上限</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>LIST表分区</p>
</blockquote>
<p>通过<code>PARTITION BY LIST(expr)</code>分区函数表达式必须返回整数，取值范围通过<code>VALUES IN (value_list)</code>定义。必须要定义，否则不能插入null值</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE TABLE h2 (</span><br><span class="line">    -&gt;   c1 INT,</span><br><span class="line">    -&gt;   c2 INT</span><br><span class="line">    -&gt; )</span><br><span class="line">    -&gt; PARTITION BY LIST(c1) (</span><br><span class="line">    -&gt;   PARTITION p0 VALUES IN (1, 4, 7),</span><br><span class="line">    -&gt;   PARTITION p1 VALUES IN (2, 5, 8)</span><br><span class="line">    -&gt; );</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<blockquote>
<p>多字段分区</p>
</blockquote>
<p>对range和list表分区来说，分区函数可以包含多个字段</p>
<p>分区多字段函数(column partition)所涉及的字段类型可以包括</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231227202837456.png" alt="image-20231227202837456"></p>
<p>范围多字段分区函数和普通的范围分区函数的区别在于</p>
<ul>
<li>字段类型多样化</li>
<li>范围多字段分区函数不支持表达式，只能用字段名</li>
<li>范围多字段分区函数支持一个或多个字段</li>
<li>每个column_list里的字段和value_list里的数值必须一一对应，数据类型也要一致</li>
<li>对范围多字段分区来说，有时一行数据的分区列表的第一个元素等于VALUES LESS THEN 的值列表的第一个元素会被插入到相应的分区</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 对比的时候会(5,10)&lt;(5,11)这样对比</span><br><span class="line"># 对比逻辑是第一个相等就比较第二个</span><br><span class="line">CREATE TABLE your_range_table (</span><br><span class="line">    id INT,</span><br><span class="line">    date_column DATE,</span><br><span class="line">    category_column VARCHAR(50),</span><br><span class="line">    value_column INT,</span><br><span class="line">    -- other columns</span><br><span class="line">)</span><br><span class="line">PARTITION BY RANGE COLUMNS (date_column, category_column) (</span><br><span class="line">    PARTITION p0 VALUES LESS THAN (&#x27;2023-01-01&#x27;, &#x27;category1&#x27;),</span><br><span class="line">    PARTITION p1 VALUES LESS THAN (&#x27;2024-01-01&#x27;, &#x27;category2&#x27;),</span><br><span class="line">    PARTITION p2 VALUES LESS THAN (MAXVALUE, MAXVALUE) -- catch-all for values not covered by previous partitions</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CREATE TABLE your_list_table (</span><br><span class="line">    id INT,</span><br><span class="line">    date_column DATE,</span><br><span class="line">    category_column VARCHAR(50),</span><br><span class="line">    value_column INT</span><br><span class="line">)</span><br><span class="line">PARTITION BY LIST COLUMNS (category_column) (</span><br><span class="line">    PARTITION p0 VALUES IN (&#x27;category1&#x27;),</span><br><span class="line">    PARTITION p1 VALUES IN (&#x27;category2&#x27;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>hash表分区</p>
</blockquote>
<p>哈希表分区，按照一个自定义的函数返回值来确定每一个分区包含的数据，这个自定义函数也可以仅仅是一个字段名，通过<code>PARTITION BY HASH(expr)</code>字句来定义哈希表分区，其中的expr表达式必须返回一个整数，基于分区的数量的取模运算(%)，根据余数插入到指定分区。null值会被放在p0分区。</p>
<p>对哈希表分区来说只需要定义分区的个数，其余的事情内部完成</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 分区表名为p0，p1.....</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t(</span><br><span class="line">    <span class="keyword">no</span> <span class="type">int</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">partition</span> <span class="keyword">by</span> hash ( <span class="keyword">no</span> )</span><br><span class="line">partitions <span class="number">4</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>key表分区</p>
</blockquote>
<p>与哈希表分区类似，key表分区依赖MySQL自身</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t(</span><br><span class="line">    <span class="keyword">no</span> <span class="type">int</span> <span class="keyword">unique</span> ,</span><br><span class="line">    num <span class="type">int</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">partition</span> <span class="keyword">by</span> key ( <span class="keyword">no</span> ) # 不写入值则使用主键，可以使用非整数类型</span><br><span class="line">partitions <span class="number">4</span>;</span><br></pre></td></tr></table></figure>



<h2 id="2-子表分区"><a href="#2-子表分区" class="headerlink" title="2.子表分区"></a>2.子表分区</h2><p>子表分区，是在表分区的基础上再创建表分区的概念，每个表分区下的子表分区个数必须一致</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 子表分区必须是range/list+hash/key子表组合</span><br><span class="line"># 分区键必须一样，子分区名p1sp1</span><br><span class="line">create table ts (id int ,pur date)</span><br><span class="line">partition by range (year(pur))</span><br><span class="line">subpartition by hash ( to_days(pur) )</span><br><span class="line">subpartitions 2</span><br><span class="line">(partition p1 values less than (1990),</span><br><span class="line">partition p2 values less than (2000));</span><br><span class="line"></span><br><span class="line"># 也可以显示指定子分区名</span><br><span class="line">create table ts (id int ,pur date)</span><br><span class="line">partition by range (year(pur))</span><br><span class="line">subpartition by hash ( to_days(pur) )</span><br><span class="line">(partition p1 values less than (1990)</span><br><span class="line">(subpartition s1,subpartition s2),</span><br><span class="line">partition p2 values less than (2000)</span><br><span class="line">(subpartition t1,subpartition t2));</span><br></pre></td></tr></table></figure>



<h2 id="3-分区表操作"><a href="#3-分区表操作" class="headerlink" title="3.分区表操作"></a>3.分区表操作</h2><ul>
<li>删除表分区</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 删除表分区也会把里面的数据删除</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tablename <span class="keyword">drop</span> <span class="keyword">partition</span> partitionname;</span><br><span class="line"></span><br><span class="line"># 删除表分区数据</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> p1 tuncate <span class="keyword">partition</span> p</span><br></pre></td></tr></table></figure>

<ul>
<li>交换数据</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 交换数据两表必须结构完全相同，包括字段、类型、索引、存储引擎</span><br><span class="line"># 交换时nt的数据必须在p分区范围之内</span><br><span class="line"># 可以添加<span class="keyword">without</span> validation来跳过行验证</span><br><span class="line"># 当有子分区时，只能交换子分区而不能交换整个分区</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> pt exchange <span class="keyword">partition</span> p <span class="keyword">with</span> <span class="keyword">table</span> nt;</span><br></pre></td></tr></table></figure>

<ul>
<li>增加表分区</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 对于范围表分区来说，增加必须在尾部，否则会失败</span><br><span class="line"># 对于列表表分区来说，要保证新增值没有出现过</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> mem <span class="keyword">add</span> <span class="keyword">partition</span> (<span class="keyword">partition</span> n <span class="keyword">values</span> less <span class="keyword">then</span> (<span class="number">1970</span>));</span><br><span class="line"></span><br><span class="line"># 为了解决这个问题，可以使用</span><br><span class="line"># 范围表分区：表示把p0表分区拆分成n和n1两个分区，n1分区必须和p0一致；也可以合并回来</span><br><span class="line"># 列表表分区：要保持分区值一致，且必须是相邻的分区；如果分区值不一致，有可能导致数据丢失</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> mem reorganize <span class="keyword">partition</span> p0 <span class="keyword">into</span> (<span class="keyword">partition</span> n <span class="keyword">values</span> less <span class="keyword">then</span> (<span class="number">1970</span>)，<span class="keyword">partition</span> n1 <span class="keyword">values</span> less <span class="keyword">then</span> (<span class="number">1980</span>));</span><br></pre></td></tr></table></figure>

<ul>
<li>哈希表分区和key表分区</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 这两类型不能删除表分区</span><br><span class="line"># 能合并表分区num表示缩减的个数，而不是缩减到的个数</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> p coalesce <span class="keyword">partition</span> num;</span><br><span class="line"></span><br><span class="line"># 增加表分区</span><br><span class="line"><span class="keyword">alter</span> tbale p <span class="keyword">add</span> <span class="keyword">partition</span> partitions <span class="number">8</span>;</span><br></pre></td></tr></table></figure>



<h1 id="22-读写分离"><a href="#22-读写分离" class="headerlink" title="22.读写分离"></a>22.读写分离</h1><p>读写分离，简单的说就是把对数据库的读和写操作分开，以对应不同的数据库服务器。主数据库提供写操作，从数据库提供读操作，这样能有效的减轻单台数据库的压力</p>
<p>Mycat控制后台数据的读写分离和负载均衡由schema.xml文件datahost标签的balance属性控制</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231224184458555.png" alt="image-20231224184458555"></p>
<ul>
<li>balance<ul>
<li>0：不开启读写分离机制，所有读操作都发送到当前可用的writeHost上</li>
<li>1：全部的readHost与备用的writeHost都参数SELECT语句的负载均衡(双主)</li>
<li>2：所有的读写操作都随机到writeHost，readHost上分发</li>
<li>3：所有的读操作随机分发到writeHost对应的readHost上执行，writeHost不负担读压力</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/AYO-Al/image/image/image-20231224184757861.png" alt="image-20231224184757861"></p>
<ul>
<li><p>writeType</p>
<ul>
<li>0：写操作都转发到第一台writeHost，writeHost1挂了会切换到writeHost2上</li>
<li>1：所有的写操作都随机的发送到配置的writeHost上</li>
</ul>
</li>
<li><p>switchType</p>
<ul>
<li>-1：不自动切换</li>
<li>1：自动切换</li>
</ul>
</li>
</ul>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">AYO</div><div class="post-copyright__author_desc">天行健，君子以自强不息</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://www.yuki.love/2023/01/17/MarkDown/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL8.0/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://www.yuki.love/2023/01/17/MarkDown/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL8.0/')">MySQL</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://www.yuki.love/2023/01/17/MarkDown/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL8.0/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=MySQL&amp;url=https://www.yuki.love/2023/01/17/MarkDown/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL8.0/&amp;pic=https://pic2.zhimg.com/v2-264805954c1f033af43e006cb826ab60_r.jpg?source=1940ef5c&amp;_r_=33d9c07f-6b23-dcfb-775e-2f0bcbf6c0b0" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.yuki.love" target="_blank">AYO</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/MySQL/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>MySQL<span class="tagsPageCount">6</span></a><a class="post-meta__box__tags" href="/tags/Database/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Database<span class="tagsPageCount">8</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://pic2.zhimg.com/v2-264805954c1f033af43e006cb826ab60_r.jpg?source=1940ef5c&amp;_r_=ff30bac3-3692-3708-c105-03d3ea910c3f" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/01/15/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/shell%E7%BC%96%E7%A8%8B/%E5%91%BD%E4%BB%A4/%E5%91%BD%E4%BB%A4%E8%A1%8C/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic2.zhimg.com/v2-264805954c1f033af43e006cb826ab60_r.jpg?source=1940ef5c&amp;_r_=fb6ed5b7-eb73-3eb9-d23a-52d5366abc4b" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Linux命令行</div></div></a></div><div class="next-post pull-right"><a href="/2023/02/15/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/DNS%E4%B8%8ECDN/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://th.bing.com/th/id/R.4cb70989991c1861426358cb196b6d01?rik=83OmAlSQSFM51Q&amp;riu=http%3A%2F%2Fpic.bizhi360.com%2Fbpic%2F88%2F9588_8.jpg&amp;ehk=Vc5LFstc1coz3liGA9YtX3SOl%2BcMJTlRfHNhk%2F4%2FA0w%3D&amp;risl=&amp;pid=ImgRaw&amp;r=0&amp;_r_=e6a56224-8d1f-5000-0433-3260498383ab" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">DNS</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2022/12/23/MarkDown/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/(%E8%BD%AC)mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%8E%9F%E7%90%86/" title="MySQL主从复制"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic2.zhimg.com/v2-264805954c1f033af43e006cb826ab60_r.jpg?source=1940ef5c&_r_=8eebfe91-2ff6-ec4a-b796-b1e59429edca" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2022-12-23</div><div class="title">MySQL主从复制</div></div></a></div><div><a href="/2022/09/23/MarkDown/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mysql/" title="MySQL基础"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic1.zhimg.com/v2-37d1dd62d373427b8035891e9fe1653e_r.jpg?source=1940ef5c&_r_=df38bf02-4ff4-f1f2-4f62-42e5aca646b9" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2022-09-23</div><div class="title">MySQL基础</div></div></a></div><div><a href="/2022/11/23/MarkDown/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/%E4%B8%89%E9%AB%98%E6%95%B0%E6%8D%AE%E5%BA%93/" title="三高MySQL"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic4.zhimg.com/v2-c2b3eb3319d52218753d0ce20bc7c100_r.jpg?_r_=2ad7d8bc-b8b8-3e05-df97-77f8f3d02264" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2022-11-23</div><div class="title">三高MySQL</div></div></a></div><div><a href="/2023/04/11/MarkDown/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/%E9%9A%8F%E7%AC%94/MySQL%E4%B8%AD%E5%85%B3%E4%BA%8E%E8%87%AA%E5%8A%A8%E6%8F%90%E4%BA%A4%E8%BF%87%E7%A8%8B%E6%A0%87%E5%BF%97%E4%BD%8D%E5%8F%98%E5%8C%96/" title="MySQL自动提交"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic1.zhimg.com/v2-0cc45f5fda6e8ff79350ec1303835629_r.jpg?source=1940ef5c&_r_=81bfb306-212b-d963-5f25-9f966f19e378" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-04-11</div><div class="title">MySQL自动提交</div></div></a></div><div><a href="/2023/09/17/MarkDown/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96/" title="MySQL优化"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://th.bing.com/th/id/R.4cb70989991c1861426358cb196b6d01?rik=83OmAlSQSFM51Q&riu=http%3A%2F%2Fpic.bizhi360.com%2Fbpic%2F88%2F9588_8.jpg&ehk=Vc5LFstc1coz3liGA9YtX3SOl%2BcMJTlRfHNhk%2F4%2FA0w%3D&risl=&pid=ImgRaw&r=0&_r_=1e69f794-0702-63a9-9370-e2e5d2501a90" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-09-17</div><div class="title">MySQL优化</div></div></a></div><div><a href="/2022/08/20/MarkDown/%E6%95%B0%E6%8D%AE%E5%BA%93/redis/redis-trib.rb/" title="Redis-trib"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic1.zhimg.com/v2-0cc45f5fda6e8ff79350ec1303835629_r.jpg?source=1940ef5c&_r_=a2082127-e428-d66e-d464-28f245e92c41" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2022-08-20</div><div class="title">Redis-trib</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-switch"><span class="first-comment">Twikoo</span><span id="switch-btn"></span><span class="second-comment">Waline</span></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div><div><div id="waline-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);"><b style="color:#fff">AYO的知识输出基地，</b><b style="color:#fff">以输出倒逼输入，以输出巩固知识！</b></div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">AYO</h1><div class="author-info__desc">天行健，君子以自强不息</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/AYO-Al" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://juejin.cn/user/3708003152300183" target="_blank" title="JueJin"><i class="anzhiyufont anzhiyu-icon-book"></i></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">1.数据库介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.1.</span> <span class="toc-text">1.数据库类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.2.</span> <span class="toc-text">2.MySQL数据库介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B7%A5%E7%A8%8B%E5%B8%88%E8%81%8C%E8%B4%A3"><span class="toc-number">1.3.</span> <span class="toc-text">3.数据库工程师职责</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-MySQL%E4%B8%8B%E8%BD%BD"><span class="toc-number">1.4.</span> <span class="toc-text">4.MySQL下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%A6%82%E4%BD%95%E5%9C%A8%E4%B8%80%E5%8F%B0%E6%9C%BA%E5%99%A8%E4%B8%8A%E5%90%AF%E5%A4%9A%E4%B8%AAMySQL%E6%9C%8D%E5%8A%A1%E5%91%A2%EF%BC%9F"><span class="toc-number">1.5.</span> <span class="toc-text">5.如何在一台机器上启多个MySQL服务呢？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-MySQL%E7%9B%B8%E5%85%B3%E5%90%AF%E5%8A%A8%E5%8F%82%E6%95%B0"><span class="toc-number">1.6.</span> <span class="toc-text">6.MySQL相关启动参数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-MySQL%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4"><span class="toc-number">2.</span> <span class="toc-text">2.MySQL基础命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-MySQL%E6%9D%83%E9%99%90%E8%AE%A4%E8%AF%81"><span class="toc-number">2.1.</span> <span class="toc-text">1.MySQL权限认证</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%9D%83%E9%99%90%E8%AF%A6%E8%A7%A3"><span class="toc-number">2.1.1.</span> <span class="toc-text">1.权限详解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%AE%BE%E7%BD%AEMySQL%E7%94%A8%E6%88%B7%E7%9A%84%E5%AF%86%E7%A0%81"><span class="toc-number">2.2.</span> <span class="toc-text">2.设置MySQL用户的密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%AE%BE%E7%BD%AEMySQL%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E8%BF%87%E6%9C%9F%E7%AD%96%E7%95%A5"><span class="toc-number">2.3.</span> <span class="toc-text">3.设置MySQL用户密码过期策略</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-SQL"><span class="toc-number">3.</span> <span class="toc-text">3.SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-SQL"><span class="toc-number">3.1.</span> <span class="toc-text">1.SQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.2.</span> <span class="toc-text">2.数据类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-DDL%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.3.</span> <span class="toc-text">3.DDL语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-DML%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.4.</span> <span class="toc-text">4.DML语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-DQL%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.5.</span> <span class="toc-text">5.DQL语句</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.5.1.</span> <span class="toc-text">1.基本查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.5.2.</span> <span class="toc-text">2.条件查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-number">3.5.3.</span> <span class="toc-text">3.聚合函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.5.4.</span> <span class="toc-text">4.分组查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%8E%92%E5%BA%8F%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.5.5.</span> <span class="toc-text">5.排序查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.5.6.</span> <span class="toc-text">6.分页查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-DQL%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-number">3.5.7.</span> <span class="toc-text">7.DQL执行顺序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-DCL"><span class="toc-number">3.6.</span> <span class="toc-text">4.DCL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="toc-number">3.6.1.</span> <span class="toc-text">1.用户管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%9D%83%E9%99%90"><span class="toc-number">3.6.2.</span> <span class="toc-text">2.权限</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%AD%A3%E5%88%99"><span class="toc-number">3.7.</span> <span class="toc-text">5.正则</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E5%87%BD%E6%95%B0"><span class="toc-number">4.</span> <span class="toc-text">4.函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="toc-number">4.1.</span> <span class="toc-text">1.字符串函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%95%B0%E5%80%BC%E5%87%BD%E6%95%B0"><span class="toc-number">4.2.</span> <span class="toc-text">2.数值函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="toc-number">4.3.</span> <span class="toc-text">3.日期函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E9%AB%98%E7%BA%A7%E5%87%BD%E6%95%B0"><span class="toc-number">4.4.</span> <span class="toc-text">4.高级函数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E7%BA%A6%E6%9D%9F"><span class="toc-number">5.</span> <span class="toc-text">5.约束</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.</span> <span class="toc-text">6.多表查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%A4%9A%E8%A1%A8%E5%85%B3%E7%B3%BB"><span class="toc-number">6.1.</span> <span class="toc-text">1.多表关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%86%85%E8%BF%9E%E6%8E%A5"><span class="toc-number">6.2.</span> <span class="toc-text">2.内连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">6.3.</span> <span class="toc-text">3.外连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E8%87%AA%E8%BF%9E%E6%8E%A5"><span class="toc-number">6.4.</span> <span class="toc-text">4.自连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.5.</span> <span class="toc-text">5.联合查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.6.</span> <span class="toc-text">6.子查询</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E4%BA%8B%E5%8A%A1"><span class="toc-number">7.</span> <span class="toc-text">7.事务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BA%8B%E5%8A%A1%E5%9B%9B%E5%A4%A7%E7%89%B9%E6%80%A7"><span class="toc-number">7.1.</span> <span class="toc-text">1.事务四大特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%B9%B6%E5%8F%91%E4%BA%8B%E5%8A%A1%E9%97%AE%E9%A2%98"><span class="toc-number">7.2.</span> <span class="toc-text">2.并发事务问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">7.3.</span> <span class="toc-text">3.事务隔离级别</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">8.</span> <span class="toc-text">8.存储引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E7%89%B9%E7%82%B9"><span class="toc-number">8.1.</span> <span class="toc-text">1.存储引擎特点</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-%E7%B4%A2%E5%BC%95"><span class="toc-number">9.</span> <span class="toc-text">9.索引</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%B4%A2%E5%BC%95%E6%A6%82%E8%BF%B0"><span class="toc-number">9.1.</span> <span class="toc-text">1.索引概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9b-%E6%A0%91%E4%BD%9C%E4%B8%BA%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%84"><span class="toc-number">9.2.</span> <span class="toc-text">2.为什么选择b+树作为索引结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%B4%A2%E5%BC%95%E8%AF%AD%E6%B3%95"><span class="toc-number">9.3.</span> <span class="toc-text">3.索引语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-number">9.4.</span> <span class="toc-text">4.性能优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-profile%E8%AF%A6%E6%83%85"><span class="toc-number">9.5.</span> <span class="toc-text">5.profile详情</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-explain%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92"><span class="toc-number">9.6.</span> <span class="toc-text">6.explain执行计划</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E7%B4%A2%E5%BC%95%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">9.7.</span> <span class="toc-text">7.索引的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E7%B4%A2%E5%BC%95%E6%B6%89%E5%8F%8A%E5%8E%9F%E5%88%99"><span class="toc-number">9.8.</span> <span class="toc-text">8.索引涉及原则</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-SQL%E4%BC%98%E5%8C%96"><span class="toc-number">10.</span> <span class="toc-text">10.SQL优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE%E4%BC%98%E5%8C%96"><span class="toc-number">10.1.</span> <span class="toc-text">1.插入数据优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%B8%BB%E9%94%AE%E6%8F%92%E5%85%A5"><span class="toc-number">10.2.</span> <span class="toc-text">2.主键插入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-order-by%E4%BC%98%E5%8C%96"><span class="toc-number">10.3.</span> <span class="toc-text">3.order by优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-group-by%E4%BC%98%E5%8C%96"><span class="toc-number">10.4.</span> <span class="toc-text">4.group by优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-limit%E4%BC%98%E5%8C%96"><span class="toc-number">10.5.</span> <span class="toc-text">5.limit优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-count%E4%BC%98%E5%8C%96"><span class="toc-number">10.6.</span> <span class="toc-text">6.count优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-update%E4%BC%98%E5%8C%96"><span class="toc-number">10.7.</span> <span class="toc-text">7.update优化</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-%E8%A7%86%E5%9B%BE"><span class="toc-number">11.</span> <span class="toc-text">11.视图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%A3%80%E6%9F%A5%E9%80%89%E9%A1%B9"><span class="toc-number">11.1.</span> <span class="toc-text">1.检查选项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%A7%86%E5%9B%BE%E6%9B%B4%E6%96%B0"><span class="toc-number">11.2.</span> <span class="toc-text">2.视图更新</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#12-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">12.</span> <span class="toc-text">12.存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%8F%98%E9%87%8F"><span class="toc-number">12.1.</span> <span class="toc-text">1.变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-IF%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD"><span class="toc-number">12.2.</span> <span class="toc-text">2.IF条件判断</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%8F%82%E6%95%B0"><span class="toc-number">12.3.</span> <span class="toc-text">3.参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-case%E8%AF%AD%E5%8F%A5"><span class="toc-number">12.4.</span> <span class="toc-text">4.case语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%BE%AA%E7%8E%AF"><span class="toc-number">12.5.</span> <span class="toc-text">5.循环</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E6%B8%B8%E6%A0%87"><span class="toc-number">12.6.</span> <span class="toc-text">6.游标</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#13-%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0"><span class="toc-number">13.</span> <span class="toc-text">13.存储函数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#14-%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">14.</span> <span class="toc-text">14.触发器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#15-%E9%94%81"><span class="toc-number">15.</span> <span class="toc-text">15.锁</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%85%A8%E5%B1%80%E9%94%81"><span class="toc-number">15.1.</span> <span class="toc-text">1.全局锁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%A1%A8%E7%BA%A7%E9%94%81"><span class="toc-number">15.2.</span> <span class="toc-text">2.表级锁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%A1%8C%E7%BA%A7%E9%94%81"><span class="toc-number">15.3.</span> <span class="toc-text">3.行级锁</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#16-Innodb%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">16.</span> <span class="toc-text">16.Innodb存储引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%9E%B6%E6%9E%84"><span class="toc-number">16.1.</span> <span class="toc-text">1.架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%86%85%E5%AD%98%E6%9E%B6%E6%9E%84"><span class="toc-number">16.1.1.</span> <span class="toc-text">2.内存架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%A3%81%E7%9B%98%E7%BB%93%E6%9E%84"><span class="toc-number">16.1.2.</span> <span class="toc-text">3.磁盘结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%90%8E%E5%8F%B0%E7%BA%BF%E7%A8%8B"><span class="toc-number">16.1.3.</span> <span class="toc-text">4.后台线程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%BA%8B%E5%8A%A1%E5%8E%9F%E7%90%86"><span class="toc-number">16.2.</span> <span class="toc-text">2.事务原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-MVCC"><span class="toc-number">16.3.</span> <span class="toc-text">3.MVCC</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#17-MySQL%E7%AE%A1%E7%90%86"><span class="toc-number">17.</span> <span class="toc-text">17.MySQL管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">17.1.</span> <span class="toc-text">1.系统数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="toc-number">17.2.</span> <span class="toc-text">2.常用工具</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#18-%E6%97%A5%E5%BF%97"><span class="toc-number">18.</span> <span class="toc-text">18.日志</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97"><span class="toc-number">18.1.</span> <span class="toc-text">1.错误日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97"><span class="toc-number">18.2.</span> <span class="toc-text">2.二进制日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-number">18.3.</span> <span class="toc-text">3.查询日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-number">18.4.</span> <span class="toc-text">4.慢查询日志</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#19-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-number">19.</span> <span class="toc-text">19.主从复制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%8E%9F%E7%90%86"><span class="toc-number">19.1.</span> <span class="toc-text">1.原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%B8%BB%E4%BB%8E%E6%90%AD%E5%BB%BA"><span class="toc-number">19.2.</span> <span class="toc-text">2.主从搭建</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#20-%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8"><span class="toc-number">20.</span> <span class="toc-text">20.分库分表</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Mycat"><span class="toc-number">20.1.</span> <span class="toc-text">1.Mycat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Mycat%E9%85%8D%E7%BD%AE"><span class="toc-number">20.2.</span> <span class="toc-text">2.Mycat配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%88%86%E7%89%87"><span class="toc-number">20.3.</span> <span class="toc-text">3.分片</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%88%86%E7%89%87%E8%A7%84%E5%88%99"><span class="toc-number">20.4.</span> <span class="toc-text">4.分片规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E7%9B%91%E6%8E%A7Mycat"><span class="toc-number">20.5.</span> <span class="toc-text">5.监控Mycat</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#21-%E8%A1%A8%E5%88%86%E5%8C%BA"><span class="toc-number">21.</span> <span class="toc-text">21.表分区</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E8%A1%A8%E5%88%86%E5%8C%BA%E7%B1%BB%E5%9E%8B"><span class="toc-number">21.1.</span> <span class="toc-text">1.表分区类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%AD%90%E8%A1%A8%E5%88%86%E5%8C%BA"><span class="toc-number">21.2.</span> <span class="toc-text">2.子表分区</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%88%86%E5%8C%BA%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">21.3.</span> <span class="toc-text">3.分区表操作</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#22-%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB"><span class="toc-number">22.</span> <span class="toc-text">22.读写分离</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/06/20/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/ELK%E6%97%A5%E5%BF%97%E5%B9%B3%E5%8F%B0/" title="ELK"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic2.zhimg.com/v2-264805954c1f033af43e006cb826ab60_r.jpg?source=1940ef5c&amp;_r_=ff30bac3-3692-3708-c105-03d3ea910c3f" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ELK"/></a><div class="content"><a class="title" href="/2024/06/20/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/ELK%E6%97%A5%E5%BF%97%E5%B9%B3%E5%8F%B0/" title="ELK">ELK</a><time datetime="2024-06-19T16:00:00.000Z" title="发表于 2024-06-20 00:00:00">2024-06-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/01/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Nginx/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" title="Nginx反向代理配置"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://th.bing.com/th/id/R.d8dfd08893b58d08d74b38ad8870a48d?rik=9KBqff6Rai035Q&amp;riu=http%3A%2F%2Fstatic.cntonan.com%2Fuploadfile%2F2019%2F0214%2F20190214104244pwm1xxsdikh.jpg&amp;ehk=MOxI2n5nY44gO%2FKsNYWAuEBvcRwSmkRVNb4dTS6Gk%2BY%3D&amp;risl=&amp;pid=ImgRaw&amp;r=0&amp;_r_=d892b81e-aa84-b650-f452-53d7d749742c" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nginx反向代理配置"/></a><div class="content"><a class="title" href="/2024/06/01/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Nginx/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" title="Nginx反向代理配置">Nginx反向代理配置</a><time datetime="2024-05-31T16:00:00.000Z" title="发表于 2024-06-01 00:00:00">2024-06-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/27/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Nginx/Nginx-all/" title="Nginx模块"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://th.bing.com/th/id/R.4cb70989991c1861426358cb196b6d01?rik=83OmAlSQSFM51Q&amp;riu=http%3A%2F%2Fpic.bizhi360.com%2Fbpic%2F88%2F9588_8.jpg&amp;ehk=Vc5LFstc1coz3liGA9YtX3SOl%2BcMJTlRfHNhk%2F4%2FA0w%3D&amp;risl=&amp;pid=ImgRaw&amp;r=0&amp;_r_=10029237-b8f9-4ac6-0024-4a24b13b9220" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nginx模块"/></a><div class="content"><a class="title" href="/2024/05/27/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Nginx/Nginx-all/" title="Nginx模块">Nginx模块</a><time datetime="2024-05-26T16:00:00.000Z" title="发表于 2024-05-27 00:00:00">2024-05-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/22/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%8E%E7%A3%81%E7%9B%98/" title="Linux文件系统与磁盘"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic2.zhimg.com/v2-264805954c1f033af43e006cb826ab60_r.jpg?source=1940ef5c&amp;_r_=d90a0feb-3430-f821-510b-8bab35385e52" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux文件系统与磁盘"/></a><div class="content"><a class="title" href="/2024/05/22/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%8E%E7%A3%81%E7%9B%98/" title="Linux文件系统与磁盘">Linux文件系统与磁盘</a><time datetime="2024-05-21T16:00:00.000Z" title="发表于 2024-05-22 00:00:00">2024-05-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/11/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/%E9%98%B2%E7%81%AB%E5%A2%99/" title="Linux防火墙"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://th.bing.com/th/id/R.d8dfd08893b58d08d74b38ad8870a48d?rik=9KBqff6Rai035Q&amp;riu=http%3A%2F%2Fstatic.cntonan.com%2Fuploadfile%2F2019%2F0214%2F20190214104244pwm1xxsdikh.jpg&amp;ehk=MOxI2n5nY44gO%2FKsNYWAuEBvcRwSmkRVNb4dTS6Gk%2BY%3D&amp;risl=&amp;pid=ImgRaw&amp;r=0&amp;_r_=02edfb53-d3e5-89ec-bc2f-6dee4ae15e4a" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux防火墙"/></a><div class="content"><a class="title" href="/2024/05/11/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/%E9%98%B2%E7%81%AB%E5%A2%99/" title="Linux防火墙">Linux防火墙</a><time datetime="2024-05-10T16:00:00.000Z" title="发表于 2024-05-11 00:00:00">2024-05-11</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="/2609320892@qq.com" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://regexlearn.com/zh-cn" title="Regex 101"><i class="anzhiyufont anzhiyu-icon-font"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://regexcrossword.com/" title="Regexcrossword"><i class="anzhiyufont anzhiyu-icon-bolt"></i></a><a class="deal_link" href="/atom.xml" title="RSS"><i class="anzhiyufont anzhiyu-icon-rss"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0, 500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" size="50px"/><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/AYO-Al" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://learngitbranching.js.org/?demo=&amp;locale=zh_CN" title="Learn Git"><i class="anzhiyufont anzhiyu-icon-pencil"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://www.drawio.com/" title="draw.io"><i class="anzhiyufont anzhiyu-icon-instagram"></i></a><a class="deal_link" href="/copyright" title="CC"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i></a></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="algolia" target="_blank" rel="noopener" href="https://www.algolia.com/">algolia</a><a class="footer-item" title="twikoo" target="_blank" rel="noopener" href="https://twikoo.js.org/">twikoo</a><a class="footer-item" title="vercel" target="_blank" rel="noopener" href="https://vercel.com/">vercel</a></div></div><div class="footer-group"><div class="footer-title">主题</div><div class="footer-links"><a class="footer-item" title="文档" target="_blank" rel="noopener" href="https://docs.anheyu.com/">文档</a><a class="footer-item" title="源码" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu">源码</a><a class="footer-item" title="更新日志" target="_blank" rel="noopener" href="https://blog.anheyu.com/update/">更新日志</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="即刻短文" href="/essay/">即刻短文</a><a class="footer-item" title="友链文章" href="/fcircle/">友链文章</a><a class="footer-item" title="留言板" href="/comments/">留言板</a></div></div><div class="footer-group"><div class="footer-title">协议</div><div class="footer-links"><a class="footer-item" title="隐私协议" href="/privacy/">隐私协议</a><a class="footer-item" title="Cookies" href="/cookies/">Cookies</a><a class="footer-item" title="版权协议" href="/copyright/">版权协议</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v7.0.0" title="博客框架为Hexo_v7.0.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v7.0.0"/></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"/></a><a class="github-badge" target="_blank" href="https://www.dogecloud.com/" style="margin-inline:5px" data-title="本站使用多吉云为静态资源提供CDN加速" title="本站使用多吉云为静态资源提供CDN加速"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/CDN-多吉云-3693F3.svg" alt="本站使用多吉云为静态资源提供CDN加速"/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="本站项目由Github托管"/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2021 - 2024 By <a class="footer-bar-link" href="/" title="AYO" target="_blank">AYO</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      if (true) {
        const from = '出自 ' + data.from
        const sub = ["生活明朗&#44; 万物可爱&#44; 人间值得&#44; 未来可期."]
        sub.unshift(data.hitokoto, from)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = data.hitokoto
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.cbd.int/typed.js@2.0.15/dist/typed.umd.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/AYO-Al/AYO-Al.github.io" title="博客">博客</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/AYO-Al" title="本站项目由GitHub托管">本站项目由GitHub托管</a><a class="footer-bar-link cc" href="/copyright" title="cc协议"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-by-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nc-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nd-line"></i></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">52</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">45</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">8</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://git.yuki.love/" title="AYO网站"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="AYO网站"/><span class="back-menu-item-text">AYO网站</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://juejin.cn/user/3708003152300183" title="AYO博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="AYO博客"/><span class="back-menu-item-text">AYO博客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/AYO-Al" title="GitHub"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="GitHub"/><span class="back-menu-item-text">GitHub</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CDN/" style="font-size: 0.88rem;">CDN<sup>1</sup></a><a href="/tags/DNS/" style="font-size: 0.88rem;">DNS<sup>1</sup></a><a href="/tags/Database/" style="font-size: 0.88rem;">Database<sup>8</sup></a><a href="/tags/Docker/" style="font-size: 0.88rem;">Docker<sup>1</sup></a><a href="/tags/ELK/" style="font-size: 0.88rem;">ELK<sup>1</sup></a><a href="/tags/Flask/" style="font-size: 0.88rem;">Flask<sup>1</sup></a><a href="/tags/Httpd/" style="font-size: 0.88rem;">Httpd<sup>1</sup></a><a href="/tags/JavaScript/" style="font-size: 0.88rem;">JavaScript<sup>1</sup></a><a href="/tags/Keepalived/" style="font-size: 0.88rem;">Keepalived<sup>1</sup></a><a href="/tags/LVS/" style="font-size: 0.88rem;">LVS<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>22</sup></a><a href="/tags/MLinux/" style="font-size: 0.88rem;">MLinux<sup>1</sup></a><a href="/tags/MySQL/" style="font-size: 0.88rem;">MySQL<sup>6</sup></a><a href="/tags/Nginx/" style="font-size: 0.88rem;">Nginx<sup>3</sup></a><a href="/tags/Prometheus/" style="font-size: 0.88rem;">Prometheus<sup>1</sup></a><a href="/tags/Python/" style="font-size: 0.88rem;">Python<sup>8</sup></a><a href="/tags/Rabbit/" style="font-size: 0.88rem;">Rabbit<sup>1</sup></a><a href="/tags/Redis/" style="font-size: 0.88rem;">Redis<sup>2</sup></a><a href="/tags/Shell/" style="font-size: 0.88rem;">Shell<sup>3</sup></a><a href="/tags/Web/" style="font-size: 0.88rem;">Web<sup>2</sup></a><a href="/tags/Zabbix/" style="font-size: 0.88rem;">Zabbix<sup>2</sup></a><a href="/tags/%E4%B8%89%E9%AB%98MySQL/" style="font-size: 0.88rem;">三高MySQL<sup>1</sup></a><a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 0.88rem;">中间件<sup>1</sup></a><a href="/tags/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" style="font-size: 0.88rem;">主从复制<sup>1</sup></a><a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" style="font-size: 0.88rem;">云计算<sup>7</sup></a><a href="/tags/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" style="font-size: 0.88rem;">反向代理<sup>1</sup></a><a href="/tags/%E5%9B%9B%E5%A4%A7%E4%BB%B6/" style="font-size: 0.88rem;">四大件<sup>2</sup></a><a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 0.88rem;">开发<sup>7</sup></a><a href="/tags/%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB%E6%9C%8D%E5%8A%A1/" style="font-size: 0.88rem;">文件共享服务<sup>1</sup></a><a href="/tags/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" style="font-size: 0.88rem;">文件系统<sup>1</sup></a><a href="/tags/%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/" style="font-size: 0.88rem;">日志管理<sup>1</sup></a><a href="/tags/%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5/" style="font-size: 0.88rem;">时间同步<sup>1</sup></a><a href="/tags/%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/" style="font-size: 0.88rem;">服务管理<sup>1</sup></a><a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 0.88rem;">爬虫<sup>4</sup></a><a href="/tags/%E7%9B%91%E6%8E%A7/" style="font-size: 0.88rem;">监控<sup>3</sup></a><a href="/tags/%E7%A3%81%E7%9B%98/" style="font-size: 0.88rem;">磁盘<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 0.88rem;">网络<sup>3</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E6%9E%B6%E6%9E%84/" style="font-size: 0.88rem;">网络架构<sup>1</sup></a><a href="/tags/%E8%BD%AF%E4%BB%B6%E7%AE%A1%E7%90%86/" style="font-size: 0.88rem;">软件管理<sup>1</sup></a><a href="/tags/%E9%98%B2%E7%81%AB%E5%A2%99/" style="font-size: 0.88rem;">防火墙<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"><a class="tag-list" href="/tags/Linux" title="Linux">Linux</a><a class="tag-list" href="/tags/Database" title="Database">Database</a><a class="tag-list" href="/tags/Kubernetes" title="Kubernetes">Kubernetes</a></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.4/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2021 By 安知鱼 V1.6.10",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 AYO 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.56.5/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.yuki.love',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.yuki.love',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><script>(() => {
  const initWaline = () => {
    const waline = Waline.init(Object.assign({
      el: '#waline-wrap',
      serverURL: '',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: false,
    }, null))
  }

  const loadWaline = async () => {
    if (typeof Waline === 'object') initWaline()
    else {
      await getCSS('https://cdn.cbd.int/@waline/client@2.15.5/dist/waline.css')
      await getScript('https://cdn.cbd.int/@waline/client@2.15.5/dist/waline.js')
      initWaline()
    }
  }

  if ('Twikoo' === 'Waline' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo.yuki.love',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "visitor@anheyu.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/fireworks.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>