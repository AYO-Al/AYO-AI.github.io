<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>PythonWeb | AYO</title><meta name="keywords" content="Web,Python,Flask"><meta name="author" content="AYO,2609320892@qq.com"><meta name="copyright" content="AYO"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="PythonWeb"><meta name="application-name" content="PythonWeb"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="PythonWeb"><meta property="og:url" content="https://ayo-al.github.io/2021/11/03/MarkDown/web/pythonweb/index.html"><meta property="og:site_name" content="AYO"><meta property="og:description" content="本文介绍了PythonWeb中的Flask框架。"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://pic4.zhimg.com/v2-c2b3eb3319d52218753d0ce20bc7c100_r.jpg?_r_=13445130-584a-4005-5481-9a328412423e"><meta property="article:author" content="AYO"><meta property="article:tag" content=""><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://pic4.zhimg.com/v2-c2b3eb3319d52218753d0ce20bc7c100_r.jpg?_r_=13445130-584a-4005-5481-9a328412423e"><meta name="description" content="本文介绍了PythonWeb中的Flask框架。"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://ayo-al.github.io/2021/11/03/MarkDown/web/pythonweb/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: undefined,
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: 'https://twikoo.yuki.love',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: undefined,
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","🤝 专修交互与设计","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},
  algolia: {"appId":"XMRZIUY8NL","apiKey":"187af2610e1cc500c95dc8b8f3a53d0e","indexName":"hexo","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: AYO","link":"链接: ","source":"来源: AYO","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'AYO',
  title: 'PythonWeb',
  postAI: '',
  pageFillDescription: '概述, 1.HTML和CSS基础, 1.1.什么是Web, 1.2.Web应用程序的工作环境, 2.网络编程基础, 2.1.TCPx2FIP协议, 2.2.IP协议, 基于传输协议的套接字编程, 2.3.TCP协议, 2.4.UDP简介, 2.5.Socket简介, 2.6.TCP编程, 2.6.1.TCP总结(建立简易聊天室), 2.7.UDP编程, 2.7.1.UDP模型, 3.web基础, 3.1.HTTP协议, 3.2.Web服务器, 3.3.WSGI接口, 3.3.1.定义WSGI接口, 3.3.2.运行WSGI服务, 3.4.ORM编程, 4.Web框架基础, 4.1.什么是Web框架？, 4.2.常用的Python Web框架, 5.Flask框架, 5.1.第一个Flask应用, 5.2.开启调试模式, 5.3.HTML转义, 5.4.路由, 5.5.变量规则, 5.6.唯一的URLx2F重定向行为, 5.7.构造URL, 5.8.HTTP方法, 5.9.静态文件, 5.11.渲染模板, 5.12.Web表单, 5.13.蓝图, 5.14.重定向和错误, 6.Flask框架进阶, 6.1.Flask请求, 6.1.1.获取get请求参数, 6.1.2.获取POST请求参数, 6.1.3.请求钩子, 6.2.Flask响应, 6.2.1.Response响应对象, 6.2.2.响应格式, 6.2.3.Cookie和Session, 6.3.消息闪现概述常见的项目类型浏览器服务器模式客户端服务器模式项目不同组成前端网页的内容和框架样式修饰网页内容通过改变和形成页面动态效果或者用户交互操作后台和前端数据交互业务处理处理数据对数据存储的操作数据存储和基础什么是全称为也叫作中文译为万维网万维网是一个通过互联网访问的由许多互相链接的超文本组成的庞大文档系统开发主要分为前端和后端前端是指用户直接交互的部分包括页面结构的外观视觉表现以及层面的交互实现后端更多的是指与数据库进行交互并处理相应的业务逻辑需要考虑的是如何实现业务功能数据存取平台的稳定性与性能等网页主要由格式化文本文件和超文本标记语言组成除此之外网页还可能包括图片影片声音等组件互联网和万维网这两个词通常没有多少区别但本质上两者并不相同互联网是一个全球互相连接的计算机网络系统相比之下万维网只是通过超链接和同一资源标识符连接的全球收集的文本和其他资源系统万维网通常使用协议访问该协议是互联网通信协议中非常关键的一环应用程序的工作环境需要访问万维网上的某个网页或网络资源时需要在浏览器上输入待访问网页的统一资源定位符或者通过超链接跳转工作流程如下的服务器名部分被分布于全球的因特网数据库所解析域名系统根据解析结果进入地址向该地址所在的服务器发送一个请求服务器响应并逐一发送构成该网页的文件网络编程基础协议当计算机为了联网时就必须约定通信协议网络协议三要素为语法语义时序互联网协议包含了上百种协议标准最重要的是协议和协议所以习惯上把互联网的协议简称为协议协议包含四个概念层分别是应用层传输层网络层链路层应用层规范不同计算机之间的服务需求为用户提供所需要的各种服务该层主要协议有文件传输协议远程登录协议域名系统协议电子邮件传输的协议等传输层规范不同计算机之间交流沟通的语言为应用层实体提供端到端的通信功能保证了数据包的顺序传送及数据的完整性传输层中最常见的两个协议分别是传输控制协议和用户数据报协议网络层解决不同计算机之间链接问题主要解决主机到主机的通信问题该层有三个主要协议网络协议互联网组管理协议互联网控制报文协议链路层解决计算机和互联网络链接和数据传输问题负责监视数据在主机和网络之间的交换事实上协议本身并未定义该层的协议而由参与互连的各网络使用自己的物理层和数据链路层协议然后与的网络接入层进行连接协议在通信时通信双方必须知道对方的唯一标识实际上是一个位整数称为以字符串表示例如实际上就是把位整数按位分组后的数字表示目的是便于阅读协议负责把数据从一台计算机通过网络发送到另一台计算机数据被分为一小块一小块然后通过包发送出去由于互联网链路复杂两台计算机直接经常有多条线路因此路由器复杂决定如何把一个包转发出去包的特点就是按块发送途径多个路由但不保证都能到达也不保证顺利到达基于传输协议的套接字编程套接字就是一套用语义协程的应用程序开发库主要用于实现进程间通信和网络编程实际开发中使用的套接字可以分为三类流套接字套接字数据报套接字和原始套接字协议协议建立在协议基础之上负责在两台计算机之间建立可靠连接保证数据包按顺序到达通过三次握手建立可靠连接四次挥手断开连接协议对每个包编号确保对方按顺序收到如果包丢了就重发许多常用的更高级协议都是建立在协议基础上的如用于浏览器的协议发送邮件的协议等一个报文除了包含要传输的数据外还包含源地址和目标地址源端口和目标端口端口每个网络程序都向操作系统申请唯一的端口号标识唯一的程序但是每个线程可能同时与很多计算机进行链接所以会申请很多端口号端口号是按照一定的规定进行分配的如端口给服务端口给服务简介不同于协议协议是面向无连接的协议使用协议时不需要建立连接只需要指定对方的地址和端口号就可以直接发送数据包但是数据无法保证一定到达虽然不可靠但是速度比协议快对于不要求可靠到达的数据就可以使用协议简介为了让两个程序使用网络进行通信二者均必须使用套接字用于描述地址和端口是一个通信链的句柄可以用来实现不同虚拟机或不同计算机之间的通信在中使用模块的函数创建一个套接字对象语法格式该函数带有两个参数可以选择用于进程间通信或者用于同一台机器进程间通信套接字类型可以是流式套接字主要用于协议或者数据套接字主要用于协议创建套接字创建套接字主要方法有方法描述绑定地址到套接字在下以元组的形式表示地址开始监听指定在拒绝连接之前操作系统可以挂起的最大连接数量该值至少为大部分应用程序设为被动接受客户端连接阻塞式等待连接的到来主动初始化服务器连接一般的格式为元组如果连接出错返回错误接受数据以字符串形式返回指定要接受的最大数据量提供有关消息的其他信息通常可以忽略发送数据将中的数据发送到连接的套接字返回值是要发送的字节数量该数量可能小于大小完整发送数据将中的数据发送到连接的套接字但在返回之前会尝试发送所有数据成功则返回失败则抛出异常接受数据与类似但返回值是元组其中是包含接收数据的字符串是发送数据的套接字地址发送数据将数据发送到套接字是形式为的元组指定远程地址返回值是发送的字节数关闭套接字编程因为连接具有安全可靠的特性所以应用更加广泛创建连接时主动发起连接的叫做客户端被动响应连接的叫做服务器创建服务器使用创建一个套接字使用绑定地址使用使套接字变为可以被动连接使用等待客户端的连接使用接收发送数据服务器等待客户端连接字符串前面的代表字符串为对象常用在如网络编程中服务器和浏览器只认类型数据为的响应报文中的响应行分别为协议版本状态码状态描述运行后再浏览器中输入连接服务器后网页就会显示创建客户端请输入要发送的数据接收到的数据为先创建一个服务器在创建一个客户端按顺序运行后客户端发送信息给服务器服务器返回数据给客户端总结建立简易聊天室建立聊天室服务端连接已经建立接收到的内容为输入发送的内容客户端已连接输入要发送的内容接收到的内容按顺序打开服务器和客户端就可以分别发送消息了编程是面向消息的协议通信时不需要建立连接数据的传输不可靠一般用于多点通信和实时的数据业务如语音广播视频聊天软件简单文件传送简单网络管理协议路由信息协议如报告股票市场航空消息域名解析创建服务器绑定到端口转换后的温度创建客户端请输入要转换的温度模型基础协议协议超文本传输协议是互联网上应用最为广泛的一种网络协议利用在两台计算机通常是服务器和客户端之间传输信息服务器当浏览器输入后浏览器会先请求服务器获得请求站点的地址根据后面的获取然后发送一个给拥有该的主机接着就会接收到服务器返回的具体过程建立连接客户端通过协议建立到服务器的连接请求过程客户端想服务器发送协议请求包请求服务器里的资源文档应答过程服务器想客户端发送协议应答包如果请求的资源包含动态语言内容服务器会调用解释引擎处理动态内容并将处理后得到的数据返回给客户端由客户端解释文档最终在用户屏幕上渲染显示图形结果关闭连接客户端和服务器断开连接常用请求方法方法描述请求指定的页面信息并返回实体主体向指定资源提交数据如提交表单或者上传文件进行处理请求数据被包含在请求体中请求会导致新资源的建立或已有资源的修改类似于请求只不过返回的响应中没有具体的内容仅用于获取报头从客户端向服务器传送的数据取代指定的文档内容请求服务器删除指定的页面允许客户端查看服务器端的性能状态码状态码说明表示信息请求收到继续处理继续切换协议表示成功返回响应即行为呗菜狗的接收理解采纳确定客户端已经请求成功已创建已接受非权威性信息无内容重置内容部分内容表明已部分下载一个文件可以续传损坏的下载或者将下载拆分为多个并发的流多状态表示重新定向为了完成请求必须进一步执行的动作已永久移动此请求和之后所有的请求都应该转到指定的对应移动对于基于表单的身份验证此消息通常表示为对象已移动请求的资源临时驻留在不同的由于重定向有事可能会改变客户端将来在请求时应该继续使用只有在或标题字段中只是此响应才能够缓存未修改客户端请求的文档已在其缓存中文档自缓存依赖尚未被修改过客户端使用文档的缓存副本而不从服务器下载文档临时重定向表示客户端错误如请求包含语法错误或者请求无法实现错误的请求访问被拒绝服务器拒绝请求服务器找不到指定请求用来访问本页面的谓词不背允许请求太长执行失败表示服务器错误如服务器不能实现一种明显无效的请求内部服务器错误服务器作为网关或代理服务器时从上游服务器收到了无效响应更多状态码可以去菜鸟教程观看接口使用进程线程池来处理一连串的请求这些进程线程池由服务器管理而不是服务器管理服务器网关接口是服务器和应用程序或框架之间的一种简单而通用的接口中有两种角色接受请求的服务器处理请求的应用它们底层是通过沟通的当服务器收到一个请求后可以通过把环境变量和一个回调函数传给后端应用应用在完成页面组装后通过把内容返回给最后再将响应返回给定义接口接口只要求开发者实现一个函数就可以响应请求一个包含了所有请求信息的字典对象一个发送响应的函数整个函数本身并没有涉及任何解析部分所以底层服务器的解析部分和应用程序逻辑部分进行分离所以函数本身必须由服务器来调用现在很多服务器都符合规范如服务器和服务器等内部还内置了模块但是只是的参考实现也就是不考虑运行效率运行服务创建一个目录创建明日科技明日学院课程读书社区服务联系我们明日课程海量课程随时随地想学就学有多名专业讲师精心打造精品课程让学习创造属于你的生活开始学习创建响应信息获取参数设置文件目录打开文件如果异常返回读取文件内容关闭文件构造响应数据返回数据创建创建一个服务器为空端口为处理函数为开始监听请求运行文件在浏览器输入编程对象关系映射是一种程序设计技术用于实现面向对象编程语言里不同类型系统的数据直接的转换面向对象是在软件工程耦合聚合封装的基础上发展起来的而关系数据库是从数学理论发展而来的数据库和对象的映射如下数据库类数据行对象字段对象的属性上面的语句可以替换为优缺点优点数据模型都在一个地方定义便于更新和维护也利于重用代码有很多现成工具很多功能可以自动完成业务代码更加简洁不会写出性能不佳的语句缺点不是轻量级的要花费很多时间学习与设置不利于复杂查询开发者无法了解数据库底层无法定制语句框架基础什么是框架框架是用来简化开发的软件框架是一些能实现常用功能的文件框架就是一系列工具的集合一个典型的框架通常会提供管理路由支持数据库支持支持支持模块引擎管理会话和是的一种设计模式模型用于封装和业务逻辑相关的数据和数据处理的方法视图是数据的体现控制器负责响应请求数据模式负责将页面展示给用户业务处理更新模板中的数据库模板引擎是为了使用户界面与业务数据分离而产生的它可以生成特定格式的文档用于网站的模板引擎一般生成一个标准的文档如在中的变量会被替换为变量值这就可以更好的实现界面与数据分离常用的框架拥有世界上最大的社区最多的包文档非常完善而且提供一站式的解决方案包括缓存管理后台验证表单处理等使得开发复杂的由数据库驱动的网站变得简单但是系统耦合度较高替换掉内置功能比较复杂学习比较困难是一个轻量级别的框架它把和合在一起所以很容易被扩展不单单是个框架还是个服务器是为了解决实时服务而诞生的使用了异步非阻塞所以运行速度非常快是一个现代的高性能框架能够自动生成框架下载安装框架当安装时以下配套软件会被自动安装用于实现应用和服务之间的标准接口用于渲染页面的模板语言与共用在渲染页面时用于避免不可信的输入防止注入攻击保证数据完整性的安全标志数据用于保护的是一个命令行应用的框架用于提供命令并允许添加自定义管理命令默认环境刚开始的时候有许多带有合理缺省值的配置值和惯例按照惯例模板和静态文件凡在应用源代码树的子目录中名称分别为和可以改变第一个应用导入类该类的实例会成为我们的应用创建该类的一个实例第一个参数是引用模块或者包的名称如果使用单一模块名称为模块的名称将会因其作为单独应用启动还是作为模块导入而有不同这样才知道到哪去找模板静态文件等使用装饰器告诉什么样的能触法执行被装饰的函数函数返回需要在用户浏览器中显示的信息默认内容类型是打开浏览器输入网址就能看见网站内容开启调试模式在对象的方法里可以设置参数开启调试模式这样更改代码后就不需要重启服务了当运行服务后你会发现只有自己的电脑能运行如果您关闭了调试器或信任您网络中的用户那么可以让服务器被公开访问只要在方法上简单的加上即可转义当返回时为了防止注入攻击所有用户提供的值在输出渲染前必须被转义使用可以手动转义路由客户端把请求发送给服务器后服务器会把请求发送给程序实例程序实例需要知道对每个请求运行那些代码所以保存了一个到函数的映射关系处理和函数之间关系的程序称为路由使用装饰器声明路由变量规则通过把的一部分编辑为就可以在中添加变量标记的部分会作为关键字参数传递给函数通过使用可以选择性的加上一个转换器为变量指定规则显示该用户名的用户信息用户名是根据显示文章是整型数据是转换器类型描述默认接收不包含斜杆的文本接受正整数接受征浮点数类似于默认但可以包含斜杆接受字符串唯一的重定向行为的是中规中矩的尾部有一个斜杠看起来就如同一个文件夹访问一个没有斜杠结尾的时会自动进行重定向帮您在尾部加上一个斜杠的没有尾部斜杠因此其行为表现与一个文件类似如果访问这个时添加了尾部斜杠就会得到一个未找到错误这样可以保持唯一并有助于搜索引擎重复索引同一页面构造函数用于构建指定函数的它把函数名称作为第一个参数它可以接受任意个关键字参数每个关键字参数对应中的变量未知变量将添加到中作为查询参数为什么不在把写死在模板中而要使用反转函数动态构建反转通常比硬编码的描述性更好您可以只在一个地方改变而不用到处乱找创建会为您处理特殊字符的转义比较直观生产的路径总是绝对路径可以避免相对路径产生副作用如果您的应用是放在根路径之外的地方如在中不在中会为您妥善处理函数名称规则的变量参数重定向函数一条可以与反转函数一起使用也可以填入视图函数路径转到页面显示该用户名的用户信息用户名是根据显示文章是整型数据是模拟登录流程如果登录成功跳转到首页登录页面告诉正在处理一个请求其实只是运行了服务器而已方法缺省情况下一个路由只回应请求可以使用装饰器的参数来处理不同的方法静态文件当需要调用静态文件一般是和文件时可以用反转函数来生成文件路径文件应该在文件下渲染模板一般来说模板默认在文件夹下所以在中使用函数渲染模板第一个参数为渲染的模板名称第二个参数为模板中变量的值在模板内部可以像使用和函数一样访问和对象模板变量在模板中使用表示一个变量它是一种特殊的占位符告诉模板引擎这个位置的值从渲染模板时使用的数据中获取能识别所有类型的变量如过滤器过滤器是一些可以用来修改和过滤变量值得特殊函数过滤器和变量用一个隔开需要参数的过滤器可以像函数一样使用括号传递如变量首字母会大写常用过滤器说明渲染时不转义把值得首字母转换为大写其他字母转为小写把值转换成小写形式把值转换为大写形式把值每个单词的首字母都转换为大写把值的首尾空格去掉渲染之前把值中所有的标签都删掉截取字符串常用于显示文章摘要参数设置截取的长度参数设置是否截取单词参数设置结尾符号自定义过滤器先写好一个函数再用把函数注册为过滤器第一个参数为函数名第二个参数为注册的过滤器名还可以用装饰器定义过滤器控制结构提供了很多种控制结构用来改变模板的渲染流程对于语句用于变量打印到模板输出对于模板输出中未包含的注释常见的模板控制结构表示结束控制结构能跟一样使用序列的相关函数还支持宏类似于函数定义一个宏调用宏还支持导入模板继承类似于类继承创建文件创建子模块继承父模块内容网页标题为获取父模块内容网页主体内容为局部模板当各个独立模板中使用同一块时可以把这部分代码抽离出来存储到局部模板中为了和普通模板分开局部模板的命名通常是以下划线开始的导入局部模板表单表单是用户跟应用实现交互的基本元素不会自己处理表单但扩展允许用户在应用中使用包从而使得表单和处理表单变得非常轻松安装保护和验证全称为即跨站请求伪造通过第三方伪造表单数据到服务器上在渲染表单时会生成一个独一无二的该将在请求中随表单数据一起传递并且在表单被接受前进行验证的值取决于存储在用户对话中的一个值该值会在分钟后过时为了更好的实现保护需要程序设置一个密钥通过密钥生成加密令牌再用令牌验证请求中表单数据的真伪设置密钥方法可用来存储框架扩展和程序本身的配置变量配置变量时通用密钥表单类请输入姓名请输入密码支持的标准字段字段类型说明文本字段多行文本字段密码文本字段隐藏文本字段文本字段值为格式文本字段值为格式文本字段值为整数文本字段值为格式文本字段值为浮点数复选框值为和一组单选按钮下拉列表下拉列表可选多个值文件上传按钮表单提交按钮把表单作为字段嵌入另一个表单内一组指定类型的字段内置的验证函数字段类型说明验证电子邮件地址比较两个字段的值常用于要求输入两次密码进行确定验证网络地址验证输入字符串的长度验证输入的值在数字范围内无输入值时跳过其他验证函数确保字段中有数据使用正则表达式验证输入值验证确保输入值在可选列表中实例创建模板首页明日学院明日图书关于我们公司简介企业文化联系我们创建表单类登录表单类用户名用户名不能为空用户名长度必须大于且小于密码密码不能为空用户名长度必须大于且小于提交创建主函数登录页面实例化表单对象渲染页面和表单首页明日学院明日学院是吉林省明日科技有限公司倾力打造的在线实用技能学习平台该平台于年正式上线主要为学习者提供海量优质的课程课程结构严谨用户可以根据自身的学习程度自主安排学习进度我们的宗旨是为编程学习者提供一站式服务培养用户的编程思维蓝图蓝图是一个存储操作方法的容器当它被注册到一个应用后这些操作方法就可以被调用蓝图很好的简化了大型应用的工作方式并给扩展提供了在应用上注册操作的核心方法蓝图对象不能独立运行必须将他注册到一个应用对象上使用蓝图的原因一个应用可以分解为多个蓝图的集合这对大型应用是理想的一个项目可以实例化一个应用对象初始化几个扩展并注册多个蓝图对前缀子域名可以在应用上注册一个蓝图前缀子域名中的参数即成为这个蓝图下所有视图函数的共同视图参数默认情况下在一个应用中用不同的规则可以多次注册一个蓝图通过蓝图可提供模板过滤器静态文件模板和其他功能一个蓝图不一定要实现应用或者视图函数初始化一个扩展时需要注册一个蓝图视图相关联的名称亦称为端点缺省情况下端点名称与视图函数名称相同前文被加入应用工厂的视图端点为可以使用来连接如果视图有参数后文会看到那么可使用连接当使用蓝图的时候蓝图的名称会添加到函数名称的前面上面的函数的端点为因为它已被加入蓝图中蓝图在包下的文件里面创建创建蓝图文件夹下的文件也可以直接在创建时加入创建蓝图创建蓝图文件夹下的文件创建蓝图第一个参数为蓝图名第二个为蓝图所在的模块名绑定蓝图在与上两文件夹同级下创建文件注册蓝图第一个参数为蓝图名称第二个参数为蓝图的前缀重定向和错误使用可以更早退出请求并返回错误代码使用装饰器可以定制出错页面框架进阶进阶知识包括的请求和响应高级模板技术以及和数据库相关的操作请求使用请求对象可以获取请求中各个字段的值对象的常用属性和方法属性或方法说明一个字典存储请求提交的所有表单字段一个字典存储通过查询字符串传递的所有参数一个字典和的合集一个字典存储所有请求的一个字典存储所有请求的所有首部一个字典存储请求上传的所有文件返回请求主体缓冲的数据返回一个字典包含解析请求主体后得到的处理请求的蓝本的名称处理请求的的端点名称请求方法可以是或方案或通过安全的连接发送请求时返回请求定义的主机名如果客户端定义了端口号还包括端口号的路径部分的查询字符串部分返回原始二进制值的路径和查询字符串部分客户端请求的完整同但没有查询字符串部分客户端的地址请求的元素环境字典获取请求参数获取的与值姓名年龄获取请求参数获取表单提交数据用户名是密码是获取表单提交的文件判断上传文件类型是否允许文件名布尔值或生成随机文件文件名随机文件名获取文件后缀使用生成随机字符头像上传表单页面接受头像字段判断文件是否上传已经上传文件类型是否正确生成一个随机文件名保存文件显示上传头像文件名真实文件路径请求钩子有时需要对请求进行预处理和后处理这时可以使用提供的请求钩子以注册在请求处理的不同阶段执行的处理函数或称为回调函数即请求钩子在执行视图函数前后执行的一些函数用户可以在这些函数里面做一些操作利用装饰器提供钩子在处理第一个请求前执行如链接数据库操作在每次请求前执行如权限校验每次请求之后调用前提是没有未处理的异常抛出在每次请求之后调用即使有未处理的异常抛出视图执行中响应响应对象响应在中使用对象表示响应报文大部分内容由服务器处理大多数情况下只负责返回主体内容当你在浏览器输入一个网址时会先判断是否可以找到与请求相匹配的路由如果没有则返回响应如果找到则调用相应的视图函数视图函数的返回值构成了响应报文的主体内容当请求成功时返回状态码默认为视图函数可以返回最多由三个元素构成的元组响应主体状态码和首部字段最常见的响应只包含主体内容还可以返回带状态码的形式有时需要附加或修改某个首部字段生成状态码为的重定向响应需要将首部中的字段设置为重定向的目标响应格式在响应中数据可以通过多种格式传输大多数情况下使用格式这也是中的默认设置不同的响应数据需要设置不同的类型类型在首部的字段中定义默认的类型当需要使用其他格式时可以通过使用提供的方法生成响应对象传入响应主体作为参数然后使用响应对象的属性设置类型常用的数据格式有纯文本和对象是无状态协议一次请求响应结束后服务器不会留下任何关于对方状态的信息所以就有了技术技术通过在请求和响应报文中添加数据来保护客户端的状态指服务器为了存储某些数据如用户信息而保存在浏览器上的小型文本数据浏览器会在一定时间内保存它并在下一次向同一个服务器发送请求时附带这些数据通常被用来进行用户会话管理在中使用类提供的方法可以在响应中添加一个首先使用方法手动生成一个响应对象传入响应主体作为参数内置的类的常用属性和方法属性或方法说明一个的对象表示响应首部可以像字典一样操作状态状态码文本类型类型用来设置解析是否为数据判断是否为数据选项的常用属性说明属性说明的名称的值被保存的世界单位为秒默认在用户会话结束关闭浏览器过期具体的过期时间一个对象或时间戳下载时只有给定的路径可用默认为整个域名设置可用的域名如果为只有通过才可以使用如果为禁止客户端获取判断是否存在欢迎来到首页请先登录验证表单数据如果用户名和密码正确将用户名写入登录成功获取对象将用户名写入返回对象渲染表单页面退出登录设置过期时间为即删除对象因为在浏览器中手动添加和修改很容易所处提供了对象以对数据加密存储指用户会话又称对话即服务器和客户端浏览器之间或桌面程序和用户之间建立的交互活动是一种持久网络协议通过在用户端和服务器端之间创建关联起到交换数据包的作用机制在不包含会话层或者是无法长时间驻留会话层的传输协议中会话的维持需要依靠数据参数中的高级别程序在中对象用来加密默认情况下它会把数据存储在浏览器上一个名为的李通过密钥对数据进行签名以加密数据因此需要先设置一个密钥设置密钥使用判断用户是否登录在上面代码基础上修改设置秘钥欢迎来到首页请先登录验证表单数据写入渲染表单页面消息闪现在开发过程中经常需要提示用户操作成功或操作失败针对这种需求提供了一个非常有用的函数可以用来闪现需要显示给用户的信息语法格式消息内容消息类型用于对不同的消息内容分类处理通过函数发送的信息会存储在对象中所以需要为程序设置密钥可以通过属性或配置变量进行设置创建定义不同消息类型的格式使用获取消息列表用限制变量的作用域用户名密码提交创建设置秘钥验证表单数据恭喜您登录成功用户名或密码错误渲染表单页面',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-02-17 14:51:36',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.0.0"><link rel="alternate" href="/atom.xml" title="AYO" type="application/atom+xml">
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://git.yuki.love/" title="AYO网站"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="AYO网站"/><span class="back-menu-item-text">AYO网站</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://juejin.cn/user/3708003152300183" title="AYO博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="AYO博客"/><span class="back-menu-item-text">AYO博客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/AYO-Al" title="GitHub"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="GitHub"/><span class="back-menu-item-text">GitHub</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">AYO</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Ansible/" style="font-size: 1.05rem;">Ansible<sup>1</sup></a><a href="/tags/CDN/" style="font-size: 1.05rem;">CDN<sup>1</sup></a><a href="/tags/DNS/" style="font-size: 1.05rem;">DNS<sup>1</sup></a><a href="/tags/Database/" style="font-size: 1.05rem;">Database<sup>8</sup></a><a href="/tags/Docker/" style="font-size: 1.05rem;">Docker<sup>1</sup></a><a href="/tags/ELK/" style="font-size: 1.05rem;">ELK<sup>1</sup></a><a href="/tags/Flask/" style="font-size: 1.05rem;">Flask<sup>1</sup></a><a href="/tags/Httpd/" style="font-size: 1.05rem;">Httpd<sup>1</sup></a><a href="/tags/JavaScript/" style="font-size: 1.05rem;">JavaScript<sup>1</sup></a><a href="/tags/Keepalived/" style="font-size: 1.05rem;">Keepalived<sup>1</sup></a><a href="/tags/LVS/" style="font-size: 1.05rem;">LVS<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 1.05rem;">Linux<sup>22</sup></a><a href="/tags/MLinux/" style="font-size: 1.05rem;">MLinux<sup>1</sup></a><a href="/tags/MySQL/" style="font-size: 1.05rem;">MySQL<sup>6</sup></a><a href="/tags/Nginx/" style="font-size: 1.05rem;">Nginx<sup>3</sup></a><a href="/tags/Prometheus/" style="font-size: 1.05rem;">Prometheus<sup>1</sup></a><a href="/tags/Python/" style="font-size: 1.05rem;">Python<sup>8</sup></a><a href="/tags/Rabbit/" style="font-size: 1.05rem;">Rabbit<sup>1</sup></a><a href="/tags/Redis/" style="font-size: 1.05rem;">Redis<sup>2</sup></a><a href="/tags/Shell/" style="font-size: 1.05rem;">Shell<sup>3</sup></a><a href="/tags/Web/" style="font-size: 1.05rem;">Web<sup>2</sup></a><a href="/tags/Zabbix/" style="font-size: 1.05rem;">Zabbix<sup>2</sup></a><a href="/tags/%E4%B8%89%E9%AB%98MySQL/" style="font-size: 1.05rem;">三高MySQL<sup>1</sup></a><a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 1.05rem;">中间件<sup>1</sup></a><a href="/tags/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" style="font-size: 1.05rem;">主从复制<sup>1</sup></a><a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" style="font-size: 1.05rem;">云计算<sup>7</sup></a><a href="/tags/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" style="font-size: 1.05rem;">反向代理<sup>1</sup></a><a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 1.05rem;">开发<sup>7</sup></a><a href="/tags/%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB%E6%9C%8D%E5%8A%A1/" style="font-size: 1.05rem;">文件共享服务<sup>1</sup></a><a href="/tags/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" style="font-size: 1.05rem;">文件系统<sup>1</sup></a><a href="/tags/%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/" style="font-size: 1.05rem;">日志管理<sup>1</sup></a><a href="/tags/%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5/" style="font-size: 1.05rem;">时间同步<sup>1</sup></a><a href="/tags/%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/" style="font-size: 1.05rem;">服务管理<sup>1</sup></a><a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 1.05rem;">爬虫<sup>4</sup></a><a href="/tags/%E7%9B%91%E6%8E%A7/" style="font-size: 1.05rem;">监控<sup>3</sup></a><a href="/tags/%E7%A3%81%E7%9B%98/" style="font-size: 1.05rem;">磁盘<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 1.05rem;">网络<sup>3</sup></a><a href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/" style="font-size: 1.05rem;">自动化运维<sup>1</sup></a><a href="/tags/%E8%BD%AF%E4%BB%B6%E7%AE%A1%E7%90%86/" style="font-size: 1.05rem;">软件管理<sup>1</sup></a><a href="/tags/%E9%98%B2%E7%81%AB%E5%A2%99/" style="font-size: 1.05rem;">防火墙<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">三月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">十一月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/10/"><span class="card-archive-list-date">十月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/09/"><span class="card-archive-list-date">九月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/Python/" itemprop="url">Python</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Web/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Web</span></a><a class="article-meta__tags" href="/tags/Python/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Python</span></a><a class="article-meta__tags" href="/tags/Flask/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Flask</span></a></span></div></div><h1 class="post-title" itemprop="name headline">PythonWeb</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2021-11-02T16:00:00.000Z" title="发表于 2021-11-03 00:00:00">2021-11-03</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-02-17T06:51:36.018Z" title="更新于 2024-02-17 14:51:36">2024-02-17</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">14.5k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>57分钟</span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为长沙"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>长沙</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://pic4.zhimg.com/v2-c2b3eb3319d52218753d0ce20bc7c100_r.jpg?_r_=13445130-584a-4005-5481-9a328412423e"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://ayo-al.github.io/2021/11/03/MarkDown/web/pythonweb/"><header><a class="post-meta-categories" href="/categories/Python/" itemprop="url">Python</a><a href="/tags/Web/" tabindex="-1" itemprop="url">Web</a><a href="/tags/Python/" tabindex="-1" itemprop="url">Python</a><a href="/tags/Flask/" tabindex="-1" itemprop="url">Flask</a><h1 id="CrawlerTitle" itemprop="name headline">PythonWeb</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">AYO</span><time itemprop="dateCreated datePublished" datetime="2021-11-02T16:00:00.000Z" title="发表于 2021-11-03 00:00:00">2021-11-03</time><time itemprop="dateCreated datePublished" datetime="2024-02-17T06:51:36.018Z" title="更新于 2024-02-17 14:51:36">2024-02-17</time></header><h2 id="概述"><a href="#概述" class="headerlink" title="#概述"></a>#概述</h2><blockquote>
<p>常见的项目类型</p>
</blockquote>
<ol>
<li>B&#x2F;S<ul>
<li>浏览器&#x2F;服务器模式</li>
</ul>
</li>
<li>C&#x2F;S<ul>
<li>客户端&#x2F;服务器模式</li>
</ul>
</li>
</ol>
<blockquote>
<p>项目不同组成</p>
</blockquote>
<ul>
<li><p>前端	</p>
<ul>
<li>HTML：web网页的内容和框架</li>
<li>CSS：样式，修饰网页内容</li>
<li>JavaScript：通过改变HTML和CSS形成页面动态效果或者用户交互操作</li>
</ul>
</li>
<li><p>后台</p>
<ul>
<li>和前端数据交互</li>
<li>业务处理-处理数据</li>
<li>对数据存储的操作</li>
</ul>
</li>
<li><p>数据存储</p>
</li>
</ul>
<h2 id="1-HTML和CSS基础"><a href="#1-HTML和CSS基础" class="headerlink" title="1.HTML和CSS基础"></a>1.HTML和CSS基础</h2><h3 id="1-1-什么是Web"><a href="#1-1-什么是Web" class="headerlink" title="1.1.什么是Web"></a>1.1.什么是Web</h3><p>web，全称为World Wide Web，也叫作www，中文译为万维网。万维网是一个通过互联网访问的、由许多互相链接的超文本组成的庞大文档系统</p>
<p>Web开发主要分为前端和后端，前端是指用户直接交互的部分，包括Web页面结构(<strong>HTML</strong>)，Web的外观视觉表现(<strong>CSS</strong>)以及Web层面的交互实现(<strong>JavaScript</strong>)，后端更多的是指与数据库进行交互并处理相应的业务逻辑，需要考虑的是如何实现业务功能、数据存取、平台的稳定性与性能等</p>
<p>网页主要由格式化文本文件和超文本标记语言(<strong>HTML</strong>)组成，除此之外，网页还可能包括图片、影片、声音等组件</p>
<blockquote>
<p>互联网和万维网这两个词通常没有多少区别，但本质上两者并不相同。互联网是一个全球互相连接的计算机网络系统，相比之下，万维网只是通过超链接和同一资源标识符连接的全球收集的文本和其他资源系统。万维网通常使用HTTP协议访问，该协议是互联网通信协议中非常关键的一环</p>
</blockquote>
<h3 id="1-2-Web应用程序的工作环境"><a href="#1-2-Web应用程序的工作环境" class="headerlink" title="1.2.Web应用程序的工作环境"></a>1.2.Web应用程序的工作环境</h3><p>需要访问万维网上的某个网页或网络资源时，需要在浏览器上输入待访问网页的统一资源定位符(<strong>URL</strong>)，或者通过超链接跳转。</p>
<p>工作流程如下：</p>
<ol>
<li>URL的服务器名部分，被分布于全球的因特网数据库所解析(域名系统)</li>
<li>根据解析结果进入IP地址</li>
<li>向该IP地址所在的服务器发送一个HTTP请求</li>
<li>服务器响应并逐一发送构成该网页的文件</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://note.youdao.com/yws/public/resource/92933d878935240680c00793fc3e404c/xmlnote/WEBRESOURCE39c46921fdb054ef959a82e3abe732a5/414"></p>
<h2 id="2-网络编程基础"><a href="#2-网络编程基础" class="headerlink" title="2.网络编程基础"></a>2.网络编程基础</h2><h3 id="2-1-TCP-IP协议"><a href="#2-1-TCP-IP协议" class="headerlink" title="2.1.TCP&#x2F;IP协议"></a>2.1.TCP&#x2F;IP协议</h3><p>当计算机为了联网时，就必须约定通信协议。</p>
<p>网络协议三要素为：语法、语义、时序</p>
<p>互联网协议包含了上百种协议标准，最重要的是TCP协议和IP协议，所以习惯上把互联网的协议简称为TCP&#x2F;IP协议。TCP&#x2F;IP协议包含四个概念层，分别是应用层、传输层、网络层、链路层</p>
<ol>
<li>应用层：规范不同计算机之间的服务需求，为用户提供所需要的各种服务。该层主要协议有FTP(文件传输协议)、Telnet(远程登录协议)、DNS(域名系统协议)、SMTP(电子邮件传输的协议)等</li>
<li>传输层：规范不同计算机之间交流沟通的语言，为应用层实体提供端到端的通信功能，保证了数据包的顺序传送及数据的完整性。传输层中最常见的两个协议分别是传输控制协议(TCP)和用户数据报协议(UDP)</li>
<li>网络层：解决不同计算机之间链接问题，主要解决主机到主机的通信问题。该层有三个主要协议：网络协议(IP)、互联网组管理协议(IGMP)、互联网控制报文协议(ICMP)</li>
<li>链路层：解决计算机和互联网络链接和数据传输问题，负责监视数据在主机和网络之间的交换。事实上，TCP&#x2F;IP协议本身并未定义该层的协议，而由参与互连的各网络使用自己的物理层和数据链路层协议，然后与TCP&#x2F;IP的网络接入层进行连接</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://note.youdao.com/yws/public/resource/92933d878935240680c00793fc3e404c/xmlnote/WEBRESOURCE212e32f9e5ce2a54e32079b9f9e03bbd/416"></p>
<h3 id="2-2-IP协议"><a href="#2-2-IP协议" class="headerlink" title="2.2.IP协议"></a>2.2.IP协议</h3><p>在通信时，通信双方必须知道对方的唯一标识(IP)。</p>
<p>IP：IP实际上是一个32位整数(称为IPv4)，以字符串表示。</p>
<blockquote>
<p>例如：172.16.254.1</p>
<p>实际上就是把32位整数按8位分组后的数字表示，目的是便于阅读</p>
<p>IP协议负责把数据从一台计算机通过网络发送到另一台计算机。</p>
<p>数据被分为一小块一小块，然后通过IP包发送出去。</p>
<p>由于互联网链路复杂，两台计算机直接经常有多条线路，因此路由器复杂决定如何把一个IP包转发出去。</p>
<p>IP包的特点就是按块发送，途径多个路由，但不保证都能到达，也不保证顺利到达</p>
</blockquote>
<h3 id="基于传输协议的套接字编程"><a href="#基于传输协议的套接字编程" class="headerlink" title="基于传输协议的套接字编程"></a>基于传输协议的套接字编程</h3><p>套接字就是一套用c语义协程的应用程序开发库，主要用于实现进程间通信和网络编程。</p>
<p>实际开发中使用的套接字可以分为三类：流套接字(TCP套接字)、数据报套接字和原始套接字</p>
<h3 id="2-3-TCP协议"><a href="#2-3-TCP协议" class="headerlink" title="2.3.TCP协议"></a>2.3.TCP协议</h3><blockquote>
<p>TCP协议建立在IP协议基础之上。</p>
<p>TCP负责在两台计算机之间建立可靠连接，保证数据包按顺序到达</p>
<p><strong>TCP通过三次握手建立可靠连接</strong>，<strong>四次挥手断开连接</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://note.youdao.com/yws/public/resource/92933d878935240680c00793fc3e404c/xmlnote/WEBRESOURCEe2a4bd56f9ff032dcfdccf6ac3e34f32/418"></p>
<p><strong>TCP协议对每个IP包编号，确保对方按顺序收到，如果包丢了就重发</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://note.youdao.com/yws/public/resource/92933d878935240680c00793fc3e404c/xmlnote/WEBRESOURCEb25ceed4107868707e120241d4aff853/420"></p>
<p>许多常用的更高级协议都是建立在TCP协议基础上的，如用于浏览器的HTTP协议、发送邮件的SMTP协议等</p>
<p>一个TCP报文除了包含要传输的数据外，<strong>还包含源IP地址和目标IP地址，源端口和目标端口</strong></p>
<p>端口：每个网络程序都向操作系统申请唯一的端口号，标识唯一的程序</p>
<p>但是每个线程可能同时与很多计算机进行链接，所以会申请很多端口号。端口号是按照一定的规定进行分配的，如：80端口给HTTP服务，21端口给FTP服务</p>
</blockquote>
<h3 id="2-4-UDP简介"><a href="#2-4-UDP简介" class="headerlink" title="2.4.UDP简介"></a>2.4.UDP简介</h3><p>不同于TCP协议，UDP协议是面向无连接的协议。使用UDP协议时，不需要建立连接，只需要指定对方的IP地址和端口号，就可以直接发送数据包。但是数据无法保证一定到达。</p>
<p>虽然不可靠，但是速度比TCP协议快，对于不要求可靠到达的数据就可以使用UDP协议</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://note.youdao.com/yws/public/resource/92933d878935240680c00793fc3e404c/xmlnote/WEBRESOURCE2ccc9e5e2c2382827be6996339f17484/422"></p>
<h3 id="2-5-Socket简介"><a href="#2-5-Socket简介" class="headerlink" title="2.5.Socket简介"></a>2.5.Socket简介</h3><p>为了让两个程序使用网络进行通信，二者均必须使用Socket套接字，用于描述IP地址和端口，是一个通信链的句柄，可以用来实现不同虚拟机或不同计算机之间的通信。</p>
<p>在python中使用socket模块的socket函数创建一个socket套接字对象</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 语法格式：</span></span><br><span class="line">s = socket.socket(socket.ADDressFamily,socket.<span class="type">Type</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;</span></span><br><span class="line">该函数带有两个参数：</span><br><span class="line">ADDressFamily：可以选择AF_INET(用于Internet进程间通信)或者AF_UNIX(用于同一台机器进程间通信)</span><br><span class="line"><span class="type">Type</span>：套接字类型，可以是SOCK_STREAM(流式套接字，主要用于TCP协议)或者SOCK_DGRAM(数据套接字，主要用于UDP协议)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建TCP/IP套接字</span></span><br><span class="line">s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建UDP/IP套接字</span></span><br><span class="line">s = socket.socket(socket.AF_INET,socket.SOCK_DGRAM)</span><br></pre></td></tr></table></figure>

<p>主要方法有：</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>s.bind()</td>
<td>绑定地址(host,port)到套接字，在AF_INET下以元组(host,port)的形式表示地址</td>
</tr>
<tr>
<td>s.listen()</td>
<td>开始TCP监听。backlog指定在拒绝连接之前，操作系统可以挂起的最大连接数量。该值至少为1，大部分应用程序设为5</td>
</tr>
<tr>
<td>s.accept()</td>
<td>被动接受TCP客户端连接，(阻塞式)等待连接的到来</td>
</tr>
<tr>
<td>s.connect()</td>
<td>主动初始化TCP服务器连接，一般address的格式为元组(host,port)，如果连接出错，返回socket.error错误</td>
</tr>
<tr>
<td>s.recv()</td>
<td>接受TCP数据，以字符串形式返回。bufsize指定要接受的最大数据量；flag提供有关消息的其他信息，通常可以忽略</td>
</tr>
<tr>
<td>s.send()</td>
<td>发送TCP数据，将string中的数据发送到连接的套接字。返回值是要发送的字节数量，该数量可能小于string大小</td>
</tr>
<tr>
<td>s.sendall()</td>
<td>完整发送TCP数据。。将string中的数据发送到连接的套接字，但在返回之前会尝试发送所有数据。成功则返回None，失败则抛出异常</td>
</tr>
<tr>
<td>s.recvfrom()</td>
<td>接受UDP数据。与recv()类似，但返回值是(data,address)元组。其中data是包含接收数据的字符串，address是发送数据的套接字地址</td>
</tr>
<tr>
<td>s.sendto()</td>
<td>发送UDP数据，将数据发送到套接字。address是形式为(ipaddr,port)的元组，指定远程地址。返回值是发送的字节数</td>
</tr>
<tr>
<td>s.close()</td>
<td>关闭套接字</td>
</tr>
</tbody></table>
<h3 id="2-6-TCP编程"><a href="#2-6-TCP编程" class="headerlink" title="2.6.TCP编程"></a>2.6.TCP编程</h3><p>因为TCP连接具有安全可靠的特性所以TCP应用更加广泛。创建TCP连接时，主动发起连接的叫做客户端，被动响应连接的叫做服务器。</p>
<p><strong>创建TCP服务器：</strong></p>
<ol>
<li>使用socket创建一个套接字</li>
<li>使用bind绑定IP地址</li>
<li>使用listen使套接字变为可以被动连接</li>
<li>使用accept等待客户端的连接</li>
<li>使用recv&#x2F;send接收发送数据</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">host = <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">port = <span class="number">8080</span></span><br><span class="line">web = socket.socket()</span><br><span class="line">web.bind((host,port))</span><br><span class="line">web.listen(<span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;服务器等待客户端连接..&#x27;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    conn,addr = web.accept()</span><br><span class="line">    data = conn.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line">    <span class="comment"># 字符串前面的b代表字符串为bytes对象</span></span><br><span class="line">    <span class="comment"># 常用在如网络编程中，服务器和浏览器只认bytes类型数据</span></span><br><span class="line">    <span class="comment"># HTTP/1.1 200 ok为HTTP的响应报文中的响应行，分别为HTTP协议版本 状态码 状态描述</span></span><br><span class="line">    conn.sendall(<span class="string">b&#x27;HTTP/1.1 200 ok\r\n\r\nHELLO World&#x27;</span>)</span><br><span class="line">    conn.close()</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 运行后再浏览器中输入127.0.0.1:8080连接服务器后网页就会显示HELLO World</span></span><br></pre></td></tr></table></figure>

<p><strong>创建TCP客户端</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">host = <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">port = <span class="number">8080</span></span><br><span class="line">s = socket.socket()</span><br><span class="line">s.connect((host,port))</span><br><span class="line">send_data = <span class="built_in">input</span>(<span class="string">&#x27;请输入要发送的数据：&#x27;</span>)</span><br><span class="line">s.send(send_data.encode())</span><br><span class="line">recvData = s.recv(<span class="number">1024</span>).decode()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;接收到的数据为：&#x27;</span>,recvData)</span><br><span class="line">s.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 先创建一个服务器，在创建一个客户端</span></span><br><span class="line"><span class="comment"># 按顺序运行后，客户端发送信息给服务器，服务器返回数据给客户端</span></span><br></pre></td></tr></table></figure>

<h4 id="2-6-1-TCP总结-建立简易聊天室"><a href="#2-6-1-TCP总结-建立简易聊天室" class="headerlink" title="2.6.1.TCP总结(建立简易聊天室)"></a>2.6.1.TCP总结(建立简易聊天室)</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://note.youdao.com/yws/public/resource/92933d878935240680c00793fc3e404c/xmlnote/WEBRESOURCE75d0420b65b4ceac5ec72bbb623b806d/429"></p>
<p><strong>建立聊天室</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 服务端</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">host = socket.gethostname()</span><br><span class="line">port = <span class="number">12345</span></span><br><span class="line">s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">s.bind((host,port))</span><br><span class="line">s.listen(<span class="number">1</span>)</span><br><span class="line">sock,addr = s.accept()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;连接已经建立&#x27;</span>)</span><br><span class="line">info = sock.recv(<span class="number">1024</span>).decode()</span><br><span class="line"><span class="keyword">while</span> info != <span class="string">&#x27;byebye&#x27;</span>:</span><br><span class="line">    <span class="keyword">if</span> info:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;接收到的内容为：&#x27;</span>+info)</span><br><span class="line">    send_data = <span class="built_in">input</span>(<span class="string">&#x27;输入发送的内容：&#x27;</span>)</span><br><span class="line">    sock.send(send_data.encode())</span><br><span class="line">    <span class="keyword">if</span> send_data == <span class="string">&#x27;byebye&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    info = sock.recv(<span class="number">1024</span>).decode()</span><br><span class="line">sock.close()</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 客户端</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">s = socket.socket()</span><br><span class="line">host = socket.gethostname()</span><br><span class="line">port = <span class="number">12345</span></span><br><span class="line">s.connect((host,port))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;已连接&#x27;</span>)</span><br><span class="line">info = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">while</span> info!= <span class="string">&#x27;byebye&#x27;</span>:</span><br><span class="line">    send_data = <span class="built_in">input</span>(<span class="string">&#x27;输入要发送的内容：&#x27;</span>)</span><br><span class="line">    s.send(send_data.encode())</span><br><span class="line">    <span class="keyword">if</span> send_data == <span class="string">&#x27;byebye&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    info = s.recv(<span class="number">1024</span>).decode()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;接收到的内容：&#x27;</span>+info)</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>按顺序打开服务器和客户端，就可以分别发送消息了</p>
</blockquote>
<h3 id="2-7-UDP编程"><a href="#2-7-UDP编程" class="headerlink" title="2.7.UDP编程"></a>2.7.UDP编程</h3><p>UDP是面向消息的协议，通信时不需要建立连接，数据的传输不可靠。UDP一般用于多点通信和实时的数据业务。如：</p>
<ol>
<li>语音广播</li>
<li>视频</li>
<li>聊天软件</li>
<li>TFTP(简单文件传送)</li>
<li>SNMP(简单网络管理协议)</li>
<li>RIP(路由信息协议，如报告股票市场，航空消息)</li>
<li>DNS(域名解析)</li>
</ol>
<p><strong>创建UDP服务器</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET,socket.SOCK_DGRAM)</span><br><span class="line">s.bind((<span class="string">&#x27;127.0.0.1&#x27;</span>,<span class="number">8888</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;绑定UDP到8888端口&#x27;</span>)</span><br><span class="line">data,addr = s.recvfrom(<span class="number">1024</span>)</span><br><span class="line">data = <span class="built_in">float</span>(data)*<span class="number">1.8</span>+<span class="number">32</span></span><br><span class="line">send_data = <span class="string">&#x27;转换后的温度：&#x27;</span>+<span class="built_in">str</span>(data)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Received from %s:%s.&#x27;</span> % addr)</span><br><span class="line">s.sendto(send_data.encode(),addr)</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>

<p><strong>创建UDP客户端</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET,socket.SOCK_DGRAM)</span><br><span class="line">data = <span class="built_in">input</span>(<span class="string">&#x27;请输入要转换的温度:&#x27;</span>)</span><br><span class="line">s.sendto(data.encode(),(<span class="string">&#x27;127.0.0.1&#x27;</span>,<span class="number">8888</span>))</span><br><span class="line"><span class="built_in">print</span>(s.recv(<span class="number">1024</span>).decode())</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>

<h4 id="2-7-1-UDP模型"><a href="#2-7-1-UDP模型" class="headerlink" title="2.7.1.UDP模型"></a>2.7.1.UDP模型</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://note.youdao.com/yws/public/resource/92933d878935240680c00793fc3e404c/xmlnote/WEBRESOURCE80520a3dcdde67fe608917c3ad00f357/432"></p>
<h2 id="3-web基础"><a href="#3-web基础" class="headerlink" title="3.web基础"></a>3.web基础</h2><h3 id="3-1-HTTP协议"><a href="#3-1-HTTP协议" class="headerlink" title="3.1.HTTP协议"></a>3.1.HTTP协议</h3><p><strong>HTTP协议(超文本传输协议)是互联网上应用最为广泛的一种网络协议。利用TCP在两台计算机(通常是Web服务器和客户端)之间传输信息。</strong></p>
<h3 id="3-2-Web服务器"><a href="#3-2-Web服务器" class="headerlink" title="3.2.Web服务器"></a>3.2.Web服务器</h3><p>当浏览器输入URL后，浏览器会先请求DNS服务器，获得请求站点的IP地址(根据http后面的URL获取)，然后发送一个HTTPRequest给拥有该IP的主机，接着就会接收到服务器返回的HTTPResponse</p>
<p>具体过程：</p>
<ol>
<li>建立连接：客户端通过TCP&#x2F;IP协议建立到服务器的TCP连接</li>
<li>请求过程：客户端想服务器发送HTTP协议请求包，请求服务器里的资源文档</li>
<li>应答过程：服务器想客户端发送HTTP协议应答包，如果请求的资源包含动态语言内容，服务器会调用解释引擎处理动态内容，并将处理后得到的数据返回给客户端。由客户端解释HTML文档，最终在用户屏幕上渲染显示图形结果</li>
<li>关闭连接：客户端和服务器断开连接</li>
</ol>
<p>​																<strong>HTTP常用请求方法</strong></p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>请求指定的页面信息，并返回实体主体</td>
</tr>
<tr>
<td>POST</td>
<td>向指定资源提交数据(如提交表单或者上传文件)，进行处理请求。数据被包含在请求体中，POST请求会导致新资源的建立或已有资源的修改</td>
</tr>
<tr>
<td>HEAD</td>
<td>类似于GET请求，只不过返回的响应中没有具体的内容，仅用于获取报头</td>
</tr>
<tr>
<td>PUT</td>
<td>从客户端向服务器传送的数据取代指定的文档内容</td>
</tr>
<tr>
<td>DELETE</td>
<td>请求服务器删除指定的页面</td>
</tr>
<tr>
<td>OPTIONS</td>
<td>允许客户端查看服务器端的性能</td>
</tr>
</tbody></table>
<p>​														<strong>HTTP状态码</strong></p>
<table>
<thead>
<tr>
<th>状态码</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>1xx</strong></td>
<td>表示信息请求收到，继续处理</td>
</tr>
<tr>
<td>100</td>
<td>继续</td>
</tr>
<tr>
<td>101</td>
<td>切换协议</td>
</tr>
<tr>
<td><strong>2xx</strong></td>
<td>表示成功返回响应，即行为呗菜狗的接收、理解、采纳</td>
</tr>
<tr>
<td>200</td>
<td>确定。客户端已经请求成功</td>
</tr>
<tr>
<td>201</td>
<td>已创建</td>
</tr>
<tr>
<td>202</td>
<td>已接受</td>
</tr>
<tr>
<td>203</td>
<td>非权威性信息</td>
</tr>
<tr>
<td>204</td>
<td>无内容</td>
</tr>
<tr>
<td>205</td>
<td>重置内容</td>
</tr>
<tr>
<td>206</td>
<td>部分内容。表明已部分下载一个文件，可以续传损坏的下载，或者将下载拆分为多个并发的流</td>
</tr>
<tr>
<td>207</td>
<td>多状态。</td>
</tr>
<tr>
<td><strong>3xx</strong></td>
<td>表示重新定向，为了完成请求，必须进一步执行的动作</td>
</tr>
<tr>
<td>301</td>
<td>已永久移动。此请求和之后所有的请求都应该转到指定的URL</td>
</tr>
<tr>
<td>302</td>
<td>对应移动。对于基于表单的身份验证，此消息通常表示为‘对象已移动’。请求的资源临时驻留在不同的URL。由于重定向有事可能会改变，客户端将来在请求时应该继续使用RequestURL。只有在CacheControl或Expires标题字段中只是，此响应才能够缓存</td>
</tr>
<tr>
<td>304</td>
<td>未修改。客户端请求的文档已在其缓存中，文档自缓存依赖尚未被修改过。客户端使用文档的缓存副本，而不从服务器下载文档</td>
</tr>
<tr>
<td>307</td>
<td>临时重定向</td>
</tr>
<tr>
<td><strong>4xx</strong></td>
<td>表示客户端错误，如请求包含语法错误或者请求无法实现</td>
</tr>
<tr>
<td>400</td>
<td>错误的请求</td>
</tr>
<tr>
<td>401</td>
<td>访问被拒绝</td>
</tr>
<tr>
<td>403</td>
<td>服务器拒绝请求</td>
</tr>
<tr>
<td>404</td>
<td>服务器找不到指定请求</td>
</tr>
<tr>
<td>405</td>
<td>用来访问本页面的HTTP谓词不背允许</td>
</tr>
<tr>
<td>414</td>
<td>请求URL太长</td>
</tr>
<tr>
<td>417</td>
<td>执行失败</td>
</tr>
<tr>
<td><strong>5xx</strong></td>
<td>表示服务器错误，如服务器不能实现一种明显无效的请求</td>
</tr>
<tr>
<td>500</td>
<td>内部服务器错误</td>
</tr>
<tr>
<td>502</td>
<td>Web服务器作为网关或代理服务器时，从上游服务器收到了无效响应</td>
</tr>
</tbody></table>
<p><strong><a target="_blank" rel="noopener" href="https://www.runoob.com/http/http-status-codes.html">更多状态码可以去菜鸟教程观看</a></strong></p>
<h3 id="3-3-WSGI接口"><a href="#3-3-WSGI接口" class="headerlink" title="3.3.WSGI接口"></a>3.3.WSGI接口</h3><p>FastCGI使用进程&#x2F;线程池来处理一连串的请求，这些进程&#x2F;线程池由FastCGI服务器管理，而不是Web服务器管理</p>
<p>WSGI(服务器网关接口)是Web服务器和Web应用程序或框架之间的一种简单而通用的接口</p>
<p>WSGI中有两种角色：</p>
<ol>
<li>接受请求的Server(服务器)</li>
<li>处理请求的Application(应用)</li>
<li>它们底层是通过FastCGI沟通的。</li>
</ol>
<blockquote>
<p>当服务器收到一个请求后，可以通过Socket把环境变量和一个Callback回调函数传给后端应用，应用在完成页面组装后通过Callback把内容返回给Server，最后Server再将响应返回给Client</p>
</blockquote>
<h4 id="3-3-1-定义WSGI接口"><a href="#3-3-1-定义WSGI接口" class="headerlink" title="3.3.1.定义WSGI接口"></a>3.3.1.定义WSGI接口</h4><p>WSGI接口只要求Web开发者实现一个函数，就可以响应HTTP请求</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">application</span>(<span class="params">environ,start_response</span>):</span><br><span class="line">    start_response(<span class="string">&#x27;200 ok&#x27;</span>,[(<span class="string">&#x27;Content-Type&#x27;</span>),<span class="string">&#x27;text/html&#x27;</span>])</span><br><span class="line">    <span class="keyword">return</span> [<span class="string">b&#x27;&lt;h1&gt;Hello,World!&lt;/h1&gt;&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># environ:一个包含了所有HTTP请求信息的字典对象</span></span><br><span class="line"><span class="comment"># start_response:一个发送HTTP响应的函数</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">整个函数本身并没有涉及任何解析HTTP部分，所以底层Web服务器的解析部分和应用程序逻辑部分进行分离</span></span><br><span class="line"><span class="string">所以函数本身必须由WSGI服务器来调用，现在很多服务器都符合WSGI规范，如：Apache服务器和Nginx服务器等，Python内部还内置了wsgiref模块，但是只是WSGI的参考实现，也就是不考虑运行效率</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-3-2-运行WSGI服务"><a href="#3-3-2-运行WSGI服务" class="headerlink" title="3.3.2.运行WSGI服务"></a>3.3.2.运行WSGI服务</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 创建一个Views目录</span></span><br><span class="line"><span class="comment"># 创建course.html</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;IE=edge&quot;</span>&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;</span><br><span class="line">    明日科技</span><br><span class="line">&lt;/title&gt;</span><br><span class="line">&lt;!-- Bootstrap core CSS --&gt;</span><br><span class="line">&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css&quot;</span> </span><br><span class="line">&lt;!-- Documentation extras --&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">body &#123;</span><br><span class="line">    position: relative; /* For scrollspy */</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* Keep code small <span class="keyword">in</span> tables on account of limited space */</span><br><span class="line">.table code &#123;</span><br><span class="line">  font-size: 13px;</span><br><span class="line">  font-weight: normal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* Inline code within headings retain the heading<span class="string">&#x27;s background-color */</span></span><br><span class="line"><span class="string">h2 code,</span></span><br><span class="line"><span class="string">h3 code,</span></span><br><span class="line"><span class="string">h4 code &#123;</span></span><br><span class="line"><span class="string">  background-color: inherit;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/* Outline button for use within the docs */</span></span><br><span class="line"><span class="string">.btn-outline &#123;</span></span><br><span class="line"><span class="string">  color: #563d7c;</span></span><br><span class="line"><span class="string">  background-color: transparent;</span></span><br><span class="line"><span class="string">  border-color: #563d7c;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.btn-outline:hover,</span></span><br><span class="line"><span class="string">.btn-outline:focus,</span></span><br><span class="line"><span class="string">.btn-outline:active &#123;</span></span><br><span class="line"><span class="string">  color: #fff;</span></span><br><span class="line"><span class="string">  background-color: #563d7c;</span></span><br><span class="line"><span class="string">  border-color: #563d7c;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/* Inverted outline button (white on dark) */</span></span><br><span class="line"><span class="string">.btn-outline-inverse &#123;</span></span><br><span class="line"><span class="string">  color: #fff;</span></span><br><span class="line"><span class="string">  background-color: transparent;</span></span><br><span class="line"><span class="string">  border-color: #cdbfe3;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.btn-outline-inverse:hover,</span></span><br><span class="line"><span class="string">.btn-outline-inverse:focus,</span></span><br><span class="line"><span class="string">.btn-outline-inverse:active &#123;</span></span><br><span class="line"><span class="string">  color: #563d7c;</span></span><br><span class="line"><span class="string">  text-shadow: none;</span></span><br><span class="line"><span class="string">  background-color: #fff;</span></span><br><span class="line"><span class="string">  border-color: #fff;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/* Bootstrap &quot;B&quot; icon */</span></span><br><span class="line"><span class="string">.bs-docs-booticon &#123;</span></span><br><span class="line"><span class="string">  display: block;</span></span><br><span class="line"><span class="string">  font-weight: 500;</span></span><br><span class="line"><span class="string">  color: #fff;</span></span><br><span class="line"><span class="string">  text-align: center;</span></span><br><span class="line"><span class="string">  cursor: default;</span></span><br><span class="line"><span class="string">  background-color: #563d7c;</span></span><br><span class="line"><span class="string">  border-radius: 15%;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.bs-docs-booticon-sm &#123;</span></span><br><span class="line"><span class="string">  width: 30px;</span></span><br><span class="line"><span class="string">  height: 30px;</span></span><br><span class="line"><span class="string">  font-size: 20px;</span></span><br><span class="line"><span class="string">  line-height: 28px;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.bs-docs-booticon-lg &#123;</span></span><br><span class="line"><span class="string">  width: 144px;</span></span><br><span class="line"><span class="string">  height: 144px;</span></span><br><span class="line"><span class="string">  font-size: 90px;</span></span><br><span class="line"><span class="string">  line-height: 140px;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.bs-docs-booticon-inverse &#123;</span></span><br><span class="line"><span class="string">  color: #563d7c;</span></span><br><span class="line"><span class="string">  background-color: #fff;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.bs-docs-booticon-outline &#123;</span></span><br><span class="line"><span class="string">  background-color: transparent;</span></span><br><span class="line"><span class="string">  border: 1px solid #cdbfe3;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/*</span></span><br><span class="line"><span class="string"> * Main navigation</span></span><br><span class="line"><span class="string"> *</span></span><br><span class="line"><span class="string"> * Turn the `.navbar` at the top of the docs purple.</span></span><br><span class="line"><span class="string"> */</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">.bs-docs-nav &#123;</span></span><br><span class="line"><span class="string">  margin-bottom: 0;</span></span><br><span class="line"><span class="string">  background-color: #fff;</span></span><br><span class="line"><span class="string">  border-bottom: 0;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.bs-home-nav .bs-nav-b &#123;</span></span><br><span class="line"><span class="string">  display: none;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.bs-docs-nav .navbar-brand,</span></span><br><span class="line"><span class="string">.bs-docs-nav .navbar-nav &gt; li &gt; a &#123;</span></span><br><span class="line"><span class="string">  font-weight: 500;</span></span><br><span class="line"><span class="string">  color: #563d7c;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.bs-docs-nav .navbar-nav &gt; li &gt; a:hover,</span></span><br><span class="line"><span class="string">.bs-docs-nav .navbar-nav &gt; .active &gt; a,</span></span><br><span class="line"><span class="string">.bs-docs-nav .navbar-nav &gt; .active &gt; a:hover &#123;</span></span><br><span class="line"><span class="string">  color: #463265;</span></span><br><span class="line"><span class="string">  background-color: #f9f9f9;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.bs-docs-nav .navbar-toggle .icon-bar &#123;</span></span><br><span class="line"><span class="string">  background-color: #563d7c;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.bs-docs-nav .navbar-header .navbar-toggle &#123;</span></span><br><span class="line"><span class="string">  border-color: #fff;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.bs-docs-nav .navbar-header .navbar-toggle:hover,</span></span><br><span class="line"><span class="string">.bs-docs-nav .navbar-header .navbar-toggle:focus &#123;</span></span><br><span class="line"><span class="string">  background-color: #f9f9f9;</span></span><br><span class="line"><span class="string">  border-color: #f9f9f9;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/*</span></span><br><span class="line"><span class="string"> * Homepage</span></span><br><span class="line"><span class="string"> *</span></span><br><span class="line"><span class="string"> * Tweaks to the custom homepage and the masthead (main jumbotron).</span></span><br><span class="line"><span class="string"> */</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/* Share masthead with page headers */</span></span><br><span class="line"><span class="string">.bs-docs-masthead,</span></span><br><span class="line"><span class="string">.bs-docs-header &#123;</span></span><br><span class="line"><span class="string">  position: relative;</span></span><br><span class="line"><span class="string">  padding: 30px 0;</span></span><br><span class="line"><span class="string">  color: #cdbfe3;</span></span><br><span class="line"><span class="string">  text-align: center;</span></span><br><span class="line"><span class="string">  text-shadow: 0 1px 0 rgba(0,0,0,.1);</span></span><br><span class="line"><span class="string">  background-color: #6f5499;</span></span><br><span class="line"><span class="string">  background-image: -webkit-gradient(linear, left top, left bottom, from(#563d7c), to(#6f5499));</span></span><br><span class="line"><span class="string">  background-image: -webkit-linear-gradient(top, #563d7c 0%, #6f5499 100%);</span></span><br><span class="line"><span class="string">  background-image:      -o-linear-gradient(top, #563d7c 0%, #6f5499 100%);</span></span><br><span class="line"><span class="string">  background-image:         linear-gradient(to bottom, #563d7c 0%, #6f5499 100%);</span></span><br><span class="line"><span class="string">  filter: progid:DXImageTransform.Microsoft.gradient(startColorstr=&#x27;</span><span class="comment">#563d7c&#x27;, endColorstr=&#x27;#6F5499&#x27;, GradientType=0);</span></span><br><span class="line">  background-repeat: repeat-x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* Masthead (headings <span class="keyword">and</span> download button) */</span><br><span class="line">.bs-docs-masthead .bs-docs-booticon &#123;</span><br><span class="line">  margin: <span class="number">0</span> auto 30px;</span><br><span class="line">&#125;</span><br><span class="line">.bs-docs-masthead h1 &#123;</span><br><span class="line">  font-weight: <span class="number">300</span>;</span><br><span class="line">  line-height: <span class="number">1</span>;</span><br><span class="line">  color: <span class="comment">#fff;</span></span><br><span class="line">&#125;</span><br><span class="line">.bs-docs-masthead .lead &#123;</span><br><span class="line">  margin: <span class="number">0</span> auto 30px;</span><br><span class="line">  font-size: 20px;</span><br><span class="line">  color: <span class="comment">#fff;</span></span><br><span class="line">&#125;</span><br><span class="line">.bs-docs-masthead .version &#123;</span><br><span class="line">  margin-top: -15px;</span><br><span class="line">  margin-bottom: 30px;</span><br><span class="line">  color: <span class="comment">#9783b9;</span></span><br><span class="line">&#125;</span><br><span class="line">.bs-docs-masthead .btn &#123;</span><br><span class="line">  width: <span class="number">100</span>%;</span><br><span class="line">  padding: 15px 30px;</span><br><span class="line">  font-size: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@media (<span class="params"><span class="built_in">min</span>-width: 480px</span>) &#123;</span></span><br><span class="line">  .bs-docs-masthead .btn &#123;</span><br><span class="line">    width: auto;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@media (<span class="params"><span class="built_in">min</span>-width: 768px</span>) &#123;</span></span><br><span class="line">  .bs-docs-masthead &#123;</span><br><span class="line">    padding: 80px <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  .bs-docs-masthead h1 &#123;</span><br><span class="line">    font-size: 60px;</span><br><span class="line">  &#125;</span><br><span class="line">  .bs-docs-masthead .lead &#123;</span><br><span class="line">    font-size: 24px;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- Analytics</span><br><span class="line">================================================== --&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">  &lt;body <span class="keyword">class</span>=<span class="string">&quot;bs-docs-home&quot;</span>&gt;</span><br><span class="line">    &lt;!-- Docs master nav --&gt;</span><br><span class="line">  &lt;header <span class="keyword">class</span>=<span class="string">&quot;navbar navbar-static-top bs-docs-nav&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;top&quot;</span>&gt;</span><br><span class="line">  &lt;div <span class="keyword">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="keyword">class</span>=<span class="string">&quot;navbar-header&quot;</span>&gt;</span><br><span class="line">      &lt;a href=<span class="string">&quot;/&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;navbar-brand&quot;</span>&gt;明日学院&lt;/a&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;nav <span class="built_in">id</span>=<span class="string">&quot;bs-navbar&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;collapse navbar-collapse&quot;</span>&gt;</span><br><span class="line">      &lt;ul <span class="keyword">class</span>=<span class="string">&quot;nav navbar-nav&quot;</span>&gt;</span><br><span class="line">        &lt;li&gt;</span><br><span class="line">          &lt;a href=<span class="string">&quot;/course.html&quot;</span> &gt;课程&lt;/a&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">        &lt;li&gt;</span><br><span class="line">          &lt;a href=<span class="string">&quot;http://www.mingrisoft.com/book.html&quot;</span>&gt;读书&lt;/a&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">        &lt;li&gt;</span><br><span class="line">          &lt;a href=<span class="string">&quot;http://www.mingrisoft.com/bbs.html&quot;</span>&gt;社区&lt;/a&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">        &lt;li&gt;</span><br><span class="line">          &lt;a href=<span class="string">&quot;http://www.mingrisoft.com/servicecenter.html&quot;</span>&gt;服务&lt;/a&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">        &lt;li&gt;</span><br><span class="line">          &lt;a href=<span class="string">&quot;/contact.html&quot;</span>&gt;联系我们&lt;/a&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/nav&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/header&gt;</span><br><span class="line">      &lt;!-- Page content of course! --&gt;</span><br><span class="line">      &lt;main <span class="keyword">class</span>=<span class="string">&quot;bs-docs-masthead&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;content&quot;</span> tabindex=<span class="string">&quot;-1&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="keyword">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span><br><span class="line">      &lt;div <span class="keyword">class</span>=<span class="string">&quot;jumbotron&quot;</span>&gt;</span><br><span class="line">        &lt;h1 style=<span class="string">&quot;color: #573e7d&quot;</span>&gt;明日课程&lt;/h1&gt;</span><br><span class="line">        &lt;p style=<span class="string">&quot;color: #573e7d&quot;</span>&gt;海量课程，随时随地，想学就学。有多名专业讲师精心打造精品课程，让学习创造属于你的生活&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;&lt;a <span class="keyword">class</span>=<span class="string">&quot;btn btn-primary btn-lg&quot;</span> href=<span class="string">&quot;http://www.mingrisoft.com/selfCourse.html&quot;</span> role=<span class="string">&quot;button&quot;</span>&gt;开始学习&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/main&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">                                            </span><br><span class="line"><span class="comment"># 创建application</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">app</span>(<span class="params">environ, start_response</span>):</span><br><span class="line">    start_response(<span class="string">&#x27;200 OK&#x27;</span>, [(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html&#x27;</span>)])     <span class="comment"># 响应信息</span></span><br><span class="line">    file_name = environ[<span class="string">&#x27;PATH_INFO&#x27;</span>][<span class="number">1</span>:] <span class="keyword">or</span> <span class="string">&#x27;index.html&#x27;</span>        <span class="comment"># 获取url参数</span></span><br><span class="line">    HTML_ROOT_DIR = <span class="string">&#x27;./Views/&#x27;</span>  <span class="comment"># 设置HTML文件目录</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        file = <span class="built_in">open</span>(HTML_ROOT_DIR + file_name, <span class="string">&quot;rb&quot;</span>)  <span class="comment"># 打开文件</span></span><br><span class="line">    <span class="keyword">except</span> IOError:</span><br><span class="line">        response = <span class="string">&quot;The file is not found!&quot;</span>     <span class="comment"># 如果异常，返回404</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        file_data = file.read() <span class="comment"># 读取文件内容</span></span><br><span class="line">        file.close()            <span class="comment"># 关闭文件</span></span><br><span class="line">        response = file_data.decode(<span class="string">&quot;utf-8&quot;</span>) <span class="comment"># 构造响应数据</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [response.encode(<span class="string">&#x27;utf-8&#x27;</span>)] <span class="comment"># 返回数据</span></span><br><span class="line"><span class="comment"># 创建web_server</span></span><br><span class="line"><span class="keyword">from</span> wsgiref.simple_server <span class="keyword">import</span> make_server</span><br><span class="line"><span class="keyword">from</span> application <span class="keyword">import</span> app</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个服务器,ip为空，端口为8000，处理函数为app</span></span><br><span class="line">httpd = make_server(<span class="string">&#x27;&#x27;</span>, <span class="number">8000</span>, app)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Serving HTTP on port 8000...&#x27;</span>)</span><br><span class="line"><span class="comment"># 开始监听HTTP请求</span></span><br><span class="line">httpd.serve_forever()</span><br><span class="line"></span><br><span class="line">                                            </span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行web_server文件，在浏览器输入127.0.0.1:8000                                            </span></span><br><span class="line">                                            </span><br></pre></td></tr></table></figure>

<h3 id="3-4-ORM编程"><a href="#3-4-ORM编程" class="headerlink" title="3.4.ORM编程"></a>3.4.ORM编程</h3><p>ORM(对象关系映射)是一种程序设计技术，用于实现面向对象编程语言里不同类型系统的数据直接的转换。</p>
<p>面向对象是在软件工程(耦合、聚合、封装)的基础上发展起来的，而关系数据库是从数学理论发展而来的</p>
<p>数据库和对象的映射如下：</p>
<ol>
<li>数据库-&gt;类</li>
<li>数据行-&gt;对象</li>
<li>字段-&gt;对象的属性</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sql = <span class="string">&#x27;select * from books order by price&#x27;</span></span><br><span class="line">cursor.execute(sql)</span><br><span class="line">data = cursor.fetchall()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上面的语句可以替换为</span></span><br><span class="line"></span><br><span class="line">data = BOOK.query.<span class="built_in">all</span>()</span><br></pre></td></tr></table></figure>

<p><strong>ORM优缺点：</strong></p>
<p>优点：</p>
<ol>
<li>数据模型都在一个地方定义，便于更新和维护，也利于重用代码</li>
<li>有很多现成工具，很多功能可以自动完成</li>
<li>业务代码更加简洁</li>
<li>不会写出性能不佳的sql语句</li>
</ol>
<p>缺点：</p>
<ol>
<li>不是轻量级的，要花费很多时间学习与设置</li>
<li>不利于复杂查询</li>
<li>开发者无法了解数据库底层，无法定制sql语句</li>
</ol>
<h2 id="4-Web框架基础"><a href="#4-Web框架基础" class="headerlink" title="4.Web框架基础"></a>4.Web框架基础</h2><h3 id="4-1-什么是Web框架？"><a href="#4-1-什么是Web框架？" class="headerlink" title="4.1.什么是Web框架？"></a>4.1.什么是Web框架？</h3><p>Web框架是用来简化Web开发的软件框架，是一些能实现常用功能的Python文件，框架就是一系列工具的集合。</p>
<p>一个典型的框架通常会提供：</p>
<ol>
<li>管理路由</li>
<li>支持数据库</li>
<li>支持MVC</li>
<li>支持ORM</li>
<li>支持模块引擎</li>
<li>管理会话和Cooies</li>
</ol>
<blockquote>
<p>&#x3D;&#x3D;MVC&#x3D;&#x3D;是Smalltalk的一种设计模式。Model(模型)用于封装和业务逻辑相关的数据和数据处理的方法，View(视图)是数据的HTML体现，Controller(控制器)负责响应请求</p>
<p>&#x3D;&#x3D;MTV&#x3D;&#x3D;，<code>M-model</code>数据模式，<code>T-template</code>负责将页面展示给用户，<code>V-view</code>业务处理，更新模板中的数据库</p>
</blockquote>
<blockquote>
<p>&#x3D;&#x3D;模板引擎&#x3D;&#x3D;是为了使用户界面与业务数据分离而产生的，它可以生成特定格式的文档，用于网站的模板引擎一般生成一个标准的HTML文档。</p>
<p>如：在<code>&#123;&#123;&#125;&#125;</code>中的变量会被替换为变量值，这就可以更好的实现界面与数据分离</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&gt;<span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;&#123;title&#125;&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello,&#123;&#123;username&#125;&#125;!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="4-2-常用的Python-Web框架"><a href="#4-2-常用的Python-Web框架" class="headerlink" title="4.2.常用的Python Web框架"></a>4.2.常用的Python Web框架</h3><ol>
<li><p>Django</p>
<blockquote>
<p>拥有世界上最大的社区，最多的包。文档非常完善，而且提供一站式的解决方案，包括缓存、ORM、管理后台、验证、表单处理等，使得开发复杂的由数据库驱动的网站变得简单。但是，Django系统耦合度较高，替换掉内置功能比较复杂，学习比较困难</p>
</blockquote>
</li>
<li><p>Flask</p>
<blockquote>
<p>是一个轻量级别的Web框架。它把Werkzeug和Jinja合在一起，所以很容易被扩展。</p>
</blockquote>
</li>
<li><p>Tornado</p>
<blockquote>
<p>不单单是个框架还是个Web服务器。是为了解决实时服务而诞生的，使用了异步非阻塞IO，所以运行速度非常快</p>
</blockquote>
</li>
<li><p>FastApI</p>
<blockquote>
<p>是一个现代的高性能框架，能够自动生成API</p>
</blockquote>
</li>
</ol>
<h2 id="5-Flask框架"><a href="#5-Flask框架" class="headerlink" title="5.Flask框架"></a>5.Flask框架</h2><ol>
<li>下载安装Flask框架</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pip install flask</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">当安装 Flask 时，以下配套软件会被自动安装。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Werkzeug 用于实现 WSGI ，应用和服务之间的标准 Python 接口。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Jinja 用于渲染页面的模板语言。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">MarkupSafe 与 Jinja 共用，在渲染页面时用于避免不可信的输入，防止注入攻击。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ItsDangerous 保证数据完整性的安全标志数据，用于保护 Flask 的 session cookie.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Click 是一个命令行应用的框架。用于提供 flask 命令，并允许添加自定义 管理命令。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>默认环境</li>
</ol>
<blockquote>
<p>刚开始的时候Flask有许多带有合理缺省值的配置值和惯例。按照惯例，模板和静态文件凡在应用Python源代码树的子目录中，名称分别为&#x3D;&#x3D;templates&#x3D;&#x3D;和&#x3D;&#x3D;static&#x3D;&#x3D;，可以改变</p>
</blockquote>
<h3 id="5-1-第一个Flask应用"><a href="#5-1-第一个Flask应用" class="headerlink" title="5.1.第一个Flask应用"></a>5.1.第一个Flask应用</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 导入Flask类，该类的实例会成为我们的WSGI应用</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">创建该类的一个实例</span></span><br><span class="line"><span class="string">第一个参数是引用模块或者包的名称，如果使用单一模块，名称为__name__。</span></span><br><span class="line"><span class="string">模块的名称将会因其作为单独应用启动还是作为模块导入而有不同</span></span><br><span class="line"><span class="string">这样flask才知道到哪去找模板、静态文件等</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用route装饰器告诉Flask什么样的URL能触法执行被装饰的函数</span></span><br><span class="line"><span class="comment"># 函数返回需要在用户浏览器中显示的信息。默认内容类型是HTML</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>  __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br><span class="line">    </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"> * Running on http://127.0.0.1:5000 (Press CTRL+C to quit)</span></span><br><span class="line"><span class="string">  打开浏览器输入网址就能看见网站内容</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-2-开启调试模式"><a href="#5-2-开启调试模式" class="headerlink" title="5.2.开启调试模式"></a>5.2.开启调试模式</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 在Flask对象的run方法里可以设置参数</span></span><br><span class="line">app.run(</span><br><span class="line">	debug=<span class="literal">True</span>, <span class="comment"># 开启调试模式，这样更改代码后就不需要重启服务了</span></span><br><span class="line">	port = <span class="number">8000</span>,</span><br><span class="line">    host=<span class="string">&#x27;0.0.0.0&#x27;</span> <span class="comment">#当运行服务后，你会发现只有自己的电脑能运行，如果您关闭了调试器或信任您网络中的用户，那么可以让服务器被公开访问。 只要在run方法上简单的加上 host=&#x27;0.0.0.0&#x27; 即可:</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="5-3-HTML转义"><a href="#5-3-HTML转义" class="headerlink" title="5.3.HTML转义"></a>5.3.HTML转义</h3><blockquote>
<p>当返回HTML时，为了防止注入攻击，所有用户提供的值在输出渲染前必须被转义。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 使用escape()可以手动转义</span></span><br><span class="line"><span class="keyword">from</span> markupsafe <span class="keyword">import</span> escape</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&lt;name&gt;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;Hello, <span class="subst">&#123;escape(name)&#125;</span>!&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="5-4-路由"><a href="#5-4-路由" class="headerlink" title="5.4.路由"></a>5.4.路由</h3><blockquote>
<p>客户端把请求发送给Web服务器后，Web服务器会把请求发送给Flask程序实例。程序实例需要知道对每个URL请求运行那些代码，所以保存了一个URL到Python函数的映射关系。处理URL和函数之间关系的程序称为路由</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://note.youdao.com/yws/public/resource/92933d878935240680c00793fc3e404c/xmlnote/WEBRESOURCE398a19eeada41bf456312baf2fd737b0/437"></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 使用装饰器声明路由</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World!&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-5-变量规则"><a href="#5-5-变量规则" class="headerlink" title="5.5.变量规则"></a>5.5.变量规则</h3><p>通过把URL的一部分编辑为<code>&lt;variable_name&gt;</code>就可以在URL中添加变量标记的 部分会作为关键字参数传递给函数。通过使用 <code>&lt;converter:variable_name&gt;</code> ，可以 选择性的加上一个转换器，为变量指定规则。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user/&lt;username&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_user_profile</span>(<span class="params">username</span>):</span><br><span class="line">    <span class="comment"># 显示该用户名的用户信息</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&#x27;用户名是:<span class="subst">&#123;username&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/post/&lt;int:post_id&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_post</span>(<span class="params">post_id</span>):</span><br><span class="line">    <span class="comment"># 根据ID显示文章，ID是整型数据</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&#x27;ID是:<span class="subst">&#123;post_id&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug = <span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>转换器类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>string</td>
<td>(默认)接收不包含斜杆的文本</td>
</tr>
<tr>
<td>int</td>
<td>接受正整数</td>
</tr>
<tr>
<td>float</td>
<td>接受征浮点数</td>
</tr>
<tr>
<td>path</td>
<td>类似于默认。但可以包含斜杆</td>
</tr>
<tr>
<td>uuid</td>
<td>接受UUID字符串</td>
</tr>
</tbody></table>
<h3 id="5-6-唯一的URL-重定向行为"><a href="#5-6-唯一的URL-重定向行为" class="headerlink" title="5.6.唯一的URL&#x2F;重定向行为"></a>5.6.唯一的URL&#x2F;重定向行为</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/projects/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">projects</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;The project page&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/about&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">about</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;The about page&#x27;</span></span><br></pre></td></tr></table></figure>

<p><code>projects</code> 的 URL 是中规中矩的，尾部有一个斜杠，看起来就如同一个文件 夹。访问一个没有斜杠结尾的 URL （ <code>/projects</code> ）时 Flask 会自动进行重 定向，帮您在尾部加上一个斜杠（ <code>/projects/</code> ）。</p>
<p><code>about</code> 的 URL 没有尾部斜杠，因此其行为表现与一个文件类似。如果访问这 个 URL 时添加了尾部斜杠（<code>/about/</code> ）就会得到一个 404 “未找到” 错 误。这样可以保持 URL 唯一，并有助于搜索引擎重复索引同一页面。</p>
<h3 id="5-7-构造URL"><a href="#5-7-构造URL" class="headerlink" title="5.7.构造URL"></a>5.7.构造URL</h3><p>url_for()函数用于构建指定函数的URL。它把函数名称作为第一个参数。它可以接受任意个关键字参数，每个关键字参数对应URL中的变量。未知变量将添加到URL中作为查询参数</p>
<p>为什么不在把 URL 写死在模板中，而要使用反转函数 <code>url_for()</code>动态构建？</p>
<ol>
<li>反转通常比硬编码 URL 的描述性更好。</li>
<li>您可以只在一个地方改变 URL ，而不用到处乱找。</li>
<li>URL 创建会为您处理特殊字符的转义，比较直观。</li>
<li>生产的路径总是绝对路径，可以避免相对路径产生副作用。</li>
<li>如果您的应用是放在 URL 根路径之外的地方（如在 <code>/myapplication</code> 中，不在 <code>/</code> 中）， <code>url_for()</code> 会为您妥善处理。</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">url_for(endpoint,values)-&gt;str</span></span><br><span class="line"><span class="string">endpoint (str) – 函数名称</span></span><br><span class="line"><span class="string">values (Any) – URL规则的变量参数</span></span><br><span class="line"><span class="string">return type str</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">重定向函数redirect(location)</span></span><br><span class="line"><span class="string">location -&gt;一条URL，可以与反转函数一起使用，也可以填入视图函数路径</span></span><br><span class="line"><span class="string">redirect(&#x27;/&#x27;)转到index页面</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,url_for,redirect</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user/&lt;username&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_user_profile</span>(<span class="params">username</span>):</span><br><span class="line">    <span class="comment"># 显示该用户名的用户信息</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&#x27;用户名是:<span class="subst">&#123;username&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/post/&lt;int:post_id&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_post</span>(<span class="params">post_id</span>):</span><br><span class="line">    <span class="comment"># 根据ID显示文章，ID是整型数据</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&#x27;ID是:<span class="subst">&#123;post_id&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="comment"># 模拟登录流程</span></span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># 如果登录成功，跳转到首页</span></span><br><span class="line">    <span class="keyword">if</span> flag:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;登录页面&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 告诉 Flask 正在处理一个请求，其实只是运行了服务器而已</span></span><br><span class="line"><span class="keyword">with</span> app.test_request_context():</span><br><span class="line">    <span class="built_in">print</span>(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(url_for(<span class="string">&#x27;show_post&#x27;</span>, post_id=<span class="number">2</span>))</span><br><span class="line">    <span class="built_in">print</span>(url_for(<span class="string">&#x27;index&#x27;</span>, username=<span class="string">&#x27;John  Doe&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug = <span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5-8-HTTP方法"><a href="#5-8-HTTP方法" class="headerlink" title="5.8.HTTP方法"></a>5.8.HTTP方法</h3><p>缺省情况下，一个路由只回应<code>GET</code>请求，可以使用route()装饰器的<code>methods</code>参数来处理不同的HTTP方法</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> do_the_login()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> show_the_login_form()</span><br></pre></td></tr></table></figure>

<h3 id="5-9-静态文件"><a href="#5-9-静态文件" class="headerlink" title="5.9.静态文件"></a>5.9.静态文件</h3><p>当web需要调用静态文件(一般是 CSS 和 JavaScript 文件)时，可以用反转函数来生成文件路径</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">url_for(<span class="string">&#x27;static&#x27;</span>, filename=<span class="string">&#x27;style.css&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># /static/style.css</span></span><br><span class="line"><span class="comment"># style.css文件应该在static文件下</span></span><br></pre></td></tr></table></figure>

<h3 id="5-11-渲染模板"><a href="#5-11-渲染模板" class="headerlink" title="5.11.渲染模板"></a>5.11.渲染模板</h3><p>一般来说HTML模板默认在templates文件夹下，所以在Flask中使用<code>render_template</code>函数渲染模板</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">render_template(<span class="string">&#x27;temp_name.html&#x27;</span>,temp_variable=name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一个参数为渲染的模板名称，第二个参数为模板中变量的值</span></span><br><span class="line"><span class="comment"># 在模板内部可以像使用 url_for() 和 get_flashed_messages() 函数一样访问 config 、 request 、 session 和 g 对象。</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>模板变量</p>
<blockquote>
<p>在模板中使用<code>&#123;&#123;&#125;&#125;</code>表示一个变量，它是一种特殊的占位符，告诉模板引擎这个位置的值从渲染模板时使用的数据中获取。Jinja2能识别所有类型的变量</p>
<p>如：</p>
</blockquote>
</li>
<li><p>过滤器</p>
<blockquote>
<p>过滤器是一些可以用来修改和过滤变量值得特殊函数，过滤器和变量用一个|隔开，需要参数的过滤器可以像函数一样使用括号传递</p>
<p>如：Hello, &#x2F;&#x2F;变量首字母会大写</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">常用过滤器</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">safe</td>
<td align="center">渲染时不转义</td>
</tr>
<tr>
<td align="center">capitalize</td>
<td align="center">把值得首字母转换为大写，其他字母转为小写</td>
</tr>
<tr>
<td align="center">lower</td>
<td align="center">把值转换成小写形式</td>
</tr>
<tr>
<td align="center">upper</td>
<td align="center">把值转换为 大写形式</td>
</tr>
<tr>
<td align="center">title</td>
<td align="center">把值每个单词的首字母都转换为大写</td>
</tr>
<tr>
<td align="center">trim</td>
<td align="center">把值的首尾空格去掉</td>
</tr>
<tr>
<td align="center">striptags</td>
<td align="center">渲染之前把值中所有的HTML标签都删掉</td>
</tr>
<tr>
<td align="center">truncate(s,length&#x3D;255,killwords&#x3D;False,end&#x3D;’…’)</td>
<td align="center">截取字符串，常用于显示文章摘要。length参数设置截取的长度，killwords参数设置是否截取单词，end参数设置结尾符号</td>
</tr>
</tbody></table>
</li>
<li><p>自定义过滤器</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 先写好一个函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">count_length</span>(<span class="params">arg</span>):</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">len</span>(arg)</span><br><span class="line"><span class="comment"># 再用add_template_filter把函数注册为过滤器</span></span><br><span class="line"><span class="comment"># 第一个参数为函数名，第二个参数为注册的过滤器名</span></span><br><span class="line">app.add_template_filter(count_length,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 还可以用template_filter()装饰器定义过滤器</span></span><br><span class="line"><span class="meta">@app.template_filter()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">count_length</span>(<span class="params">arg</span>):</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">len</span>(arg)</span><br></pre></td></tr></table></figure>


</li>
<li><p>控制结构</p>
<p>Jinja2提供了很多种控制结构，用来改变模板的渲染流程</p>
<ul>
<li><p><code>&#123;% ... %&#125;</code>对于语句</p>
</li>
<li><p><code>&#123;&#123; ... &#125;&#125;</code>用于变量打印到模板输出</p>
</li>
<li><p>&#96;&#96;对于模板输出中未包含的注释</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 常见的模板</span></span><br><span class="line"><span class="comment"># if控制结构</span></span><br><span class="line">&#123;% <span class="keyword">if</span> user %&#125;</span><br><span class="line">Hello,&#123;&#123;user&#125;&#125;</span><br><span class="line">&#123;% <span class="keyword">else</span> %&#125;</span><br><span class="line">&#123;&#123;user&#125;&#125;</span><br><span class="line">&#123;% endif %&#125; <span class="comment">#表示结束</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># for控制结构，能跟python一样使用序列的相关函数</span></span><br><span class="line">&lt;ul&gt;</span><br><span class="line">&#123;% <span class="keyword">for</span> comment <span class="keyword">in</span> comments %&#125;</span><br><span class="line">&lt;li&gt;&#123;&#123;comment&#125;&#125;&lt;/li&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Jinja2还支持宏(类似于函数)</span></span><br><span class="line">&#123;% macro render_comment(comment) %&#125;</span><br><span class="line">&lt;li&gt;&#123;&#123;comment&#125;&#125;&lt;/li&gt;</span><br><span class="line">&lt;% endmacro %&gt; <span class="comment"># 定义一个宏</span></span><br><span class="line">&#123;% <span class="keyword">for</span> comment <span class="keyword">in</span> comments %&#125;</span><br><span class="line">&#123;&#123;render_comment(comment)&#125;&#125; <span class="comment"># 调用宏</span></span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 还支持导入</span></span><br><span class="line">&#123;% <span class="keyword">import</span> <span class="string">&#x27;macros.html&#x27;</span> <span class="keyword">as</span> macros %&#125;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">&#123;% <span class="keyword">for</span> comment <span class="keyword">in</span> comments %&#125;</span><br><span class="line">&#123;&#123;macros.render_comment(comment)&#125;&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模板继承，类似于类继承</span></span><br><span class="line"><span class="comment"># 创建base.html文件</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">   &#123;% block head %&#125;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;&#123;% block title %&#125;&#123;% endblock %&#125;Title&lt;/title&gt;</span><br><span class="line">    &#123;% endblock %&#125;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &#123;% block body %&#125;</span><br><span class="line">    &#123;% endblock %&#125;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建子模块</span></span><br><span class="line">&#123;% extends <span class="string">&#x27;base.html&#x27;</span> %&#125; <span class="comment"># 继承父模块内容</span></span><br><span class="line">&#123;% block title %&#125;index&#123;% endblock %&#125; <span class="comment"># 网页标题为indexTitle</span></span><br><span class="line">&#123;% block head %&#125;</span><br><span class="line">&#123;&#123;<span class="built_in">super</span>()&#125;&#125;  <span class="comment"># 获取父模块内容</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line">&#123;% block body %&#125;</span><br><span class="line">&lt;h1&gt;Hello&lt;/h1&gt;  <span class="comment"># 网页主体内容为Hello</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 局部模板</span></span><br><span class="line"><span class="comment"># 当各个独立模板中使用同一块HTML时，可以把这部分代码抽离出来，存储到局部模板中</span></span><br><span class="line"><span class="comment"># 为了和普通模板分开，局部模板的命名通常是以下划线开始的</span></span><br><span class="line"><span class="comment"># 导入局部模板</span></span><br><span class="line">&#123;% include <span class="string">&#x27;_banner.html&#x27;</span> %&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-12-Web表单"><a href="#5-12-Web表单" class="headerlink" title="5.12.Web表单"></a>5.12.Web表单</h3><blockquote>
<p>表单是用户跟Web应用实现交互的基本元素，Flask不会自己处理表单，但Flask-WTF扩展允许用户在Flask应用中使用WTFForms包，从而使得表单和处理表单变得非常轻松</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 安装WTForms</span></span><br><span class="line">pip install flask-wtf</span><br></pre></td></tr></table></figure>

<ul>
<li><p>CSRF保护和验证</p>
<blockquote>
<p>CSRF全称为Cross Site Resquest Forgery,即跨站请求伪造。CSRF通过第三方伪造表单数据，POST到服务器上。WTForms在渲染表单时会生成一个独一无二的token，该taken将在POST请求中随表单数据一起传递，并且在表单被接受前进行验证。taken的值取决于存储在用户对话(cookies)中的一个值，该值会在30分钟后过时</p>
<p>为了更好的实现CSRF保护，Flask-WTF需要程序设置一个密钥，通过密钥生成加密令牌，再用令牌验证请求中表单数据的真伪</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 设置密钥</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="string">&#x27;mrsoft&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># config方法可用来存储框架，扩展和程序本身的配置变量</span></span><br><span class="line"><span class="comment"># SECRET_KEY配置变量时通用密钥</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>表单类</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_wtf <span class="keyword">import</span> FlaskForm</span><br><span class="line"><span class="keyword">from</span> wtforms <span class="keyword">import</span> StringField,PasswordField,SubmitField</span><br><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> InputRequired</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NameFrom</span>(<span class="title class_ inherited__">FlaskForm</span>):</span><br><span class="line">    name = StringField(<span class="string">&#x27;请输入姓名&#x27;</span>,validators=[InputRequired()])</span><br><span class="line">    password = PasswordField(<span class="string">&#x27;请输入密码&#x27;</span>,validators=[InputRequired()])</span><br><span class="line">    submit = SubmitField(<span class="string">&#x27;Submit&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>​													<strong>WTForms支持的HTML标准字段</strong></p>
<table>
<thead>
<tr>
<th align="center">字段类型</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">StringField</td>
<td align="center">文本字段</td>
</tr>
<tr>
<td align="center">TextAreaField</td>
<td align="center">多行文本字段</td>
</tr>
<tr>
<td align="center">PasswordField</td>
<td align="center">密码文本字段</td>
</tr>
<tr>
<td align="center">HiddenField</td>
<td align="center">隐藏文本字段</td>
</tr>
<tr>
<td align="center">DateField</td>
<td align="center">文本字段，值为datetime.date格式</td>
</tr>
<tr>
<td align="center">DateTimeField</td>
<td align="center">文本字段，值为datetime.datetime格式</td>
</tr>
<tr>
<td align="center">IntegerField</td>
<td align="center">文本字段，值为整数</td>
</tr>
<tr>
<td align="center">DecimalField</td>
<td align="center">文本字段，值为datetime.Decimal格式</td>
</tr>
<tr>
<td align="center">FloatField</td>
<td align="center">文本字段,值为浮点数</td>
</tr>
<tr>
<td align="center">BooleanField</td>
<td align="center">复选框，值为True和False</td>
</tr>
<tr>
<td align="center">RadioField</td>
<td align="center">一组单选按钮</td>
</tr>
<tr>
<td align="center">SelectField</td>
<td align="center">下拉列表</td>
</tr>
<tr>
<td align="center">SelectMultipleField</td>
<td align="center">下拉列表，可选多个值</td>
</tr>
<tr>
<td align="center">FileField</td>
<td align="center">文件上传按钮</td>
</tr>
<tr>
<td align="center">SubmitField</td>
<td align="center">表单提交按钮</td>
</tr>
<tr>
<td align="center">FormField</td>
<td align="center">把表单作为字段嵌入另一个表单内</td>
</tr>
<tr>
<td align="center">FieldList</td>
<td align="center">一组指定类型的字段</td>
</tr>
</tbody></table>
</li>
</ul>
<p>​																<strong>WTForms内置的验证函数</strong></p>
<table>
<thead>
<tr>
<th align="center">字段类型</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Email</td>
<td align="center">验证电子邮件地址</td>
</tr>
<tr>
<td align="center">EqualTo</td>
<td align="center">比较两个字段的值，常用于要求输入两次密码进行确定</td>
</tr>
<tr>
<td align="center">IPAddress</td>
<td align="center">验证IPv4网络地址</td>
</tr>
<tr>
<td align="center">Length</td>
<td align="center">验证输入字符串的长度</td>
</tr>
<tr>
<td align="center">NumberRange</td>
<td align="center">验证输入的值在数字范围内</td>
</tr>
<tr>
<td align="center">Optional</td>
<td align="center">无输入值时跳过其他验证函数</td>
</tr>
<tr>
<td align="center">Required</td>
<td align="center">确保字段中有数据</td>
</tr>
<tr>
<td align="center">Regexp</td>
<td align="center">使用正则表达式验证输入值</td>
</tr>
<tr>
<td align="center">URL</td>
<td align="center">验证URL</td>
</tr>
<tr>
<td align="center">AnyOf</td>
<td align="center">确保输入值在可选列表中</td>
</tr>
</tbody></table>
<ul>
<li><p><strong>实例</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 创建HTML模板</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;/static/css/bootstrap.css&quot;</span>&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;/static/js/jquery.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;/static/js/bootstrap.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;nav <span class="keyword">class</span>=<span class="string">&quot;navbar navbar-expand-sm bg-primary navbar-dark&quot;</span>&gt;</span><br><span class="line">  &lt;ul <span class="keyword">class</span>=<span class="string">&quot;navbar-nav&quot;</span>&gt;</span><br><span class="line">    &lt;li <span class="keyword">class</span>=<span class="string">&quot;nav-item active&quot;</span>&gt;</span><br><span class="line">      &lt;a <span class="keyword">class</span>=<span class="string">&quot;nav-link&quot;</span> href=<span class="string">&quot;#&quot;</span>&gt;首页&lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;li <span class="keyword">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">      &lt;a <span class="keyword">class</span>=<span class="string">&quot;nav-link&quot;</span> href=<span class="string">&quot;#&quot;</span>&gt;明日学院&lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;li <span class="keyword">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span><br><span class="line">      &lt;a <span class="keyword">class</span>=<span class="string">&quot;nav-link&quot;</span> href=<span class="string">&quot;#&quot;</span>&gt;明日图书&lt;/a&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;!-- Dropdown --&gt;</span><br><span class="line">    &lt;li <span class="keyword">class</span>=<span class="string">&quot;nav-item dropdown&quot;</span>&gt;</span><br><span class="line">      &lt;a <span class="keyword">class</span>=<span class="string">&quot;nav-link dropdown-toggle&quot;</span> href=<span class="string">&quot;#&quot;</span></span><br><span class="line">          <span class="built_in">id</span>=<span class="string">&quot;navbardrop&quot;</span> data-toggle=<span class="string">&quot;dropdown&quot;</span>&gt;</span><br><span class="line">        关于我们</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">      &lt;div <span class="keyword">class</span>=<span class="string">&quot;dropdown-menu&quot;</span>&gt;</span><br><span class="line">        &lt;a <span class="keyword">class</span>=<span class="string">&quot;dropdown-item&quot;</span> href=<span class="string">&quot;#&quot;</span>&gt;公司简介&lt;/a&gt;</span><br><span class="line">        &lt;a <span class="keyword">class</span>=<span class="string">&quot;dropdown-item&quot;</span> href=<span class="string">&quot;#&quot;</span>&gt;企业文化&lt;/a&gt;</span><br><span class="line">        &lt;a <span class="keyword">class</span>=<span class="string">&quot;dropdown-item&quot;</span> href=<span class="string">&quot;#&quot;</span>&gt;联系我们&lt;/a&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">&lt;/nav&gt;</span><br><span class="line"></span><br><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;jumbotron&quot;</span>&gt;</span><br><span class="line">  &lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">      &lt;div <span class="keyword">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">      &#123;&#123; form.name.label &#125;&#125;</span><br><span class="line">      &#123;&#123; form.name(<span class="keyword">class</span>=<span class="string">&quot;form-control&quot;</span>)&#125;&#125;</span><br><span class="line">      &#123;% <span class="keyword">for</span> err <span class="keyword">in</span> form.name.errors %&#125;</span><br><span class="line">          &lt;p style=<span class="string">&quot;color: red&quot;</span>&gt;&#123;&#123; err &#125;&#125;&lt;/p&gt;</span><br><span class="line">      &#123;% endfor %&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div <span class="keyword">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">      &#123;&#123; form.password.label &#125;&#125;</span><br><span class="line">      &#123;&#123; form.password(<span class="keyword">class</span>=<span class="string">&quot;form-control&quot;</span>) &#125;&#125;</span><br><span class="line">      &#123;% <span class="keyword">for</span> err <span class="keyword">in</span> form.password.errors %&#125;</span><br><span class="line">         &lt;p style=<span class="string">&quot;color: red&quot;</span>&gt;&#123;&#123; err &#125;&#125;&lt;/p&gt;</span><br><span class="line">      &#123;% endfor %&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &#123;&#123; form.csrf_token &#125;&#125;</span><br><span class="line">      &#123;&#123; form.submit(<span class="keyword">class</span>=<span class="string">&quot;btn btn-primary&quot;</span>) &#125;&#125;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建表单类</span></span><br><span class="line"><span class="keyword">from</span> flask_wtf <span class="keyword">import</span> FlaskForm</span><br><span class="line"><span class="keyword">from</span> wtforms <span class="keyword">import</span> StringField, PasswordField,SubmitField</span><br><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> DataRequired,Length</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginForm</span>(<span class="title class_ inherited__">FlaskForm</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    登录表单类</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    name = StringField(label=<span class="string">&#x27;用户名&#x27;</span>, validators=[</span><br><span class="line">        DataRequired(<span class="string">&quot;用户名不能为空&quot;</span>),</span><br><span class="line">        Length(<span class="built_in">max</span>=<span class="number">8</span>,<span class="built_in">min</span>=<span class="number">3</span>,message=<span class="string">&quot;用户名长度必须大于3且小于8&quot;</span>)</span><br><span class="line">    ])</span><br><span class="line">    password = PasswordField(label=<span class="string">&#x27;密码&#x27;</span>, validators=[</span><br><span class="line">        DataRequired(<span class="string">&quot;密码不能为空&quot;</span>),</span><br><span class="line">        Length(<span class="built_in">max</span>=<span class="number">10</span>, <span class="built_in">min</span>=<span class="number">6</span>, message=<span class="string">&quot;用户名长度必须大于6且小于10&quot;</span>)</span><br><span class="line">    ])</span><br><span class="line">    submit = SubmitField(label=<span class="string">&quot;提交&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 创建主函数</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask ,url_for,redirect, render_template</span><br><span class="line"><span class="keyword">from</span> models <span class="keyword">import</span> LoginForm</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="string">&#x27;mrsoft&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    登录页面</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    form = LoginForm()  <span class="comment"># 实例化表单对象</span></span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        username = form.name.data</span><br><span class="line">        password = form.password.data</span><br><span class="line">        <span class="keyword">if</span> username== <span class="string">&quot;andy&quot;</span> <span class="keyword">and</span> password == <span class="string">&quot;mrsoft&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>,form=form) <span class="comment"># 渲染页面和表单</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    首页</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    name = <span class="string">&quot;明日学院&quot;</span></span><br><span class="line">    message = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        明日学院，是吉林省明日科技有限公司倾力打造的在线实用技能学习平台，该平台于2016年正式</span></span><br><span class="line"><span class="string">        上线，主要为学习者提供海量、优质的课程，课程结构严谨，用户可以根据自身的学习程度，自主安</span></span><br><span class="line"><span class="string">        排学习进度。我们的宗旨是，为编程学习者提供一站式服务，培养用户的编程思维。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>,name=name,message=message)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="5-13-蓝图"><a href="#5-13-蓝图" class="headerlink" title="5.13.蓝图"></a>5.13.蓝图</h3><p>蓝图是一个存储操作方法的容器，当它被注册到一个应用后，这些操作方法就可以被调用。蓝图很好的简化了大型应用的工作方式，并给Flask扩展提供了在应用上注册操作的核心方法。蓝图对象不能独立运行，必须将他注册到一个应用对象上</p>
<p>使用蓝图的原因：</p>
<ol>
<li>一个应用可以分解为多个蓝图的集合。这对大型应用是理想的，一个项目可以实例化一个应用对象，初始化几个扩展，并注册多个蓝图</li>
<li>对URL前缀&#x2F;子域名，可以在应用上注册一个蓝图。URL前缀&#x2F;子域名中的参数即成为这个蓝图下所有视图函数的共同视图参数(默认情况下)</li>
<li>在一个应用中，用不同的URL规则可以多次注册一个蓝图</li>
<li>通过蓝图可提供模板过滤器、静态文件、模板和其他功能。一个蓝图不一定要实现应用或者视图函数</li>
<li>初始化一个Flask扩展时，需要注册一个蓝图</li>
</ol>
<blockquote>
<p>视图相关联的名称亦称为 <em>端点</em> ，缺省情况下，端点名称与视图函数名称相同。</p>
<p>前文被加入应用工厂的 <code>hello()</code> 视图端点为 <code>&#39;hello&#39;</code> ，可以使用 <code>url_for(&#39;hello&#39;)</code> 来连接。如果视图有参数，后文会看到，那么可使用 <code>url_for(&#39;hello&#39;, who=&#39;World&#39;)</code> 连接。</p>
<p>当使用蓝图的时候，蓝图的名称会添加到函数名称的前面。上面的 <code>login</code> 函数 的端点为 <code>&#39;auth.login&#39;</code> ，因为它已被加入 <code>&#39;auth&#39;</code> 蓝图中。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 蓝图在python包下的__init__文件里面创建</span></span><br><span class="line"><span class="comment"># 创建home蓝图，hone文件夹下的__init__文件</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint</span><br><span class="line"></span><br><span class="line"><span class="comment"># home = Blueprint(&#x27;home&#x27;, __name__, url_prefix=&#x27;/auth&#x27;)</span></span><br><span class="line"><span class="comment"># 也可以直接在创建时加入URL</span></span><br><span class="line">home = Blueprint(<span class="string">&quot;home&quot;</span>,__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建蓝图</span></span><br><span class="line"><span class="meta">@home.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">   <span class="keyword">return</span>  <span class="string">&#x27;&lt;h1&gt;Hello Home!&lt;/h1&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建admin蓝图，admin文件夹下的__init__文件</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建蓝图，第一个参数为蓝图名，第二个为蓝图所在的模块名</span></span><br><span class="line">admin = Blueprint(<span class="string">&quot;admin&quot;</span>,__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@admin.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">   <span class="keyword">return</span>  <span class="string">&#x27;&lt;h1&gt;Hello Admin!&lt;/h1&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 绑定蓝图，在与上两文件夹同级下创建run.py文件</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> app.home <span class="keyword">import</span> home <span class="keyword">as</span> home_blueprint</span><br><span class="line"><span class="keyword">from</span> app.admin <span class="keyword">import</span> admin <span class="keyword">as</span> admin_blueprint</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="comment"># 注册蓝图</span></span><br><span class="line">app.register_blueprint(home_blueprint, url_prefix=<span class="string">&#x27;/home&#x27;</span>)</span><br><span class="line">app.register_blueprint(admin_blueprint, url_prefix=<span class="string">&#x27;/admin&#x27;</span>)</span><br><span class="line"><span class="comment"># 第一个参数为蓝图名称，第二个参数为蓝图的URL前缀</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5-14-重定向和错误"><a href="#5-14-重定向和错误" class="headerlink" title="5.14.重定向和错误"></a>5.14.重定向和错误</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> abort, redirect, url_for,Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="comment"># 使用 abort() 可以 更早退出请求，并返回错误代码</span></span><br><span class="line">    abort(<span class="number">404</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 errorhandler() 装饰器可以定制出错页面</span></span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">404</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">page_not_found</span>(<span class="params">error</span>):</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;page_not_found.html&#x27;</span>), <span class="number">404</span></span><br></pre></td></tr></table></figure>



<h2 id="6-Flask框架进阶"><a href="#6-Flask框架进阶" class="headerlink" title="6.Flask框架进阶"></a>6.Flask框架进阶</h2><p>进阶知识包括Flask的请求和响应、高级模板技术以及和数据库相关的操作</p>
<h3 id="6-1-Flask请求"><a href="#6-1-Flask请求" class="headerlink" title="6.1.Flask请求"></a>6.1.Flask请求</h3><p>使用Request请求对象可以获取请求中各个字段的值</p>
<p>​																		<strong>Request对象的常用属性和方法</strong></p>
<table>
<thead>
<tr>
<th align="center">属性或方法</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">form</td>
<td align="center">一个字典，存储请求提交的所有表单字段</td>
</tr>
<tr>
<td align="center">args</td>
<td align="center">一个字典，存储通过URL查询字符串传递的所有参数</td>
</tr>
<tr>
<td align="center">values</td>
<td align="center">一个字典，form和args的合集</td>
</tr>
<tr>
<td align="center">cookies</td>
<td align="center">一个字典，存储所有请求的cookies</td>
</tr>
<tr>
<td align="center">headers</td>
<td align="center">一个字典，存储所有请求的所有HTTP首部</td>
</tr>
<tr>
<td align="center">files</td>
<td align="center">一个字典，存储请求上传的所有文件</td>
</tr>
<tr>
<td align="center">get_data()</td>
<td align="center">返回请求主体缓冲的数据</td>
</tr>
<tr>
<td align="center">get_json()</td>
<td align="center">返回一个Python字典，包含解析请求主体后得到的JSON</td>
</tr>
<tr>
<td align="center">blueprint</td>
<td align="center">处理请求的Flask蓝本的名称</td>
</tr>
<tr>
<td align="center">endpoint</td>
<td align="center">处理请求的Flask的端点名称</td>
</tr>
<tr>
<td align="center">method</td>
<td align="center">HTTP请求方法，可以是GET或POST</td>
</tr>
<tr>
<td align="center">scheme</td>
<td align="center">URL方案（http或https）</td>
</tr>
<tr>
<td align="center">is_secure()</td>
<td align="center">通过安全的连接(https)发送请求时，返回True</td>
</tr>
<tr>
<td align="center">host</td>
<td align="center">请求定义的主机名，如果客户端定义了端口号，还包括端口号</td>
</tr>
<tr>
<td align="center">path</td>
<td align="center">URL的路径部分</td>
</tr>
<tr>
<td align="center">query_string</td>
<td align="center">URL的查询字符串部分，返回原始二进制值</td>
</tr>
<tr>
<td align="center">full_path</td>
<td align="center">URL的路径和查询字符串部分</td>
</tr>
<tr>
<td align="center">url</td>
<td align="center">客户端请求的完整URL</td>
</tr>
<tr>
<td align="center">base_url</td>
<td align="center">同url，但没有查询字符串部分</td>
</tr>
<tr>
<td align="center">remote_addr</td>
<td align="center">客户端的IP地址</td>
</tr>
<tr>
<td align="center">environ</td>
<td align="center">请求的元素WSGI环境字典</td>
</tr>
</tbody></table>
<h4 id="6-1-1-获取get请求参数"><a href="#6-1-1-获取get请求参数" class="headerlink" title="6.1.1.获取get请求参数"></a>6.1.1.获取get请求参数</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 获取http://127.0.0.1:5000/?name=ande&amp;age=18的name与age值</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    name = request.args.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    age = request.args.get(<span class="string">&#x27;age&#x27;</span>)</span><br><span class="line">    message = <span class="string">f&#x27;姓名：<span class="subst">&#123;name&#125;</span>\n 年龄：<span class="subst">&#123;age&#125;</span>&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> message</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h4 id="6-1-2-获取POST请求参数"><a href="#6-1-2-获取POST请求参数" class="headerlink" title="6.1.2.获取POST请求参数"></a>6.1.2.获取POST请求参数</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 获取表单提交数据</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request,render_template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">        message = <span class="string">f&#x27;用户名是:<span class="subst">&#123;username&#125;</span>&lt;/br&gt;密码是:<span class="subst">&#123;password&#125;</span>&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> message</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 获取表单提交的文件</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> send_from_directory</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request,render_template,redirect,url_for</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">UPLOAD_FOLDER = os.path.join(app.root_path,<span class="string">&#x27;uploads&#x27;</span>)</span><br><span class="line">ALLOWED_EXTENSIONS = <span class="built_in">set</span>([<span class="string">&#x27;png&#x27;</span>, <span class="string">&#x27;jpg&#x27;</span>, <span class="string">&#x27;jpeg&#x27;</span>, <span class="string">&#x27;gif&#x27;</span>])</span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>] = UPLOAD_FOLDER</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">allowed_file</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    判断上传文件类型是否允许</span></span><br><span class="line"><span class="string">    :param filename: 文件名</span></span><br><span class="line"><span class="string">    :return: 布尔值True或False</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;.&#x27;</span> <span class="keyword">in</span> filename <span class="keyword">and</span> \</span><br><span class="line">           filename.rsplit(<span class="string">&#x27;.&#x27;</span>, <span class="number">1</span>)[<span class="number">1</span>] <span class="keyword">in</span> ALLOWED_EXTENSIONS</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">random_file</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    生成随机文件</span></span><br><span class="line"><span class="string">    :param filename: 文件名</span></span><br><span class="line"><span class="string">    :return: 随机文件名</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 获取文件后缀</span></span><br><span class="line">    ext = os.path.splitext(filename)[<span class="number">1</span>]</span><br><span class="line">    <span class="comment"># 使用uuid生成随机字符</span></span><br><span class="line">    new_filename = uuid.uuid4().<span class="built_in">hex</span>+ext</span><br><span class="line">    <span class="keyword">return</span> new_filename</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    头像上传表单页面</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="comment"># 接受头像字段</span></span><br><span class="line">        avatar = request.files[<span class="string">&#x27;avatar&#x27;</span>]</span><br><span class="line">        <span class="comment"># 判断文件是否上传，已经上传文件类型是否正确</span></span><br><span class="line">        <span class="keyword">if</span> avatar <span class="keyword">and</span> allowed_file(avatar.filename):</span><br><span class="line">            <span class="comment"># 生成一个随机文件名</span></span><br><span class="line">            filename = random_file(avatar.filename)</span><br><span class="line">            <span class="comment"># 保存文件</span></span><br><span class="line">            avatar.save(os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], filename))</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;uploaded_file&#x27;</span>,filename=filename))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;upload.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/uploads/&lt;filename&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">uploaded_file</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    显示上传头像</span></span><br><span class="line"><span class="string">    :param filename: 文件名</span></span><br><span class="line"><span class="string">    :return: 真实文件路径</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> send_from_directory(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>],filename)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="6-1-3-请求钩子"><a href="#6-1-3-请求钩子" class="headerlink" title="6.1.3.请求钩子"></a>6.1.3.请求钩子</h4><p>有时需要对请求进行预处理(preprocessing)和后处理(postprocessing),这时可以使用Flask提供的请求钩子(Hook),以注册在请求处理的不同阶段执行的处理函数(或称为回调函数，即Callback)</p>
<p>请求钩子：在执行视图函数前后执行的一些函数，用户可以在这些函数里面做一些操作</p>
<p>Flask利用装饰器提供钩子：</p>
<ol>
<li>before_first_request:在处理第一个请求前执行，如链接数据库操作</li>
<li>before_request:在每次请求前执行，如权限校验</li>
<li>after_request:每次请求之后调用，前提是没有未处理的异常抛出</li>
<li>teardown_request:在每次请求之后调用，即使有未处理的异常抛出</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;视图执行中&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;index page&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.before_first_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">before_first_request</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;before_first_request&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.before_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">before_request</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;before_request&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.after_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">after_request</span>(<span class="params">response</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;after_request&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.teardown_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">teardown_request</span>(<span class="params">error</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;teardown_request:error %s&#x27;</span>%error)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h3 id="6-2-Flask响应"><a href="#6-2-Flask响应" class="headerlink" title="6.2.Flask响应"></a>6.2.Flask响应</h3><h4 id="6-2-1-Response响应对象"><a href="#6-2-1-Response响应对象" class="headerlink" title="6.2.1.Response响应对象"></a>6.2.1.Response响应对象</h4><p>响应在Flask中使用Response对象表示，响应报文大部分内容由服务器处理，大多数情况下只负责返回主体内容。</p>
<p>当你在浏览器输入一个网址时，Flask会先判断是否可以找到与请求URL相匹配的路由，如果没有则返回404响应。如果找到，则调用相应的视图函数。视图函数的返回值构成了响应报文的主体内容，当请求成功时，返回状态码默认为200.</p>
<p>视图函数可以返回最多由三个元素构成的元组：响应主体、状态码和首部字段。</p>
<ol>
<li><p>最常见的响应只包含主体内容</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/index&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">	<span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>还可以返回带状态码的形式</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">404</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">e</span>):</span><br><span class="line">	<span class="keyword">return</span> render_template(<span class="string">&#x27;404.html&#x27;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>有时需要附加或修改某个首部字段</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 生成状态码为3xx的重定向响应，需要将首部中的Location字段设置为重定向的目标URL</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/index&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>,<span class="number">302</span>,&#123;<span class="string">&#x27;Location&#x27;</span>,<span class="string">&#x27;http://www.mingrisoft.com&#x27;</span>&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="6-2-2-响应格式"><a href="#6-2-2-响应格式" class="headerlink" title="6.2.2.响应格式"></a>6.2.2.响应格式</h4><p>在HTTP响应中，数据可以通过多种格式传输。大多数情况下使用HTML格式，这也是Flask中的默认设置。不同的响应数据需要设置不同的MIME类型，MIME类型在首部的Content-Type字段中定义。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 默认的HTML类型</span></span><br><span class="line">Content-<span class="type">Type</span>:text/html;charset=utf8</span><br></pre></td></tr></table></figure>

<p>当需要使用其他格式时，可以通过使用Flask提供的make_response()方法生成响应对象，传入响应主体作为参数，然后使用响应对象的mimetype属性设置MIME类型</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,make_response</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/index&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">	response = make_response(<span class="string">&#x27;Hello,World&#x27;</span>)</span><br><span class="line">	response.mimetype = <span class="string">&#x27;text/plain&#x27;</span></span><br><span class="line">	<span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<p>常用的数据格式有：</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 纯文本：text&#x2F;plain</li>
<li><input checked="" disabled="" type="checkbox"> HTML：text&#x2F;html</li>
<li><input checked="" disabled="" type="checkbox"> XML：application&#x2F;xml</li>
<li><input checked="" disabled="" type="checkbox"> JSON：application&#x2F;json</li>
</ul>
<h4 id="6-2-3-Cookie和Session"><a href="#6-2-3-Cookie和Session" class="headerlink" title="6.2.3.Cookie和Session"></a>6.2.3.Cookie和Session</h4><p><strong>1. Cookies对象</strong></p>
<p>​		HTTP是无状态协议。一次请求响应结束后，服务器不会留下任何关于对方状态的信息。所以就有了Cookie技术，Cookie技术通过在请求和响应报文中添加Cookie数据来保护客户端的状态</p>
<p>​		Cookie指Web服务器为了存储某些数据(如用户信息)而保存在浏览器上的小型文本数据。浏览器会在一定时间内保存它，并在下一次向同一个服务器发送请求时附带这些数据。Cookie通常被用来进行用户会话管理</p>
<p>​		在Flask中，使用Response类提供的set_cookie()方法可以在响应中添加一个cookie，首先使用make_response方法手动生成一个响应对象，传入响应主体作为参数。</p>
<p>​															<strong>内置的Response类的常用属性和方法</strong></p>
<table>
<thead>
<tr>
<th align="center">属性或方法</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">headers</td>
<td align="center">一个Werkzeug的headers对象，表示响应首部，可以像字典一样操作</td>
</tr>
<tr>
<td align="center">status</td>
<td align="center">状态</td>
</tr>
<tr>
<td align="center">status_code</td>
<td align="center">状态码，文本类型</td>
</tr>
<tr>
<td align="center">mimetype</td>
<td align="center">MIME类型</td>
</tr>
<tr>
<td align="center">set_cookie</td>
<td align="center">用来设置cookie</td>
</tr>
<tr>
<td align="center">get_json</td>
<td align="center">解析是否为JSON数据</td>
</tr>
<tr>
<td align="center">is_json</td>
<td align="center">判断是否为JSON数据</td>
</tr>
</tbody></table>
<p>​													<strong>Cookie选项的常用属性说明</strong></p>
<table>
<thead>
<tr>
<th align="center">属性</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">key</td>
<td align="center">cookie的名称</td>
</tr>
<tr>
<td align="center">value</td>
<td align="center">cookie的值</td>
</tr>
<tr>
<td align="center">max_age</td>
<td align="center">cookie被保存的世界，单位为秒。默认在用户会话结束(关闭浏览器)过期</td>
</tr>
<tr>
<td align="center">expires</td>
<td align="center">具体的过期时间，一个datetime对象或UNIX时间戳</td>
</tr>
<tr>
<td align="center">path</td>
<td align="center">下载cookie时只有给定的路径可用，默认为整个域名</td>
</tr>
<tr>
<td align="center">domain</td>
<td align="center">设置cookie可用的域名</td>
</tr>
<tr>
<td align="center">secure</td>
<td align="center">如果为True，只有通过HTTPS才可以使用</td>
</tr>
<tr>
<td align="center">httponly</td>
<td align="center">如果为True，禁止客户端javaScript获取cookie</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request,render_template,make_response</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="comment"># 判断Cookie是否存在</span></span><br><span class="line">    <span class="keyword">if</span> request.cookies.get(<span class="string">&#x27;username&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;欢迎来到首页!&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;请先登录!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="comment"># 验证表单数据</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> username == <span class="string">&#x27;mrsoft&#x27;</span> <span class="keyword">and</span> password == <span class="string">&#x27;mrsoft&#x27;</span>:</span><br><span class="line">            <span class="comment"># 如果用户名和密码正确，将用户名写入Cookie</span></span><br><span class="line">            response = make_response((<span class="string">&#x27;登录成功!&#x27;</span>))    <span class="comment"># 获取response对象</span></span><br><span class="line">            response.set_cookie(<span class="string">&#x27;username&#x27;</span>, username) <span class="comment"># 将用户名写入Cookie</span></span><br><span class="line">            <span class="keyword">return</span> response <span class="comment"># 返回response对象</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>) <span class="comment"># 渲染表单页面</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/logout&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    response = make_response((<span class="string">&#x27;退出登录!&#x27;</span>))</span><br><span class="line">    <span class="comment"># 设置Cookie过期时间为0，即删除Cookie</span></span><br><span class="line">    response.set_cookie(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;&#x27;</span>, expires=<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>2. Session对象</strong></p>
<p>​	因为在浏览器中手动添加和修改cookie很容易，所处Flask提供了Session对象以对Cookie数据加密存储</p>
<p>​	Session指用户会话，又称对话，即服务器和客户端&#x2F;浏览器之间或桌面程序和用户之间建立的交互活动</p>
<p>​	Session是一种持久网络协议，通过在用户端和服务器端之间创建关联，起到交换数据包的作用机制。Session在不包含会话层(UDP)或者是无法长时间驻留会话层(http)的传输协议中，会话的维持需要依靠数据参数中的高级别程序</p>
<p>​	在Flask中，Session对象用来加密Cookie。默认情况下，它会把数据存储在浏览器上一个名为Session的cookie李。Session通过密钥对数据进行签名以加密数据，因此需要先设置一个密钥。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 设置密钥</span></span><br><span class="line">app.secret_key = <span class="string">&#x27;asjoaisjdas45as6d4a8sd7&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 使用session判断用户是否登录(在上面代码基础上修改)</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request,render_template,make_response,session,redirect,url_for</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="string">&#x27;mrsoft12345678&#x27;</span> <span class="comment"># 设置秘钥</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> session.get(<span class="string">&#x27;logged_in&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;欢迎来到首页!&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;请先登录!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="comment"># 验证表单数据</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> username == <span class="string">&#x27;mrsoft&#x27;</span> <span class="keyword">and</span> password == <span class="string">&#x27;mrsoft&#x27;</span>:</span><br><span class="line">            session[<span class="string">&#x27;logged_in&#x27;</span>] = <span class="literal">True</span>  <span class="comment"># 写入session</span></span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>) <span class="comment"># 渲染表单页面</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/logout&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    session.pop(<span class="string">&#x27;logged_in&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="6-3-消息闪现"><a href="#6-3-消息闪现" class="headerlink" title="6.3.消息闪现"></a>6.3.消息闪现</h3><p>在开发过程中，经常需要提示用户操作成功或操作失败，针对这种需求，Flask提供了一个非常有用的flask()函数，可以用来闪现需要显示给用户的信息</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 语法格式</span></span><br><span class="line">flask(message,category)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">message：消息内容</span></span><br><span class="line"><span class="string">category：消息类型，用于对不同的消息内容分类处理</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">通过flash函数发送的信息会存储在session对象中，所以需要为程序设置密钥</span></span><br><span class="line"><span class="string">可以通过secret_key属性或配置变量SECRET_KEY进行设置</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建login.html</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">    	<span class="comment"># 定义不同消息类型的格式</span></span><br><span class="line">        .error &#123; color: red &#125;</span><br><span class="line">        .success &#123; color: blue&#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div style=<span class="string">&quot;padding:20px&quot;</span>&gt;</span><br><span class="line">    	<span class="comment"># 使用get_flashed_messages(with_categories=true)获取消息列表</span></span><br><span class="line">        <span class="comment"># 用with限制messages变量的作用域</span></span><br><span class="line">        &#123;% <span class="keyword">with</span> messages = get_flashed_messages(with_categories=true) %&#125;</span><br><span class="line">          &#123;% <span class="keyword">if</span> messages %&#125;</span><br><span class="line">            &lt;ul <span class="keyword">class</span>=flashes&gt;</span><br><span class="line">            &#123;% <span class="keyword">for</span> category, message <span class="keyword">in</span> messages %&#125;</span><br><span class="line">              &lt;li <span class="keyword">class</span>=<span class="string">&quot;&#123;&#123; category &#125;&#125;&quot;</span>&gt;&#123;&#123; message &#125;&#125;&lt;/li&gt;</span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">            &lt;/ul&gt;</span><br><span class="line">          &#123;% endif %&#125;</span><br><span class="line">        &#123;% endwith %&#125;</span><br><span class="line">        &lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;label <span class="keyword">for</span>=<span class="string">&quot;username&quot;</span>&gt;用户名&lt;/label&gt;</span><br><span class="line">                &lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;text&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;username&quot;</span> name=<span class="string">&quot;username&quot;</span> value=<span class="string">&quot;&quot;</span>&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;label <span class="keyword">for</span>=<span class="string">&quot;password&quot;</span>&gt;密&amp;nbsp;&amp;nbsp;&amp;nbsp;码&lt;/label&gt;</span><br><span class="line">                &lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;password&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;password&quot;</span> value=<span class="string">&quot;&quot;</span>&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;button <span class="built_in">type</span>=<span class="string">&quot;submit&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;btn btn-primary&quot;</span>&gt;提交&lt;/button&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建run.py</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request,render_template,redirect,url_for,flash</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="string">&#x27;mrsoft12345678&#x27;</span> <span class="comment"># 设置秘钥</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="comment"># 验证表单数据</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> username == <span class="string">&#x27;mrsoft&#x27;</span> <span class="keyword">and</span> password == <span class="string">&#x27;mrsoft&#x27;</span>:</span><br><span class="line">            flash(<span class="string">&#x27;恭喜您登录成功&#x27;</span>,<span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flash(<span class="string">&#x27;用户名或密码错误&#x27;</span>, <span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>) <span class="comment"># 渲染表单页面</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>





</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">AYO</div><div class="post-copyright__author_desc">天行健，君子以自强不息</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://ayo-al.github.io/2021/11/03/MarkDown/web/pythonweb/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://ayo-al.github.io/2021/11/03/MarkDown/web/pythonweb/')">PythonWeb</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://ayo-al.github.io/2021/11/03/MarkDown/web/pythonweb/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=PythonWeb&amp;url=https://ayo-al.github.io/2021/11/03/MarkDown/web/pythonweb/&amp;pic=https://pic4.zhimg.com/v2-c2b3eb3319d52218753d0ce20bc7c100_r.jpg?_r_=13445130-584a-4005-5481-9a328412423e" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://AYO-Al.github.io" target="_blank">AYO</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Web/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Web<span class="tagsPageCount">2</span></a><a class="post-meta__box__tags" href="/tags/Python/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Python<span class="tagsPageCount">8</span></a><a class="post-meta__box__tags" href="/tags/Flask/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Flask<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://pic1.zhimg.com/v2-37d1dd62d373427b8035891e9fe1653e_r.jpg?source=1940ef5c&amp;_r_=cd92b4ac-a5d5-13ed-cc96-783c40c74024" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/09/20/MarkDown/web/JavaScript/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic2.zhimg.com/v2-264805954c1f033af43e006cb826ab60_r.jpg?source=1940ef5c&amp;_r_=27dff1ed-d31e-cc2a-61f1-d674cc72aeae" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">JavaScript</div></div></a></div><div class="next-post pull-right"><a href="/2022/02/20/MarkDown/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%BD%91/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic2.zhimg.com/v2-264805954c1f033af43e006cb826ab60_r.jpg?source=1940ef5c&amp;_r_=81a05300-2429-c351-76ed-349fa3c4189d" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">计算机网络</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2021/09/20/MarkDown/web/JavaScript/" title="JavaScript"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic2.zhimg.com/v2-264805954c1f033af43e006cb826ab60_r.jpg?source=1940ef5c&_r_=27dff1ed-d31e-cc2a-61f1-d674cc72aeae" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2021-09-20</div><div class="title">JavaScript</div></div></a></div><div><a href="/2021/04/04/MarkDown/python/python%E5%9F%BA%E7%A1%80/%E5%B8%B8%E7%94%A8%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0/" title="Python内置函数"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://th.bing.com/th/id/OIP.IV7LvR2MoBb3y-EKG9uAJAHaEK?rs=1&pid=ImgDetMain&_r_=287231c4-bb7c-b96d-4dcf-aba8d9af0046" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2021-04-04</div><div class="title">Python内置函数</div></div></a></div><div><a href="/2021/06/15/MarkDown/python/python%E5%9F%BA%E7%A1%80/python%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/" title="Python中的垃圾回收机制"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic1.zhimg.com/v2-0cc45f5fda6e8ff79350ec1303835629_r.jpg?source=1940ef5c&_r_=5b989600-1dea-f912-09cb-0da81148be10" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2021-06-15</div><div class="title">Python中的垃圾回收机制</div></div></a></div><div><a href="/2021/09/09/MarkDown/python/%E7%88%AC%E8%99%AB/%E5%A2%9E%E9%87%8F%E5%BC%8F%E7%88%AC%E8%99%AB/" title="增量式爬虫"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://th.bing.com/th/id/OIP.IV7LvR2MoBb3y-EKG9uAJAHaEK?rs=1&pid=ImgDetMain&_r_=80fabf36-02bb-4c95-d9ce-6a0b6b88dfd6" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2021-09-09</div><div class="title">增量式爬虫</div></div></a></div><div><a href="/2021/02/15/MarkDown/python/python%E5%9F%BA%E7%A1%80/python%E5%9F%BA%E7%A1%80/" title="Python"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic4.zhimg.com/v2-c2b3eb3319d52218753d0ce20bc7c100_r.jpg?_r_=9b576a47-2534-bd20-f3b7-f53ed28df997" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2021-02-15</div><div class="title">Python</div></div></a></div><div><a href="/2021/08/17/MarkDown/python/%E7%88%AC%E8%99%AB/%E7%88%AC%E8%99%AB%E5%88%9D%E5%A7%8B/" title="爬虫基础"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic1.zhimg.com/v2-0cc45f5fda6e8ff79350ec1303835629_r.jpg?source=1940ef5c&_r_=fcd892af-1102-e031-a564-9310e51c0ebf" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2021-08-17</div><div class="title">爬虫基础</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-switch"><span class="first-comment">Twikoo</span><span id="switch-btn"></span><span class="second-comment">Waline</span></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div><div><div id="waline-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);"><b style="color:#fff">AYO的知识输出基地，</b><b style="color:#fff">以输出倒逼输入，以输出巩固知识！</b></div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">AYO</h1><div class="author-info__desc">天行健，君子以自强不息</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/AYO-Al" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://juejin.cn/user/3708003152300183" target="_blank" title="JueJin"><i class="anzhiyufont anzhiyu-icon-book"></i></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">#概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-HTML%E5%92%8CCSS%E5%9F%BA%E7%A1%80"><span class="toc-number">2.</span> <span class="toc-text">1.HTML和CSS基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E4%BB%80%E4%B9%88%E6%98%AFWeb"><span class="toc-number">2.1.</span> <span class="toc-text">1.1.什么是Web</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-Web%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83"><span class="toc-number">2.2.</span> <span class="toc-text">1.2.Web应用程序的工作环境</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80"><span class="toc-number">3.</span> <span class="toc-text">2.网络编程基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-TCP-IP%E5%8D%8F%E8%AE%AE"><span class="toc-number">3.1.</span> <span class="toc-text">2.1.TCP&#x2F;IP协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-IP%E5%8D%8F%E8%AE%AE"><span class="toc-number">3.2.</span> <span class="toc-text">2.2.IP协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%A5%97%E6%8E%A5%E5%AD%97%E7%BC%96%E7%A8%8B"><span class="toc-number">3.3.</span> <span class="toc-text">基于传输协议的套接字编程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-TCP%E5%8D%8F%E8%AE%AE"><span class="toc-number">3.4.</span> <span class="toc-text">2.3.TCP协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-UDP%E7%AE%80%E4%BB%8B"><span class="toc-number">3.5.</span> <span class="toc-text">2.4.UDP简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-Socket%E7%AE%80%E4%BB%8B"><span class="toc-number">3.6.</span> <span class="toc-text">2.5.Socket简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-TCP%E7%BC%96%E7%A8%8B"><span class="toc-number">3.7.</span> <span class="toc-text">2.6.TCP编程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-1-TCP%E6%80%BB%E7%BB%93-%E5%BB%BA%E7%AB%8B%E7%AE%80%E6%98%93%E8%81%8A%E5%A4%A9%E5%AE%A4"><span class="toc-number">3.7.1.</span> <span class="toc-text">2.6.1.TCP总结(建立简易聊天室)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-UDP%E7%BC%96%E7%A8%8B"><span class="toc-number">3.8.</span> <span class="toc-text">2.7.UDP编程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-7-1-UDP%E6%A8%A1%E5%9E%8B"><span class="toc-number">3.8.1.</span> <span class="toc-text">2.7.1.UDP模型</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-web%E5%9F%BA%E7%A1%80"><span class="toc-number">4.</span> <span class="toc-text">3.web基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-HTTP%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.1.</span> <span class="toc-text">3.1.HTTP协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-Web%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">4.2.</span> <span class="toc-text">3.2.Web服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-WSGI%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.3.</span> <span class="toc-text">3.3.WSGI接口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-1-%E5%AE%9A%E4%B9%89WSGI%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.3.1.</span> <span class="toc-text">3.3.1.定义WSGI接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-2-%E8%BF%90%E8%A1%8CWSGI%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.3.2.</span> <span class="toc-text">3.3.2.运行WSGI服务</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-ORM%E7%BC%96%E7%A8%8B"><span class="toc-number">4.4.</span> <span class="toc-text">3.4.ORM编程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Web%E6%A1%86%E6%9E%B6%E5%9F%BA%E7%A1%80"><span class="toc-number">5.</span> <span class="toc-text">4.Web框架基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E4%BB%80%E4%B9%88%E6%98%AFWeb%E6%A1%86%E6%9E%B6%EF%BC%9F"><span class="toc-number">5.1.</span> <span class="toc-text">4.1.什么是Web框架？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E5%B8%B8%E7%94%A8%E7%9A%84Python-Web%E6%A1%86%E6%9E%B6"><span class="toc-number">5.2.</span> <span class="toc-text">4.2.常用的Python Web框架</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Flask%E6%A1%86%E6%9E%B6"><span class="toc-number">6.</span> <span class="toc-text">5.Flask框架</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E7%AC%AC%E4%B8%80%E4%B8%AAFlask%E5%BA%94%E7%94%A8"><span class="toc-number">6.1.</span> <span class="toc-text">5.1.第一个Flask应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E5%BC%80%E5%90%AF%E8%B0%83%E8%AF%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.2.</span> <span class="toc-text">5.2.开启调试模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-HTML%E8%BD%AC%E4%B9%89"><span class="toc-number">6.3.</span> <span class="toc-text">5.3.HTML转义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E8%B7%AF%E7%94%B1"><span class="toc-number">6.4.</span> <span class="toc-text">5.4.路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-%E5%8F%98%E9%87%8F%E8%A7%84%E5%88%99"><span class="toc-number">6.5.</span> <span class="toc-text">5.5.变量规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-%E5%94%AF%E4%B8%80%E7%9A%84URL-%E9%87%8D%E5%AE%9A%E5%90%91%E8%A1%8C%E4%B8%BA"><span class="toc-number">6.6.</span> <span class="toc-text">5.6.唯一的URL&#x2F;重定向行为</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-7-%E6%9E%84%E9%80%A0URL"><span class="toc-number">6.7.</span> <span class="toc-text">5.7.构造URL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-8-HTTP%E6%96%B9%E6%B3%95"><span class="toc-number">6.8.</span> <span class="toc-text">5.8.HTTP方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-9-%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6"><span class="toc-number">6.9.</span> <span class="toc-text">5.9.静态文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-11-%E6%B8%B2%E6%9F%93%E6%A8%A1%E6%9D%BF"><span class="toc-number">6.10.</span> <span class="toc-text">5.11.渲染模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-12-Web%E8%A1%A8%E5%8D%95"><span class="toc-number">6.11.</span> <span class="toc-text">5.12.Web表单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-13-%E8%93%9D%E5%9B%BE"><span class="toc-number">6.12.</span> <span class="toc-text">5.13.蓝图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-14-%E9%87%8D%E5%AE%9A%E5%90%91%E5%92%8C%E9%94%99%E8%AF%AF"><span class="toc-number">6.13.</span> <span class="toc-text">5.14.重定向和错误</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-Flask%E6%A1%86%E6%9E%B6%E8%BF%9B%E9%98%B6"><span class="toc-number">7.</span> <span class="toc-text">6.Flask框架进阶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-Flask%E8%AF%B7%E6%B1%82"><span class="toc-number">7.1.</span> <span class="toc-text">6.1.Flask请求</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-1-%E8%8E%B7%E5%8F%96get%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0"><span class="toc-number">7.1.1.</span> <span class="toc-text">6.1.1.获取get请求参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-2-%E8%8E%B7%E5%8F%96POST%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0"><span class="toc-number">7.1.2.</span> <span class="toc-text">6.1.2.获取POST请求参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-3-%E8%AF%B7%E6%B1%82%E9%92%A9%E5%AD%90"><span class="toc-number">7.1.3.</span> <span class="toc-text">6.1.3.请求钩子</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-Flask%E5%93%8D%E5%BA%94"><span class="toc-number">7.2.</span> <span class="toc-text">6.2.Flask响应</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-1-Response%E5%93%8D%E5%BA%94%E5%AF%B9%E8%B1%A1"><span class="toc-number">7.2.1.</span> <span class="toc-text">6.2.1.Response响应对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-%E5%93%8D%E5%BA%94%E6%A0%BC%E5%BC%8F"><span class="toc-number">7.2.2.</span> <span class="toc-text">6.2.2.响应格式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-3-Cookie%E5%92%8CSession"><span class="toc-number">7.2.3.</span> <span class="toc-text">6.2.3.Cookie和Session</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E6%B6%88%E6%81%AF%E9%97%AA%E7%8E%B0"><span class="toc-number">7.3.</span> <span class="toc-text">6.3.消息闪现</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/06/20/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/ELK%E6%97%A5%E5%BF%97%E5%B9%B3%E5%8F%B0/" title="ELK"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic1.zhimg.com/v2-37d1dd62d373427b8035891e9fe1653e_r.jpg?source=1940ef5c&amp;_r_=cd92b4ac-a5d5-13ed-cc96-783c40c74024" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ELK"/></a><div class="content"><a class="title" href="/2024/06/20/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/ELK%E6%97%A5%E5%BF%97%E5%B9%B3%E5%8F%B0/" title="ELK">ELK</a><time datetime="2024-06-19T16:00:00.000Z" title="发表于 2024-06-20 00:00:00">2024-06-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/01/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Nginx/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" title="Nginx反向代理配置"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://th.bing.com/th/id/R.d8dfd08893b58d08d74b38ad8870a48d?rik=9KBqff6Rai035Q&amp;riu=http%3A%2F%2Fstatic.cntonan.com%2Fuploadfile%2F2019%2F0214%2F20190214104244pwm1xxsdikh.jpg&amp;ehk=MOxI2n5nY44gO%2FKsNYWAuEBvcRwSmkRVNb4dTS6Gk%2BY%3D&amp;risl=&amp;pid=ImgRaw&amp;r=0&amp;_r_=0911bb0f-74f3-7759-0647-50656ae83740" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nginx反向代理配置"/></a><div class="content"><a class="title" href="/2024/06/01/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Nginx/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" title="Nginx反向代理配置">Nginx反向代理配置</a><time datetime="2024-05-31T16:00:00.000Z" title="发表于 2024-06-01 00:00:00">2024-06-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/27/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Nginx/Nginx-all/" title="Nginx模块"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic2.zhimg.com/v2-264805954c1f033af43e006cb826ab60_r.jpg?source=1940ef5c&amp;_r_=25354333-95d5-ebb9-fd70-825cf6ef2a11" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nginx模块"/></a><div class="content"><a class="title" href="/2024/05/27/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Nginx/Nginx-all/" title="Nginx模块">Nginx模块</a><time datetime="2024-05-26T16:00:00.000Z" title="发表于 2024-05-27 00:00:00">2024-05-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/22/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%8E%E7%A3%81%E7%9B%98/" title="Linux文件系统与磁盘"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/preview.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux文件系统与磁盘"/></a><div class="content"><a class="title" href="/2024/05/22/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%8E%E7%A3%81%E7%9B%98/" title="Linux文件系统与磁盘">Linux文件系统与磁盘</a><time datetime="2024-05-21T16:00:00.000Z" title="发表于 2024-05-22 00:00:00">2024-05-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/11/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/%E9%98%B2%E7%81%AB%E5%A2%99/" title="Linux防火墙"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://th.bing.com/th/id/OIP.IV7LvR2MoBb3y-EKG9uAJAHaEK?rs=1&amp;pid=ImgDetMain&amp;_r_=a2b8a349-91b5-2a7a-7e38-ea3a5d089768" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux防火墙"/></a><div class="content"><a class="title" href="/2024/05/11/MarkDown/%E4%BA%91%E8%AE%A1%E7%AE%97/Linux/%E9%98%B2%E7%81%AB%E5%A2%99/" title="Linux防火墙">Linux防火墙</a><time datetime="2024-05-10T16:00:00.000Z" title="发表于 2024-05-11 00:00:00">2024-05-11</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="/2609320892@qq.com" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://regexlearn.com/zh-cn" title="Regex 101"><i class="anzhiyufont anzhiyu-icon-font"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://regexcrossword.com/" title="Regexcrossword"><i class="anzhiyufont anzhiyu-icon-bolt"></i></a><a class="deal_link" href="/atom.xml" title="RSS"><i class="anzhiyufont anzhiyu-icon-rss"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0, 500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" size="50px"/><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/AYO-Al" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://learngitbranching.js.org/?demo=&amp;locale=zh_CN" title="Learn Git"><i class="anzhiyufont anzhiyu-icon-pencil"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://www.drawio.com/" title="draw.io"><i class="anzhiyufont anzhiyu-icon-instagram"></i></a><a class="deal_link" href="/copyright" title="CC"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i></a></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="algolia" target="_blank" rel="noopener" href="https://www.algolia.com/">algolia</a><a class="footer-item" title="twikoo" target="_blank" rel="noopener" href="https://twikoo.js.org/">twikoo</a><a class="footer-item" title="vercel" target="_blank" rel="noopener" href="https://vercel.com/">vercel</a></div></div><div class="footer-group"><div class="footer-title">主题</div><div class="footer-links"><a class="footer-item" title="文档" target="_blank" rel="noopener" href="https://docs.anheyu.com/">文档</a><a class="footer-item" title="源码" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu">源码</a><a class="footer-item" title="更新日志" target="_blank" rel="noopener" href="https://blog.anheyu.com/update/">更新日志</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="即刻短文" href="/essay/">即刻短文</a><a class="footer-item" title="友链文章" href="/fcircle/">友链文章</a><a class="footer-item" title="留言板" href="/comments/">留言板</a></div></div><div class="footer-group"><div class="footer-title">协议</div><div class="footer-links"><a class="footer-item" title="隐私协议" href="/privacy/">隐私协议</a><a class="footer-item" title="Cookies" href="/cookies/">Cookies</a><a class="footer-item" title="版权协议" href="/copyright/">版权协议</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v7.0.0" title="博客框架为Hexo_v7.0.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v7.0.0"/></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"/></a><a class="github-badge" target="_blank" href="https://www.dogecloud.com/" style="margin-inline:5px" data-title="本站使用多吉云为静态资源提供CDN加速" title="本站使用多吉云为静态资源提供CDN加速"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/CDN-多吉云-3693F3.svg" alt="本站使用多吉云为静态资源提供CDN加速"/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="本站项目由Github托管"/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2021 - 2024 By <a class="footer-bar-link" href="/" title="AYO" target="_blank">AYO</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      if (true) {
        const from = '出自 ' + data.from
        const sub = ["生活明朗&#44; 万物可爱&#44; 人间值得&#44; 未来可期."]
        sub.unshift(data.hitokoto, from)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = data.hitokoto
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.cbd.int/typed.js@2.0.15/dist/typed.umd.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/AYO-Al/AYO-Al.github.io" title="博客">博客</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/AYO-Al" title="本站项目由GitHub托管">本站项目由GitHub托管</a><a class="footer-bar-link cc" href="/copyright" title="cc协议"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-by-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nc-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nd-line"></i></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">52</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">45</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">8</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://git.yuki.love/" title="AYO网站"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="AYO网站"/><span class="back-menu-item-text">AYO网站</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://juejin.cn/user/3708003152300183" title="AYO博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="AYO博客"/><span class="back-menu-item-text">AYO博客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/AYO-Al" title="GitHub"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="GitHub"/><span class="back-menu-item-text">GitHub</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Ansible/" style="font-size: 0.88rem;">Ansible<sup>1</sup></a><a href="/tags/CDN/" style="font-size: 0.88rem;">CDN<sup>1</sup></a><a href="/tags/DNS/" style="font-size: 0.88rem;">DNS<sup>1</sup></a><a href="/tags/Database/" style="font-size: 0.88rem;">Database<sup>8</sup></a><a href="/tags/Docker/" style="font-size: 0.88rem;">Docker<sup>1</sup></a><a href="/tags/ELK/" style="font-size: 0.88rem;">ELK<sup>1</sup></a><a href="/tags/Flask/" style="font-size: 0.88rem;">Flask<sup>1</sup></a><a href="/tags/Httpd/" style="font-size: 0.88rem;">Httpd<sup>1</sup></a><a href="/tags/JavaScript/" style="font-size: 0.88rem;">JavaScript<sup>1</sup></a><a href="/tags/Keepalived/" style="font-size: 0.88rem;">Keepalived<sup>1</sup></a><a href="/tags/LVS/" style="font-size: 0.88rem;">LVS<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>22</sup></a><a href="/tags/MLinux/" style="font-size: 0.88rem;">MLinux<sup>1</sup></a><a href="/tags/MySQL/" style="font-size: 0.88rem;">MySQL<sup>6</sup></a><a href="/tags/Nginx/" style="font-size: 0.88rem;">Nginx<sup>3</sup></a><a href="/tags/Prometheus/" style="font-size: 0.88rem;">Prometheus<sup>1</sup></a><a href="/tags/Python/" style="font-size: 0.88rem;">Python<sup>8</sup></a><a href="/tags/Rabbit/" style="font-size: 0.88rem;">Rabbit<sup>1</sup></a><a href="/tags/Redis/" style="font-size: 0.88rem;">Redis<sup>2</sup></a><a href="/tags/Shell/" style="font-size: 0.88rem;">Shell<sup>3</sup></a><a href="/tags/Web/" style="font-size: 0.88rem;">Web<sup>2</sup></a><a href="/tags/Zabbix/" style="font-size: 0.88rem;">Zabbix<sup>2</sup></a><a href="/tags/%E4%B8%89%E9%AB%98MySQL/" style="font-size: 0.88rem;">三高MySQL<sup>1</sup></a><a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 0.88rem;">中间件<sup>1</sup></a><a href="/tags/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" style="font-size: 0.88rem;">主从复制<sup>1</sup></a><a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" style="font-size: 0.88rem;">云计算<sup>7</sup></a><a href="/tags/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" style="font-size: 0.88rem;">反向代理<sup>1</sup></a><a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 0.88rem;">开发<sup>7</sup></a><a href="/tags/%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB%E6%9C%8D%E5%8A%A1/" style="font-size: 0.88rem;">文件共享服务<sup>1</sup></a><a href="/tags/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" style="font-size: 0.88rem;">文件系统<sup>1</sup></a><a href="/tags/%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/" style="font-size: 0.88rem;">日志管理<sup>1</sup></a><a href="/tags/%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5/" style="font-size: 0.88rem;">时间同步<sup>1</sup></a><a href="/tags/%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/" style="font-size: 0.88rem;">服务管理<sup>1</sup></a><a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 0.88rem;">爬虫<sup>4</sup></a><a href="/tags/%E7%9B%91%E6%8E%A7/" style="font-size: 0.88rem;">监控<sup>3</sup></a><a href="/tags/%E7%A3%81%E7%9B%98/" style="font-size: 0.88rem;">磁盘<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 0.88rem;">网络<sup>3</sup></a><a href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/" style="font-size: 0.88rem;">自动化运维<sup>1</sup></a><a href="/tags/%E8%BD%AF%E4%BB%B6%E7%AE%A1%E7%90%86/" style="font-size: 0.88rem;">软件管理<sup>1</sup></a><a href="/tags/%E9%98%B2%E7%81%AB%E5%A2%99/" style="font-size: 0.88rem;">防火墙<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"><a class="tag-list" href="/tags/Linux" title="Linux">Linux</a><a class="tag-list" href="/tags/Database" title="Database">Database</a><a class="tag-list" href="/tags/Kubernetes" title="Kubernetes">Kubernetes</a></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.4/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2021 By 安知鱼 V1.6.10",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 AYO 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.56.5/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.yuki.love',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.yuki.love',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><script>(() => {
  const initWaline = () => {
    const waline = Waline.init(Object.assign({
      el: '#waline-wrap',
      serverURL: '',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: false,
    }, null))
  }

  const loadWaline = async () => {
    if (typeof Waline === 'object') initWaline()
    else {
      await getCSS('https://cdn.cbd.int/@waline/client@2.15.5/dist/waline.css')
      await getScript('https://cdn.cbd.int/@waline/client@2.15.5/dist/waline.js')
      initWaline()
    }
  }

  if ('Twikoo' === 'Waline' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo.yuki.love',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "visitor@anheyu.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/fireworks.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>